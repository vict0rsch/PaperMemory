!function r(i,o,n){function s(t,e){if(!o[t]){if(!i[t]){var a="function"==typeof require&&require;if(!e&&a)return a(t,!0);if(l)return l(t,!0);throw(e=new Error("Cannot find module '"+t+"'")).code="MODULE_NOT_FOUND",e}a=o[t]={exports:{}},i[t][0].call(a.exports,function(e){return s(i[t][1][e]||e)},a,a.exports,r,i,o,n)}return o[t].exports}for(var l="function"==typeof require&&require,e=0;e<n.length;e++)s(n[e]);return s}({1:[function(e,t,a){var r,i,t=t.exports={};function o(){throw new Error("setTimeout has not been defined")}function n(){throw new Error("clearTimeout has not been defined")}try{r="function"==typeof setTimeout?setTimeout:o}catch(e){r=o}try{i="function"==typeof clearTimeout?clearTimeout:n}catch(e){i=n}function s(t){if(r===setTimeout)return setTimeout(t,0);if((r===o||!r)&&setTimeout)return(r=setTimeout)(t,0);try{return r(t,0)}catch(e){try{return r.call(null,t,0)}catch(e){return r.call(this,t,0)}}}var l,p=[],c=!1,d=-1;function u(){c&&l&&(c=!1,l.length?p=l.concat(p):d=-1,p.length)&&h()}function h(){if(!c){for(var e=s(u),t=(c=!0,p.length);t;){for(l=p,p=[];++d<t;)l&&l[d].run();d=-1,t=p.length}l=null,c=!1,!function(t){if(i===clearTimeout)return clearTimeout(t);if((i===n||!i)&&clearTimeout)return(i=clearTimeout)(t);try{i(t)}catch(e){try{return i.call(null,t)}catch(e){return i.call(this,t)}}}(e)}}function f(e,t){this.fun=e,this.array=t}function m(){}t.nextTick=function(e){var t=new Array(arguments.length-1);if(1<arguments.length)for(var a=1;a<arguments.length;a++)t[a-1]=arguments[a];p.push(new f(e,t)),1!==p.length||c||s(h)},f.prototype.run=function(){this.fun.apply(null,this.array)},t.title="browser",t.browser=!0,t.env={},t.argv=[],t.version="",t.versions={},t.on=m,t.addListener=m,t.once=m,t.off=m,t.removeListener=m,t.removeAllListeners=m,t.emit=m,t.prependListener=m,t.prependOnceListener=m,t.listeners=function(e){return[]},t.binding=function(e){throw new Error("process.binding is not supported")},t.cwd=function(){return"/"},t.chdir=function(e){throw new Error("process.chdir is not supported")},t.umask=function(){return 0}},{}],2:[function(e,t,a){Object.defineProperty(a,"__esModule",{value:!0});e="octokit-endpoint.js/9.0.4 "+(a.endpoint=void 0,e("universal-user-agent").getUserAgent)();function s(t,a){let r=Object.assign({},t);return Object.keys(a).forEach(e=>{(e=>{var t;return"object"==typeof e&&null!==e&&"[object Object]"===Object.prototype.toString.call(e)&&(null===(t=Object.getPrototypeOf(e))||"function"==typeof(t=Object.prototype.hasOwnProperty.call(t,"constructor")&&t.constructor)&&t instanceof t&&Function.prototype.call(t)===Function.prototype.call(e))})(a[e])&&e in t?r[e]=s(t[e],a[e]):Object.assign(r,{[e]:a[e]})}),r}function l(e){for(var t in e)void 0===e[t]&&delete e[t]}function r(e,t,a){var r,i,o;(a="string"==typeof t?([r,i]=t.split(" "),Object.assign(i?{method:r,url:i}:{url:r},a)):Object.assign({},t)).headers=(o=a.headers)?Object.keys(o).reduce((e,t)=>(e[t.toLowerCase()]=o[t],e),{}):{},l(a),l(a.headers);let n=s(e||{},a);return"/graphql"===a.url&&(e&&e.mediaType.previews?.length&&(n.mediaType.previews=e.mediaType.previews.filter(e=>!n.mediaType.previews.includes(e)).concat(n.mediaType.previews)),n.mediaType.previews=(n.mediaType.previews||[]).map(e=>e.replace(/-preview/,""))),n}var d=/\{[^}]+\}/g;function u(e){return e.replace(/^\W+|\W+$/g,"").split(/,/)}function h(e,t){var a,r={__proto__:null};for(a of Object.keys(e))-1===t.indexOf(a)&&(r[a]=e[a]);return r}function n(e){return e.split(/(%[0-9A-Fa-f]{2})/g).map(function(e){return e=/%[0-9A-Fa-f]/.test(e)?e:encodeURI(e).replace(/%5B/g,"[").replace(/%5D/g,"]")}).join("")}function p(e){return encodeURIComponent(e).replace(/[!'()*]/g,function(e){return"%"+e.charCodeAt(0).toString(16).toUpperCase()})}function c(e,t,a){return t=("+"===e||"#"===e?n:p)(t),a?p(a)+"="+t:t}function f(e){return null!=e}function m(e){return";"===e||"&"===e||"?"===e}function g(e){return{expand:function(e,i){var o=["+","#",".","/",";","?","&"];return"/"===(e=e.replace(/\{([^\{\}]+)\}|([^\{\}]+)/g,function(e,r,t){if(r){let t="",a=[];return-1!==o.indexOf(r.charAt(0))&&(t=r.charAt(0),r=r.substr(1)),r.split(/,/g).forEach(function(e){e=/([^:\*]*)(?::(\d+)|(\*))?/.exec(e);a.push(((e,a,r,t)=>{var i=e[r],o=[];if(f(i)&&""!==i)if("string"==typeof i||"number"==typeof i||"boolean"==typeof i)i=i.toString(),t&&"*"!==t&&(i=i.substring(0,parseInt(t,10))),o.push(c(a,i,m(a)?r:""));else if("*"===t)Array.isArray(i)?i.filter(f).forEach(function(e){o.push(c(a,e,m(a)?r:""))}):Object.keys(i).forEach(function(e){f(i[e])&&o.push(c(a,i[e],e))});else{let t=[];Array.isArray(i)?i.filter(f).forEach(function(e){t.push(c(a,e))}):Object.keys(i).forEach(function(e){f(i[e])&&(t.push(p(e)),t.push(c(a,i[e].toString())))}),m(a)?o.push(p(r)+"="+t.join(",")):0!==t.length&&o.push(t.join(","))}else";"===a?f(i)&&o.push(p(r)):""!==i||"&"!==a&&"?"!==a?""===i&&o.push(""):o.push(p(r)+"=");return o})(i,t,e[1],e[2]||e[3]))}),t&&"+"!==t?(r=",","?"===t?r="&":"#"!==t&&(r=t),(0!==a.length?t:"")+a.join(r)):a.join(",")}return n(t)}))?e:e.replace(/\/$/,"")}.bind(null,e)}}function i(t){var e=t.method.toUpperCase();let a=(t.url||"/").replace(/:([a-z]\w+)/g,"{$1}");var r=Object.assign({},t.headers);let i;var o=h(t,["method","baseUrl","url","headers","request","mediaType"]);let n=(c=(c=a).match(d))?c.map(u).reduce((e,t)=>e.concat(t),[]):[];a=g(a).expand(o),/^http/.test(a)||(a=t.baseUrl+a);var s,l,p,c=h(o,Object.keys(t).filter(e=>n.includes(e)).concat("baseUrl"));return/application\/octet-stream/i.test(r.accept)||(t.mediaType.format&&(r.accept=r.accept.split(/,/).map(e=>e.replace(/application\/vnd(\.\w+)(\.v3)?(\.\w+)?(\+json)?$/,"application/vnd$1$2."+t.mediaType.format)).join(",")),a.endsWith("/graphql")&&t.mediaType.previews?.length&&(o=r.accept.match(/[\w-]+(?=-preview)/g)||[],r.accept=o.concat(t.mediaType.previews).map(e=>`application/vnd.github.${e}-preview`+(t.mediaType.format?"."+t.mediaType.format:"+json")).join(","))),["GET","HEAD"].includes(e)?a=(o=a,s=c,l=/\?/.test(o)?"&":"?",0===(p=Object.keys(s)).length?o:o+l+p.map(e=>"q"===e?"q="+s.q.split("+").map(encodeURIComponent).join("+"):e+"="+encodeURIComponent(s[e])).join("&")):"data"in c?i=c.data:Object.keys(c).length&&(i=c),r["content-type"]||void 0===i||(r["content-type"]="application/json; charset=utf-8"),["PATCH","PUT"].includes(e)&&void 0===i&&(i=""),Object.assign({method:e,url:a,headers:r},void 0!==i?{body:i}:null,t.request?{request:t.request}:null)}function o(e,t){e=r(e,t),t=function(e,t,a){return i(r(e,t,a))}.bind(null,e);return Object.assign(t,{DEFAULTS:e,defaults:o.bind(null,e),merge:r.bind(null,e),parse:i})}a.endpoint=o(null,{method:"GET",baseUrl:"https://api.github.com",headers:{accept:"application/vnd.github.v3+json","user-agent":e},mediaType:{format:""}})},{"universal-user-agent":7}],3:[function(e,t,a){Object.defineProperty(a,"__esModule",{value:!0}),a.RequestError=void 0;var i=e("deprecation"),e=(e=e("once"))&&e.__esModule?e:{default:e};var o=(0,e.default)(e=>console.warn(e)),n=(0,e.default)(e=>console.warn(e)),e=class extends Error{constructor(e,t,a){super(e),Error.captureStackTrace&&Error.captureStackTrace(this,this.constructor),this.name="HttpError",this.status=t;let r;"headers"in a&&void 0!==a.headers&&(r=a.headers),"response"in a&&(this.response=a.response,r=a.response.headers);e=Object.assign({},a.request);a.request.headers.authorization&&(e.headers=Object.assign({},a.request.headers,{authorization:a.request.headers.authorization.replace(/ .*$/," [REDACTED]")})),e.url=e.url.replace(/\bclient_secret=\w+/g,"client_secret=[REDACTED]").replace(/\baccess_token=\w+/g,"access_token=[REDACTED]"),this.request=e,Object.defineProperty(this,"code",{get(){return o(new i.Deprecation("[@octokit/request-error] `error.code` is deprecated, use `error.status`.")),t}}),Object.defineProperty(this,"headers",{get(){return n(new i.Deprecation("[@octokit/request-error] `error.headers` is deprecated, use `error.response.headers`.")),r||{}}})}};a.RequestError=e},{deprecation:5,once:6}],4:[function(e,t,a){Object.defineProperty(a,"__esModule",{value:!0}),a.request=void 0;var r=e("@octokit/endpoint"),i=e("universal-user-agent"),p=e("@octokit/request-error");function o(r){let i=r.request&&r.request.log?r.request.log:console,o=!1!==r.request?.parseSuccessResponseBody,n=(((e=>{var t;return"object"==typeof e&&null!==e&&"[object Object]"===Object.prototype.toString.call(e)&&(null===(t=Object.getPrototypeOf(e))||"function"==typeof(t=Object.prototype.hasOwnProperty.call(t,"constructor")&&t.constructor)&&t instanceof t&&Function.prototype.call(t)===Function.prototype.call(e))})(r.body)||Array.isArray(r.body))&&(r.body=JSON.stringify(r.body)),{}),s,l,e=globalThis.fetch;if(e=r.request?.fetch?r.request.fetch:e)return e(r.url,{method:r.method,body:r.body,headers:r.headers,signal:r.request?.signal,...r.body&&{duplex:"half"}}).then(async e=>{l=e.url,s=e.status;for(var t of e.headers)n[t[0]]=t[1];var a;if("deprecation"in n&&(a=(a=n.link&&n.link.match(/<([^>]+)>; rel="deprecation"/))&&a.pop(),i.warn(`[@octokit/request] "${r.method} ${r.url}" is deprecated. It is scheduled to be removed on `+n.sunset+(a?". See "+a:""))),204!==s&&205!==s){if("HEAD"===r.method){if(s<400)return;throw new p.RequestError(e.statusText,s,{response:{url:l,status:s,headers:n,data:void 0},request:r})}if(304===s)throw new p.RequestError("Not modified",s,{response:{url:l,status:s,headers:n,data:await c(e)},request:r});if(400<=s)throw a=await c(e),new p.RequestError((e=>"string"==typeof e?e:"message"in e?Array.isArray(e.errors)?e.message+": "+e.errors.map(JSON.stringify).join(", "):e.message:"Unknown error: "+JSON.stringify(e))(a),s,{response:{url:l,status:s,headers:n,data:a},request:r});return o?await c(e):e.body}}).then(e=>({status:s,url:l,headers:n,data:e})).catch(e=>{if(e instanceof p.RequestError)throw e;if("AbortError"===e.name)throw e;let t=e.message;throw"TypeError"===e.name&&"cause"in e&&(e.cause instanceof Error?t=e.cause.message:"string"==typeof e.cause&&(t=e.cause)),new p.RequestError(t,500,{request:r})});throw new Error("fetch is not set. Please pass a fetch implementation as new Octokit({ request: { fetch }}). Learn more at https://github.com/octokit/octokit.js/#fetch-missing")}async function c(e){var t=e.headers.get("content-type");return/application\/json/.test(t)?e.json().catch(()=>e.text()).catch(()=>""):!t||/^text\/|charset=utf-8$/.test(t)?e.text():e.arrayBuffer()}function n(e,t){let a=e.defaults(t);return Object.assign(function(e,t){e=a.merge(e,t);return e.request&&e.request.hook?(t=(e,t)=>o(a.parse(a.merge(e,t))),Object.assign(t,{endpoint:a,defaults:n.bind(null,a)}),e.request.hook(t,e)):o(a.parse(e))},{endpoint:a,defaults:n.bind(null,a)})}a.request=n(r.endpoint,{headers:{"user-agent":"octokit-request.js/8.1.6 "+(0,i.getUserAgent)()}})},{"@octokit/endpoint":2,"@octokit/request-error":3,"universal-user-agent":7}],5:[function(e,t,a){Object.defineProperty(a,"__esModule",{value:!0}),a.Deprecation=void 0;class r extends Error{constructor(e){super(e),Error.captureStackTrace&&Error.captureStackTrace(this,this.constructor),this.name="Deprecation"}}a.Deprecation=r},{}],6:[function(e,t,a){e=e("wrappy");function r(e){function t(){return t.called?t.value:(t.called=!0,t.value=e.apply(this,arguments))}return t.called=!1,t}function i(e){function t(){if(t.called)throw new Error(t.onceError);return t.called=!0,t.value=e.apply(this,arguments)}var a=e.name||"Function wrapped with `once`";return t.onceError=a+" shouldn't be called more than once",t.called=!1,t}t.exports=e(r),t.exports.strict=e(i),r.proto=r(function(){Object.defineProperty(Function.prototype,"once",{value:function(){return r(this)},configurable:!0}),Object.defineProperty(Function.prototype,"onceStrict",{value:function(){return i(this)},configurable:!0})})},{wrappy:8}],7:[function(e,t,a){!function(e){!function(){Object.defineProperty(a,"__esModule",{value:!0}),a.getUserAgent=function(){if("object"==typeof navigator&&"userAgent"in navigator)return navigator.userAgent;return"object"!=typeof e||void 0===e.version?"<environment undetectable>":`Node.js/${e.version.substr(1)} (${e.platform}; ${e.arch})`}}.call(this)}.call(this,e("_process"))},{_process:1}],8:[function(e,t,a){t.exports=function e(i,t){if(i&&t)return e(i)(t);if("function"!=typeof i)throw new TypeError("need wrapper function");Object.keys(i).forEach(function(e){a[e]=i[e]});return a;function a(){for(var e=new Array(arguments.length),t=0;t<e.length;t++)e[t]=arguments[t];var a=i.apply(this,e),r=e[e.length-1];return"function"==typeof a&&a!==r&&Object.keys(r).forEach(function(e){a[e]=r[e]}),a}}},{}],9:[function(a,e,t){!function(t){!function(){var e=a("@octokit/request").request;"undefined"==typeof window?window=t:t=window,t.octokitRequest=e}.call(this)}.call(this,void 0!==global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"@octokit/request":4}]},{},[9]);let findEl=(e,t)=>void 0===t?"string"==typeof e?document.getElementById(e):e:(t.startsWith(".")||(t="."+t),findEl("memory-container--"+e).querySelector(t)),fadeOut=(e,t=250,a=()=>{})=>{(e=findEl(e)).style.transition=t+"ms",e.style.opacity=0,setTimeout(()=>{e.style.display="none",a()},t)},fadeIn=(e,t="block",a=250,r=()=>{})=>{(e=findEl(e)).style.opacity=0,"none"===e.style.display&&(e.style.display=t),setTimeout(()=>{e.style.transition=a+"ms",e.style.opacity=1,setTimeout(()=>{r()},a)},0)},val=(e,t)=>{if((e="string"==typeof e?findEl(e):e)instanceof HTMLInputElement&&"checkbox"===e.type){if(void 0===t)return e.checked;e.checked=t}if(void 0===t)return e?e.value:"";e&&(e.value=t)},showId=(e,t="block")=>{(e="string"==typeof e?findEl(e):e)&&(e.style.display=t)},hideId=e=>{(e="string"==typeof e?findEl(e):e)&&(e.style.display="none")},setTextId=(e,t)=>{(e="string"==typeof e?findEl(e):e)&&(e.innerText=t)},setHTML=(e,t)=>{(e="string"==typeof e?findEl(e):e)&&(e.innerHTML=t)},dispatch=(e,t)=>{if("string"==typeof e&&(e=findEl(e)),"string"==typeof t){if("focus"===t)return void e.focus();if("blur"===t)return void e.blur();t=new Event(t)}e&&e.dispatchEvent(t)},hasClass=(e,t)=>{let a;if(a="string"==typeof e?findEl(e):e)return a.classList.contains(t)},addClass=(e,t)=>{let a;(a="string"==typeof e?findEl(e):e)&&a.classList.add(t)},removeClass=(e,t)=>{let a;(a="string"==typeof e?findEl(e):e)&&a.classList.remove(t)},addListener=(e,t,a)=>{(e="string"==typeof e?findEl(e):e)&&e.addEventListener(t,a)},setPlaceholder=(e,t)=>{(e="string"==typeof e?findEl(e):e)&&void 0!==e.placeholder&&(e.placeholder=t)},style=(e,t,a)=>{if(e="string"==typeof e?findEl(e):e){if(void 0===a)return e.style[t];e.style[t]=a}},disable=(e,t=!0)=>{(e="string"==typeof e?findEl(e):e)&&(e.disabled=t)},slideUp=(e,t=250,a=()=>{})=>{(e="string"==typeof e?findEl(e):e)&&(e.style.transitionProperty="height, margin, padding",e.style.transitionDuration=t+"ms",e.style.height=e.offsetHeight+"px",e.offsetHeight,e.style.overflow="hidden",e.style.height=0,e.style.paddingTop=0,e.style.paddingBottom=0,e.style.marginTop=0,e.style.marginBottom=0,window.setTimeout(()=>{e.style.display="none",e.style.removeProperty("height"),e.style.removeProperty("padding-top"),e.style.removeProperty("padding-bottom"),e.style.removeProperty("margin-top"),e.style.removeProperty("margin-bottom"),e.style.removeProperty("overflow"),e.style.removeProperty("transition-duration"),e.style.removeProperty("transition-property"),e.style.removeProperty("box-sizing"),a()},t))},slideDown=(t,a=500,r=()=>{})=>{if(t="string"==typeof t?findEl(t):t){t.style.removeProperty("display");let e=window.getComputedStyle(t).display;"none"===e&&(e="block"),t.style.display=e;var i=t.offsetHeight;t.style.overflow="hidden",t.style.height=0,t.style.paddingTop=0,t.style.paddingBottom=0,t.style.marginTop=0,t.style.marginBottom=0,t.offsetHeight,t.style.transitionProperty="height, margin, padding",t.style.transitionDuration=a+"ms",t.style.height=i+"px",t.style.removeProperty("padding-top"),t.style.removeProperty("padding-bottom"),t.style.removeProperty("margin-top"),t.style.removeProperty("margin-bottom"),window.setTimeout(()=>{t.style.removeProperty("height"),t.style.removeProperty("overflow"),t.style.removeProperty("transition-duration"),t.style.removeProperty("transition-property"),r()},a)}},queryAll=(e,t)=>t?[...t.querySelectorAll(e)]:[...document.querySelectorAll(e)],querySelector=(e,t)=>(t||document).querySelector(e),createElementFromHTML=e=>{var t=document.createElement("div");return t.innerHTML=e.trim(),t.firstChild},addEventToClass=(e,t,a)=>{e.startsWith(".")||(e="."+e),queryAll(e).forEach(e=>{e.addEventListener(t,a)})};"undefined"!=typeof module&&null!=module.exports&&((dummyModule=module).exports={findEl:findEl,fadeOut:fadeOut,fadeIn:fadeIn,val:val,showId:showId,hideId:hideId,setTextId:setTextId,setHTML:setHTML,dispatch:dispatch,hasClass:hasClass,addClass:addClass,removeClass:removeClass,addListener:addListener,setPlaceholder:setPlaceholder,style:style,disable:disable,slideUp:slideUp,slideDown:slideDown,queryAll:queryAll,querySelector:querySelector,createElementFromHTML:createElementFromHTML,addEventToClass:addEventToClass}),Object.defineProperty(Array.prototype,"last",{value:function(e=0){return this.reverse()[e]}}),Object.defineProperty(String.prototype,"capitalize",{value:function(e=!1){return e?this.split(" ").map(e=>e.capitalize()).join(" "):this.charAt(0).toUpperCase()+this.slice(1).toLowerCase()}});var dummyModule,global={};function BibtexParser(){this.months=["jan","feb","mar","apr","may","jun","jul","aug","sep","oct","nov","dec"],this.notKey=[",","{","}"," ","="],this.pos=0,this.input="",this.entries=new Array,this.currentEntry="",this.setInput=function(e){this.input=e},this.getEntries=function(){return this.entries},this.isWhitespace=function(e){return" "==e||"\r"==e||"\t"==e||"\n"==e},this.match=function(e,t){if(this.skipWhitespace(t=null==t?!0:t),this.input.substring(this.pos,this.pos+e.length)!=e)throw TypeError("Token mismatch: match -> expected "+e+", found "+this.input.substring(this.pos));this.pos+=e.length,this.skipWhitespace(t)},this.tryMatch=function(e,t){return this.skipWhitespace(t=null==t?!0:t),this.input.substring(this.pos,this.pos+e.length)==e},this.matchAt=function(){for(;this.input.length>this.pos&&"@"!=this.input[this.pos];)this.pos++;return"@"==this.input[this.pos]},this.skipWhitespace=function(e){for(;this.isWhitespace(this.input[this.pos]);)this.pos++;if("%"==this.input[this.pos]&&1==e){for(;"\n"!=this.input[this.pos];)this.pos++;this.skipWhitespace(e)}},this.value_braces=function(){for(var e,t=0,a=(this.match("{",!1),this.pos),r=!1;;){if(!r)if("}"==this.input[this.pos]){if(!(0<t))return e=this.pos,this.match("}",!1),this.input.substring(a,e);t--}else if("{"==this.input[this.pos])t++;else if(this.pos>=this.input.length-1)throw TypeError("Unterminated value: value_braces");r="\\"==this.input[this.pos]&&0==r,this.pos++}},this.value_comment=function(){for(var e="",t=0;!this.tryMatch("}",!1)||0!=t;){if(e+=this.input[this.pos],"{"==this.input[this.pos]&&t++,"}"==this.input[this.pos]&&t--,this.pos>=this.input.length-1)throw TypeError("Unterminated value: value_comment",+this.input.substring(start));this.pos++}return e},this.value_quotes=function(){this.match('"',!1);for(var e,t=this.pos,a=!1;;){if(!a){if('"'==this.input[this.pos])return e=this.pos,this.match('"',!1),this.input.substring(t,e);if(this.pos>=this.input.length-1)throw TypeError("Unterminated value: value_quotes",this.input.substring(t))}a="\\"==this.input[this.pos]&&0==a,this.pos++}},this.single_value=function(){var e=this.pos;if(this.tryMatch("{"))return this.value_braces();if(this.tryMatch('"'))return this.value_quotes();var t=this.key();if(t.match("^[0-9]+$"))return t;if(0<=this.months.indexOf(t.toLowerCase()))return t.toLowerCase();throw"Value expected: single_value"+this.input.substring(e)+" for key: "+t},this.value=function(){var e=[];for(e.push(this.single_value());this.tryMatch("#");)this.match("#"),e.push(this.single_value());return e.join("")},this.key=function(e){for(var t=this.pos;;){if(this.pos>=this.input.length)throw TypeError("Runaway key: key");if(0<=this.notKey.indexOf(this.input[this.pos]))return e&&","!=this.input[this.pos]?(this.pos=t,null):this.input.substring(t,this.pos);this.pos++}},this.key_equals_value=function(){var e,t=this.key();if(this.tryMatch("="))return this.match("="),e=this.value(),[t=t.trim(),e];throw TypeError("Value expected, equals sign missing: key_equals_value",this.input.substring(this.pos))},this.key_value_list=function(){var e=this.key_equals_value();for(this.currentEntry.entryTags={},this.currentEntry.entryTags[e[0]]=e[1];this.tryMatch(",")&&(this.match(","),!this.tryMatch("}"));)e=this.key_equals_value(),this.currentEntry.entryTags[e[0]]=e[1]},this.entry_body=function(e){this.currentEntry={},this.currentEntry.citationKey=this.key(!0),this.currentEntry.entryType=e.substring(1),null!=this.currentEntry.citationKey&&this.match(","),this.key_value_list(),this.entries.push(this.currentEntry)},this.directive=function(){return this.match("@"),"@"+this.key()},this.preamble=function(){this.currentEntry={},this.currentEntry.entryType="PREAMBLE",this.currentEntry.entry=this.value_comment(),this.entries.push(this.currentEntry)},this.comment=function(){this.currentEntry={},this.currentEntry.entryType="COMMENT",this.currentEntry.entry=this.value_comment(),this.entries.push(this.currentEntry)},this.entry=function(e){this.entry_body(e)},this.alernativeCitationKey=function(){this.entries.forEach(function(e){!e.citationKey&&e.entryTags&&(e.citationKey="",e.entryTags.author&&(e.citationKey+=e.entryTags.author.split(",")[0]+=", "),e.citationKey+=e.entryTags.year)})},this.cleanCitationKey=function(){var e=this.pos,t=e+this.input.slice(e).indexOf(","),a=this.input.slice(0,e),r=this.input.slice(t),i=this.input.slice(e,t).split("{");let o=i[0];for(var n=1;n<i.length;n++){var s=i[n].split("}");o+=s[0].replace(/\W/g,"")+s[1]}o=o.replace(/\s+/g,""),this.input=a+o+r},this.bibtex=function(){for(;this.matchAt();){var e=this.directive();this.match("{"),this.cleanCitationKey(),"@STRING"==e.toUpperCase()?this.string():"@PREAMBLE"==e.toUpperCase()?this.preamble():"@COMMENT"==e.toUpperCase()?this.comment():this.entry(e),this.match("}")}this.alernativeCitationKey()}}"undefined"!=typeof window&&(global=window),"undefined"!=typeof chrome&&chrome?.runtime?.setUninstallURL&&chrome?.runtime?.setUninstallURL("https://forms.gle/1JSV8PcxQugRmsd46"),global.state={currentMemoryPagination:0,dataVersion:0,deleted:{},files:{},ignoreSources:{},lastRefresh:new Date,memoryIsOpen:!1,memoryItemsPerPage:10,menuIsOpen:!1,papers:{},papersList:[],papersReady:!1,paperTags:new Set,pdfTitleFn:null,prefs:{},showFavorites:!1,sortedPapers:[],sortKey:"",timerIdMap:new WeakMap,titleHashToIds:{},titleFunction:null,urlHashToId:{}},global.state.titleFunction=e=>{let t=e.title.replaceAll("\n","")+" - "+e.id;return t=t.replaceAll(":"," ").replace(/\\s\\s+/g," ")},global.descendingSortKeys=["addDate","count","lastOpenDate","favoriteDate","year"],global.svgActionsHoverTitles={edit:"Edit paper details",copyMd:"Copy Markdown-formatted link",copyBibtext:"Copy Bibtex citation",visits:"Number of times you have opened this paper",openLocal:"Open downloaded pdf",copyLink:"Copy paper url",copyHypeLink:"Copy url as hyperlink"},global.select2Options={placeholder:"Tag paper",maximumSelectionLength:5,allowClear:!0,tags:!0,tokenSeparators:[","," "]},global.prefsCheckNames=["checkBib","checkMd","checkDownload","checkPdfTitle","checkFeedback","checkDarkMode","checkDirectOpen","checkStore","checkScirate","checkVanity","checkAr5iv","checkHuggingface","checkOfficialRepos","checkPreferPdf","checkPdfOnly","checkNoAuto","checkMdYearVenue","checkEnterLocalPdf","checkWebsiteParsing"],global.prefsCheckDefaultFalse=["checkDarkMode","checkStore","checkScirate","checkVanity","checkAr5iv","checkHuggingface","checkOfficialRepos","checkPdfOnly","checkNoAuto","checkMdYearVenue"],global.prefsStorageKeys=[...global.prefsCheckNames,"pdfTitleFn"],global.sourceExtras={springer:{types:["chapter","article","book","referenceworkentry"]}},global.preprintSources=["arxiv","biorxiv"],global.knownPaperPages={acl:{patterns:["aclanthology.org/"],name:"ACL Anthology (Association for Computational Linguistics)"},acm:{patterns:["dl.acm.org/doi/"],name:"ACM (Association for Computing Machinery)"},aps:{patterns:[e=>Boolean(e.match(/journals\.aps\.org\/\w+\/(abstract|pdf)\//g))],name:"APS (American Physical Society)"},acs:{patterns:["pubs.acs.org/doi/"],name:"ACS (American Chemical Society)"},arxiv:{patterns:["arxiv.org/abs/","arxiv.org/pdf/","scirate.com/arxiv/","ar5iv.labs.arxiv.org/html/","arxiv-vanity.com/papers/",e=>e.includes("huggingface.co/papers/")&&e.split("huggingface.co/papers/")[1].match(/\d+\.\d+/)],name:"ArXiv"},biorxiv:{patterns:["biorxiv.org/content"],name:"BioRxiv"},chemrxiv:{patterns:["chemrxiv.org/engage/chemrxiv/article-details/",e=>e.includes("https://chemrxiv.org/engage/api-gateway/chemrxiv/assets")&&e.endsWith(".pdf")],name:"ChemRxiv"},cvf:{patterns:["openaccess.thecvf.com/content"],name:"CVF (Computer Vision Foundation)"},frontiers:{patterns:["frontiersin.org/articles"],name:"Frontiers"},hal:{patterns:[e=>/hal\.science\/\w+-\d+(v\d+)?(\/document)?$/gi.test(e),e=>/hal\.science\/\w+-\d+(v\d+)?\/file\/.+\.pdf$/gi.test(e)],name:"HAL"},ihep:{patterns:["inspirehep.net/literature/","inspirehep.net/files/"],name:"IHEP (INSPIRE - High Energy Physics)"},ijcai:{patterns:[e=>/ijcai\.org\/proceedings\/\d{4}\/\d+/gi.test(e)],name:"IJCAI (International Joint Conferences on Artificial Intelligence)"},ieee:{patterns:["ieeexplore.ieee.org/document/","ieeexplore.ieee.org/abstract/document/","ieeexplore.ieee.org/stamp/stamp.jsp?tp=&arnumber="],name:"IEEE (Institute of Electrical and Electronics Engineers)"},iop:{patterns:["iopscience.iop.org/article/"],name:"IOP (Institute Of Physics)"},jmlr:{patterns:[e=>e.includes("jmlr.org/papers/v")&&!e.endsWith("/")],name:"JMLR (Journal of Machine Learning Research)"},mdpi:{patterns:[e=>/mdpi\.com\/\d+-.+/gi.test(e)],name:"MDPI (Multidisciplinary Digital Publishing Institute)"},nature:{patterns:["nature.com/articles/"],name:"Nature"},neurips:{patterns:["neurips.cc/paper/","neurips.cc/paper_files/paper/","nips.cc/paper/"],name:"NeurIPS (Neural Information Processing Systems)"},openreview:{patterns:["openreview.net/forum","openreview.net/pdf","openreview.net/attachment"],name:"OpenReview"},oup:{patterns:[e=>0<=(e.split("https://academic.oup.com/")[1]?.split("/")[1]?.indexOf("article")??-1)],name:"OUP (Oxford University Press)"},plos:{patterns:[e=>/journals\.plos\.org\/.+\/article.+id=/gi.test(e)],name:"PLOS (Public Library of Science)"},pmc:{patterns:["ncbi.nlm.nih.gov/pmc/articles/PMC"],name:"PMC (PubMed Central)"},pmlr:{patterns:["proceedings.mlr.press/"],name:"PMLR (Proceedings of Machine Learning Research)"},pnas:{patterns:["pnas.org/content/","pnas.org/doi/"],name:"PNAS (Proceedings of the National Academy of Sciences)"},rsc:{patterns:["pubs.rsc.org/en/content/article"],name:"RSC (Royal Society of Chemistry)"},science:{patterns:[e=>Boolean(e.match(/science\.org\/doi\/?(abs|full|pdf|epdf)?\//g))],name:"Science"},sciencedirect:{patterns:["sciencedirect.com/science/article/pii/","sciencedirect.com/science/article/abs/pii/","reader.elsevier.com/reader/sd/pii/"],name:"ScienceDirect"},springer:{patterns:[...global.sourceExtras.springer.types.map(e=>`link.springer.com/${e}/`),"link.springer.com/content/pdf/"],name:"Springer"},website:{patterns:[],name:"Manually parsed website"},wiley:{patterns:[e=>Boolean(e.match(/onlinelibrary\.wiley\.com\/doi\/(abs|full|pdf|epdf|10\.)\//g))],name:"Wiley"}},global.overrideORConfs={"robot-learning":"CoRL",ijcai:"IJCAI"},global.overridePMLRConfs={"Conference on Learning Theory":"CoLT","International Conference on Machine Learning":"ICML","Conference on Uncertainty in Artificial Intelligence":"UAI","Conference on Robot Learning":"CoRL","International Conference on Artificial Intelligence and Statistics":"AISTATS","International Conference on Algorithmic Learning Theory":"ALT"},global.overrideDBLPVenues={"J. Mach. Learn. Res.":"JMLR"},global.consolHeaderStyle="@import url('https://fonts.googleapis.com/css2?family=Fira+Code:wght@300');font-family:'Fira Code' monospace;font-size:1rem;font-weight:300;display:inline-block;border:2px solid #A41716;border-radius: 4px;padding: 12px; margin: 12px;",global.storeReadme=`
/!\\ Warning: This folder has been created automatically by your PaperMemory browser extension.

/!\\ It has to stay in your downloads for PaperMemory to be able to access your papers.

/!\\ To be able to open files from this folder instead of re-downloading them, PaperMemory will match their titles and downloaded urls.

/!\\ If you change the default title function in the Advanced Options and do not include a paper's title in the file name, PaperMemory may not be able to open the file and will instead open the pdf url.

/!\\ Unfortunately, PaperMemory cannot detect papers that have not been *downloaded there* so putting papers in this folder will not make them discoverable by the \`browser.downloads\` API PaperMemory uses.
`,global.englishStopWords=new Set(["i","me","my","myself","we","our","ours","ourselves","you","your","yours","yourself","yourselves","he","him","his","himself","she","her","hers","herself","it","its","itself","they","them","their","theirs","themselves","what","which","who","whom","this","that","these","those","am","is","are","was","were","be","been","being","have","has","had","having","do","does","did","doing","a","an","the","and","but","if","or","because","as","until","while","of","at","by","for","with","about","against","between","into","through","during","before","after","above","below","to","from","up","down","in","out","on","off","over","under","again","further","then","once","here","there","when","where","why","how","all","any","both","each","few","more","most","other","some","such","no","nor","not","only","own","same","so","than","too","very","s","t","can","will","just","don","should","now"]),global.journalAbbreviations=null,"undefined"!=typeof module&&null!=module.exports&&((dummyModule=module).exports={state:global.state,descendingSortKeys:global.descendingSortKeys,svgActionsHoverTitles:global.svgActionsHoverTitles,select2Options:global.select2Options,prefsCheckNames:global.prefsCheckNames,prefsCheckDefaultFalse:global.prefsCheckDefaultFalse,prefsStorageKeys:global.prefsStorageKeys,sourceExtras:global.sourceExtras,preprintSources:global.preprintSources,knownPaperPages:global.knownPaperPages,overrideORConfs:global.overrideORConfs,overridePMLRConfs:global.overridePMLRConfs,overrideDBLPVenues:global.overrideDBLPVenues,consolHeaderStyle:global.consolHeaderStyle,storeReadme:global.storeReadme,englishStopWords:global.englishStopWords,journalAbbreviations:global.journalAbbreviations});let safeRemoveSurroundingBraces=e=>{let t=0,a=0,r=!0;for(var i of e.slice(1,-1))if("{"===i&&t++,"}"===i&&a++,a>t){r=!1;break}return r?e.slice(1,-1):e},bibtexToObject=e=>{var t,a,r=new BibtexParser,e=(r.setInput(e),r.bibtex(),r.getEntries()[0]),i={...e.entryTags,entryType:e.entryType,citationKey:e.citationKey};for([t,a]of Object.entries(i))a.startsWith("{")&&a.endsWith("}")&&(i[t]=safeRemoveSurroundingBraces(a)),t===t.toUpperCase()&&(i[t.toLowerCase()]=i[t],delete i[t]);return i},bibtexToString=t=>{let a=`@${(t={...t=(t="string"==typeof t?bibtexToObject(t):t).hasOwnProperty("entryTags")?{...t.entryTags,entryType:t.entryType,citationKey:t.citationKey}:t}).entryType.toLowerCase()}{${t.citationKey},
`;delete t.entryType,delete t.citationKey;var r,i,o=Math.max(...Object.keys(t).map(e=>e.length));for(r in t)if(t.hasOwnProperty(r)&&t[r]){let e=t[r].replaceAll(/\s+/g," ").trim();0<(e=e.startsWith("{")&&e.endsWith("}")?safeRemoveSurroundingBraces(e):e).length&&(i=r+" ".repeat(o-r.length),a+=`	${i} = {${e}},
`)}return(a.slice(0,-2)+"\n}").replaceAll("\t","  ").replaceAll("--","-")},extractBibtexValue=(e,t)=>{e=bibtexToObject(e);return e.hasOwnProperty(t)?e[t]:""},extractAuthor=e=>extractBibtexValue(e,"author").replaceAll("{","").replaceAll("}","").replaceAll("\\","").split(" and ").map(e=>e.split(", ").reverse().join(" ")).join(" and "),logTrace=("undefined"!=typeof module&&null!=module.exports&&((dummyModule=module).exports={BibtexParser:BibtexParser,safeRemoveSurroundingBraces:safeRemoveSurroundingBraces,bibtexToObject:bibtexToObject,bibtexToString:bibtexToString,extractBibtexValue:extractBibtexValue,extractAuthor:extractAuthor}),"undefined"!=typeof LOGTRACE&&LOGTRACE),log=(...e)=>{var t;logTrace&&(t=(new Error).stack,e.push("\n\nLog trace:\n"+t.split("\n").slice(2).join("\n")));let a="%c%s ",r=!1,i=!1,o=!1,n=!1,s=!1;"[info]"===e[0]?(r=!0,e=e.slice(1)):"[warn]"===e[0]?(i=!0,e=e.slice(1)):"[error]"===e[0]?(o=!0,e=e.slice(1)):"[ok]"===e[0]?(s=!0,e=e.slice(1)):"[debug]"===e[0]&&(n=!0,e=e.slice(1)),e.forEach(e=>{switch(typeof e){case"bigint":case"number":a+="%d   ";break;case"string":a+="%s   ";break;default:a+="%o   "}}),console.log(a,"color: "+(r?"#8BB4F7; font-weight:bold;":i?"#f3bd1e; font-weight:bold;":o?"#FF4F54; font-weight:bold;":s?"#23F62B; font-weight:bold;":n?"#BA357E; font-weight:bold;":"tan"),"[PM]",...e)},info=(...e)=>log("[info]",...e),warn=(...e)=>log("[warn]",...e),debug=(...e)=>log("[debug]",...e),logOk=(...e)=>log("[ok]",...e),logError=(...e)=>log("[error]",...e),consoleHeader=e=>console.groupCollapsed("%c"+e,global.consolHeaderStyle),getDisplayId=e=>{var t=e;return(e=e.split("_")[0].split(".")[0]).startsWith("OR-")||(e=e.split("-").slice(0,2).join("-")),global.state.papers.hasOwnProperty(t)&&("nature"===(t=global.state.papers[t]).source&&(t.note.match(/^Published\ @.+\(\d+\)$/)&&(e+="-"+t.note.split("@")[1].split("(")[0].trim().split(" ").map(e=>e[0].toUpperCase()).join("")),e.includes(t.year+"")||(e+="-"+t.year)),"acs"!==t.source||e.includes(t.year+"")||(e+="-"+t.year),"iop"!==t.source||e.includes(t.year+"")||(e+="-"+t.year)),e},isObject=e=>"object"==typeof e&&!Array.isArray(e)&&null!==e,isPdfUrl=e=>e.endsWith(".pdf")||e.endsWith("/pdf")||e.includes("openreview.net/pdf")||e.match(/\/e?pdf\//g)||e.includes("ieee.org/stamp/stamp.jsp?tp=&arnumber=")||e.includes("articlepdf");function delay(t,a){let r=0;return function(...e){clearTimeout(r),r=setTimeout(t.bind(this,...e),a||0)}}let cleanPapers=e=>{e={...e};return delete e.__dataVersion,e},firstNonStopLowercase=e=>{var e=e.toLowerCase().split(" ").map(miniHash),t=e.filter(e=>!global.englishStopWords.has(e));return(0<t.length?t:e)[0]},miniHash=(e,t)=>(void 0===t&&(t=""),e.toLowerCase().replace(/\W/g,t)),fallbackCopyTextToClipboard=e=>{var t=document.createElement("textarea");t.value=e,t.style.top="0",t.style.left="0",t.style.position="fixed",document.body.appendChild(t),t.focus(),t.select();try{var a=document.execCommand("copy")?"successful":"unsuccessful";log("Fallback: Copying text command was "+a)}catch(e){console.error("Fallback: Oops, unable to copy",e)}document.body.removeChild(t)},copyTextToClipboard=e=>{navigator.clipboard?navigator.clipboard.writeText(e).then(()=>{log("Async: Copying to clipboard was successful!")},e=>{console.error("Async: Could not copy text: ",e)}):fallbackCopyTextToClipboard(e)};async function pasteRich(t,a){var e,r;"undefined"!=typeof ClipboardItem?(e=new Blob([t],{type:"text/html"}),r=new Blob([a],{type:"text/plain"}),e=new ClipboardItem({"text/html":e,"text/plain":r}),await navigator.clipboard.write([e])):(r=e=>{e.clipboardData.setData("text/html",t),e.clipboardData.setData("text/plain",a),e.preventDefault()},document.addEventListener("copy",r),document.execCommand("copy"),document.removeEventListener("copy",r))}let copyHyperLinkToClipboard=(e,t)=>{pasteRich(`<a href="${e}">${t}</a>`,t+" "+e)},parseUrl=e=>{var t=document.createElement("a");return t.href=e,t},downloadTextFile=(e,t,a)=>{var r=document.createElement("a");"text/plain"===a?(e=e.replace(/\\n/g,"%0D%0A").replace(/"/g,""),r.download=t,r.href="data:text/plain,"+e):(e=new Blob([e],{type:a}),r.href=URL.createObjectURL(e),r.download=t),r.click()},eventId=e=>e.target.closest(".memory-container").id.split("--")[1];async function downloadURI(e,a){a=a.replace(/[^\w\s]/gi,"");var e=await fetch(e).then(e=>e.blob()),t=new FileReader;t.readAsDataURL(e),t.onload=e=>{var e=e.target.result,t=document.createElement("a");t.download=a,t.href=e,document.body.appendChild(t),t.click(),document.body.removeChild(t)}}let downloadFile=(e,t)=>{var a;window.ActiveXObject?(window.ActiveXObject,document.execCommand&&((a=window.open(e,"_blank")).document.close(),a.document.execCommand("SaveAs",!0,t||e),a.close())):((a=document.createElement("a")).href=e,a.target="_blank",a.download=t,navigator.userAgent.toLowerCase().match(/(ipad|iphone|safari)/)&&navigator.userAgent.search("Chrome")<0?document.location=a.href:(e=new MouseEvent("click",{view:window,bubbles:!0,cancelable:!1}),a.dispatchEvent(e),(window.URL||window.webkitURL).revokeObjectURL(a.href)))},hashCode=e=>e.split("").reduce((e,t)=>(e=(e<<5)-e+t.charCodeAt(0))&e,0),parseCVFUrl=e=>{var t=e.replace("https://openaccess.thecvf.com/content","").slice(1).split("/")[0].split("_");let a,r;r=1===t.length?(a=t[0].slice(0,-4),t[0].slice(-4)):(a=t[0].toUpperCase(),t[1]);t=e.split("/").last().split(".")[0],e=(hashCode(t)+"").replace("-","").slice(0,8),t=`${a}-${r}_`+e;return{conf:a,year:r,id:t}},cleanBiorxivURL=e=>e=(e=e.replace(".full.pdf","")).match(/\d$/)?e:e.split(".").slice(0,-1).join("."),textareaFocusEnd=e=>{setTimeout(()=>{e.selectionStart=e.selectionEnd=1e4},0)},tablerSvg=(e,t,a)=>{switch(t=(t=void 0===t?"":t)&&`id="${t}"`,a=(a=(a=void 0===a?[]:a).filter(e=>e))&&`class="${a.join(" ")}"`,e){case"adjustments":return`<svg viewBox="0 0 24 24" ${t} ${a}>
            <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
            <circle cx="6" cy="10" r="2" />
            <line x1="6" y1="4" x2="6" y2="8" />
            <line x1="6" y1="12" x2="6" y2="20" />
            <circle cx="12" cy="16" r="2" />
            <line x1="12" y1="4" x2="12" y2="14" />
            <line x1="12" y1="18" x2="12" y2="20" />
            <circle cx="18" cy="7" r="2" />
            <line x1="18" y1="4" x2="18" y2="5" />
            <line x1="18" y1="9" x2="18" y2="20" />
            </svg>`;case"circle-x":return`<svg viewBox="0 0 24 24" ${t} ${a}>
            <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
            <circle cx="12" cy="12" r="9" />
            <path d="M10 10l4 4m0 -4l-4 4" />
            </svg>`;case"star":return`<svg viewBox="0 0 24 24" ${t} ${a}>
            <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
            <path d="M12 17.75l-6.172 3.245l1.179 -6.873l-5 -4.867l6.9 -1l3.086 -6.253l3.086 6.253l6.9 1l-5 4.867l1.179 6.873z" />
            </svg>`;case"writing":return`<svg viewBox="0 0 24 24" ${t} ${a}>
            <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
            <path d="M20 17v-12c0 -1.121 -.879 -2 -2 -2s-2 .879 -2 2v12l2 2l2 -2z" />
            <path d="M16 7h4" />
            <path d="M18 19h-13a2 2 0 1 1 0 -4h4a2 2 0 1 0 0 -4h-3" />
            </svg>`;case"file-symlink":return`<svg viewBox="0 0 24 24" ${t} ${a}>
            <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
            <path d="M4 21v-4a3 3 0 0 1 3 -3h5" />
            <path d="M9 17l3 -3l-3 -3" />
            <path d="M14 3v4a1 1 0 0 0 1 1h4" />
            <path d="M5 11v-6a2 2 0 0 1 2 -2h7l5 5v11a2 2 0 0 1 -2 2h-9.5" />
            </svg>`;case"link":return`<svg viewBox="0 0 24 24" ${t} ${a}>
            <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
            <path d="M10 14a3.5 3.5 0 0 0 5 0l4 -4a3.5 3.5 0 0 0 -5 -5l-.5 .5" />
            <path d="M14 10a3.5 3.5 0 0 0 -5 0l-4 4a3.5 3.5 0 0 0 5 5l.5 -.5" />
            </svg>`;case"clipboard-list":return`<svg viewBox="0 0 24 24" ${t} ${a}>
            <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
            <path d="M9 5h-2a2 2 0 0 0 -2 2v12a2 2 0 0 0 2 2h10a2 2 0 0 0 2 -2v-12a2 2 0 0 0 -2 -2h-2" />
            <rect x="9" y="3" width="6" height="4" rx="2" />
            <line x1="9" y1="12" x2="9.01" y2="12" />
            <line x1="13" y1="12" x2="15" y2="12" />
            <line x1="9" y1="16" x2="9.01" y2="16" />
            <line x1="13" y1="16" x2="15" y2="16" />
            </svg>`;case"archive":return`<svg viewBox="0 0 24 24" ${t} ${a}>
            <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
            <rect x="3" y="4" width="18" height="4" rx="2" />
            <path d="M5 8v10a2 2 0 0 0 2 2h10a2 2 0 0 0 2 -2v-10" />
            <line x1="10" y1="12" x2="14" y2="12" />
            </svg>`;case"external-link":return`<svg viewBox="0 0 24 24" ${t} ${a}>
            <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
            <path d="M11 7h-5a2 2 0 0 0 -2 2v9a2 2 0 0 0 2 2h9a2 2 0 0 0 2 -2v-5" />
            <line x1="10" y1="14" x2="20" y2="4" />
            <polyline points="15 4 20 4 20 9" />
            </svg>`;case"file-download":return`<svg viewBox="0 0 24 24" ${t} ${a}>
            <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
            <path d="M14 3v4a1 1 0 0 0 1 1h4" />
            <path d="M17 21h-10a2 2 0 0 1 -2 -2v-14a2 2 0 0 1 2 -2h7l5 5v11a2 2 0 0 1 -2 2z" />
            <line x1="12" y1="11" x2="12" y2="17" />
            <polyline points="9 14 12 17 15 14" />
             </svg>`;case"circle-x":return`<svg viewBox="0 0 24 24" ${t} ${a}>
			<path stroke="none" d="M0 0h24v24H0z" fill="none" />
			<circle cx="12" cy="12" r="9" />
			<path d="M10 10l4 4m0 -4l-4 4" />
		    </svg>`;case"settings":return`<svg viewBox="0 0 24 24" ${t} ${a}>
            <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
            <path d="M10.325 4.317c.426 -1.756 2.924 -1.756 3.35 0a1.724 1.724 0 0 0 2.573 1.066c1.543 -.94 3.31 .826 2.37 2.37a1.724 1.724 0 0 0 1.065 2.572c1.756 .426 1.756 2.924 0 3.35a1.724 1.724 0 0 0 -1.066 2.573c.94 1.543 -.826 3.31 -2.37 2.37a1.724 1.724 0 0 0 -2.572 1.065c-.426 1.756 -2.924 1.756 -3.35 0a1.724 1.724 0 0 0 -2.573 -1.066c-1.543 .94 -3.31 -.826 -2.37 -2.37a1.724 1.724 0 0 0 -1.065 -2.572c-1.756 -.426 -1.756 -2.924 0 -3.35a1.724 1.724 0 0 0 1.066 -2.573c-.94 -1.543 .826 -3.31 2.37 -2.37c1 .608 2.296 .07 2.572 -1.065z" />
            <circle cx="12" cy="12" r="3" />
            </svg>`;case"messages":return`<svg viewBox="0 0 24 24" ${t} ${a}>
                <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
                <path d="M21 14l-3 -3h-7a1 1 0 0 1 -1 -1v-6a1 1 0 0 1 1 -1h9a1 1 0 0 1 1 1v10" />
                <path d="M14 15v2a1 1 0 0 1 -1 1h-7l-3 3v-10a1 1 0 0 1 1 -1h2" />
            </svg>`;case"vanity":return`<svg viewBox="0 0 24 24" ${t} ${a}>
                <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
                <path d="M 17.278533 40.830163 C 18.35462 40.830163 19.222826 41.69837 19.222826 42.774457 L 19.222826 43.80163 C 19.222826 44.889946 18.35462 45.758152 17.278533 45.758152 C 16.202446 45.758152 15.322011 44.889946 15.322011 43.80163 L 15.322011 42.774457 C 15.322011 41.69837 16.202446 40.830163 17.278533 40.830163 Z M 17.278533 40.830163 " transform="matrix(0.319444,0,0,0.319444,0,0)"/>
                <path d="M 22.597826 37.345109 C 23.673913 37.345109 24.54212 38.213315 24.54212 39.289402 L 24.54212 40.316576 C 24.54212 41.392663 23.673913 42.273098 22.597826 42.273098 C 21.521739 42.273098 20.641304 41.392663 20.641304 40.316576 L 20.641304 39.289402 C 20.641304 38.213315 21.521739 37.345109 22.597826 37.345109 Z M 22.597826 37.345109 " transform="matrix(0.319444,0,0,0.319444,0,0)"/>
                <path d="M 27.758152 39.228261 C 28.834239 39.228261 29.702446 40.096467 29.702446 41.172554 L 29.702446 42.199728 C 29.702446 43.275815 28.834239 44.15625 27.758152 44.15625 C 26.682065 44.15625 25.80163 43.275815 25.80163 42.199728 L 25.80163 41.172554 C 25.80163 40.096467 26.682065 39.228261 27.758152 39.228261 Z M 27.758152 39.228261 " transform="matrix(0.319444,0,0,0.319444,0,0)"/>
                <path d="M 33.052989 46.797554 C 34.129076 46.797554 34.997283 47.665761 34.997283 48.741848 L 34.997283 49.78125 C 34.997283 50.857337 34.129076 51.725543 33.052989 51.725543 C 31.976902 51.725543 31.108696 50.857337 31.108696 49.78125 L 31.108696 48.741848 C 31.108696 47.665761 31.976902 46.797554 33.052989 46.797554 Z M 33.052989 46.797554 " transform="matrix(0.319444,0,0,0.319444,0,0)"/>
                <path d="M 20.188859 56.53125 L 19.980978 43.067935 C 19.907609 41.649457 18.745924 40.524457 17.327446 40.5 C 16.630435 40.475543 15.970109 40.744565 15.480978 41.221467 C 15.004076 41.710598 14.735054 42.383152 14.759511 43.067935 L 14.808424 59.686141 " transform="matrix(0.319444,0,0,0.319444,0,0)"/>
                <path d="M 30.58288 56.800272 L 30.411685 41.625 C 30.411685 41.625 30.154891 39.044837 27.868207 39.044837 C 25.569293 39.044837 25.165761 41.625 25.165761 41.625 " transform="matrix(0.319444,0,0,0.319444,0,0)"/>
                <path d="M 35.767663 59.686141 L 35.633152 48.754076 C 35.461957 47.519022 34.373641 46.601902 33.126359 46.638587 C 31.842391 46.589674 30.717391 47.482337 30.497283 48.754076 " transform="matrix(0.319444,0,0,0.319444,0,0)"/>
                <path d="M 25.251359 55.235054 L 25.116848 39.142663 C 24.945652 37.907609 23.857337 37.002717 22.610054 37.039402 C 21.326087 36.978261 20.201087 37.883152 19.980978 39.154891 L 20.005435 44.755435 " transform="matrix(0.319444,0,0,0.319444,0,0)"/>
                <path d="M 38.995924 36.5625 L 45.415761 26.902174 " transform="matrix(0.319444,0,0,0.319444,0,0)"/>
                <path d="M 36.085598 43.532609 C 36.085598 43.532609 37.956522 42.138587 38.519022 41.612772 C 39.558424 40.78125 40.120924 39.497283 39.998641 38.164402 C 39.839674 37.173913 38.922554 36.501359 37.932065 36.648098 " transform="matrix(0.319444,0,0,0.319444,0,0)"/>
                <path d="M 43.153533 25.410326 L 52.813859 11.017663 L 58.035326 13.769022 L 48.203804 28.748641 L 45.415761 26.902174 Z M 43.153533 25.410326 " transform="matrix(0.319444,0,0,0.319444,0,0)"/>
            </svg>`;case"ar5iv":return`<svg viewBox="0 0 24 24" ${t} ${a}>
                <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
                <path d="M12 2l.642 .005l.616 .017l.299 .013l.579 .034l.553 .046c4.687 .455 6.65 2.333 7.166 6.906l.03 .29l.046 .553l.041 .727l.006 .15l.017 .617l.005 .642l-.005 .642l-.017 .616l-.013 .299l-.034 .579l-.046 .553c-.455 4.687 -2.333 6.65 -6.906 7.166l-.29 .03l-.553 .046l-.727 .041l-.15 .006l-.617 .017l-.642 .005l-.642 -.005l-.616 -.017l-.299 -.013l-.579 -.034l-.553 -.046c-4.687 -.455 -6.65 -2.333 -7.166 -6.906l-.03 -.29l-.046 -.553l-.041 -.727l-.006 -.15l-.017 -.617l-.004 -.318v-.648l.004 -.318l.017 -.616l.013 -.299l.034 -.579l.046 -.553c.455 -4.687 2.333 -6.65 6.906 -7.166l.29 -.03l.553 -.046l.727 -.041l.15 -.006l.617 -.017c.21 -.003 .424 -.005 .642 -.005zm2 5h-4a1 1 0 0 0 -.993 .883l-.007 .117v4a1 1 0 0 0 .883 .993l.117 .007h3v2h-2l-.007 -.117a1 1 0 0 0 -1.993 .117a2 2 0 0 0 1.85 1.995l.15 .005h2a2 2 0 0 0 1.995 -1.85l.005 -.15v-2a2 2 0 0 0 -1.85 -1.995l-.15 -.005h-2v-2h3a1 1 0 0 0 .993 -.883l.007 -.117a1 1 0 0 0 -.883 -.993l-.117 -.007z" stroke-width="0" fill="#7c7f8b"></path>
            </svg>`;case"vocabulary":return`<svg viewBox="0 0 24 24" ${t} ${a}>
                <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
                <path d="M10 19h-6a1 1 0 0 1 -1 -1v-14a1 1 0 0 1 1 -1h6a2 2 0 0 1 2 2a2 2 0 0 1 2 -2h6a1 1 0 0 1 1 1v14a1 1 0 0 1 -1 1h-6a2 2 0 0 0 -2 2a2 2 0 0 0 -2 -2z" />
                <path d="M12 5v16" />
                <path d="M7 7h1" />
                <path d="M7 11h1" />
                <path d="M16 7h1" />
                <path d="M16 11h1" />
                <path d="M16 15h1" />
            </svg>`;case"database-export":return`<svg viewBox="0 0 24 24" ${t} ${a}>
                <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
                <ellipse cx="12" cy="6" rx="8" ry="3" />
                <path d="M4 6v6c0 1.657 3.582 3 8 3a19.84 19.84 0 0 0 3.302 -.267m4.698 -2.733v-6" />
                <path d="M4 12v6c0 1.599 3.335 2.905 7.538 2.995m8.462 -6.995v-2m-6 7h7m-3 -3l3 3l-3 3" />
            </svg>`;case"eyeglass":return`<svg viewBox="0 0 24 24" ${t} ${a}>
                <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
                <path d="M8 4h-2l-3 10" />
                <path d="M16 4h2l3 10" />
                <line x1="10" y1="16" x2="14" y2="16" />
                <path d="M21 16.5a3.5 3.5 0 0 1 -7 0v-2.5h7v2.5" />
                <path d="M10 16.5a3.5 3.5 0 0 1 -7 0v-2.5h7v2.5" />
            </svg>`;case"markdown":return`<svg viewBox="0 0 24 24" ${t} ${a}>
                <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
                <rect x="3" y="5" width="18" height="14" rx="2" />
                <path d="M7 15v-6l2 2l2 -2v6" />
                <path d="M14 13l2 2l2 -2m-2 2v-6" />
            </svg>`;case"math-function":return`<svg viewBox="0 0 24 24" ${t} ${a}>
                <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
                <path d="M14 10h1c1 0 1 1 2.016 3.527c.984 2.473 .984 3.473 1.984 3.473h1" />
                <path d="M13 17c1.5 0 3 -2 4 -3.5s2.5 -3.5 4 -3.5" />
                <path d="M3 19c0 1.5 .5 2 2 2s2 -4 3 -9s1.5 -9 3 -9s2 .5 2 2" />
                <line x1="5" y1="12" x2="11" y2="12" />
            </svg>`;case"device-desktop-code":return`<svg viewBox="0 0 24 24" ${t} ${a}>
                <path stroke="none" d="M0 0h24v24H0z" fill="none"></path>
                <path d="M12.5 16h-8.5a1 1 0 0 1 -1 -1v-10a1 1 0 0 1 1 -1h16a1 1 0 0 1 1 1v8"></path>
                <path d="M7 20h4"></path>
                <path d="M9 16v4"></path>
                <path d="M20 21l2 -2l-2 -2"></path>
                <path d="M17 17l-2 2l2 2"></path>
            </svg>`;case"info-square-rounded":return`<svg viewBox="0 0 24 24" ${t} ${a}>
                <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
                <path d="M12 9h.01" /><path d="M11 12h1v4h1" />
                <path d="M12 3c7.2 0 9 1.8 9 9s-1.8 9 -9 9s-9 -1.8 -9 -9s1.8 -9 9 -9z" />
            </svg>`;case"huggingface":return`<img
                src="${chrome.runtime.getURL(global.state.prefs.checkDarkMode?"src/shared/hf-logo-transparent-darktheme.svg":"src/shared/hf-logo-transparent-lighttheme.svg")}"
                ${t}
                ${a}
            >`;default:return""}},stringifyError=e=>{let t=chrome.runtime.id;return e.stack.split("\n").map(e=>e.split(" ").map(e=>e.split(t).last()).join(" ")).join("<br/>")},arraysIdentical=(e,t)=>{var a=e.length;if(a!=t.length)return!1;for(;a--;)if(e[a]!==t[a])return!1;return!0},parseTags=e=>{e=Array.from(e.selectedOptions,e=>e.value.trim()).filter(e=>e);return e.sort(),e},getPaperEdits=(e,t)=>{let a,r,i,o;return o=t?(a=val("popup-form-note-textarea--"+e),i=val(document.getElementById("popup-form-note--"+e).querySelector(".form-code-input")),r=parseTags(findEl("popup-item-tags--"+e)),findEl("checkFavorite--"+e).checked):(a=val(findEl(e,"form-note-textarea")),i=val(findEl(e,"form-code-input")),r=parseTags(findEl(e,"memory-item-tags")),hasClass("memory-container--"+e,"favorite")),{note:a,tags:r,codeLink:i,favorite:o}},setFormChangeListener=(e,t)=>{let a,r,i,o;t?(a="#popup-item-tags--"+e.replace(".","\\."),i="popup-form-codeLink--"+e,r="popup-form-note-textarea--"+e,o="checkFavorite--"+e,$(a).on("change",delay(monitorPaperEdits(e,t),300)),addListener(i,"keyup",delay(monitorPaperEdits(e,t),300)),addListener(r,"keyup",delay(monitorPaperEdits(e,t),300)),addListener(o,"change",delay(monitorPaperEdits(e,t),300))):(a=".memory-item-tags",i=".form-code-input",r=".form-note-textarea",addEventToClass(i,"keyup",delay(monitorPaperEdits(void 0,t),300)),addEventToClass(r,"keyup",delay(monitorPaperEdits(void 0,t),300)))},monitorPaperEdits=(l,p)=>e=>{let t;t=void 0===l?eventId(e):l;var a=getPaperEdits(t,p),r=global.state.papers[t];let i=!1;for(var o in a){var n=r[o],s=(o,a[o]);"tags"===o?arraysIdentical(n,s)||(i=!0):n!==s&&(i=!0)}i&&(console.log("Updating meta data for",t),(p?handlePopupSaveEdits:handleMemorySaveEdits)(t))},cutAuthors=(e,t,a)=>{void 0===t&&(t=140),void 0===a&&(a=", ");let r="";var i,o,n=e.split(" and "),s=n[n.length-1];for([i,o]of n.entries()){if(!(5+r.length+a.length+o.length+s.length<t||i==n.length-1)){r+=" <span class='expand-memory-authors'>...</span> "+s;break}r?r+=", "+o:r=o}return r},sendMessageToBackground=e=>new Promise(t=>{chrome.runtime.sendMessage(e,e=>{t(e)})}),getStoredFiles=()=>new Promise(t=>{chrome.downloads.search({filenameRegex:"(PaperMemoryStore/)?.*.pdf"},e=>t(e.filter(e=>e.exists&&"complete"===e.state&&!e.filename.toLowerCase().includes("readme.txt"))))}),noParamUrl=e=>e.split("?")[0].split("#")[0],urlToWebsiteId=e=>{var t;return e.split("/").last().includes("#")&&(t=e.split("#").length-1,e=e.split("#").slice(0,t).join("#")),miniHash(e.replace("https://","").replace("http://","").replace("www.",""))},silentPromiseTimeout=(e,a=5e3)=>{let r;return Promise.race([e,new Promise((e,t)=>r=setTimeout(e,a))]).finally(()=>clearTimeout(r))},shouldWarn=async(e,t=()=>{})=>t(!1),spaceCamelCase=e=>e.replace(/([A-Z](?=[a-z]+)|[A-Z]+(?![a-z]))/g," $1").trim(),toSingleSpace=e=>e.replace(/\s\s+/g," "),dedent=e=>(""+e).replace(/(\n)\s+/g,"$1"),arxivIdFromPaperID=e=>e.split("-").last().replace("_","/"),cleanStr=e=>e.replace(/[^a-zA-Z0-9 ]/g,""),arxivIdFromURL=e=>e.includes("scirate.com/arxiv/")?e.split("scirate.com/arxiv/")[1].match(/\d+\.\d+/)[0]:e.includes("arxiv-vanity.com/papers/")?e.split("arxiv-vanity.com/papers/")[1].match(/\d+\.\d+/)[0]:e.includes("ar5iv.labs.arxiv.org/html/")?e.split("ar5iv.labs.arxiv.org/html/")[1].match(/\d+\.\d+/)[0]:e.includes("huggingface.co/papers/")?e.split("huggingface.co/papers/")[1].match(/\d+\.\d+/)[0]:noParamUrl(e).replace("/abs/","/pdf/").split("/pdf/")[1].replace(".pdf","").split("v")[0].replace("/","_"),getBrowserName=async()=>{let e=navigator.appName;var t=navigator.userAgent;return-1!=(verOffset=t.indexOf("OPR"))?e="Opera":navigator.brave&&await navigator.brave.isBrave()?e="Brave":-1!=(verOffset=t.indexOf("Edg"))?e="Microsoft Edge":-1!=(verOffset=t.indexOf("MSIE"))?e="Microsoft Internet Explorer":-1!=(verOffset=t.indexOf("Chrome"))?e="Chrome":-1!=(verOffset=t.indexOf("Safari"))?e="Safari":-1!=(verOffset=t.indexOf("Firefox"))&&(e="Firefox"),e};function getRandomToken(){for(var e=new Uint8Array(32),t=(crypto.getRandomValues(e),""),a=0;a<e.length;++a)t+=e[a].toString(16);return t}"undefined"!=typeof module&&null!=module.exports&&((dummyModule=module).exports={logTrace:logTrace,log:log,info:info,warn:warn,debug:debug,logOk:logOk,logError:logError,consoleHeader:consoleHeader,getDisplayId:getDisplayId,isObject:isObject,isPdfUrl:isPdfUrl,cleanPapers:cleanPapers,firstNonStopLowercase:firstNonStopLowercase,miniHash:miniHash,fallbackCopyTextToClipboard:fallbackCopyTextToClipboard,copyTextToClipboard:copyTextToClipboard,copyHyperLinkToClipboard:copyHyperLinkToClipboard,parseUrl:parseUrl,downloadTextFile:downloadTextFile,eventId:eventId,downloadFile:downloadFile,downloadURI:downloadURI,hashCode:hashCode,parseCVFUrl:parseCVFUrl,cleanBiorxivURL:cleanBiorxivURL,textareaFocusEnd:textareaFocusEnd,tablerSvg:tablerSvg,stringifyError:stringifyError,arraysIdentical:arraysIdentical,parseTags:parseTags,getPaperEdits:getPaperEdits,setFormChangeListener:setFormChangeListener,monitorPaperEdits:monitorPaperEdits,cutAuthors:cutAuthors,sendMessageToBackground:sendMessageToBackground,getStoredFiles:getStoredFiles,noParamUrl:noParamUrl,urlToWebsiteId:urlToWebsiteId,silentPromiseTimeout:silentPromiseTimeout,shouldWarn:shouldWarn,spaceCamelCase:spaceCamelCase,toSingleSpace:toSingleSpace,dedent:dedent,arxivIdFromPaperID:arxivIdFromPaperID,cleanStr:cleanStr,arxivIdFromURL:arxivIdFromURL,getBrowserName:getBrowserName});let getPat=async e=>{var t=await getStorage("syncPAT");if(!t&&(warn("No PAT found. Aborting and disabling sync."),await setStorage("syncState",!1),e))throw new Error("No PAT found.");return t},getIdentifier=async()=>{var e=await getBrowserName();let t=await getStorage("syncId");return t||(t=e+"-"+(t=getRandomToken()),info("No syncId found. Creating new one: ",t),await setStorage("syncId",t)),t},getGist=async r=>{let i=(r=r??{}).pat;var o=r.store??!0,r=r.patError??!0;try{i=i||await getPat(r);let t=await getStorage("syncTest")?"TestsPaperMemorySync":"DO_NO_EDIT__PaperMemorySyncV2.json",a="Automated PaperMemory sync Gist. Do not edit manually.",e=(await octokitRequest.defaults({headers:{authorization:"token "+i,"X-GitHub-Api-Version":"2022-11-28"}})("GET /gists")).data?.find(e=>e.description===a&&e.files[t]);if(!e){info("No Gist found. Creating new one...");var n=await getStorage("papers");if(!(e=await createGistWithFile({filename:t,pat:i,description:a,content:n})))return{ok:!1,payload:"wrongPAT"}}file=e.files[t];var s=e.id;return o&&await setStorage("syncPAT",i),{ok:!0,payload:{file:file,pat:i,gistId:s}}}catch(e){return console.log(e),warn("Because of the error ^ syncing is now disabled."),setStorage("syncState",!1),{ok:!1,payload:"wrongPAT",error:e}}},createGistWithFile=async({file:e,pat:t,content:a,description:r="Automated PaperMemory sync Gist. Do not edit manually."})=>{if(void 0===e)throw new Error("No file provided.");return"string"!=typeof a&&(a=JSON.stringify(a,null,"")),"string"==typeof e&&(e={filename:e}),t=t||await getPat(),(await octokitRequest.defaults({headers:{authorization:"token "+t,"X-GitHub-Api-Version":"2022-11-28"}})("POST /gists",{description:r,files:{[e.filename]:{content:a}},public:!1})).data},getDataForGistFile=async({file:t,pat:e,gistId:a})=>{"string"==typeof t&&(t={filename:t}),e=e||await getPat();var r,e=octokitRequest.defaults({headers:{authorization:"token "+e,"X-GitHub-Api-Version":"2022-11-28"}});let i;return i=a?(await e("GET /gists/"+a)).data:(await e("GET /gists")).data?.find(e=>e.files[t.filename]),(t=i.files[t.filename]).filename.endsWith(".json")?({data:a,status:r}=await fetchJSON(t.raw_url),a):fetchText(t.raw_url)},updateGistFile=async({file:e,content:t,gistId:a,pat:r})=>(r=r||await getPat(),"string"!=typeof t&&(t=JSON.stringify(t,null,"")),"string"==typeof e&&(e={filename:e}),octokitRequest.defaults({headers:{authorization:"token "+r,"X-GitHub-Api-Version":"2022-11-28"}})("PATCH /gists/"+a,{files:{[e.filename]:{content:t}}})),pushToRemote=async()=>sendMessageToBackground({type:"writeSync"}),pullFromRemote=async(e,t)=>{var a=Date.now(),r=await sendMessageToBackground({type:"pullSync"});return consoleHeader("PaperMemory Pull "+String.fromCodePoint("0x1F504")),log("Remote Papers pulled: ",r),r&&(await initState({isContentScript:t,papers:r??e,print:!1}),t=(Date.now()-a)/1e3,info(`Successfully pulled from Github (${t}s).`),await setStorage("papers",global.state.papers)),console.groupEnd(),r},shouldSync=async()=>!!await getStorage("syncState"),initSyncAndState=async({papers:e=null,isContentScript:t=!1,forceInit:a=!1,stateIsReady:r=()=>{},remoteIsReady:i=()=>{}}={})=>{global.state.dataVersion&&!a||await initState({papers:e,isContentScript:t}),r(),await shouldSync()&&(t||startSyncLoader(),await pullFromRemote(e,t)?t||(a=global.state.sortedPapers.length,setPlaceholder("memory-search",`Search ${a} entries...`),global.state.memoryIsOpen||window.location.href.includes("options.html")||await makeMemoryHTML(),successSyncLoader()):t||errorSyncLoader()),i()},startSyncLoader=async()=>{showId("sync-popup-feedback"),hideId("sync-popup-error"),hideId("sync-popup-synced"),showId("sync-popup-syncing","flex")},successSyncLoader=async()=>{showId("sync-popup-feedback"),hideId("sync-popup-syncing"),hideId("sync-popup-error"),showId("sync-popup-synced"),setTimeout(()=>{hideId("sync-popup-feedback")},2e3)},errorSyncLoader=async()=>{showId("sync-popup-feedback"),hideId("sync-popup-syncing"),hideId("sync-popup-synced"),showId("sync-popup-error"),setTimeout(()=>{hideId("sync-popup-feedback")},2e3)},deleteGist=async({gistId:e,pat:t})=>(t=t||await getPat(),octokitRequest.defaults({headers:{authorization:"token "+t,"X-GitHub-Api-Version":"2022-11-28"}})("DELETE /gists/"+e)),sleep=async t=>new Promise(e=>setTimeout(e,t)),measureCacheTime=async({maxTime:a=1e5})=>{var r=`PaperMemory-cache-test-${Math.random().toString(36).substring(7)}.json`,i={test:"test",data:{counter:0}},o=await createGistWithFile({file:r,content:i,description:"PaperMemory cache test. You *can* delete this."}),n=(console.log("Test gist: ",o),o.id);try{var s=o.files[r],l=(i.data.counter++,await updateGistFile({file:s,content:i,gistId:n})),p=(console.log("updateResp: ",l),Date.now());let e,t=0;for(;;){var c=await getDataForGistFile({file:s,gistId:n});if(console.log(""),console.log("data: ",c),e=(Date.now()-p)/1e3,console.log("Time: ",e,"at iteration: ",t),1===c.data.counter)break;if(await sleep(500),e>a)break;t++}e>a?warn("Cache time too long: > maxTime=",a,"ms"):info(`Cache time: ${e}s`)}catch(e){console.log(e)}finally{info("Deleting test gist..."),await deleteGist({gistId:n})}},migrateData=("undefined"!=typeof module&&null!=module.exports&&((dummyModule=module).exports={getPat:getPat,getIdentifier:getIdentifier,getGist:getGist,createGistWithFile:createGistWithFile,getDataForGistFile:getDataForGistFile,updateGistFile:updateGistFile,pushToRemote:pushToRemote,pullFromRemote:pullFromRemote,shouldSync:shouldSync,initSyncAndState:initSyncAndState,startSyncLoader:startSyncLoader,successSyncLoader:successSyncLoader,errorSyncLoader:errorSyncLoader,deleteGist:deleteGist,sleep:sleep,measureCacheTime:measureCacheTime}),async(a,r,e=!0)=>{if(void 0===a)return chrome.storage.local.set({papers:{__dataVersion:r}}),{papers:{__dataVersion:r},success:!0};var i,o,n,s,l,p,c,d,u=a.__dataVersion||-1,h=[];let f={...a};try{if(10001<=u)return log("No migration needed"),{papers:a,success:!0};e&&backupData({...a}),delete a.__dataVersion;let t={};for(var m in a){if(t[m]=[],u<5&&(a[m].hasOwnProperty("bibtex")||(a[m].bibtex="",t[m].push("(m5) bibtex default")),a[m].pdfLink.endsWith(".pdf")||(a[m].pdfLink=a[m].pdfLink+".pdf",t[m].push("(m5) pdfLink to .pdf")),a[m].codeLink||(a[m].codeLink="",t[m].push("(m5) codeLink default")),a[m].source||(a[m].id.includes("NeurIPS")?(a[m].source="neurips",t[m].push("(m5) NeurIPS to neurips")):(a[m].source="arxiv",t[m].push("(m5) source default is arxiv")))),u<208&&("arxiv"!==a[m].source&&a[m].md.includes("https://arxiv.com/abs/")&&(a[m].md=`[${a[m].title}](${a[m].pdfLink})`,t[m].push("(m208) md from title and pdfLink")),"arxiv"!==a[m].source&&a[m].pdfLink.includes("arxiv.org/pdf/")&&(a[m].source="arxiv",t[m].push("(m208) set arxiv source from pdfLink")),m.match(/^\d/))&&"arxiv"===a[m].source&&(i="Arxiv-"+m,o={...a[m],id:i},a[i]=o,h.push(m),t[m].push("(m208) new arxiv id to Arxiv-")),u<209&&(a[m].hasOwnProperty("favorite")||(a[m].favorite=!1,a[m].favoriteDate="",t[m].push("(m209) favorite defaults"))),u<210&&("arxiv"===a[m].source&&(n=a[m].pdfLink.match(/v\d+\.pdf/gi))&&0<n.length&&(a[m].pdfLink=a[m].pdfLink.replace(n[0],".pdf"),t[m].push("(m210) remove pdf version")),a[m].hasOwnProperty("bibtext"))&&(a[m].bibtex=a[m].bibtext+"",delete a[m].bibtext,t[m].push("(m210) bibtext typo to bibtex")),u<450&&!a[m].hasOwnProperty("venue"))try{a[m].venue=await makeVenue(a[m]),t[m].push("(m450) venue from id")}catch(e){logError(e),a[m].venue="",t[m].push("(m450) ERROR in venue from id")}if(u<502&&(m.startsWith("ACL-")&&"acl"!==a[m].source&&(a[m].source="acl",t[m].push("(m502) fix set source to acl")),"acs"===a[m].source)&&(a[m].pdfLink=a[m].pdfLink.replace("/doi/pdf/abs/","/doi/pdf/"),t[m].push("(m502) fix acs pdfLink")),u<510&&(a[m].venue?.toLowerCase().includes("arxiv")&&(a[m].venue="",a[m].note=a[m].note.replace(/accepted\s*@\s*arxiv\.org.+semanticscholar\.org\]/gi,"").trim(),t[m].push("(m509) fix: remove arxiv as venue")),!1===a[m].codeLink&&(a[m].codeLink="",t[m].push("(m509) codeLink from false to ''")),"string"!=typeof a[m].year&&(a[m].year=a[m].year+"",t[m].push("(m509) year to string"),"undefined"===a[m].year)&&(a[m].year="unknown",t[m].push("(m509) empty year to unknown")),void 0===a[m].venue)&&(a[m].venue="",t[m].push("(m509) venue undefined to ''")),u<513&&"iop"===a[m].source&&(l=(s=m).split("_")[1],p=s.split("_")[0]+"_"+miniHash(l),a[p]={...a[s]},h.push(s),t[m].push("(m513) iop doi-in-id to minihash")),u<1e4){if("acm"===a[m].source){let e=a[m].bibtex;var g=e.split("\n");g[0].includes("?")&&(g[0]=g[0].split("?")[0]+","),e=g.join("\n"),a[m].bibtex=e,t[m].push("(m10000) fix acm bibtex")}a[m].bibtex&&(c=bibtexToObject(a[m].bibtex))&&c.hasOwnProperty("abstract")&&(delete c.abstract,t[m].push("(m10000) remove bibtex abstract"),a[m].bibtex=bibtexToString(c))}u<10001&&a[m].bibtex&&!a[m].hasOwnProperty("doi")&&(d=bibtexToObject(a[m].bibtex).doi)&&(a[m].doi=d,t[m].push("(m10001) add doi from bibtex"))}return h.forEach((e,t)=>{delete a[e],log("Deleting "+e)}),(f={...a}).__dataVersion=r,info("Migration summary:"),Object.keys(t).forEach(e=>{0<t[e].length&&log(e+":\n\t  "+t[e].join("\n\t  "))}),e&&chrome.storage.local.set({papers:f},()=>{log("Migrated papers:"),log(f),log("Data version is now "+r)}),{papers:f,success:!0}}catch(e){return log(`Error migrating data from version ${u} to ${r}: `),log(e),{papers:f,success:!1,error:e}}}),logStorage=t=>{chrome.storage.local.get(t,e=>{log(e[t])})},getStorage=async a=>new Promise((t,e)=>{chrome.storage.local.get(a,e=>{t("string"==typeof a?e[a]:e)})}),setStorage=async(a,r,i=()=>{})=>new Promise((e,t)=>{chrome.storage.local.set({[a]:r},()=>{i(),e(!0)})}),deletePaperInStorage=async(e,t)=>{let a=!1;(t=t||(await getStorage("papers")??{})).hasOwnProperty(e)&&(updateDuplicatedUrls(null,e,!0),a=(a=delete global.state.titleHashToIds[miniHash(t[e].title)])&&delete t[e],delete global.state.papers[e]),a?(await setStorage("papers",t),global.state.papersList=Object.values(cleanPapers(global.state.papers)),sortMemory(),log("Successfully deleted paper",e)):log("Error: no deletion")},getTheme=async()=>await getStorage("checkDarkMode")?"dark":"light",backupData=async a=>{chrome.storage.local.get("papersBackup",({papersBackup:e})=>{var t;void 0===e&&(e={});for(t of Object.keys(e).map(e=>parseInt(e)).sort((e,t)=>e<t?1:-1).slice(4))delete e[t];e[a.__dataVersion]=a,chrome.storage.local.set({papersBackup:e},()=>{log("Backed up data with version: "+a.__dataVersion)})})};function dateDiffInDays(e,t){e=Date.UTC(e.getFullYear(),e.getMonth(),e.getDate()),t=Date.UTC(t.getFullYear(),t.getMonth(),t.getDate());return Math.floor((t-e)/864e5)}let weeklyBackup=async()=>{var e=await getStorage("weeklyBackups")??{},t=new Date,a=Object.keys(e).map(e=>new Date(e)).sort((e,t)=>e.getTime()-t.getTime());if(0<a.length&&dateDiffInDays(a[a.length-1],t)<7)return;var r,i={};for(r of a.reverse().slice(0,5))i[r.toString()]=e[r.toString()];i[t.toString()]=await getStorage("papers")??{},setStorage("weeklyBackups",i)},getPrefs=async()=>{let e=!1,t;var a,r=await getStorage("prefs")??{},i=((e=0===Object.keys(r).length?!0:e)&&(t=await getStorage(global.prefsStorageKeys)??{}),{});for(a of global.prefsCheckNames)i[a]=(t??r).hasOwnProperty(a)?(t??r)[a]:!(0<=global.prefsCheckDefaultFalse.indexOf(a));return i.checkOfficialRepos&&(setStorage("pwcPrefs",{official:!0}),delete i.checkOfficialRepos,setStorage("prefs",i)),e&&setStorage("prefs",i),i},getManifestDataVersion=()=>chrome.runtime.getManifest().version.split(".").map((e,t)=>parseInt(e)*10**(4-2*t)).reduce((e,t)=>e+t),versionToSemantic=e=>(e=(e-=1e4*(major=parseInt(e/1e4,10)))-100*(minor=parseInt(e/100,10)),`${major}.${minor}.`+e),validatePaper=(t,e=!0)=>{var a,r,i,o={addDate:{type:"string",desc:"the paper's date of addition to the Memory",default:e=>(new Date).toJSON(),validation:e=>{try{new Date(e)}catch(e){return`Invalid addDate (could not parse as date: ${e})`}}},author:{type:"string",desc:"` and `-separated authors `${firstName} ${lastName}`",validation:e=>{if(!e)throw Error(`No author: ${e} for paper ${t.id}:
${JSON.stringify(t,null,2)}
Fix the json file and try again.
`)}},bibtex:{type:"string",desc:"BibTex citation with new lines (`\n`)",validation:t=>{try{bibtexToObject(t)}catch(e){return`Invalid BibTex: ${e} :
`+t}}},code:{type:"object",desc:"the paper's code object as returned by the PapersWithCode API",default:e=>({})},codeLink:{type:"string",desc:"the paper's code link",default:e=>"",validation:t=>{try{parseUrl(t)}catch(e){return`Invalid codeLink (${t}): `+e}}},count:{type:"number",desc:"the paper's number of visits",default:e=>1,validation:e=>{if(e<0)return`Invalid count (${e}): must be >= 0`}},doi:{type:"string",desc:"the paper's doi",default:e=>bibtexToObject(e.bibtex).doi??""},extras:{type:"object",desc:"extra information about the paper which may be required per source",optional:!0},favorite:{type:"boolean",desc:"user wants to star the paper",default:e=>!1},favoriteDate:{type:"string",desc:"date the paper was added as a favorite",default:e=>""},id:{type:"string",desc:"Unique PaperMemory ID"},key:{type:"string",desc:"BibTex citation key",default:e=>"defaultKey_"+e.id},lastOpenDate:{type:"string",desc:"When the paper was last opened",default:e=>(new Date).toJSON()},md:{type:"string",desc:"markdown-formatted string `[${title}](${pdfLink})`",default:e=>`[${e.title}](${e.pdfLink})`},note:{type:"string",desc:"the user's note for this paper",default:e=>""},pdfLink:{type:"string",desc:"the link to the paper's pdf"},source:{type:"string",desc:"the paper's source i.e. where it was added to the memory from",validation:e=>{if(Object.keys(global.knownPaperPages).indexOf(e)<0)return"Unknown source "+e}},tags:{type:"array[string]",desc:"the user's tags for this paper",default:e=>[]},title:{type:"string",desc:"the paper's title",validation:e=>{if(!e)throw Error(`No title: ${e} for paper ${t.id}:
${JSON.stringify(t,null,2)}
Fix the json file and try again.
`)}},venue:{type:"string",desc:"the paper's publication venue",default:e=>""},year:{type:"string",desc:"year of publication",validation:e=>{if(!/^\d{4}$/.test(e))return`Invalid year (${e}): must be 4 digits exactly`}}},n={};for(a in o)if(n[a]||(n[a]=[]),t.hasOwnProperty(a)){var s,l=o[a].type,p=typeof t[a];l.includes("array")||"object"===l?l.includes("array")?Array.isArray(t[a])?(c=l.split("[")[1].replace("]",""),0<t[a].length&&(s=typeof t[a][0])!==c&&(message=` ${a} should contain ${c} not ${s} (${t.id})`,n[a].push(message),e)&&console.warn(message)):(message=`${a} should be an array (${t.id})`,n[a].push(message),e&&console.warn(message)):Object(t[a])!==t[a]&&(message=`${a} should be an object (${t.id})`,n[a].push(message),e)&&console.warn(message):p!==l&&(message=` ${a} should be of type ${l} not ${p} (${t.id})`,n[a].push(message),e)&&console.warn(message)}else if(o[a].default){var c=o[a].default(t);t[a]=c,message=` Attribute "${a}" absent; will be set to '${JSON.stringify(c)}' (${t.id})`,n[a].push(message),e&&console.warn(message)}else if(!o[a].optional)throw new Error(`Cannot continue, paper is corrupted. Missing mandatory attribute "${a}" in `+t.id);for(r in o)o[r].validation&&(i=o[r].validation(t[r]))&&(n[r]||(n[r]=[]),n[r].push(i),e)&&console.warn(i+` (${t.id})`);return{warnings:n,paper:t}},prepareOverwriteData=async e=>{let t=!0,a="",r="",i;try{e.__dataVersion||(e.__dataVersion=1);var o,n,s=await migrateData(e,getManifestDataVersion(),!1);if(!s.success)return r="Could not migrate the data before storing it",s.error&&(r+=":<br/>"+stringifyError(s.error)),{success:!1,message:r};for(o in i=s.papers)o.startsWith("__")||(paperWarnings=validatePaper(i[o]).warnings)&&0<paperWarnings.length&&(a+="<br/>"+Object.entries(paperWarnings).map((e,t)=>`<h5>${e}</h5>`+t.join("<br/>")).join("<br/>"));a&&(n=await getStorage("papers")??{},setStorage("uploadBackup",n)),t=!1}catch(e){log("prepareOverwriteData error",e),r='<h5 class="errorTitle"> /!\\ OverwriteMemoryError:</h5><br/>'+stringifyError(e),t=!0}return{success:!t,message:r,warning:a,papersToWrite:i}},makeVenue=async e=>{let t="";switch((t=e.note&&e.note.match(/(accepted|published)\ @\ .+\(?\d{4}\)?/i)?e.note.split("@")[1].trim().replace(/\(?\d{4}\)?/,"").split("--")[0].trim():t)&&"neurips"===t.toLowerCase()&&(t="NeurIPS"),e.source){case"arxiv":break;case"neurips":t="NeurIPS";break;case"cvf":t=t||(await makeCVFPaper(e.pdfLink)).venue;break;case"openreview":t=t||(await makeOpenReviewPaper(e.pdfLink)).venue;break;case"biorxiv":break;case"pmlr":t=e.conf?.split(/\d{4}/)[0]??"";break;case"acl":t=e.conf??"";break;case"pnas":t="PNAS";break;case"nature":t=t||e.venue;break;case"iop":case"acs":t=e.venue}return t},makeTitleHashToIdList=e=>{var t,a,r={};for([t,a]of Object.entries(cleanPapers(e))){var i=miniHash(a.title);r.hasOwnProperty(i)||(r[i]=[]),r[i].push(t)}return r},isPaper=("undefined"!=typeof module&&null!=module.exports&&((dummyModule=module).exports={migrateData:migrateData,logStorage:logStorage,getStorage:getStorage,setStorage:setStorage,deletePaperInStorage:deletePaperInStorage,getTheme:getTheme,backupData:backupData,weeklyBackup:weeklyBackup,getPrefs:getPrefs,getManifestDataVersion:getManifestDataVersion,versionToSemantic:versionToSemantic,validatePaper:validatePaper,prepareOverwriteData:prepareOverwriteData,makeVenue:makeVenue,makeTitleHashToIdList:makeTitleHashToIdList}),async(e,t=!1)=>{var a={};if(e){for(var r in global.knownPaperPages){var i,o=global.knownPaperPages[r].patterns;a[r]=!1;for(i of o)if("string"==typeof i?e.includes(i)&&(a[r]=!0):"function"==typeof i&&(a[r]=i(e)),a[r])break}a.localFile=isKnownLocalFile(e),a.stored=!t&&(await findLocalFile(e)??!1),a.parsedWebsite=global.state.papers["Website_"+urlToWebsiteId(e)]??!1}return a}),isSourceURL=async(e,t)=>Object.values(await isPaper(e,t)).some(e=>e),paperToAbs=e=>{let t,a,r;var i=e.pdfLink;let o="";switch(e.source){case"arxiv":o=i.replace("/pdf/","/abs/").replace(".pdf","");break;case"neurips":o=i.replace("/file/","/hash/").replace("-Paper.pdf","-Abstract.html");break;case"cvf":o=i.replace("/papers/","/html/").replace(".pdf",".html");break;case"openreview":o=i.replace("/pdf?","/forum?");break;case"biorxiv":o=i.replace(".full.pdf","");break;case"pmlr":o=i.split("/").slice(0,-1).join("/")+".html";break;case"acl":o=i.replace(".pdf","");break;case"pnas":o=i.replace(".full.pdf","").replace("/doi/pdf/","/doi/full/");break;case"nature":o=i.replace(".pdf","");break;case"acs":o=i.replace("pubs.acs.org/doi/pdf/","pubs.acs.org/doi/").split("?")[0];break;case"iop":o=i.split("#")[0].replace(/\/pdf$/,"");break;case"jmlr":o=i.split("/").slice(0,-1).join("/").replace("/papers/volume","/papers/v")+".html";break;case"pmc":var n=i.match(/PMC\d+/)[0];o=i.split(n)[0]+n;break;case"ijcai":var n=i.replace(".pdf","").split("/").last().match(/[1-9]\d*/),s=i.match(/proceedings\/\d+/gi)[0].split("/")[1];o=`https://www.ijcai.org/proceedings/${s}/`+n;break;case"acm":o=i.replace("/doi/pdf/","/doi/");break;case"ieee":o="https://ieeexplore.ieee.org/document/"+e.key;break;case"springer":o=e.extra.url;break;case"aps":[t,a]=parseUrl(i).pathname.split("/").slice(1,3),o=i.replace(`/${t}/${a}/`,`/${t}/abstract/`);break;case"wiley":o=i.replace(/\/doi\/e?pdf\//g,"/doi/abs/");break;case"sciencedirect":s=i.split("/pii/")[1].split("/")[0].split("#")[0].split("?")[0];o="https://www.sciencedirect.com/science/article/pii/"+s;break;case"science":(r=i.split("/doi/")[1]).startsWith("10.")||(r=r.split("/").slice(1).join("/")),o="https://science.org/doi/full/"+r;break;case"frontiers":o=i.replace(/\/pdf$/,"/full");break;case"ihep":o="https://inspirehep.net/literature/"+e.id.split("-")[1];break;case"plos":o=i.replace("/article/file?","/article?").split("&")[0];break;case"rsc":o=i.replace("/articlepdf/","/articlelanding/");break;case"website":o=e.pdfLink;break;case"mdpi":o=e.pdfLink.split("/pdf")[0];break;case"oup":o="https://doi.org/"+e.doi;break;case"hal":o=i.split("/file/")[0].split("/document")[0];break;case"chemrxiv":o="https://chemrxiv.org/engage/chemrxiv/article-details/"+i.split("/item/")[1].split("/")[0];break;default:o="https://xkcd.com/1969/"}return o.replace("http://","https://")},paperToPDF=e=>{let t=e.pdfLink;switch(e.source){case"arxiv":t=t.replace("arxiv.org/abs/","arxiv.org/pdf/").replace(/\.pdf$/,"").replace(/v\d+$/gi,""),t+=".pdf";break;case"neurips":t=t.replace("/hash/","/file/").replace("-Abstract.html","-Paper.pdf");break;case"cvf":t=t.replace("/html/","/papers/").replace(".html",".pdf");break;case"openreview":t=t.replace("/forum?","/pdf?");break;case"biorxiv":t=cleanBiorxivURL(t)+".full.pdf";break;case"pmlr":case"acl":case"pnas":break;case"nature":t.endsWith(".pdf")||(t+=".pdf");break;case"iop":t.endsWith("/pdf")||(t+="/pdf");break;case"acs":case"jmlr":case"pmc":case"ijcai":case"acm":case"ieee":case"springer":case"aps":case"wiley":case"sciencedirect":case"science":case"frontiers":case"ihep":case"plos":case"rsc":case"mdpi":case"oup":case"hal":case"chemrxiv":case"website":break;default:t="https://xkcd.com/1969/"}return t.replace("http://","https://")},findLocalFile=async t=>{if("string"==typeof t){let e;try{e=await parseIdFromUrl(t)}catch(e){return new Promise(e=>e(null))}if(!global.state.papers.hasOwnProperty(e))return new Promise(e=>e(null));paper=global.state.papers[e]}else paper=t;t=await getStoredFiles(),t=await matchPapersToFiles({[paper.id]:paper},t),t=Object.values(t);return 1===t.length?t[0]:null},matchPapersToFiles=async(e,t)=>{var a,r=Object.fromEntries(Object.values(e).map(e=>[e.id,miniHash(e.title)])),i=(t=t.filter(e=>e.exists&&"complete"===e.state&&!e.filename.toLowerCase().includes("readme.txt")),Object.fromEntries(t.map(e=>[e.id,miniHash(e.filename)]))),o={};for(a of t){let t;try{(t=await parseIdFromUrl(a.finalUrl))&&e.hasOwnProperty(t)&&(o[t]=a)}catch(e){t=null}if(!t){let t=i[a.id];var n=Object.entries(r).find(([,e])=>t.includes(e));n&&(o[n[0]]=a)}}return o},matchAllFilesToPapers=()=>new Promise((t,e)=>{chrome.downloads.search({filenameRegex:"PaperMemoryStore/.*"},async e=>{e=await matchPapersToFiles(cleanPapers(global.state.papers),e);t(e)})}),mergePapers=(e={newPaper:{},oldPaper:{}})=>{let{oldPaper:t,newPaper:a,...r}=e;var i,o,n={...t},e={overwrites:["lastOpenDate"],incrementCount:!1,syncMerge:!1,...r};for(i in a)(!t.hasOwnProperty(i)||a[i]&&!t[i])&&(n[i]=a[i]);e.incrementCount&&1===n.count&&(n.count+=1),e.syncMerge&&(n.count=t.count+a.count,n.note=t.note??"",a.note&&a.note!==t.note&&(n.note+="\n\n--[Sync Merge]--\n",n.note+=a.note),n.tags=[...t.tags,...a.tags],n.lastOpenDate=a.lastOpenDate,a.lastOpenDate>t.lastOpenDate&&(n.lastOpenDate=a.lastOpenDate),n.addDate=a.addDate,a.addDate>t.addDate)&&(n.addDate=a.addDate);for(o of e.overwrites)a.hasOwnProperty(o)&&(n[o]=a[o]);return n},updatePaperVisits=e=>(e.count+=1,e.lastOpenDate=(new Date).toJSON(),log("Updating paper to:",e),e),addOrUpdatePaper=async({url:a,is:r,prefs:i,tab:e,store:o=!0,contentScriptCallbacks:n={update:()=>{},preprints:()=>{}}})=>{let s=Date.now(),l,p,c={};consoleHeader("PaperMemory Parsing "+String.fromCodePoint("0x1F4DD")),global.state.papers=await getStorage("papers")??{};var t=await parseIdFromUrl(a,e),d=global.state.papers.hasOwnProperty(t);if(t&&d&&"anonymous"!==global.state.papers[t].author.toLowerCase())l=updatePaperVisits(global.state.papers[t]),p=!1;else{let t=await makePaper(r,a,e);if(!t)return;global.state.titleHashToIds=makeTitleHashToIdList(global.state.papers);d=findFuzzyPaperMatch(global.state.titleHashToIds,t);if(d&&o){let e=global.state.papers[d];log("New paper",t,"already exists as",e),addPaperToTitleHashToId(t),e.venue?(r=["lastOpenDate"],"anonymous"===e.author.toLowerCase()&&(r.push("author"),r.push("year"),r.push("venue"),r.push("bibtex"),r.push("note")),console.log("overwrites: ",r),e=mergePapers({newPaper:t,overwrites:r,oldPaper:e,incrementCount:!1}),updateDuplicatedUrls(a,d)):t.venue?(updateDuplicatedUrls(paperToAbs(e),t.id),updateDuplicatedUrls(paperToPDF(e),t.id),await deletePaperInStorage(e.id,global.state.papers),e=mergePapers({newPaper:t,oldPaper:e,incrementCount:!1,overwrites:["lastOpenDate","venue","bibtex","id","key","pdfLink","source","year","author"]})):"anonymous"===e.author.toLowerCase()&&(e=mergePapers({newPaper:t,oldPaper:e,incrementCount:!0,overwrites:["lastOpenDate","author","year","venue","bibtex","note"]})),t=updatePaperVisits(e),p=!1}else p=!0;l=t}if(!l.codeLink||!l.venue)try{var u=await tryPWCMatch(l),h=!l.codeLink&&u?.codeLink,f=u?.note,m=u?.bibtex,g=!l.venue&&u?.venue;(c={codeLink:h,note:f,venue:g,bibtex:m}).codeLink&&(l.codeLink=c.codeLink,u.hasOwnProperty("note")&&delete u.note,l.code=u)}catch(e){log("Error trying to discover a code repository:"),log(e)}return global.state.papers=await getStorage("papers")??{},p&&global.state.papers.hasOwnProperty(l.id)&&(warn("Paper has been created by another page: merging papers."),l=mergePapers({newPaper:global.state.papers[l.id],oldPaper:l,incrementCount:!0}),p=!1),o&&!global.state.deleted[l.id]&&(global.state.papers[l.id]=l),chrome.storage.local.set({papers:global.state.papers},async()=>{n.update(l),pushToRemote();let e;if(p||c.codeLink?p?(o?logOk("Added '"+l.title+"' to your Memory!"):warn("Discovered '"+l.title+"' but did not store it (`store` is false)."),log("paper: ",l),e="Added to your Memory",c.codeLink&&(e+="<br/><div id='feedback-pwc'>(+ repo from PapersWithCode) </div>"),i&&i.checkFeedback&&o&&feedback(e,l)):(e="Found a code repository on PapersWithCode!",i&&i.checkFeedback&&o&&feedback(e)):o&&logOk("Updated '"+l.title+"' in your Memory"),!l.note||!l.venue||"anonymous"===l.author.toLowerCase()){var t,a,r=await tryPreprintMatch(l);for(t of["note","venue","bibtex","doi"])l[t]&&"bibtex"!==t||(a=r[t]??c[t])&&(log(`Updating preprint ${t} to`,a),l[t]=a);global.state.papers=await getStorage("papers")??{},p&&global.state.papers.hasOwnProperty(l.id)&&1<global.state.papers[l.id].count&&(warn("Paper has been created by another page: merging papers."),l=mergePapers({newPaper:global.state.papers[l.id],oldPaper:l,incrementCount:!1})),o&&!global.state.deleted[l.id]&&(global.state.papers[l.id]=l),await new Promise(e=>chrome.storage.local.set({papers:global.state.papers},e))}n.preprints(l),pushToRemote(),info(`Done processing paper (${(Date.now()-s)/1e3}s).`),console.groupEnd()}),{paper:l,id:t}},findPaperForProperty=(e,t,a,r="id")=>e.find(e=>e.source===t&&e[r].includes(a))?.id,parseIdFromUrl=async(t,e=null)=>{if(e)return urlToWebsiteId(t);let a;e=miniHash(t),e=global.state.urlHashToId[e];if(e)return e;var e=await isPaper(t,!0),r=Object.values(cleanPapers(global.state.papers));if(e.arxiv){var i=arxivIdFromURL(t),i=(a="Arxiv-"+i,Object.values(global.state.titleHashToIds).find(e=>e.includes(a)));i&&(a=i.find(e=>!e.startsWith("Arxiv-"))??a)}else if(e.neurips){var i=t.split("/paper/")[1].split("/")[0],o=t.split("/").last().split("-")[0].slice(0,8);a=`NeurIPS-${i}_`+o}else if(e.cvf)a=parseCVFUrl(t).id;else if(e.openreview){i=t.match(/id=\w+/)[0].replace("id=","");a=findPaperForProperty(r,"openreview",i)}else if(e.biorxiv){let e=(t=cleanBiorxivURL(t)).split("/").last();e.match(/v\d+$/)&&(e=e.split("v")[0]),a="Biorxiv-"+e;var o=Object.values(global.state.titleHashToIds).find(e=>e.includes(a));o&&(a=o.find(e=>!e.startsWith("Biorxiv-"))??a)}else if(e.pmlr){i=t.split("/").last().split(".")[0],o="20"+i.match(/\d+/)[0];a=`PMLR-${o}-`+i}else if(e.acl){o=(t=(t=t.replace(".pdf","")).endsWith("/")?t.slice(0,-1):t).split("/").last();a=findPaperForProperty(r,"acl",o)}else if(e.pnas){i=((t=t.replace(".full.pdf","")).endsWith("/")?t.split("/").slice(-2):t.split("/").slice(-1))[0];a=findPaperForProperty(r,"pnas",i)}else if(e.nature){o=(t=t.replace(".pdf","").split("#")[0]).split("/").last();a=findPaperForProperty(r,"nature",o)}else if(e.acs){t=noParamUrl(t).replace("pubs.acs.org/doi/pdf/","/doi/").replace("pubs.acs.org/doi/abs/","/doi/");let e=miniHash(t.split("/doi/")[1]);a="ACS_"+e}else if(e.iop){t=noParamUrl(t).replace(/\/pdf$/,"");let e=miniHash(t.split("/article/")[1].split("/meta")[0]);a="IOPscience_"+e}else if(e.jmlr){i=(t=(t=t.endsWith(".pdf")?t.split("/").slice(0,-1).join("/"):t).replace(".html","")).split("/").last(),o="20"+i.match(/\d+/)[0];a=`JMLR-${o}_`+i}else if(e.pmc){o=t.match(/PMC\d+/g)[0].replace("PMC","");a=findPaperForProperty(r,"pmc",o)}else if(e.ijcai){i=t.endsWith(".pdf")?t.replace(".pdf","").split("/").last().match(/[1-9]\d*/):t.split("/").last(),o=t.match(/proceedings\/\d+/gi)[0].split("/")[1];a=`IJCAI-${o}_`+i}else if(e.acm){let e=t.replace(/\/doi\/?(pdf|abs|full)?\//,"/doi/").split("/doi/")[1];a=findPaperForProperty(r,"acm",miniHash(e))}else if(e.ieee){o=(t.includes("ieee.org/document/")?t.split("ieee.org/document/"):t.includes("ieee.org/abstract/document/")?t.split("ieee.org/abstract/document/"):t.split("arnumber="))[1].match(/\d+/)[0];a=findPaperForProperty(r,"ieee",o)}else if(e.springer){let e=global.sourceExtras.springer.types.filter(e=>t.includes(`/${e}/`))[0];if(!e){if(!t.includes("/content/pdf/"))throw new Error("Could not find Springer type for "+t);e="content/pdf"}i=noParamUrl(t).split(`/${e}/`)[1].replace(".pdf","");a=findPaperForProperty(r,"springer",miniHash(i))}else if(e.aps){var[o,i]=parseUrl(t.split("#")[0]).pathname.split("/").slice(1,3);let e=t.split(`/${o}/${i}/`).last();a=findPaperForProperty(r,"aps",miniHash(e))}else if(e.wiley){let e=t.split("?")[0].split("#")[0].split("/").slice(-2).join("/");a=findPaperForProperty(r,"wiley",miniHash(e))}else if(e.sciencedirect){o=t.split("/pii/")[1].split("/")[0].split("#")[0].split("?")[0];a=findPaperForProperty(r,"sciencedirect",miniHash(o))}else if(e.science)(doi=noParamUrl(t).split("/doi/")[1]).startsWith("10.")||(doi=doi.split("/").slice(1).join("/")),a=findPaperForProperty(r,"science",miniHash(doi));else if(e.frontiers)doi=noParamUrl(t).split("/articles/")[1].split("/").slice(0,-1).join("/"),a=findPaperForProperty(r,"frontiers",miniHash(doi));else if(e.ihep)a=t.includes("/literature/")?(i=noParamUrl(t).match(/\/literature\/(\d+)/)[1],findPaperForProperty(r,"ihep",i)):(o=noParamUrl(t).split("/files/")[1].split("/")[0],findPaperForProperty(r,"ihep",o,"pdfLink"));else if(e.plos){let e=t.split("?id=").last().split("&")[0];a=findPaperForProperty(r,"plos",miniHash(e))}else if(e.rsc){i=noParamUrl(t).split("/").last();a=findPaperForProperty(r,"rsc",miniHash(i))}else if(e.mdpi){o=noParamUrl(t.split("mdpi.com/")[1].split("/pdf")[0].split("/reprints")[0].split("/notes")[0]);a=findPaperForProperty(r,"mdpi",miniHash(o))}else if(e.oup){t=noParamUrl(t).split("https://academic.oup.com/").last();i=(t=isPdfUrl(t)?t.split("/").slice(0,-1).join("/"):t).split("/").slice(2).join("");a=findPaperForProperty(r,"oup",miniHash(i))}else if(e.hal){o=(t=noParamUrl(t).replace(/(hal\.science\/\w+-\d+)(v\d+)?((\/document|\/file\/.+\.pdf))?/,"$1")).split("/").last();a=findPaperForProperty(r,"hal",miniHash(o))}else if(e.chemrxiv)chemRxivId=chemRxivId=isPdfUrl(t)?t.split("/item/")[1].split("/")[0]:noParamUrl(t).split("/").last(),a=findPaperForProperty(r,"chemrxiv",miniHash(chemRxivId));else if(e.localFile)a=e.localFile;else{if(!e.parsedWebsite)throw new Error("unknown paper url. Is: "+JSON.stringify(e));a=e.parsedWebsite.id}return a},isKnownLocalFile=e=>{if(!e.startsWith("file://"))return!1;if(!e.endsWith(".pdf"))return!1;let t=decodeURIComponent(e).replace("file://","");var a=Object.entries(global.state.files).filter(([,e])=>e.filename===t);if(0<a.length)return console.log("Found stored"),a[0][0];let r=decodeURIComponent(e.split("/").last()).toLowerCase().replace(/\W/g,"");a=Object.values(cleanPapers(global.state.papers)).map(e=>({title:miniHash(e.title),id:e.id})).filter(e=>r.includes(e.title));return 0!==a.length&&a[0].id},makeMdLink=(e,t={})=>{var a=(t.checkPreferPdf?paperToPDF:paperToAbs)(e);let r="",i=(!t.checkMdYearVenue||(r=(r=e.note.match(/(.+)\s*@\s*([\w\s]+\(?\d{4}\)?)/i))&&r[2]?.replace(/\s+/g," ").replace(/[\(\)]/g,""))||(r="",e.venue&&(r+=e.venue+" "),r+=e.year),e.title);return`[${i=r?`${i} (${r.replace(/\s+/g," ")})`:i}](${a})`},duration=("undefined"!=typeof module&&null!=module.exports&&((dummyModule=module).exports={isPaper:isPaper,isSourceURL:isSourceURL,paperToAbs:paperToAbs,paperToPDF:paperToPDF,findLocalFile:findLocalFile,matchPapersToFiles:matchPapersToFiles,matchAllFilesToPapers:matchAllFilesToPapers,mergePapers:mergePapers,updatePaperVisits:updatePaperVisits,addOrUpdatePaper:addOrUpdatePaper,findPaperForProperty:findPaperForProperty,parseIdFromUrl:parseIdFromUrl,isKnownLocalFile:isKnownLocalFile,makeMdLink:makeMdLink}),e=>(Date.now()-e[0])/1e3),initState=async({papers:e,isContentScript:t,print:a=!0}={})=>{var r=[],i=(r.unshift(Date.now()),a&&consoleHeader("PaperMemory Init "+String.fromCodePoint("0x2705")),e||(e=await getStorage("papers")??{},a&&log("Time to retrieve stored papers (s): "+duration(r))),r.unshift(Date.now()),global.state.dataVersion=getManifestDataVersion(),a&&log("Time to parse data version (s): "+duration(r)),r.unshift(Date.now()),weeklyBackup(),a&&log("Time to backup papers (weekly) (s): "+duration(r)),r.unshift(Date.now()),await migrateData(e,global.state.dataVersion));a&&log("Time to migrate data (s): "+duration(r)),r.unshift(Date.now()),e=i.papers,global.state.papers=e,global.state.prefs=await getPrefs(),a&&log("Time to retrieve user preferences (s): "+duration(r)),r.unshift(Date.now()),global.state.ignoreSources=await getStorage("ignoreSources")??{},a&&log("Time to retrieve sources to ignore (s): "+duration(r)),r.unshift(Date.now()),global.state.urlHashToId=await getStorage("urlHashToId")??{},a&&log("Time to retrieve sources to urlHashToId (s): "+duration(r)),r.unshift(Date.now()),global.state.titleHashToIds=makeTitleHashToIdList(e),a&&log("Time to hash titles (s): "+duration(r)),r.unshift(Date.now()),t||(global.state.files=await matchAllFilesToPapers(),a&&log("Time to match all local files (s): "+duration(r)),r.unshift(Date.now()),global.state.papersList=Object.values(cleanPapers(e)),global.state.sortKey="lastOpenDate",global.state.papersReady=!0,sortMemory(),a&&log("Time to sort memory (s): "+duration(r)),r.unshift(Date.now()),makeTags(),a&&log("Time to make tags (s): "+duration(r)),r.unshift(Date.now())),info("State init duration (s): "+(Date.now()-r.last())/1e3),a&&console.groupEnd()},sortMemory=()=>{global.state.sortedPapers=Object.values(cleanPapers(global.state.papers)),global.state.sortedPapers.sort(orderPapers(0<=global.descendingSortKeys.indexOf(global.state.sortKey))),global.state.papersList.sort(orderPapers(0<=global.descendingSortKeys.indexOf(global.state.sortKey)))},orderPapers=i=>(e,t)=>{let a=e[global.state.sortKey],r=t[global.state.sortKey];return void 0===a&&(a=""),void 0===r&&(r=""),"string"==typeof a&&(a=a.toLowerCase(),r=r.toLowerCase()),i?a>r?-1:1:a>r?1:-1},makeTags=()=>{var e,t=new Set;for(e of global.state.sortedPapers)for(var a of e.tags)t.add(a);global.state.paperTags=[...t],global.state.paperTags.sort()},getExamplePaper=async e=>{var t=await getStorage("papers")??{},a=Object.keys(t).filter(e=>-1===e.indexOf("__")).reverse();let r=t[a[e=void 0===e?getRandomInt(a.length):e]];return r=void 0===r?{title:"Dummy title",author:"Cool Author and Great Author and Complicated Name uthor",year:2021,id:"NoneXiv-214324",bibtex:"@Nonesense{}",tags:["t1","t2"],note:"Thispaperdoesnotexist.com"}:r},stateTitleFunction=e=>{let t=e;return"string"==typeof e&&void 0===(t=global.state.papers[e])?(log("Error in stateTitleFunction: unknown id",e),"Unknown ID"):global.state.titleFunction(t).replaceAll("\n"," ").replace(/\s\s+/g," ")},updateDuplicatedUrls=(t,a,e=!1)=>{if(e){let e;if((e=t?[miniHash(t)]:Object.keys(global.state.urlHashToId).filter(e=>global.state.urlHashToId[e]===a))&&e.length){for(var r of e)warn("Removing duplicated url",t,"for",a),delete global.state.urlHashToId[r];setStorage("urlHashToId",global.state.urlHashToId)}}else global.state.urlHashToId[miniHash(t)]=a,setStorage("urlHashToId",global.state.urlHashToId)},addPaperToTitleHashToId=e=>{var t=e.id,e=miniHash(e.title);global.state.titleHashToIds.hasOwnProperty(e)||(global.state.titleHashToIds[e]=[]),global.state.titleHashToIds[e].includes(t)||global.state.titleHashToIds[e].push(t)},readJournalAbbreviations=async()=>{var e,t;global.journalAbbreviations||(e=chrome.runtime.getURL("src/data/iso4-journals.json"),e=await fetch(e).then(e=>e.json()),t=chrome.runtime.getURL("src/data/journal-abbreviations.json"),t=await fetch(t).then(e=>e.json()),global.journalAbbreviations=Object.fromEntries([...Object.entries(e),...Object.entries(t)].map(([e,t])=>[miniHash(e),t])))},downloadPaperPdf=async e=>{if(!global.state.papersReady)throw new Error("[PM] State is not ready (downloadPaperPdf)");let t=stateTitleFunction(e);t=(t=t.replaceAll(":"," ")).replace(/[\u2000-\u206F\u2E00-\u2E7F\\'!"#$%&()*+,\/:;<=>?@\[\]^`{|}~]/g," ").replace(/\s+/g," "),global.state.prefs.checkStore&&(t="PaperMemoryStore/"+t,0===(await getStoredFiles()).length)&&chrome.downloads.download({url:URL.createObjectURL(new Blob([global.storeReadme])),filename:"PaperMemoryStore/IMPORTANT_README.txt",saveAs:!1}),(t=t.endsWith("pdf")?t.slice(0,-3)+".pdf":t).endsWith(".pdf")||(t+=".pdf"),log("Downloading paper",e,"to",t),chrome.downloads.download({url:paperToPDF(e),filename:t})},decodeHtml=("undefined"!=typeof module&&null!=module.exports&&((dummyModule=module).exports={duration:duration,initState:initState,sortMemory:sortMemory,orderPapers:orderPapers,makeTags:makeTags,getExamplePaper:getExamplePaper,stateTitleFunction:stateTitleFunction,updateDuplicatedUrls:updateDuplicatedUrls,addPaperToTitleHashToId:addPaperToTitleHashToId,readJournalAbbreviations:readJournalAbbreviations,downloadPaperPdf:downloadPaperPdf}),e=>{var t=document.createElement("textarea");return t.innerHTML=e,t.value}),flipAuthor=e=>e.split(", ").reverse().join(" "),flipAndAuthors=e=>e.split(" and ").map(flipAuthor).join(" and "),fetchArxivXML=async e=>{e=e.replace("Arxiv-","").replace("_","/");return fetch("https://export.arxiv.org/api/query?"+new URLSearchParams({id_list:e}))},fetchCvfHTML=async e=>{let t,a;var r;return t=e.endsWith(".pdf")?e.replace("/papers_backup/","/papers/").replace("/papers/","/html/").replace(".pdf",".html"):e,!(a=await fetch(t).then(e=>e.ok?e.text():""))&&t.includes("thecvf.com/content_")&&({conf:e,year:r}=parseCVFUrl(e),t=t.replace(`/content_${e}_${r}/`,`/content_${e.toLowerCase()}_${r}/`),a=await fetch(t).then(e=>e.ok?e.text():"")),a},doi2BibtexObject=async e=>{e=await fetchText(`https://citation.doi.org/format?doi=${e}&style=bibtex&lang=en-US`),e=bibtexToObject(e);return delete e.abstract,e.bibtex=bibtexToString(e),e},getOpenReviewNoteJSON=e=>sendMessageToBackground({type:"OpenReviewNoteJSON",url:e}),getOpenReviewForumJSON=e=>sendMessageToBackground({type:"OpenReviewForumJSON",url:e}),fetchDom=async e=>{e=await fetch(e).then(e=>e.ok?e.text():"");return(new DOMParser).parseFromString(e.replaceAll("\n",""),"text/html")},fetchText=async e=>{try{var t=await fetch(e);return(t.ok?await t.text():"").trim()}catch(e){return logError("fetchText error:",e),""}},fetchJSON=async e=>{try{var t=await fetch(e),a=t.status;return{data:t.ok?await t.json():null,status:a}}catch(e){return logError("fetchJSON error:",e),{}}},fetchBibtex=async e=>{var e=await fetchText(e),t=bibtexToObject(e),a=(delete t.abstract,e=bibtexToString(t),`Published in ${t.journal} (${t.year})`);return{...t,bibtex:e,note:a,venue:t.journal,key:t.citationKey}},extractCrossrefData=e=>{if(e.status&&"ok"===e.status)if("work"!==e["message-type"])error("Unknown `message-type` from CrossRef",e);else{var t=e.message,a=(log("Crossref data.message: ",t),t.author.map(e=>e.given+" "+e.family).join(" and ")),r=t.issued?t.issued["date-parts"][0][0]+"":t.published?t.published["date-parts"][0][0]+"":null;if(r){var i,o,n,s=t.title[0];if(s)return i=t["container-title"][0]??"Springer",n=[miniHash(t.author[0].family),r.slice(2),firstNonStopLowercase(s)].join(""),o=t.DOI,n={entryType:"book"===t.type?"book":"book-chapter"===t.type?"InBook":t.type.includes("article")?"Article":"InProceedings",citationKey:n,publisher:t.publisher,author:a,title:s,year:r,doi:o},t.page&&(n.pages=t.page),t.volume&&(n.volume=t.volume),t.type.includes("journal")&&(n.journal=i),t.link&&0<t.link.length&&((a=t.link.find(e=>"application/pdf"===e["content-type"]))&&(n.pdf=a.URL),s=t.link.find(e=>"text/html"===e["content-type"])??t.link[0])&&(n.url=s.URL),r=bibtexToString(n),{...n,bibtex:r,venue:i};error("Cannot find title in CrossRef data",t)}else error("Cannot find year in CrossRef data",t)}else error("Cannot parse CrossRef response",e)},fetchCrossRefDataForDoi=async e=>{var{data:e,status:t}=await fetchJSON(`https://api.crossref.org/works/${e}?mailto=schmidtv%40mila.quebec`);return{data:extractCrossrefData(e),status:t}},fetchSemanticScholarDataForDoi=async e=>{var t,e=(await fetchJSON(`https://api.semanticscholar.org/graph/v1/paper/${e}?fields=venue,year,authors,title`)).data;let a;return e&&(a={},e.venue&&(a.venue=e.venue),e.year&&(a.year=e.year),e.authors&&(a.author=e.authors.map(e=>e.name).join(" and ")),e.title&&(a.title=e.title),e=""+miniHash(e.authors[0].name)+firstNonStopLowercase(a.title),t=bibtexToString({entryType:"article",citationKey:e,...a}),a.bibtex=t,a.key=e),a},getDCPatterns=e=>{let t=e.slice(3);var e=["dc.","DC:","DC.","dc:"].map(e=>e+t.toLowerCase()),a=["dc.","DC:","DC.","dc:"].map(e=>e+t.capitalize());return[...e,...a]},getMetaContent=({selector:a,dom:t,all:e=!1,pure:r=!1})=>{let i="";for(let[t,e]of Object.entries(a))/dc\W/.test(e.toLowerCase())?i+=getDCPatterns(e).map(e=>`meta[${t}='${e}']`).join(","):i+=`meta[${t}='${e}']`;if(e){let e=queryAll(i,t).map(e=>e.getAttribute("content")??"");return r?e:e.map(spaceCamelCase).map(toSingleSpace)}let o=t.querySelector(i)?.getAttribute("content")??"";return r?o:toSingleSpace(spaceCamelCase(o))},extractDataFromDCMetaTags=e=>{var t,a,r,i,o,n,s=getMetaContent({selector:{name:"dc.Creator"},dom:e,all:!0}).join(" and ")||getMetaContent({selector:{name:"citation_author"},dom:e,all:!0}).join(" and ");return s?(t=(getMetaContent({selector:{name:"dc.Date"},dom:e})||getMetaContent({selector:{name:"citation_publication_date"},dom:e})).split("-")[0].split("/")[0],a=getMetaContent({selector:{name:"dc.Publisher"},dom:e}).replaceAll("\n"," ")||getMetaContent({selector:{property:"og:site_name"},dom:e,pure:!0}),r=getMetaContent({selector:{name:"dc.Title"},dom:e})||getMetaContent({selector:{name:"citation_title"},dom:e}),i=getMetaContent({selector:{name:"citation_journal_title"},dom:e}),o=getMetaContent({selector:{name:"citation_pdf_url"},dom:e,pure:!0}),e=getMetaContent({selector:{scheme:"doi"},dom:e})||getMetaContent({selector:{name:"citation_doi"},dom:e}),n=(""+s.split(" and ")[0].split(" ").find((e,t)=>1<=t&&1<miniHash(e).length)+t+firstNonStopLowercase(r)).toLowerCase(),{author:s,year:t,publisher:a,title:r,venue:i,key:n,doi:e,bibtex:bibtexToString({citationKey:n,entryType:"article",title:r,author:s,year:t,doi:e,publisher:a,journal:i}),pdfLink:o,note:i?`Published @ ${i} (${t})`:""}):null},makeArxivPaper=async e=>{var e=arxivIdFromURL(e),t=await(await fetchArxivXML(e)).text(),t=(new DOMParser).parseFromString(t.replaceAll("\n",""),"text/xml"),a=queryAll("author name",t).map(e=>e.innerHTML),r=a.join(" and "),i=[...t.getElementsByTagName("link")].map(e=>e.getAttribute("href")).filter(e=>e.includes("arxiv.org/pdf/"))[0].replace(/v\d+(\.pdf)?$/gi,".pdf"),o=(o=t.querySelector("entry title"))?.textContent||o?.innerText||"",t=t.querySelector("entry published").innerHTML.slice(0,4),a=a[0].split(" ").last().toLowerCase()+t+firstNonStopLowercase(o),n="Arxiv-"+e.replace("/","_"),s="";return{author:r,bibtex:s+`@article{${a},
`+`    title={${o} },
`+`    author={${r} },
`+`    year={${t}},
`+`    journal={arXiv preprint arXiv: ${e}}
`+"}",id:n,key:a,pdfLink:i,title:o,venue:"",year:t}},makeNeuripsPaper=async e=>{var t=(e=e.endsWith(".pdf")?e.replace("/file/","/hash/").replace(/-Paper(.*)\.pdf/,"-Abstract$1.html"):e).split("/").slice(-1)[0].split("-Paper")[0],a=await fetchDom(e),r=[...a.getElementsByTagName("a")].filter(e=>"Bibtex"===e.innerText)[0]?.getAttribute("href");let i,o,n,s,l;r?(i=await fetchText("https://"+parseUrl(e).host+r),{author:o,citationKey,title:n,year:s}=bibtexToObject(i),o=flipAndAuthors(o),l=citationKey):(r=queryAll(".container-fluid .col p",a),n=a.getElementsByTagName("h4")[0].innerHTML,a=queryAll("h4",a).filter(e=>"Authors"===e.innerText)[0],o=a.nextElementSibling.innerText.split(", ").map(e=>e.split(" ").map(e=>e.capitalize()).join(" ")).join(" and "),s=r[0].innerHTML.match(/\d{4}/)[0],l="neurips"+s+t.slice(0,8),i="",i=(i=(i=(i=(i+=`@inproceedings{NEURIPS${s}_${t.slice(0,8)},
`)+`    author={${o}},
`+`    booktitle={Advances in Neural Information Processing Systems},
`)+`    editor={H.Larochelle and M.Ranzato and R.Hadsell and M.F.Balcan and H.Lin},
`+`    publisher={Curran Associates, Inc.},
`)+`    title={${n}},
`+`    url={${e}},
`)+`    year={${s}}
`+"}",i=bibtexToString(i));a=e.replace("/hash/","/file/").replace("-Abstract.html","-Paper.pdf"),r=`NeurIPS-${s}_`+t.slice(0,8),e="NeurIPS",t=`Accepted @ ${e} (${s})`;return{author:o,bibtex:i,id:r,key:l,note:t,pdfLink:a,title:n,venue:e,year:s}},makeCVFPaper=async e=>{var t=await fetchCvfHTML(e),t=(new DOMParser).parseFromString(t.replaceAll("\n",""),"text/html"),a=t.getElementById("papertitle").innerText.trim(),r=t.querySelector("#authors i").innerText.split(",").map(e=>e.trim()).join(" and "),{year:i,id:o,conf:n}=parseCVFUrl(e);let s="";if(e.endsWith(".pdf"))s=e;else{let e=[...t.getElementsByTagName("a")].filter(e=>"pdf"===e.innerText)[0].getAttribute("href");(e=e.startsWith("../")?e.replaceAll("../",""):e).startsWith("/")||(e="/"+e),s="http://openaccess.thecvf.com"+e}var e=n,n=`Accepted @ ${e} (${i})`,t=bibtexToString(t.querySelector(".bibref").innerText),l=t.split("{")[1].split(",")[0];return{author:r,bibtex:t,id:o,key:l,note:n,pdfLink:s,title:a,venue:e,year:i}},makeOpenReviewBibTex=(e,t)=>{var a=e.content.title,r=e.content.authors.join(" and "),i=e.cdate?new Date(e.cdate).getFullYear():"0000",e=(e.cdate||log("makeOpenReviewBibTex: no cdate found in",e),e.content.authors[0].split(" ").last()),o="";return o+`@inproceedings{${e=(e+=i)+firstNonStopLowercase(a)},
`+`    title={${a}},
`+`    author={${r}},
`+`    year={${i}},
`+`    url={${t}},
`+"}"},extractAPIv2ContentValue=e=>{var t,a,r={};let i=!1;for([t,a]of Object.entries(e.content))a&&a.value?(r[t]=a.value,i=!0):r[t]=a;return e.content=r,{isV2:i,paper:e}},makeOpenReviewPaper=async e=>{var t=await getOpenReviewNoteJSON(e),a=await getOpenReviewForumJSON(e);if(403===t.status&&"ForbiddenError"===t.name)throw logError(dedent(`Error parsing OpenReview url ${e}.
            Most likely because this entry is protected and you do not have the rights to access it.

            1/ Make sure you are logged in.
            2/ Alternatively, this may be due to OpenReview changing the visibility of this paper.

            Try accessing this URL manually to make sure.`)),Error(t.message);if(404===t.status&&"NotFoundError"===t.name)throw logError(dedent(`Error parsing OpenReview url ${e}.`)),Error(t.message);var t=t.notes[0],r=!1,a=a.notes,i=({isV2:r,paper:t}=extractAPIv2ContentValue(t),console.log("paper",t),t.content.title),o=(t.content.authors||t.content.authors?.value||["Anonymous"]).join(" and "),n=bibtexToString(t.content._bibtex||makeOpenReviewBibTex(t,e)),s=bibtexToObject(n),l=s.citationKey,p=s.year;let c;c=t.pdf?"https://openreview.net/pdf?id="+t.id:(t.html||e).replace("/forum?id=","/pdf?id=");e=t.invitation?.split("/")||t.domain.split("/");let d=e[0].split(".")[0],u=e.slice(1).join("/").split("-")[0].replaceAll("/"," ").replace(" Conference",""),h=d,f=!1;global.overrideORConfs.hasOwnProperty(d)&&(h=global.overrideORConfs[d],f=!0),f&&(u=u.replace(h,""),d=h);e=(d+" "+u).replace(/ \d\d\d\d/g,"").replace(/\s\s+/g," "),t=`OR-${d}-${p}_`+t.id;let m,g,y,b="";return(m=r?a.filter(e=>e?.content?.recommendation?.value):a.filter(e=>-1<["Final Decision","Paper Decision","Acceptance Decision"].indexOf(e?.content?.title)))&&0<m.length&&(g=(g=r?m[0].content.recommendation.value:m[0].content.decision).split(" ").map((e,t)=>0===t?cleanStr(e)+"ed":e).join(" "),y=g+` @ ${e} (${p})`,g.toLowerCase().indexOf("rejected")<0)&&(b=e),"Anonymous"!==o&&!b&&s.booktitle&&(y="Accepted @ "+s.booktitle,b=s.booktitle),{author:o,bibtex:n,id:t,key:l,note:y="Anonymous"===o&&"Rejected"!=g?`Under review @ ${e} (${p}) (${(new Date).toLocaleDateString()})`:y,pdfLink:c,title:i,venue:b,year:p}},makeBioRxivPaper=async e=>{var t=e.replace(".full.pdf",""),a="https://api.biorxiv.org//details/biorxiv/"+e.split("/").slice(-2).join("/").replace(".full.pdf","").split("v")[0],r=await fetch(a).then(e=>e.json());if("ok"!==r.messages[0].status)throw new Error(a+" returned "+r.messages[0].status);var a=r.collection.last(),r=await fetchText(t),t=(new DOMParser).parseFromString(r.replaceAll("\n",""),"text/html").querySelector(".bibtext a").getAttribute("href"),r=bibtexToString(await(await fetch(t)).text()),t=extractAuthor(r),i=await parseIdFromUrl(e),o=r.split("\n")[0].split("{")[1].replace(",","").trim();return{author:t,bibtex:r,id:i,key:o,note:"",pdfLink:cleanBiorxivURL(e)+".full.pdf",title:a.title,venue:"",year:a.date.split("-")[0]}},makePMLRPaper=async e=>{var t,a=e.split("/").last().split(".")[0],r=await parseIdFromUrl(e),e=e.includes(".html")?e:e.split("/").slice(0,-2).join("/")+`/${a}.html`,i=e.replace(".html","")+`/${a}.pdf`,e=await fetchDom(e),o=e.getElementById("bibtex").innerText.replaceAll("\t"," ").replaceAll(/\s\s+/g," ");let n=o;for(t of o.match(/,\ ?\w+ ?= ?{/g))n=n.replace(t,t.replace(", ",",\n    ").replace(" = ","="));n.endsWith("}}")&&(n=n.slice(0,-2)+"}\n}"),n=bibtexToString(n);var s,o=extractAuthor(n),e=e.getElementsByTagName("h1")[0].innerText,l=extractBibtexValue(n,"year");let p=extractBibtexValue(n,"booktitle").replaceAll("Proceedings of the",""),c=p;for(s in note=`Accepted @ ${c} (${l})`,global.overridePMLRConfs)if(p.includes(s)){c=global.overridePMLRConfs[s],p=c+" "+l,note="Accepted @ "+p;break}return{author:o,bibtex:n,id:r,key:a,note:note,pdfLink:i,title:e,venue:c,year:l}},findACLValue=(e,t)=>queryAll("dt",e).filter(e=>e.innerText.includes(t))[0].nextElementSibling.innerText,makeACLPaper=async e=>{e=e.replace(".pdf","");var t,a,r,i,o,n,e=await fetchDom(e),s=e.getElementById("citeBibtexContent");if(s)return t=e.getElementById("title").innerText,s=bibtexToString(s.innerText),a=(i=bibtexToObject(s)).year,r=i.author.replace(/\s+/g," ").split(" and ").map(e=>e.split(",").map(e=>e.trim()).reverse().join(" ")).join(" and "),i=i.citationKey,o=findACLValue(e,"Venue"),n=findACLValue(e,"PDF"),{author:r,bibtex:s,id:`ACL-${o}-${a}_`+findACLValue(e,"Anthology ID"),key:i,note:`Accepted @ ${o} (${a})`,pdfLink:n,title:t,venue:o,year:a}},makePNASPaper=async e=>{e=e.replace(".full.pdf","").replace(/\/doi\/e?pdf\//,"/doi/abs/");var t=await fetchDom(e),a=t.getElementsByTagName("h1")[0].innerText,r=queryAll(".authors span[property='author'] a:not([property='email']):not(.orcid-id)",t).filter(e=>!e.getAttribute("href").includes("mailto:")).map(e=>e.innerText).join(" and "),i=t.querySelector("span[property='datePublished']").innerText.match(/\d{4}/g)[0],o=`PNAS-${i}_`+(e.endsWith("/")?e.split("/").slice(-2):e.split("/").slice(-1))[0],e=e.includes("/doi/pdf/")||e.includes("/doi/epdf/")?e.replace("/doi/epdf/","/doi/pdf/"):e.replace("/doi/abs/","/doi/pdf/").replace("/doi/full/","/doi/pdf/"),t=[...t.querySelector(".core-container").getElementsByTagName("a")].map(e=>e.getAttribute("href")).filter(e=>e?.includes("https://doi.org"))[0].split("/").slice(-2).join("/"),n="doi:"+t;return{author:r,bibtex:bibtexToString(`
    @article{${n},
        author={${r}},
        title={${a}},
        journal = {Proceedings of the National Academy of Sciences},
        year={${i}},
        doi={${t}},
        eprint={${e}},
        URL={${e.replace("/doi/pdf/","/doi/abs/")}}
    }`),id:o,key:n,note:`Published @ PNAS (${i})`,pdfLink:e,title:a,venue:"PNAS",year:i}},makeNaturePaper=async e=>{var t,a=(e=e.replace(".pdf","").split("#")[0])+".pdf",r=e.split("/").last(),e=await fetchDom(e),i=e.querySelector("h1.c-article-title").innerText,o=queryAll("ul.c-article-author-list li",e).map(e=>e.innerText.replace(/(\ ?,)|&||\d/g,"").split(/orcid/i)[0].trim()).filter(e=>0<e.length).join(" and "),n=e.querySelector(".c-article-info-details").innerText.match(/\(\d{4}\)/)[0].replace(/\(|\)/g,""),s=e.querySelector(".c-article-info-details [data-test]").innerText,r=`Nature-${n}_`+r;let l;for(t of[".c-bibliographic-information__citation",".c-bibliographic-information__value"])if(l=querySelector(t)?.innerText.split("https://doi.org/")[1])break;l=l||[...e.getElementsByTagName("span")].map(e=>e.innerText).filter(e=>e.includes("https://doi.org"))[0];var e=""+o.split(" ")[1]+n+firstNonStopLowercase(i),p={citationKey:e,entryType:"article",author:o,title:i,journal:s,year:n},p=(l&&(p.doi=l,p.url="https://doi.org/"+l),bibtexToString(p));return{author:o,bibtex:p,id:r,key:e,note:`Published @ ${s} (${n})`,pdfLink:a,title:i,venue:s,year:n}},makeACSPaper=async e=>{var e=(e=e.replace("pubs.acs.org/doi/pdf/","pubs.acs.org/doi/").split("?")[0]).replace("/abs/","/").split("/doi/")[1],t=`https://pubs.acs.org/action/downloadCitation?doi=${e}&include=cit&format=bibtex&direct=true`,t=await fetchText(t),a=bibtexToObject(t),r=a.author.replaceAll("\n","").trim(),i=a.title.trim(),o=a.year.trim(),n=a.citationKey.trim(),s="https://pubs.acs.org/doi/pdf/"+e,l=`Published @ ${a.journal} (${a.year})`;return{author:r,bibtex:t,id:"ACS_"+e.replaceAll(".","").replaceAll("/",""),key:n,note:l,pdfLink:s,title:i,venue:a.journal,year:o}},makeIOPPaper=async e=>{(e=e.split("#")[0]).endsWith("/pdf")&&(e=e.slice(0,-4));var t=await fetchDom(e),t=queryAll(".btn-multi-block a",t).filter(e=>"BibTeX"===e.innerText).map(e=>e.getAttribute("href"))[0],t="https://"+parseUrl(e).host+t,t=await fetchText(t),a=bibtexToObject(t),r=a.author.replaceAll("\n","").trim(),i=a.title.trim(),o=a.year.trim(),n=a.citationKey.trim(),s=e+"/pdf",a=a.journal,l=`Published @ ${a} (${o})`,e=e.split("/article/").last().split("/meta")[0];return{author:r,bibtex:t,id:"IOPscience_"+miniHash(e),key:n,note:l,pdfLink:s,title:i,venue:a,year:o}},makeJMLRPaper=async e=>{var t=(e=(e=(e=e.includes("/papers/volume")?e.replace("/papers/volume","/papers/v"):e).endsWith(".pdf")?e.split("/").slice(0,-1).join("/"):e).replace(".html","")).split("/").last(),a=e+".bib",a=await fetchText(a),{author:r,year:i,title:o,citationKey:n}=bibtexToObject(a);return{author:r,bibtex:a,id:`JMLR-${i}_`+t,key:n.trim(),note:`Published @ JMLR (${i})`,pdfLink:e.replace("/papers/v","/papers/volume")+`/${t}.pdf`,title:o,venue:"JMLR",year:i}},makePMCPaper=async e=>{var t=e.match(/PMC\d+/)[0].replace("PMC",""),a=e.split("PMC"+t)[0]+"PMC"+t,r=await(await fetch(`https://api.ncbi.nlm.nih.gov/lit/ctxp/v1/pmc/?format=csl&id=${t}&download=true`)).json(),i=r["epub-date"]?r["epub-date"]["date-parts"][0][0]+"":r.issued["date-parts"][0][0]+"",o=r.author.map(e=>e.given+" "+e.family).join(" and "),n=r["container-title"].split(" ").map(e=>e.capitalize()).join(" "),s=r.title,t=`PMC-${i}_`+t,l=r.author[0].family+i+firstNonStopLowercase(s);let p;return{author:o,bibtex:bibtexToString({entryType:"article",citationKey:l,journal:n,issn:r.ISSN,volume:r.volume,page:r.page,doi:r.DOI,PMID:r.PMID,PMCID:r.PMCID,publisher:r.publisher,author:o,title:s}),id:t,key:l,note:`Published @ ${n} (${i})`,pdfLink:p=isPdfUrl(e)?e:a+"/pdf",title:s,venue:n,year:i}},makePubMedPaper=async e=>{var e=[...(await fetchDom(e.split("?")[0])).getElementsByTagName("meta")].filter(e=>e.getAttribute("name")?.includes("citation_")),e=Object.fromEntries(e.map(e=>[e.getAttribute("name").replace("citation_",""),e.getAttribute("content")])),t=document.querySelector("div.authors-list").innerText.replace(/\d/gi,"").split(",").map(e=>e.trim()).join(" and "),a=e.title,r=e.journal_title,i=e.date.split("/")[2],o=`PubMed-${i}_`+e.pmid,n=""+t.split(" and ")[0].split(" ").last()+i+firstNonStopLowercase(e.title),e={entryType:"article",citationKey:n,publisher:e.publisher,doi:e.doi,issn:e.issn,journal:r,year:i,author:t};return{author:t,bibtex:bibtexToString(e),id:o,key:n,note:`Accepted @ ${journal} (${i})`,pdfLink:"",title:a,venue:r,year:i}},makeIJCAIPaper=async e=>{var t=e.endsWith(".pdf")?e.replace(".pdf","").split("/").last().match(/[1-9]\d*/)[0]:e.split("/").last(),e=e.match(/proceedings\/\d+/gi)[0].split("/")[1],a=(await fetchText(`https://www.ijcai.org/proceedings/${e}/bibtex/`+t)).replace(/}\n/gi,"},\n"),r=bibtexToObject(a.split("\n").filter(e=>!/note\s+=/gi.test(e)).join("\n")),i=r.citationKey,o=r.title;return{author:flipAndAuthors(r.author),bibtex:a,id:`IJCAI-${e}_`+t,key:i,note:`Accepted @ IJCAI (${e})`,pdfLink:`https://www.ijcai.org/proceedings/${e}/${t.padStart(4,0)}.pdf`,title:o,venue:"IJCAI",year:e}},makeACMPaper=async e=>{let t;e=noParamUrl(e),t=isPdfUrl(e)?e:e.replace(/\/doi\/?(abs|full)?\//,"/doi/pdf/");var a=await fetchDom(e.replace("/doi/pdf/","/doi/"));let r,i,o,n,s,l,p,c;var d=extractDataFromDCMetaTags(a),a=(d?{author:r,year:i,title:o,venue:n,key:s,doi:l,bibtex:p,note:c}=d:(o=a.querySelector(".citation__title").innerText,r=queryAll("ul[aria-label='authors'] li.loa__item .loa__author-name",a).map(e=>e.innerText.replace(",","").trim()).join(" and "),d=a.querySelector(".issue-item__detail a").innerText,n=d.split("'")[0].trim(),i="20"+d.split("'")[1].split(":")[0].trim(),l=t.split("/doi/pdf/")[1],c=`Accepted @ ${n} (${i})`,s=l,p=bibtexToString({entryType:"article",citationKey:l,journal:n,author:r,title:o,year:i,publisher:"Association for Computing Machinery",address:"New York, NY, USA",url:noParamUrl(e).replace("/doi/pdf/","/doi/")})),`ACM-${i}_`+miniHash(l));return{author:r,bibtex:p,id:a,key:s,note:c,pdfLink:t,title:o,venue:n,year:i}},makeIEEEPaper=async e=>{isPdfUrl(e)&&(e=`https://ieeexplore.ieee.org/document/${e.split("/stamp/stamp.jsp?tp=&arnumber=")[1].match(/\d+/)[0]}/`);var t=await fetchDom(e),t=JSON.parse([...t.getElementsByTagName("script")].filter(e=>e.innerHTML?.includes("metadata="))[0].innerHTML.split("metadata=")[1].split(/};\s*/)[0]+"}"),a=t.title,r=t.authors.map(e=>e.name).join(" and "),i=t.publicationYear,e=""+parseUrl(e).origin+t.pdfUrl,o=t.publicationTitle,n=t.articleId;return{author:r,bibtex:bibtexToString({entryType:"article",citationKey:n,journal:o,volume:t.volume,pages:t.startPage+"-"+t.endPage,doi:t.doi,title:a,year:i,author:r}),id:`IEEE-${i}_`+n,key:n,note:`Accepted @ ${o} (${i})`,pdfLink:e,title:a,venue:o,year:i}},makeSpringerPaper=async t=>{var e=[...global.sourceExtras.springer.types,"content/pdf"],a=e.find(e=>t.includes(`/${e}/`));if(!a)throw new Error(`Could not find Springer type for ${t} (known: ${e.join(", ")})`);var r,i,o,n,s,l,e=t.split(`/${a}/`)[1].split("?")[0].replace(".pdf",""),p=(await fetchCrossRefDataForDoi(e)).data;if(p)return{author:r,bibtex:i,citationKey:o,year:n,title:s,venue:l}=p,{author:r,bibtex:i,id:`Springer-${n}_`+miniHash(e),key:o,note:`Published @ ${l} (${n})`,pdfLink:p.pdf??("content/pdf"===a?t:t.replace(`/${a}/`,"/content/pdf/")+".pdf"),title:s,venue:l,year:n,extra:{url:"https://doi.org/"+e}};throw new Error("Aborting Springer paper parsing, see error above")},makeAPSPaper=async e=>{e=e.split("#")[0];var[t,a]=parseUrl(e).pathname.split("/").slice(1,3),r=e.split(`/${t}/${a}/`).last(),i=e.replace(`/${t}/${a}/`,`/${t}/export/`),i=await fetchText(i+"?type=bibtex&download=true"),o=bibtexToObject(i),e=e.replace(`/${t}/${a}/`,`/${t}/pdf/`),a=`APS-${o.year}_`+miniHash(r),t=o.journal??o.publisher,r=(await readJournalAbbreviations(),global.journalAbbreviations[miniHash(t)]??t),t=`Published @ ${r} (${o.year})`;return{author:flipAndAuthors(o.author),bibtex:i,id:a,key:o.citationKey,note:t,pdfLink:e,title:o.title,venue:r,year:o.year}},makeWileyPaper=async e=>{var e=(e=noParamUrl(e)).match(/\/doi\/10\./g)?e.replace("/doi/","/doi/pdf"):e.replace(/\/doi\/(abs|epdf|full)\//g,"/doi/pdf/"),t=e.replace("/doi/pdf/","/doi/abs/").split("/doi/abs/")[1],a=await doi2BibtexObject(t),{author:r,title:i,year:o}=a,n=`Wiley-${o}_`+miniHash(t),s=a.bibtex,l=a.journal,a=(a.publisher,`Published @ ${l} (${o})`);return{author:r,bibtex:s,id:n,key:miniHash(t),note:a,pdfLink:e,title:i,venue:l,year:o,doi:t}},makeScienceDirectPaper=async e=>{var e=e.split("/pii/")[1].split("/")[0].split("#")[0].split("?")[0],t=await fetchText(`https://www.sciencedirect.com/sdfe/arp/cite?pii=${e}&format=text%2Fx-bibtex&withabstract=false`),{author:a,journal:r,year:i,title:o,citationKey:n}=bibtexToObject(t),s=`Published @ ${r} (${i})`;return{author:a,bibtex:t,id:`ScienceDirect-${i}_`+miniHash(e),key:n,note:s,pdfLink:"https://reader.elsevier.com/reader/sd/pii/"+e,title:o,venue:r??"Science Direct",year:i}},makeSciencePaper=async e=>{let t,a,r,i,o,n,s,l,p,c,d;n="https://science.org/doi/pdf/"+(c=(c=noParamUrl(e).split("/doi/")[1]).startsWith("10.")?c:c.split("/").slice(1).join("/")),d="https://science.org/doi/full/"+c;var e=(await fetchCrossRefDataForDoi(c)).data;return e?({author:t,bibtex:a,title:s,venue:l,year:p}=e,i=e.citationKey,o=`Published @ ${l} (${p})`):(e=await fetchDom(d),{author:t,year:p,publisher,title:s,venue:l,key:i,bibtex:a,note:o}=extractDataFromDCMetaTags(e)),r=`Science-${p}_`+miniHash(c),{author:t,bibtex:a,id:r,key:i,note:o,pdfLink:n,title:s,venue:l,year:p}},makeFrontiersPaper=async e=>{e=e.replace(/\/pdf$/,"/full");var t=noParamUrl(e).split("/articles/")[1].split("/full")[0],a=await fetchText(`https://www.frontiersin.org/articles/${t}/bibTex`),a=Object.fromEntries(Object.entries(bibtexToObject(a)).map(([e,t])=>["citationKey"===e||"entryType"===e?e:e.toLowerCase(),t])),{author:r,journal:i,year:o,title:n,citationKey:s}=(a.author=flipAndAuthors(a.author),delete a.abstract,a),l=`Published @ ${i} (${o})`;return{author:r,bibtex:bibtexToString(a),id:`Frontiers-${o}_`+miniHash(t),key:s,note:l,pdfLink:e.replace(/\/full$/,"/pdf"),title:n,venue:i,year:o}},makeIHEPPaper=async a=>{let r,i;if(a.includes("/files/")){let t=a.split("/files/")[1].split("/")[0];var o="https://inspirehep.net/api/literature?q=documents.key:"+t,o=(await fetchJSON(o)).data;if(!(r=o.hits.hits.find(e=>!!e.metadata.documents.find(e=>e.key===t))))return void warn("Could not find an Inspire HEP record for the url",a);i=r.metadata.control_number}else i=a.match(/\/literature\/(\d+)/)[1];if(i){var o=await fetchText(`https://inspirehep.net/api/literature/${i}?format=bibtex`),t=(r||({data:r}=await fetchJSON(`https://inspirehep.net/api/literature/${i}?format=json`)),bibtexToObject(o));let e=t.title??r.metadata.titles[0].title;e.startsWith("{")&&e.endsWith("}")&&(e=e.slice(1,-1));var n=r.metadata.documents?.[0]?.url??a,s=flipAndAuthors(t.author),l=t.year??r.created.split("-")[0],p="IHEP-"+i,c=t.journal??"Inspire HEP",d=t.citationKey,t=t.doi??"";return{author:s,bibtex:o,id:p,key:d,note:`Published @ ${c} (${l})`,pdfLink:n,title:e,venue:c,year:l,doi:t}}warn("Could not find an Inspire HEP id for the url",a)},makePLOSPaper=async e=>{var t=e.split("?id=").last().split("&")[0],{bibtex:a,key:r,author:i,venue:o,title:n,note:s,year:l}=await fetchBibtex(e.split("/article")[0]+"/article/citation/bibtex?id="+t),p=e.split("/article")[0]+`/article/file?id=${t}&type=printable`,e=e.split("journals.plos.org/")[1].split("/")[0];return{author:flipAndAuthors(i),bibtex:a,id:`PLOS-${e}_`+miniHash(t),key:r,note:s,pdfLink:p,title:n,venue:o,year:l,doi:t}},makeRSCPaper=async e=>{var t=noParamUrl(e).split("/").last(),a=e.split("/").find(e=>"articlehtml"===e||"articlepdf"===e||"articlelanding"===e).replace("article",""),e="articlepdf"===a?e:e.replace(`/article${a}/`,"/articlepdf/"),{bibtex:a,key:r,author:i,venue:o,title:n,note:s,year:l,doi:p}=await fetchBibtex(`https://pubs.rsc.org/en/content/formatedresult?markedids=${t}&downloadtype=article&managertype=bibtex`);return{author:flipAndAuthors(i),bibtex:a,id:`RSC-${o.replaceAll(" ","")}_`+miniHash(t),key:r,note:s,pdfLink:e,title:n,venue:o,year:l,doi:p}},makeWebsitePaper=async e=>{var t=e.url,a=await fetchDom(t),a=Object.fromEntries([...a.querySelectorAll("meta")].filter(e=>e.getAttribute("property")).filter(e=>e.getAttribute("property").startsWith("og:")).map(e=>[e.getAttribute("property").replace("og:",""),e.getAttribute("content")])),r=a.site_name||parseUrl(t).hostname.replace("www.","").capitalize(),i=(new Date).getFullYear()+"",o="Website_"+urlToWebsiteId(t),n=a.description||"",s=t,a=a.title||e.title,e=miniHash(r)+i+firstNonStopLowercase(a),t=`@misc{${e},
        author = {${r}},
        title = {${a}},
        year = {${i}},
        url = {${t}},
        note = {Accessed ${(new Date).toISOString().split("T")[0]}}
    }`;return{author:r,bibtex:bibtexToString(bibtexToObject(t)),id:o,key:e,note:n,pdfLink:s,title:a,venue:"",year:i}},makeMDPIPaper=async e=>{(e=(e=(e=noParamUrl(e)).split("/").last().startsWith("pdf")?e.split("/").slice(0,-1).join("/"):e).endsWith("/notes")?e.replace("/notes",""):e).endsWith("/reprints")&&(e=e.replace("/reprints",""));var t=await fetchDom(e),{author:t,year:a,title:r,venue:i,key:o,doi:n,bibtex:s,note:l,pdfLink:p}=extractDataFromDCMetaTags(t);return{author:t,bibtex:s,id:`MDPI-${a}_`+miniHash(e.split("mdpi.com/")[1]),key:o,note:l,pdfLink:p,title:r,venue:i,year:a,doi:n}},makeOUPPaper=async e=>{var t=(e=noParamUrl(e)).split("/").last(),t=await fetchText(`https://academic.oup.com/Citation/Download?resourceId=${t}&resourceType=3&citationFormat=2`),a=bibtexToObject(t),{title:a,year:r,author:i,journal:o,doi:n,citationKey:s,eprint:l}=(delete a.abstract,t=bibtexToString(a),a),i=flipAndAuthors(i),p=`Published @ ${o} (${r})`,c=e.split("https://academic.oup.com/")[1].split("/").slice(2).join("");return{author:i,bibtex:t,id:`OUP-${r}_`+miniHash(c),key:s,note:p,pdfLink:l?.replaceAll("\\","")??e,title:a,venue:o,year:r,doi:n}},makerHALPaper=async e=>{var t=(e=noParamUrl(e).replace(/(hal\.science\/\w+-\d+)(v\d+)?(\/document)?/,"$1")).split("/").last(),a=`https://hal.science/${t}/bibtex`,a=await fetchText(a),r=bibtexToObject(a),{title:i,year:o,journal:n,author:s,doi:l,pdf:p}=r,c=n?`Published @ ${n} (${o})`:"",r=r.citationKey;return{author:flipAndAuthors(s),bibtex:bibtexToString(a),id:`HAL-${o}_`+miniHash(t),key:r,note:c,pdfLink:p??e,title:i,venue:n,year:o,doi:l}},makeChemRxivPaper=async e=>{let t,a=e;isPdfUrl(e)?(t=e.split("/item/")[1].split("/")[0],a="https://chemrxiv.org/engage/chemrxiv/article-details/"+t):t=noParamUrl(e).split("/").last();var e=await fetchDom(a),{author:e,year:r,title:i,venue:o,key:n,doi:s,bibtex:l,pdfLink:p,note:c}=extractDataFromDCMetaTags(e);return{author:e,bibtex:l,id:`ChemRxiv-${r}_`+miniHash(t),key:n,note:c,pdfLink:p,title:i,venue:o,year:r,doi:s}},tryPWCMatch=async e=>{let t;var a={type:"papersWithCode",pwcPrefs:await getStorage("pwcPrefs")??{},paper:e},{url:a,note:r,venue:i,pubYear:o}=await sendMessageToBackground(a)??{};return a&&!e.codeLink?log("[PapersWithCode] Discovered a code repository:",a):log("[PapersWithCode] No code repository found"),i&&!e.venue?(log("[PapersWithCode] Found a publication venue:",i),e=bibtexToObject(e.bibtex),t=bibtexToString({...e,year:o,journal:i})):log("[PapersWithCode] No publication found"),{codeLink:a,note:r,venue:i,bibtex:t}},tryCrossRef=async(e,t)=>{if(t)return sendMessageToBackground({type:"try-cross-ref",paper:e});try{var a="https://api.crossref.org/works?rows=1&mailto=schmidtv%40mila.quebec&select=event%2Ctitle&query.title="+encodeURI(e.title),r=await fetch(a).then(e=>e.json());if("ok"!==r.status)return log(`[Crossref] ${a} returned `+r.message.status),{};if(0===r.message.items.length)return{};if(r.message.items[0].title[0]?.toLowerCase().replaceAll("\n"," ").replaceAll(/\s\s+/g," ")!==e.title.toLowerCase().replaceAll("\n"," ").replaceAll(/\s\s+/g," "))return{};if(!r.message.items[0].event||!r.message.items[0].event.name)return{};info("Found a CrossRef match");var i=r.message.items[0].event.name.trim();return{venue:i,note:`Accepted @ ${i} -- [crossref.org]`}}catch(e){return logError("[Crossref]",e),{}}},tryDBLP=async(e,t)=>{if(t)return sendMessageToBackground({type:"try-dblp",paper:e});try{var a=encodeURI(e.title),r=await fetch(`https://dblp.org/search/publ/api?q=${a}&format=json`);if(429===r.status)return{status:429};var i,o,n,s,l,p=await r.json();if(p.result&&p.result.hits&&p.result.hits.hit&&p.result.hits.hit.length)for(i of p.result.hits.hit.sort((e,t)=>parseInt(e.info.year,10)-parseInt(t.info.year,10)))if(decodeHtml(i.info.title?.toLowerCase().replaceAll("\n"," ").replaceAll(".","").replaceAll(/\s\s+/g," "))===e.title.toLowerCase().replaceAll("\n"," ").replaceAll(".","").replaceAll(/\s\s+/g," ")&&"CoRR"!==i.info.venue)return info("Found a DBLP match"),o=await fetchText(i.info.url+".bib"),n=miniHash(i.info.venue),await readJournalAbbreviations(),s=(global.journalAbbreviations[n]??i.info.venue).trim(),l=i.info.year,i.info.url,{venue:s,note:`Accepted @ ${s} ${l} -- [dblp.org]`,bibtex:o};return{}}catch(e){return logError("[DBLP]",e),{}}},trySemanticScholar=async(t,e)=>{if(e)return sendMessageToBackground({type:"try-semantic-scholar",paper:t});try{var{data:a,status:r}=await fetchJSON(`https://api.semanticscholar.org/graph/v1/paper/search?query=${encodeURI(t.title)}&fields=title,venue,year,authors,externalIds,url&limit=5`);if(a&&a.data&&0<a.data.length)for(var i of a.data)if(miniHash(i.title)===miniHash(t.title)&&Math.abs(i.year-t.year)<3&&i.venue&&!i.venue.toLowerCase().includes("arxiv")&&!i.venue.toLowerCase().includes("biorxiv")){info("Found a Semantic Scholar match");let e=i.venue.trim().replace(/^\d{4}/,"").trim();e.indexOf(" ")<0&&(e=e.toUpperCase());var o=(i.year+"").trim(),n=`Accepted @ ${e} (${o}) -- [semanticscholar.org]`,s=i.authors.map(e=>e.name).join(" and "),l=i.externalIds.DOI,p=bibtexToString({entryType:"article",citationKey:miniHash(i.authors[0].name.split(" ").last())+o+firstNonStopLowercase(t.title),title:t.title,author:s,journal:e,year:o,doi:l,bibSource:"Semantic Scholar "+i.url});return{venue:e,note:n,bibtex:p,status:r}}return{status:r}}catch(e){logError("[SemanticScholar]",e)}return{status:404}},tryGoogleScholar=async e=>{e=await sendMessageToBackground({type:"google-scholar",paper:e});return e.note&&info("Found a Google Scholar match",e.note),e},tryUnpaywall=async(t,e)=>{if(e)return sendMessageToBackground({type:"try-unpaywall",paper:t});var e=`https://api.unpaywall.org/v2/search?query=${encodeURI(t.title)}&is_oa=true&email=papermemory+${parseInt(1e3*Math.random())}@gmail.com`,{data:e,status:a}=await fetchJSON(e);if(e&&200===a){var r,e=e.results?.find(e=>miniHash(e.response.title)===miniHash(t.title));if(e&&e.journal_name)return{venue:r=e.journal_name,note:`Accepted @ ${r} (${e.year}) -- [unpaywall.org]`,doi:e.doi}}return{status:a}},tryPreprintMatch=async(e,t=!1)=>{let a,r,i,o,n;var s,l,p={},c=["GoogleScholar","SemanticScholar","CrossRef","DBLP","Unpaywall"],d=[silentPromiseTimeout(tryGoogleScholar(e)),silentPromiseTimeout(trySemanticScholar(e,!0)),silentPromiseTimeout(tryCrossRef(e)),silentPromiseTimeout(tryDBLP(e)),silentPromiseTimeout(tryUnpaywall(e))];t&&(d.push(silentPromiseTimeout(tryPWCMatch(e))),c.push("PapersWithCode"));for([s,l]of Object.entries(c)){if(p[l]=await d[s],{note:a,venue:r,bibtex:i,doi:n}=p[l]??{},a)break;log(`[${l}] No publication found`)}return t&&(p.hasOwnProperty(c="PapersWithCode")||(p[c]=await d[c]),p[c].codeLink)&&!e.codeLink&&(o=p[c].codeLink),{note:a,venue:r,bibtex:i,code:o,doi:n}},initPaper=async e=>{for(var t in e.note||(e.note=""),e.md=`[${e.title}](${e.pdfLink})`,e.tags=[],e.codeLink=e.codeLink??"",e.favorite=!1,e.favoriteDate="",e.addDate=(new Date).toJSON(),e.lastOpenDate=e.addDate,e.count=1,e.code={},e.doi=e.doi??bibtexToObject(e.bibtex).doi??"",e)e.hasOwnProperty(t)&&"string"==typeof e[t]&&(e[t]=e[t].trim());return e=await autoTagPaper(e),validatePaper(e),e},autoTagPaper=async a=>{try{var e,r,i=await getStorage("autoTags");if(i&&i.length){let t=new Set;for(var o of i)o.tags?.length&&(o.title||o.author)&&(e=!o.title||new RegExp(o.title,"i").test(a.title),r=!o.author||new RegExp(o.author,"i").test(a.author),e)&&r&&o.tags.forEach(e=>t.add(e));a.tags=[...t].sort(),a.tags.length&&log("Automatically adding tags:",a.tags)}return a}catch(e){return log("Error auto-tagging:",e),log("Paper:",a),a}},makePaper=async(e,t,a=!1)=>{let r;if(a)(r=await makeWebsitePaper(a))&&(r.source="website");else if(e.arxiv)(r=await makeArxivPaper(t))&&(r.source="arxiv");else if(e.neurips)(r=await makeNeuripsPaper(t))&&(r.source="neurips");else if(e.cvf)(r=await makeCVFPaper(t))&&(r.source="cvf");else if(e.openreview)(r=await makeOpenReviewPaper(t))&&(r.source="openreview");else if(e.biorxiv)(r=await makeBioRxivPaper(t))&&(r.source="biorxiv");else if(e.pmlr)(r=await makePMLRPaper(t))&&(r.source="pmlr");else if(e.acl)(r=await makeACLPaper(t))&&(r.source="acl");else if(e.pnas)(r=await makePNASPaper(t))&&(r.source="pnas");else if(e.nature)(r=await makeNaturePaper(t))&&(r.source="nature");else if(e.acs)(r=await makeACSPaper(t))&&(r.source="acs");else if(e.iop)(r=await makeIOPPaper(t))&&(r.source="iop");else if(e.jmlr)(r=await makeJMLRPaper(t))&&(r.source="jmlr");else if(e.pmc)(r=await makePMCPaper(t))&&(r.source="pmc");else if(e.ijcai)(r=await makeIJCAIPaper(t))&&(r.source="ijcai");else if(e.acm)(r=await makeACMPaper(t))&&(r.source="acm");else if(e.ieee)(r=await makeIEEEPaper(t))&&(r.source="ieee");else if(e.springer)(r=await makeSpringerPaper(t))&&(r.source="springer");else if(e.aps)(r=await makeAPSPaper(t))&&(r.source="aps");else if(e.wiley)(r=await makeWileyPaper(t))&&(r.source="wiley");else if(e.sciencedirect)(r=await makeScienceDirectPaper(t))&&(r.source="sciencedirect");else if(e.science)(r=await makeSciencePaper(t))&&(r.source="science");else if(e.frontiers)(r=await makeFrontiersPaper(t))&&(r.source="frontiers");else if(e.ihep)(r=await makeIHEPPaper(t))&&(r.source="ihep");else if(e.plos)(r=await makePLOSPaper(t))&&(r.source="plos");else if(e.rsc)(r=await makeRSCPaper(t))&&(r.source="rsc");else if(e.mdpi)(r=await makeMDPIPaper(t))&&(r.source="mdpi");else if(e.oup)(r=await makeOUPPaper(t))&&(r.source="oup");else if(e.hal)(r=await makerHALPaper(t))&&(r.source="hal");else{if(!e.chemrxiv)throw new Error("Unknown paper source: "+JSON.stringify({is:e,url:t}));(r=await makeChemRxivPaper(t))&&(r.source="chemrxiv")}if(void 0!==r)return initPaper(r)},findFuzzyPaperMatch=(e,t)=>{t=miniHash(t.title);return e.hasOwnProperty(t)?(e=e[t]).find(t=>!global.preprintSources.some(e=>t.toLowerCase().startsWith(e)))||e[0]:null};"undefined"!=typeof module&&null!=module.exports&&((dummyModule=module).exports={decodeHtml:decodeHtml,flipAuthor:flipAuthor,flipAndAuthors:flipAndAuthors,fetchArxivXML:fetchArxivXML,fetchCvfHTML:fetchCvfHTML,getOpenReviewNoteJSON:getOpenReviewNoteJSON,getOpenReviewForumJSON:getOpenReviewForumJSON,fetchDom:fetchDom,fetchText:fetchText,fetchJSON:fetchJSON,fetchBibtex:fetchBibtex,extractCrossrefData:extractCrossrefData,fetchCrossRefDataForDoi:fetchCrossRefDataForDoi,fetchSemanticScholarDataForDoi:fetchSemanticScholarDataForDoi,getMetaContent:getMetaContent,extractDataFromDCMetaTags:extractDataFromDCMetaTags,makeArxivPaper:makeArxivPaper,makeNeuripsPaper:makeNeuripsPaper,makeCVFPaper:makeCVFPaper,makeOpenReviewBibTex:makeOpenReviewBibTex,extractAPIv2ContentValue:extractAPIv2ContentValue,makeOpenReviewPaper:makeOpenReviewPaper,makeBioRxivPaper:makeBioRxivPaper,makePMLRPaper:makePMLRPaper,findACLValue:findACLValue,makeACLPaper:makeACLPaper,makePNASPaper:makePNASPaper,makeNaturePaper:makeNaturePaper,makeACSPaper:makeACSPaper,makeIOPPaper:makeIOPPaper,makeJMLRPaper:makeJMLRPaper,makePMCPaper:makePMCPaper,makePubMedPaper:makePubMedPaper,makeIJCAIPaper:makeIJCAIPaper,makeACMPaper:makeACMPaper,makeIEEEPaper:makeIEEEPaper,makeSpringerPaper:makeSpringerPaper,makeAPSPaper:makeAPSPaper,makeWileyPaper:makeWileyPaper,makeScienceDirectPaper:makeScienceDirectPaper,makeSciencePaper:makeSciencePaper,makeFrontiersPaper:makeFrontiersPaper,makeIHEPPaper:makeIHEPPaper,makePLOSPaper:makePLOSPaper,makeRSCPaper:makeRSCPaper,makeWebsitePaper:makeWebsitePaper,makeMDPIPaper:makeMDPIPaper,makeOUPPaper:makeOUPPaper,makerHALPaper:makerHALPaper,tryPWCMatch:tryPWCMatch,tryCrossRef:tryCrossRef,tryDBLP:tryDBLP,trySemanticScholar:trySemanticScholar,tryGoogleScholar:tryGoogleScholar,tryUnpaywall:tryUnpaywall,tryPreprintMatch:tryPreprintMatch,initPaper:initPaper,autoTagPaper:autoTagPaper,makePaper:makePaper,findFuzzyPaperMatch:findFuzzyPaperMatch});