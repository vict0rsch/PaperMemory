const findEl=(e,t)=>void 0===t?"string"==typeof e?document.getElementById(e):e:findEl("memory-container--"+e).querySelector("."+t),fadeOut=(e,t=250,r=()=>{})=>{(e=findEl(e)).style.transition=t+"ms",e.style.opacity=0,setTimeout(()=>{e.style.display="none",r()},t)},fadeIn=(e,t="block",r=250,i=()=>{})=>{(e=findEl(e)).style.opacity=0,"none"===e.style.display&&(e.style.display=t),setTimeout(()=>{e.style.transition=r+"ms",e.style.opacity=1,setTimeout(()=>{i()},r)},0)},val=(e,t)=>{if(e instanceof HTMLInputElement&&"checkbox"===e.type){if(void 0===t)return e.checked;e.checked=t}if("string"==typeof e&&(e=findEl(e)),void 0===t)return e?e.value:"";e&&(e.value=t)},showId=(e,t="block")=>{let r=findEl(e);r&&(r.style.display=t)},hideId=e=>{(el=findEl(e))&&(el.style.display="none")},setTextId=(e,t)=>{let r=findEl(e);r&&(r.innerText=t)},setHTML=(e,t)=>{(e="string"==typeof e?findEl(e):e)&&(e.innerHTML=t)},dispatch=(e,t)=>{if("string"==typeof e&&(e=findEl(e)),"string"==typeof t){if("focus"===t)return void e.focus();if("blur"===t)return void e.blur();t=new Event(t)}e&&e.dispatchEvent(t)},hasClass=(e,t)=>{let r;if(r="string"==typeof e?findEl(e):e)return r.classList.contains(t)},addClass=(e,t)=>{let r;(r="string"==typeof e?findEl(e):e)&&r.classList.add(t)},removeClass=(e,t)=>{let r;(r="string"==typeof e?findEl(e):e)&&r.classList.remove(t)},addListener=(e,t,r)=>{(e="string"==typeof e?findEl(e):e)&&e.addEventListener(t,r)},setPlaceholder=(e,t)=>{(e="string"==typeof e?findEl(e):e)&&void 0!==e.placeholder&&(e.placeholder=t)},style=(e,t,r)=>{if(e="string"==typeof e?findEl(e):e){if(void 0===r)return e.style[t];e.style[t]=r}},disable=(e,t=!0)=>{(e="string"==typeof e?findEl(e):e)&&(e.disabled=t)},slideUp=(e,t=250,r=()=>{})=>{(e="string"==typeof e?findEl(e):e)&&(e.style.transitionProperty="height, margin, padding",e.style.transitionDuration=t+"ms",e.style.height=e.offsetHeight+"px",e.offsetHeight,e.style.overflow="hidden",e.style.height=0,e.style.paddingTop=0,e.style.paddingBottom=0,e.style.marginTop=0,e.style.marginBottom=0,window.setTimeout(()=>{e.style.display="none",e.style.removeProperty("height"),e.style.removeProperty("padding-top"),e.style.removeProperty("padding-bottom"),e.style.removeProperty("margin-top"),e.style.removeProperty("margin-bottom"),e.style.removeProperty("overflow"),e.style.removeProperty("transition-duration"),e.style.removeProperty("transition-property"),e.style.removeProperty("box-sizing"),r()},t))},slideDown=(t,r=500,i=()=>{})=>{if(t="string"==typeof t?findEl(t):t){t.style.removeProperty("display");let e=window.getComputedStyle(t).display;"none"===e&&(e="block"),t.style.display=e;var a=t.offsetHeight;t.style.overflow="hidden",t.style.height=0,t.style.paddingTop=0,t.style.paddingBottom=0,t.style.marginTop=0,t.style.marginBottom=0,t.offsetHeight,t.style.transitionProperty="height, margin, padding",t.style.transitionDuration=r+"ms",t.style.height=a+"px",t.style.removeProperty("padding-top"),t.style.removeProperty("padding-bottom"),t.style.removeProperty("margin-top"),t.style.removeProperty("margin-bottom"),window.setTimeout(()=>{t.style.removeProperty("height"),t.style.removeProperty("overflow"),t.style.removeProperty("transition-duration"),t.style.removeProperty("transition-property"),i()},r)}},slideToggle=(e,t=500,r=()=>{})=>("none"===window.getComputedStyle(e).display?slideDown:slideUp)(e,t,r),queryAll=(e,t)=>[...e.querySelectorAll(t)],createElementFromHTML=e=>{var t=document.createElement("div");return t.innerHTML=e.trim(),t.firstChild},addEventToClass=(e,t,r)=>{e.startsWith(".")||(e="."+e),document.querySelectorAll(e).forEach(e=>{e.addEventListener(t,r)})};var dummyModule,global=("undefined"!=typeof module&&null!=module.exports&&(dummyModule=module,dummyModule.exports={findEl:findEl,fadeOut:fadeOut,fadeIn:fadeIn,val:val,showId:showId,hideId:hideId,setTextId:setTextId,setHTML:setHTML,dispatch:dispatch,hasClass:hasClass,addClass:addClass,removeClass:removeClass,addListener:addListener,setPlaceholder:setPlaceholder,style:style,disable:disable,slideUp:slideUp,slideDown:slideDown,slideToggle:slideToggle,queryAll:queryAll,addEventToClass:addEventToClass,createElementFromHTML:createElementFromHTML}),Object.defineProperty(Array.prototype,"last",{value:function(e=0){return this.reverse()[e]}}),Object.defineProperty(String.prototype,"capitalize",{value:function(e=!1){return e?this.split(" ").map(e=>e.capitalize()).join(" "):this.charAt(0).toUpperCase()+this.slice(1).toLowerCase()}}),{}),dummyModule,dummyModule,dummyModule,dummyModule,dummyModule,dummyModule,dummyModule;function _min(e,t,r,i,a){return e<t||r<t?r<e?r+1:e+1:i===a?t:t+1}"undefined"!=typeof window&&(global=window),global.state={dataVersion:0,memoryIsOpen:!1,menuIsOpen:!1,papers:{},papersList:[],paperTags:new Set,pdfTitleFn:null,showFavorites:!1,sortedPapers:[],sortKey:"",papersReady:!1,prefs:{},files:{},ignoreSources:{},lastRefresh:new Date,titleHashToIds:{},urlHashToId:{},memoryItemsPerPage:25,currentMemoryPagination:0},global.descendingSortKeys=["addDate","count","lastOpenDate","favoriteDate","year"],global.select2Options={placeholder:"Tag paper",maximumSelectionLength:5,allowClear:!0,tags:!0,tokenSeparators:[","," "]},global.prefsCheckNames=["checkBib","checkMd","checkDownload","checkPdfTitle","checkFeedback","checkDarkMode","checkDirectOpen","checkStore","checkScirate","checkOfficialRepos","checkPreferPdf","checkPdfOnly","checkNoAuto","checkMdYearVenue"],global.prefsCheckDefaultFalse=["checkDarkMode","checkStore","checkScirate","checkOfficialRepos","checkPdfOnly","checkNoAuto","checkMdYearVenue"],global.prefsStorageKeys=[...global.prefsCheckNames,"pdfTitleFn"],global.sourceExtras={springer:{types:["chapter","article","book","referenceworkentry"]}},global.preprintSources=["arxiv","biorxiv"],global.knownPaperPages={acl:["aclanthology.org/"],acm:["dl.acm.org/doi/"],aps:[e=>Boolean(e.match(/journals\.aps\.org\/\w+\/(abstract|pdf)\//g))],acs:["pubs.acs.org/doi/"],arxiv:["arxiv.org/abs/","arxiv.org/pdf/","scirate.com/arxiv/"],biorxiv:["biorxiv.org/content"],cvf:["openaccess.thecvf.com/content"],frontiers:["frontiersin.org/articles"],ihep:["inspirehep.net/literature/","inspirehep.net/files/"],ijcai:[e=>/ijcai\.org\/proceedings\/\d{4}\/\d+/gi.test(e)],ieee:["ieeexplore.ieee.org/document/","ieeexplore.ieee.org/abstract/document/","ieeexplore.ieee.org/stamp/stamp.jsp?tp=&arnumber="],iop:["iopscience.iop.org/article/"],jmlr:[e=>e.includes("jmlr.org/papers/v")&&!e.endsWith("/")],nature:["nature.com/articles/"],neurips:["neurips.cc/paper/","nips.cc/paper/"],openreview:["openreview.net/forum","openreview.net/pdf","openreview.net/attachment"],plos:[e=>/journals\.plos\.org\/.+\/article.+id=/gi.test(e)],pmc:["ncbi.nlm.nih.gov/pmc/articles/PMC"],pmlr:["proceedings.mlr.press/"],pnas:["pnas.org/content/","pnas.org/doi/"],rsc:["pubs.rsc.org/en/content/article"],science:[e=>Boolean(e.match(/science\.org\/doi\/?(abs|full|pdf|epdf)?\//g))],sciencedirect:["sciencedirect.com/science/article/pii/","sciencedirect.com/science/article/abs/pii/","reader.elsevier.com/reader/sd/pii/"],springer:[...global.sourceExtras.springer.types.map(e=>`link.springer.com/${e}/`),"link.springer.com/content/pdf/"],wiley:[e=>Boolean(e.match(/onlinelibrary\.wiley\.com\/doi\/(abs|full|pdf|epdf)\//g))]},global.sourcesNames={acl:"Association for Computational Linguistics (ACL)",acm:"Association for Computing Machinery (ACM)",acs:"American Chemical Society (ACS)",aps:"American Physical Society",arxiv:"ArXiv",biorxiv:"BioRxiv",cvf:"Computer Vision Foundation (CVF)",ijcai:"International Joint Conferences on Artificial Intelligence (IJCAI)",iop:"Institute Of Physics (IOP)",jmlr:"Journal of Machine Learning Research (JMLR)",nature:"Nature",neurips:"NeurIPS",openreview:"OpenReview",pmc:"PubMed Central",pmlr:"Proceedings of Machine Learning Research (PMLR)",pnas:"Proceedings of the National Academy of Sciences (PNAS)",science:"Science",sciencedirect:"ScienceDirect",springer:"Springer",wiley:"Wiley"},global.overrideORConfs={"robot-learning":"CoRL",ijcai:"IJCAI"},global.overridePMLRConfs={"Conference on Learning Theory":"CoLT","International Conference on Machine Learning":"ICML","Conference on Uncertainty in Artificial Intelligence":"UAI","Conference on Robot Learning":"CoRL","International Conference on Artificial Intelligence and Statistics":"AISTATS","International Conference on Algorithmic Learning Theory":"ALT"},global.overrideDBLPVenues={"J. Mach. Learn. Res.":"JMLR"},global.consolHeaderStyle="@import url('https://fonts.googleapis.com/css2?family=Fira+Code:wght@300');font-family:'Fira Code' monospace;font-size:1rem;font-weight:300;display:inline-block;border:2px solid #A41716;border-radius: 4px;padding: 12px; margin: 12px;",global.fuzzyTitleMatchMinDist=4,global.defaultTitleFunctionCode=`(paper) => {
 const title = paper.title.replaceAll("\\n", '');
 const id = paper.id;
 let name = \`\${title} - \${id}\`;
 name = name.replaceAll(":", " ").replace(/\\s\\s+/g, " ");
 return name
};`,global.storeReadme=`/!\\ Warning: This folder has been created automatically by your PaperMemory browser extension.
 /!\\ It has to stay in your downloads for PaperMemory to be able to access your papers.
 /!\\ To be able to open files from this folder instead of re-downloading them, PaperMemory will match their titles and downloaded urls.
 /!\\ If you change the default title function in the Advanced Options and do not include a paper's title in the file name, PaperMemory may not be able to open the file and will instead open the pdf url.
 /!\\ Unfortunately, PaperMemory cannot detect papers that have not been *downloaded there* so putting papers in this folder will not make them discoverable by the \`browser.downloads\` API PaperMemory uses.`,global.englishStopWords=new Set(["i","me","my","myself","we","our","ours","ourselves","you","your","yours","yourself","yourselves","he","him","his","himself","she","her","hers","herself","it","its","itself","they","them","their","theirs","themselves","what","which","who","whom","this","that","these","those","am","is","are","was","were","be","been","being","have","has","had","having","do","does","did","doing","a","an","the","and","but","if","or","because","as","until","while","of","at","by","for","with","about","against","between","into","through","during","before","after","above","below","to","from","up","down","in","out","on","off","over","under","again","further","then","once","here","there","when","where","why","how","all","any","both","each","few","more","most","other","some","such","no","nor","not","only","own","same","so","than","too","very","s","t","can","will","just","don","should","now"]),global.journalAbbreviations=null,"undefined"!=typeof module&&null!=module.exports&&(dummyModule=module,dummyModule.exports={state:global.state,descendingSortKeys:global.descendingSortKeys,select2Options:global.select2Options,prefsCheckNames:global.prefsCheckNames,prefsCheckDefaultFalse:global.prefsCheckDefaultFalse,prefsStorageKeys:global.prefsStorageKeys,sourceExtras:global.sourceExtras,preprintSources:global.preprintSources,knownPaperPages:global.knownPaperPages,sourcesNames:global.sourcesNames,overrideORConfs:global.overrideORConfs,overridePMLRConfs:global.overridePMLRConfs,overrideDBLPVenues:global.overrideDBLPVenues,fuzzyTitleMatchMinDist:global.fuzzyTitleMatchMinDist,defaultTitleFunctionCode:global.defaultTitleFunctionCode,storeReadme:global.storeReadme,englishStopWords:global.englishStopWords,journalAbbreviations:global.journalAbbreviations,consolHeaderStyle:global.consolHeaderStyle});const levenshtein=(e,t)=>{if(e===t)return 0;e.length>t.length&&(r=e,e=t,t=r);for(var r,i=e.length,a=t.length;0<i&&e.charCodeAt(i-1)===t.charCodeAt(a-1);)i--,a--;for(var n=0;n<i&&e.charCodeAt(n)===t.charCodeAt(n);)n++;if(a-=n,0===(i-=n)||a<3)return a;for(var o,s,l,c,p,u,d,f,h,g,m,y=0,b=[],v=0;v<i;v++)b.push(v+1),b.push(e.charCodeAt(n+v));for(var w=b.length-1;y<a-3;)for(f=t.charCodeAt(n+(o=y)),h=t.charCodeAt(n+(s=y+1)),g=t.charCodeAt(n+(l=y+2)),m=t.charCodeAt(n+(c=y+3)),p=y+=4,v=0;v<w;v+=2)o=_min(u=b[v],o,s,f,d=b[v+1]),s=_min(o,s,l,h,d),l=_min(s,l,c,g,d),p=_min(l,c,p,m,d),b[v]=p,c=l,l=s,s=o,o=u;for(;y<a;)for(f=t.charCodeAt(n+(o=y)),p=++y,v=0;v<w;v+=2)u=b[v],b[v]=p=_min(u,o,p,f,b[v+1]),o=u;return p};function BibtexParser(){this.months=["jan","feb","mar","apr","may","jun","jul","aug","sep","oct","nov","dec"],this.notKey=[",","{","}"," ","="],this.pos=0,this.input="",this.entries=new Array,this.currentEntry="",this.setInput=function(e){this.input=e},this.getEntries=function(){return this.entries},this.isWhitespace=function(e){return" "==e||"\r"==e||"\t"==e||"\n"==e},this.match=function(e,t){if(this.skipWhitespace(t=null==t?!0:t),this.input.substring(this.pos,this.pos+e.length)!=e)throw TypeError("Token mismatch: match -> expected "+e+", found "+this.input.substring(this.pos));this.pos+=e.length,this.skipWhitespace(t)},this.tryMatch=function(e,t){return this.skipWhitespace(t=null==t?!0:t),this.input.substring(this.pos,this.pos+e.length)==e},this.matchAt=function(){for(;this.input.length>this.pos&&"@"!=this.input[this.pos];)this.pos++;return"@"==this.input[this.pos]},this.skipWhitespace=function(e){for(;this.isWhitespace(this.input[this.pos]);)this.pos++;if("%"==this.input[this.pos]&&1==e){for(;"\n"!=this.input[this.pos];)this.pos++;this.skipWhitespace(e)}},this.value_braces=function(){for(var e,t=0,r=(this.match("{",!1),this.pos),i=!1;;){if(!i)if("}"==this.input[this.pos]){if(!(0<t))return e=this.pos,this.match("}",!1),this.input.substring(r,e);t--}else if("{"==this.input[this.pos])t++;else if(this.pos>=this.input.length-1)throw TypeError("Unterminated value: value_braces");i="\\"==this.input[this.pos]&&0==i,this.pos++}},this.value_comment=function(){for(var e="",t=0;!this.tryMatch("}",!1)||0!=t;){if(e+=this.input[this.pos],"{"==this.input[this.pos]&&t++,"}"==this.input[this.pos]&&t--,this.pos>=this.input.length-1)throw TypeError("Unterminated value: value_comment",+this.input.substring(start));this.pos++}return e},this.value_quotes=function(){this.match('"',!1);for(var e,t=this.pos,r=!1;;){if(!r){if('"'==this.input[this.pos])return e=this.pos,this.match('"',!1),this.input.substring(t,e);if(this.pos>=this.input.length-1)throw TypeError("Unterminated value: value_quotes",this.input.substring(t))}r="\\"==this.input[this.pos]&&0==r,this.pos++}},this.single_value=function(){var e=this.pos;if(this.tryMatch("{"))return this.value_braces();if(this.tryMatch('"'))return this.value_quotes();var t=this.key();if(t.match("^[0-9]+$"))return t;if(0<=this.months.indexOf(t.toLowerCase()))return t.toLowerCase();throw"Value expected: single_value"+this.input.substring(e)+" for key: "+t},this.value=function(){var e=[];for(e.push(this.single_value());this.tryMatch("#");)this.match("#"),e.push(this.single_value());return e.join("")},this.key=function(e){for(var t=this.pos;;){if(this.pos>=this.input.length)throw TypeError("Runaway key: key");if(0<=this.notKey.indexOf(this.input[this.pos]))return e&&","!=this.input[this.pos]?(this.pos=t,null):this.input.substring(t,this.pos);this.pos++}},this.key_equals_value=function(){var e,t=this.key();if(this.tryMatch("="))return this.match("="),e=this.value(),[t=t.trim(),e];throw TypeError("Value expected, equals sign missing: key_equals_value",this.input.substring(this.pos))},this.key_value_list=function(){var e=this.key_equals_value();for(this.currentEntry.entryTags={},this.currentEntry.entryTags[e[0]]=e[1];this.tryMatch(",")&&(this.match(","),!this.tryMatch("}"));)e=this.key_equals_value(),this.currentEntry.entryTags[e[0]]=e[1]},this.entry_body=function(e){this.currentEntry={},this.currentEntry.citationKey=this.key(!0),this.currentEntry.entryType=e.substring(1),null!=this.currentEntry.citationKey&&this.match(","),this.key_value_list(),this.entries.push(this.currentEntry)},this.directive=function(){return this.match("@"),"@"+this.key()},this.preamble=function(){this.currentEntry={},this.currentEntry.entryType="PREAMBLE",this.currentEntry.entry=this.value_comment(),this.entries.push(this.currentEntry)},this.comment=function(){this.currentEntry={},this.currentEntry.entryType="COMMENT",this.currentEntry.entry=this.value_comment(),this.entries.push(this.currentEntry)},this.entry=function(e){this.entry_body(e)},this.alernativeCitationKey=function(){this.entries.forEach(function(e){!e.citationKey&&e.entryTags&&(e.citationKey="",e.entryTags.author&&(e.citationKey+=e.entryTags.author.split(",")[0]+=", "),e.citationKey+=e.entryTags.year)})},this.bibtex=function(){for(;this.matchAt();){var e=this.directive();this.match("{"),"@STRING"==e.toUpperCase()?this.string():"@PREAMBLE"==e.toUpperCase()?this.preamble():"@COMMENT"==e.toUpperCase()?this.comment():this.entry(e),this.match("}")}this.alernativeCitationKey()}}const bibtexToObject=e=>{var t=new BibtexParser,e=(t.setInput(e),t.bibtex(),t.getEntries()[0]);return{...e.entryTags,entryType:e.entryType,citationKey:e.citationKey}},bibtexToString=e=>{let t=`@${(e={...e="string"==typeof e?bibtexToObject(e):e}).entryType.toLowerCase()}{${e.citationKey},
`;delete e.entryType,delete e.citationKey;var r,i=Math.max(...Object.keys(e).map(e=>e.length));for(const a in e)e.hasOwnProperty(a)&&e[a]&&(r=e[a].replaceAll(/\s+/g," ").trim(),bkey=a+" ".repeat(i-a.length),t+=`	${bkey} = {${r}},
`);return(t.slice(0,-2)+"\n}").replaceAll("\t","  ").replaceAll("--","-")},extractBibtexValue=(e,t)=>{const r=bibtexToObject(e);return r.hasOwnProperty(t)?r[t]:""},extractAuthor=e=>extractBibtexValue(e,"author").replaceAll("{","").replaceAll("}","").replaceAll("\\","").split(" and ").map(e=>e.split(", ").reverse().join(" ")).join(" and "),logTrace=("undefined"!=typeof module&&null!=module.exports&&(dummyModule=module,dummyModule.exports={bibtexToObject:bibtexToObject,bibtexToString:bibtexToString,extractBibtexValue:extractBibtexValue,extractAuthor:extractAuthor}),"undefined"!=typeof LOGTRACE&&LOGTRACE),log=(...e)=>{if(logTrace){const s=(new Error).stack;e.push("\n\nLog trace:\n"+s.split("\n").slice(2).join("\n"))}let t="%c%s ",r=!1,i=!1,a=!1,n=!1,o=!1;"[info]"===e[0]?(r=!0,e=e.slice(1)):"[warn]"===e[0]?(i=!0,e=e.slice(1)):"[error]"===e[0]?(a=!0,e=e.slice(1)):"[ok]"===e[0]?(o=!0,e=e.slice(1)):"[debug]"===e[0]&&(n=!0,e=e.slice(1)),e.forEach(e=>{switch(typeof e){case"bigint":case"number":t+="%d   ";break;case"string":t+="%s   ";break;default:t+="%o   "}}),console.log(t,"color: "+(r?"#8BB4F7; font-weight:bold;":i?"#f3bd1e; font-weight:bold;":a?"#FF4F54; font-weight:bold;":o?"#23F62B; font-weight:bold;":n?"#BA357E; font-weight:bold;":"tan"),"[PM]",...e)},info=(...e)=>log("[info]",...e),warn=(...e)=>log("[warn]",...e),debug=(...e)=>log("[debug]",...e),logOk=(...e)=>log("[ok]",...e),logError=(...e)=>log("[error]",...e),consoleHeader=e=>console.groupCollapsed("%c"+e,global.consolHeaderStyle),getDisplayId=e=>{var t=e;if((e=e.split("_")[0].split(".")[0]).startsWith("OR-")||(e=e.split("-").slice(0,2).join("-")),global.state.papers.hasOwnProperty(t)){const r=global.state.papers[t];if("nature"===r.source){if(r.note.match(/^Published\ @.+\(\d+\)$/)){const i=r.note.split("@")[1].split("(")[0].trim();e+="-"+i.split(" ").map(e=>e[0].toUpperCase()).join("")}e+="-"+r.year}"acs"===r.source&&(e+="-"+r.year),"iop"===r.source&&(e+="-"+r.year)}return e},isObject=e=>"object"==typeof e&&!Array.isArray(e)&&null!==e,isPdfUrl=e=>e.endsWith(".pdf")||e.endsWith("/pdf")||e.includes("openreview.net/pdf")||e.match(/\/e?pdf\//g)||e.includes("ieee.org/stamp/stamp.jsp?tp=&arnumber=")||e.includes("articlepdf");function delay(t,r){let i=0;return function(...e){clearTimeout(i),i=setTimeout(t.bind(this,...e),r||0)}}const cleanPapers=e=>{let t={...e};return delete t.__dataVersion,t},firstNonStopLowercase=e=>{let t=e.toLowerCase(),r=t.split(" ").map(miniHash);e=r.filter(e=>!global.englishStopWords.has(e));return(0<e.length?e:r)[0]},miniHash=e=>e.toLowerCase().replace(/\W/g,""),fallbackCopyTextToClipboard=e=>{var t=document.createElement("textarea");t.value=e,t.style.top="0",t.style.left="0",t.style.position="fixed",document.body.appendChild(t),t.focus(),t.select();try{var r=document.execCommand("copy")?"successful":"unsuccessful";log("Fallback: Copying text command was "+r)}catch(e){console.error("Fallback: Oops, unable to copy",e)}document.body.removeChild(t)},copyTextToClipboard=e=>{navigator.clipboard?navigator.clipboard.writeText(e).then(()=>{log("Async: Copying to clipboard was successful!")},e=>{console.error("Async: Could not copy text: ",e)}):fallbackCopyTextToClipboard(e)},parseUrl=e=>{var t=document.createElement("a");return t.href=e,t},downloadTextFile=(e,t,r)=>{var i=document.createElement("a");"text/plain"===r?(e=e.replace(/\\n/g,"%0D%0A").replace(/"/g,""),i.download=t,i.href="data:text/plain,"+e):(e=new Blob([e],{type:r}),i.href=URL.createObjectURL(e),i.download=t),i.click()},eventId=e=>e.target.closest(".memory-container").id.split("--")[1],downloadFile=(e,t)=>{var r;window.ActiveXObject?window.ActiveXObject&&document.execCommand&&((r=window.open(e,"_blank")).document.close(),r.document.execCommand("SaveAs",!0,t||e),r.close()):((r=document.createElement("a")).href=e,r.target="_blank",e=e.substring(e.lastIndexOf("/")+1),r.download=t||e,navigator.userAgent.toLowerCase().match(/(ipad|iphone|safari)/)&&navigator.userAgent.search("Chrome")<0?document.location=r.href:(t=new MouseEvent("click",{view:window,bubbles:!0,cancelable:!1}),r.dispatchEvent(t),(window.URL||window.webkitURL).revokeObjectURL(r.href)))},hashCode=e=>e.split("").reduce((e,t)=>(e=(e<<5)-e+t.charCodeAt(0))&e,0),parseCVFUrl=e=>{const t=e.replace("https://openaccess.thecvf.com/content","").slice(1).split("/")[0].split("_");let r,i;i=1===t.length?(r=t[0].slice(0,-4),t[0].slice(-4)):(r=t[0].toUpperCase(),t[1]);e=e.split("/").last().split(".")[0],e=(hashCode(e)+"").replace("-","").slice(0,8),e=`${r}-${i}_`+e;return{conf:r,year:i,id:e}},cleanBiorxivURL=e=>e=(e=e.replace(".full.pdf","")).match(/\d$/)?e:e.split(".").slice(0,-1).join("."),textareaFocusEnd=e=>{setTimeout(()=>{e.selectionStart=e.selectionEnd=1e4},0)},tablerSvg=(e,t,r)=>{switch(t=(t=void 0===t?"":t)&&`id="${t}"`,r=(r=(r=void 0===r?[]:r).filter(e=>e))&&`class="${r.join(" ")}"`,e){case"adjustments":return`<svg viewBox="0 0 24 24" ${t} ${r}><path stroke="none" d="M0 0h24v24H0z" fill="none"/><circle cx="6" cy="10" r="2"/><line x1="6" y1="4" x2="6" y2="8"/><line x1="6" y1="12" x2="6" y2="20"/><circle cx="12" cy="16" r="2"/><line x1="12" y1="4" x2="12" y2="14"/><line x1="12" y1="18" x2="12" y2="20"/><circle cx="18" cy="7" r="2"/><line x1="18" y1="4" x2="18" y2="5"/><line x1="18" y1="9" x2="18" y2="20"/></svg>`;case"circle-x":return`<svg viewBox="0 0 24 24" ${t} ${r}><path stroke="none" d="M0 0h24v24H0z" fill="none"/><circle cx="12" cy="12" r="9"/><path d="M10 10l4 4m0 -4l-4 4"/></svg>`;case"star":return`<svg viewBox="0 0 24 24" ${t} ${r}><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M12 17.75l-6.172 3.245l1.179 -6.873l-5 -4.867l6.9 -1l3.086 -6.253l3.086 6.253l6.9 1l-5 4.867l1.179 6.873z"/></svg>`;case"writing":return`<svg viewBox="0 0 24 24" ${t} ${r}><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M20 17v-12c0 -1.121 -.879 -2 -2 -2s-2 .879 -2 2v12l2 2l2 -2z"/><path d="M16 7h4"/><path d="M18 19h-13a2 2 0 1 1 0 -4h4a2 2 0 1 0 0 -4h-3"/></svg>`;case"file-symlink":return`<svg viewBox="0 0 24 24" ${t} ${r}><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M4 21v-4a3 3 0 0 1 3 -3h5"/><path d="M9 17l3 -3l-3 -3"/><path d="M14 3v4a1 1 0 0 0 1 1h4"/><path d="M5 11v-6a2 2 0 0 1 2 -2h7l5 5v11a2 2 0 0 1 -2 2h-9.5"/></svg>`;case"link":return`<svg viewBox="0 0 24 24" ${t} ${r}><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M10 14a3.5 3.5 0 0 0 5 0l4 -4a3.5 3.5 0 0 0 -5 -5l-.5 .5"/><path d="M14 10a3.5 3.5 0 0 0 -5 0l-4 4a3.5 3.5 0 0 0 5 5l.5 -.5"/></svg>`;case"clipboard-list":return`<svg viewBox="0 0 24 24" ${t} ${r}><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M9 5h-2a2 2 0 0 0 -2 2v12a2 2 0 0 0 2 2h10a2 2 0 0 0 2 -2v-12a2 2 0 0 0 -2 -2h-2"/><rect x="9" y="3" width="6" height="4" rx="2"/><line x1="9" y1="12" x2="9.01" y2="12"/><line x1="13" y1="12" x2="15" y2="12"/><line x1="9" y1="16" x2="9.01" y2="16"/><line x1="13" y1="16" x2="15" y2="16"/></svg>`;case"archive":return`<svg viewBox="0 0 24 24" ${t} ${r}><path stroke="none" d="M0 0h24v24H0z" fill="none"/><rect x="3" y="4" width="18" height="4" rx="2"/><path d="M5 8v10a2 2 0 0 0 2 2h10a2 2 0 0 0 2 -2v-10"/><line x1="10" y1="12" x2="14" y2="12"/></svg>`;case"external-link":return`<svg viewBox="0 0 24 24" ${t} ${r}><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M11 7h-5a2 2 0 0 0 -2 2v9a2 2 0 0 0 2 2h9a2 2 0 0 0 2 -2v-5"/><line x1="10" y1="14" x2="20" y2="4"/><polyline points="15 4 20 4 20 9"/></svg>`;case"file-download":return`<svg viewBox="0 0 24 24" ${t} ${r}><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M14 3v4a1 1 0 0 0 1 1h4"/><path d="M17 21h-10a2 2 0 0 1 -2 -2v-14a2 2 0 0 1 2 -2h7l5 5v11a2 2 0 0 1 -2 2z"/><line x1="12" y1="11" x2="12" y2="17"/><polyline points="9 14 12 17 15 14"/></svg>`;case"cirlce-x":return`<svg viewBox="0 0 24 24" ${t} ${r}><path stroke="none" d="M0 0h24v24H0z" fill="none"/><circle cx="12" cy="12" r="9"/><path d="M10 10l4 4m0 -4l-4 4"/></svg>`;case"settings":return`<svg viewBox="0 0 24 24" ${t} ${r}><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M10.325 4.317c.426 -1.756 2.924 -1.756 3.35 0a1.724 1.724 0 0 0 2.573 1.066c1.543 -.94 3.31 .826 2.37 2.37a1.724 1.724 0 0 0 1.065 2.572c1.756 .426 1.756 2.924 0 3.35a1.724 1.724 0 0 0 -1.066 2.573c.94 1.543 -.826 3.31 -2.37 2.37a1.724 1.724 0 0 0 -2.572 1.065c-.426 1.756 -2.924 1.756 -3.35 0a1.724 1.724 0 0 0 -2.573 -1.066c-1.543 .94 -3.31 -.826 -2.37 -2.37a1.724 1.724 0 0 0 -1.065 -2.572c-1.756 -.426 -1.756 -2.924 0 -3.35a1.724 1.724 0 0 0 1.066 -2.573c-.94 -1.543 .826 -3.31 2.37 -2.37c1 .608 2.296 .07 2.572 -1.065z"/><circle cx="12" cy="12" r="3"/></svg>`;case"messages":return`<svg viewBox="0 0 24 24" ${t} ${r}><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M21 14l-3 -3h-7a1 1 0 0 1 -1 -1v-6a1 1 0 0 1 1 -1h9a1 1 0 0 1 1 1v10"/><path d="M14 15v2a1 1 0 0 1 -1 1h-7l-3 3v-10a1 1 0 0 1 1 -1h2"/></svg>`;case"vocabulary":return`<svg viewBox="0 0 24 24" ${t} ${r}><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M10 19h-6a1 1 0 0 1 -1 -1v-14a1 1 0 0 1 1 -1h6a2 2 0 0 1 2 2a2 2 0 0 1 2 -2h6a1 1 0 0 1 1 1v14a1 1 0 0 1 -1 1h-6a2 2 0 0 0 -2 2a2 2 0 0 0 -2 -2z"/><path d="M12 5v16"/><path d="M7 7h1"/><path d="M7 11h1"/><path d="M16 7h1"/><path d="M16 11h1"/><path d="M16 15h1"/></svg>`;case"database-export":return`<svg viewBox="0 0 24 24" ${t} ${r}><path stroke="none" d="M0 0h24v24H0z" fill="none"/><ellipse cx="12" cy="6" rx="8" ry="3"/><path d="M4 6v6c0 1.657 3.582 3 8 3a19.84 19.84 0 0 0 3.302 -.267m4.698 -2.733v-6"/><path d="M4 12v6c0 1.599 3.335 2.905 7.538 2.995m8.462 -6.995v-2m-6 7h7m-3 -3l3 3l-3 3"/></svg>`;case"eyeglass":return`<svg viewBox="0 0 24 24" ${t} ${r}><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M8 4h-2l-3 10"/><path d="M16 4h2l3 10"/><line x1="10" y1="16" x2="14" y2="16"/><path d="M21 16.5a3.5 3.5 0 0 1 -7 0v-2.5h7v2.5"/><path d="M10 16.5a3.5 3.5 0 0 1 -7 0v-2.5h7v2.5"/></svg>`;case"markdown":return`<svg viewBox="0 0 24 24" ${t} ${r}><path stroke="none" d="M0 0h24v24H0z" fill="none"/><rect x="3" y="5" width="18" height="14" rx="2"/><path d="M7 15v-6l2 2l2 -2v6"/><path d="M14 13l2 2l2 -2m-2 2v-6"/></svg>`;case"math-function":return`<svg viewBox="0 0 24 24" ${t} ${r}><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M14 10h1c1 0 1 1 2.016 3.527c.984 2.473 .984 3.473 1.984 3.473h1"/><path d="M13 17c1.5 0 3 -2 4 -3.5s2.5 -3.5 4 -3.5"/><path d="M3 19c0 1.5 .5 2 2 2s2 -4 3 -9s1.5 -9 3 -9s2 .5 2 2"/><line x1="5" y1="12" x2="11" y2="12"/></svg>`;default:return""}},stringifyError=e=>{const t=chrome.runtime.id;return e.stack.split("\n").map(e=>e.split(" ").map(e=>e.split(t).last()).join(" ")).join("<br/>")},arraysIdentical=(e,t)=>{var r=e.length;if(r!=t.length)return!1;for(;r--;)if(e[r]!==t[r])return!1;return!0},parseTags=e=>{let t=Array.from(e.selectedOptions,e=>e.value.trim()).filter(e=>e);return t.sort(),t},getPaperEdits=(e,t)=>{let r,i,a,n;return n=t?(r=val("popup-form-note-textarea--"+e),a=val(document.getElementById("popup-form-note--"+e).querySelector(".form-code-input")),i=parseTags(findEl("popup-item-tags--"+e)),findEl("checkFavorite--"+e).checked):(r=val(findEl(e,"form-note-textarea")),a=val(findEl(e,"form-code-input")),i=parseTags(findEl(e,"memory-item-tags")),hasClass("memory-container--"+e,"favorite")),{note:r,tags:i,codeLink:a,favorite:n}},setFormChangeListener=(e,t)=>{let r,i,a,n;t?(r="#popup-item-tags--"+e.replace(".","\\."),a="popup-form-codeLink--"+e,i="popup-form-note-textarea--"+e,n="checkFavorite--"+e,$(r).on("change",delay(monitorPaperEdits(e,t),300)),addListener(a,"keyup",delay(monitorPaperEdits(e,t),300)),addListener(i,"keyup",delay(monitorPaperEdits(e,t),300)),addListener(n,"change",delay(monitorPaperEdits(e,t),300))):(r=".memory-item-tags",a=".form-code-input",i=".form-note-textarea",addEventToClass(a,"keyup",delay(monitorPaperEdits(void 0,t),300)),addEventToClass(i,"keyup",delay(monitorPaperEdits(void 0,t),300)))},monitorPaperEdits=(c,p)=>e=>{let t;t=void 0===c?eventId(e):c;var r=getPaperEdits(t,p),i=global.state.papers[t];let a=!1,n={};for(const l in r){var o=i[l],s=(n[l]=o,r[l]);"tags"===l?arraysIdentical(o,s)||(a=!0):o!==s&&(a=!0)}a&&(console.log("Updating meta data for",t),(p?handlePopupSaveEdits:handleMemorySaveEdits)(t))},cutAuthors=(e,t,r)=>{void 0===t&&(t=140),void 0===r&&(r=", ");let i="";var e=e.split(" and "),a=e[e.length-1];for(const n of e){if(!(5+i.length+r.length+n.length+a.length<t)){i+=" ... "+a;break}i?i+=", "+n:i=n}return i},sendMessageToBackground=e=>new Promise(t=>{chrome.runtime.sendMessage(e,e=>{t(e)})}),getStoredFiles=()=>new Promise(t=>{chrome.downloads.search({filenameRegex:"(PaperMemoryStore/)?.*.pdf"},e=>t(e.filter(e=>e.exists&&"complete"===e.state&&!e.filename.toLowerCase().includes("readme.txt"))))}),noParamUrl=e=>e.split("?")[0].split("#")[0],silentPromiseTimeout=(e,r=5e3)=>{let i;return Promise.race([e,new Promise((e,t)=>i=setTimeout(e,r))]).finally(()=>clearTimeout(i))},shouldWarn=async(e,t=()=>{})=>{if("pdf-title"===e){var r=await getStorage("titleFunctionCode");if(r&&r!==global.defaultTitleFunctionCode)if(!(await getStorage("userWarnings")??{})[e])return t(!0)}return t(!1)},getGist=("undefined"!=typeof module&&null!=module.exports&&(dummyModule=module,dummyModule.exports={log:log,info:info,logError:logError,logOk:logOk,debug:debug,warn:warn,getDisplayId:getDisplayId,isObject:isObject,isPdfUrl:isPdfUrl,delay:delay,cleanPapers:cleanPapers,firstNonStopLowercase:firstNonStopLowercase,fallbackCopyTextToClipboard:fallbackCopyTextToClipboard,copyTextToClipboard:copyTextToClipboard,parseUrl:parseUrl,downloadTextFile:downloadTextFile,eventId:eventId,downloadFile:downloadFile,hashCode:hashCode,parseCVFUrl:parseCVFUrl,cleanBiorxivURL:cleanBiorxivURL,textareaFocusEnd:textareaFocusEnd,tablerSvg:tablerSvg,stringifyError:stringifyError,arraysIdentical:arraysIdentical,parseTags:parseTags,getPaperEdits:getPaperEdits,setFormChangeListener:setFormChangeListener,monitorPaperEdits:monitorPaperEdits,cutAuthors:cutAuthors,sendMessageToBackground:sendMessageToBackground,getStoredFiles:getStoredFiles,miniHash:miniHash,noParamUrl:noParamUrl,silentPromiseTimeout:silentPromiseTimeout,shouldWarn:shouldWarn}),!function i(a,n,o){function s(t,e){if(!n[t]){if(!a[t]){var r="function"==typeof require&&require;if(!e&&r)return r(t,!0);if(l)return l(t,!0);throw(e=new Error("Cannot find module '"+t+"'")).code="MODULE_NOT_FOUND",e}r=n[t]={exports:{}},a[t][0].call(r.exports,function(e){return s(a[t][1][e]||e)},r,r.exports,i,a,n,o)}return n[t].exports}for(var l="function"==typeof require&&require,e=0;e<o.length;e++)s(o[e]);return s}({1:[function(r,e,t){!function(t){!function(){var e=r("simple-github-gist-api");"undefined"==typeof window?window=t:t=window,t.GithubGist=e}.call(this)}.call(this,void 0!==global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"simple-github-gist-api":39}],2:[function(e,t,r){t.exports=e("./lib/axios")},{"./lib/axios":4}],3:[function(e,t,r){"use strict";var d=e("./../utils"),f=e("./../core/settle"),h=e("./../helpers/cookies"),g=e("./../helpers/buildURL"),m=e("../core/buildFullPath"),y=e("./../helpers/parseHeaders"),b=e("./../helpers/isURLSameOrigin"),v=e("../defaults/transitional"),w=e("../core/AxiosError"),P=e("../cancel/CanceledError"),x=e("../helpers/parseProtocol");t.exports=function(u){return new Promise(function(t,r){var e,i=u.data,a=u.headers,n=u.responseType;function o(){u.cancelToken&&u.cancelToken.unsubscribe(e),u.signal&&u.signal.removeEventListener("abort",e)}d.isFormData(i)&&d.isStandardBrowserEnv()&&delete a["Content-Type"];var s=new XMLHttpRequest,l=(u.auth&&(l=u.auth.username||"",p=u.auth.password?unescape(encodeURIComponent(u.auth.password)):"",a.Authorization="Basic "+btoa(l+":"+p)),m(u.baseURL,u.url));function c(){var e;s&&(e="getAllResponseHeaders"in s?y(s.getAllResponseHeaders()):null,e={data:n&&"text"!==n&&"json"!==n?s.response:s.responseText,status:s.status,statusText:s.statusText,headers:e,config:u,request:s},f(function(e){t(e),o()},function(e){r(e),o()},e),s=null)}s.open(u.method.toUpperCase(),g(l,u.params,u.paramsSerializer),!0),s.timeout=u.timeout,"onloadend"in s?s.onloadend=c:s.onreadystatechange=function(){s&&4===s.readyState&&(0!==s.status||s.responseURL&&0===s.responseURL.indexOf("file:"))&&setTimeout(c)},s.onabort=function(){s&&(r(new w("Request aborted",w.ECONNABORTED,u,s)),s=null)},s.onerror=function(){r(new w("Network Error",w.ERR_NETWORK,u,s,s)),s=null},s.ontimeout=function(){var e=u.timeout?"timeout of "+u.timeout+"ms exceeded":"timeout exceeded",t=u.transitional||v;u.timeoutErrorMessage&&(e=u.timeoutErrorMessage),r(new w(e,t.clarifyTimeoutError?w.ETIMEDOUT:w.ECONNABORTED,u,s)),s=null},d.isStandardBrowserEnv()&&(p=(u.withCredentials||b(l))&&u.xsrfCookieName?h.read(u.xsrfCookieName):void 0)&&(a[u.xsrfHeaderName]=p),"setRequestHeader"in s&&d.forEach(a,function(e,t){void 0===i&&"content-type"===t.toLowerCase()?delete a[t]:s.setRequestHeader(t,e)}),d.isUndefined(u.withCredentials)||(s.withCredentials=!!u.withCredentials),n&&"json"!==n&&(s.responseType=u.responseType),"function"==typeof u.onDownloadProgress&&s.addEventListener("progress",u.onDownloadProgress),"function"==typeof u.onUploadProgress&&s.upload&&s.upload.addEventListener("progress",u.onUploadProgress),(u.cancelToken||u.signal)&&(e=function(e){s&&(r(!e||e.type?new P:e),s.abort(),s=null)},u.cancelToken&&u.cancelToken.subscribe(e),u.signal&&(u.signal.aborted?e():u.signal.addEventListener("abort",e)));var i=i||null,p=x(l);p&&-1===["http","https","file"].indexOf(p)?r(new w("Unsupported protocol "+p+":",w.ERR_BAD_REQUEST,u)):s.send(i)})}},{"../cancel/CanceledError":6,"../core/AxiosError":9,"../core/buildFullPath":11,"../defaults/transitional":17,"../helpers/parseProtocol":29,"./../core/settle":14,"./../helpers/buildURL":20,"./../helpers/cookies":22,"./../helpers/isURLSameOrigin":25,"./../helpers/parseHeaders":28,"./../utils":33}],4:[function(e,t,r){"use strict";var a=e("./utils"),n=e("./helpers/bind"),o=e("./core/Axios"),s=e("./core/mergeConfig");var i=function t(r){var e=new o(r),i=n(o.prototype.request,e);return a.extend(i,o.prototype,e),a.extend(i,e),i.create=function(e){return t(s(r,e))},i}(e("./defaults"));i.Axios=o,i.CanceledError=e("./cancel/CanceledError"),i.CancelToken=e("./cancel/CancelToken"),i.isCancel=e("./cancel/isCancel"),i.VERSION=e("./env/data").version,i.toFormData=e("./helpers/toFormData"),i.AxiosError=e("../lib/core/AxiosError"),i.Cancel=i.CanceledError,i.all=function(e){return Promise.all(e)},i.spread=e("./helpers/spread"),i.isAxiosError=e("./helpers/isAxiosError"),t.exports=i,t.exports.default=i},{"../lib/core/AxiosError":9,"./cancel/CancelToken":5,"./cancel/CanceledError":6,"./cancel/isCancel":7,"./core/Axios":8,"./core/mergeConfig":13,"./defaults":16,"./env/data":18,"./helpers/bind":19,"./helpers/isAxiosError":24,"./helpers/spread":30,"./helpers/toFormData":31,"./utils":33}],5:[function(e,t,r){"use strict";var a=e("./CanceledError");function i(e){if("function"!=typeof e)throw new TypeError("executor must be a function.");this.promise=new Promise(function(e){t=e});var t,i=this;this.promise.then(function(e){if(i._listeners){for(var t=i._listeners.length,r=0;r<t;r++)i._listeners[r](e);i._listeners=null}}),this.promise.then=function(e){var t,e=new Promise(function(e){i.subscribe(e),t=e}).then(e);return e.cancel=function(){i.unsubscribe(t)},e},e(function(e){i.reason||(i.reason=new a(e),t(i.reason))})}i.prototype.throwIfRequested=function(){if(this.reason)throw this.reason},i.prototype.subscribe=function(e){this.reason?e(this.reason):this._listeners?this._listeners.push(e):this._listeners=[e]},i.prototype.unsubscribe=function(e){this._listeners&&-1!==(e=this._listeners.indexOf(e))&&this._listeners.splice(e,1)},i.source=function(){var t;return{token:new i(function(e){t=e}),cancel:t}},t.exports=i},{"./CanceledError":6}],6:[function(e,t,r){"use strict";var i=e("../core/AxiosError");function a(e){i.call(this,null==e?"canceled":e,i.ERR_CANCELED),this.name="CanceledError"}e("../utils").inherits(a,i,{__CANCEL__:!0}),t.exports=a},{"../core/AxiosError":9,"../utils":33}],7:[function(e,t,r){"use strict";t.exports=function(e){return!(!e||!e.__CANCEL__)}},{}],8:[function(e,t,r){"use strict";var i=e("./../utils"),a=e("../helpers/buildURL"),n=e("./InterceptorManager"),p=e("./dispatchRequest"),u=e("./mergeConfig"),o=e("./buildFullPath"),d=e("../helpers/validator"),f=d.validators;function s(e){this.defaults=e,this.interceptors={request:new n,response:new n}}s.prototype.request=function(e,t){"string"==typeof e?(t=t||{}).url=e:t=e||{},(t=u(this.defaults,t)).method?t.method=t.method.toLowerCase():this.defaults.method?t.method=this.defaults.method.toLowerCase():t.method="get";var r,e=t.transitional,i=(void 0!==e&&d.assertOptions(e,{silentJSONParsing:f.transitional(f.boolean),forcedJSONParsing:f.transitional(f.boolean),clarifyTimeoutError:f.transitional(f.boolean)},!1),[]),a=!0,n=(this.interceptors.request.forEach(function(e){"function"==typeof e.runWhen&&!1===e.runWhen(t)||(a=a&&e.synchronous,i.unshift(e.fulfilled,e.rejected))}),[]);if(this.interceptors.response.forEach(function(e){n.push(e.fulfilled,e.rejected)}),!a){var o=[p,void 0];for(Array.prototype.unshift.apply(o,i),o=o.concat(n),r=Promise.resolve(t);o.length;)r=r.then(o.shift(),o.shift());return r}for(var s=t;i.length;){var l=i.shift(),c=i.shift();try{s=l(s)}catch(e){c(e);break}}try{r=p(s)}catch(e){return Promise.reject(e)}for(;n.length;)r=r.then(n.shift(),n.shift());return r},s.prototype.getUri=function(e){e=u(this.defaults,e);var t=o(e.baseURL,e.url);return a(t,e.params,e.paramsSerializer)},i.forEach(["delete","get","head","options"],function(r){s.prototype[r]=function(e,t){return this.request(u(t||{},{method:r,url:e,data:(t||{}).data}))}}),i.forEach(["post","put","patch"],function(a){function e(i){return function(e,t,r){return this.request(u(r||{},{method:a,headers:i?{"Content-Type":"multipart/form-data"}:{},url:e,data:t}))}}s.prototype[a]=e(),s.prototype[a+"Form"]=e(!0)}),t.exports=s},{"../helpers/buildURL":20,"../helpers/validator":32,"./../utils":33,"./InterceptorManager":10,"./buildFullPath":11,"./dispatchRequest":12,"./mergeConfig":13}],9:[function(e,t,r){"use strict";var s=e("../utils");function l(e,t,r,i,a){Error.call(this),this.message=e,this.name="AxiosError",t&&(this.code=t),r&&(this.config=r),i&&(this.request=i),a&&(this.response=a)}s.inherits(l,Error,{toJSON:function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:this.config,code:this.code,status:this.response&&this.response.status?this.response.status:null}}});var c=l.prototype,i={};["ERR_BAD_OPTION_VALUE","ERR_BAD_OPTION","ECONNABORTED","ETIMEDOUT","ERR_NETWORK","ERR_FR_TOO_MANY_REDIRECTS","ERR_DEPRECATED","ERR_BAD_RESPONSE","ERR_BAD_REQUEST","ERR_CANCELED"].forEach(function(e){i[e]={value:e}}),Object.defineProperties(l,i),Object.defineProperty(c,"isAxiosError",{value:!0}),l.from=function(e,t,r,i,a,n){var o=Object.create(c);return s.toFlatObject(e,o,function(e){return e!==Error.prototype}),l.call(o,e.message,t,r,i,a),o.name=e.name,n&&Object.assign(o,n),o},t.exports=l},{"../utils":33}],10:[function(e,t,r){"use strict";var i=e("./../utils");function a(){this.handlers=[]}a.prototype.use=function(e,t,r){return this.handlers.push({fulfilled:e,rejected:t,synchronous:!!r&&r.synchronous,runWhen:r?r.runWhen:null}),this.handlers.length-1},a.prototype.eject=function(e){this.handlers[e]&&(this.handlers[e]=null)},a.prototype.forEach=function(t){i.forEach(this.handlers,function(e){null!==e&&t(e)})},t.exports=a},{"./../utils":33}],11:[function(e,t,r){"use strict";var i=e("../helpers/isAbsoluteURL"),a=e("../helpers/combineURLs");t.exports=function(e,t){return e&&!i(t)?a(e,t):t}},{"../helpers/combineURLs":21,"../helpers/isAbsoluteURL":23}],12:[function(e,t,r){"use strict";var i=e("./../utils"),a=e("./transformData"),n=e("../cancel/isCancel"),o=e("../defaults"),s=e("../cancel/CanceledError");function l(e){if(e.cancelToken&&e.cancelToken.throwIfRequested(),e.signal&&e.signal.aborted)throw new s}t.exports=function(t){return l(t),t.headers=t.headers||{},t.data=a.call(t,t.data,t.headers,t.transformRequest),t.headers=i.merge(t.headers.common||{},t.headers[t.method]||{},t.headers),i.forEach(["delete","get","head","post","put","patch","common"],function(e){delete t.headers[e]}),(t.adapter||o.adapter)(t).then(function(e){return l(t),e.data=a.call(t,e.data,e.headers,t.transformResponse),e},function(e){return n(e)||(l(t),e&&e.response&&(e.response.data=a.call(t,e.response.data,e.response.headers,t.transformResponse))),Promise.reject(e)})}},{"../cancel/CanceledError":6,"../cancel/isCancel":7,"../defaults":16,"./../utils":33,"./transformData":15}],13:[function(e,t,r){"use strict";var c=e("../utils");t.exports=function(t,r){r=r||{};var i={};function a(e,t){return c.isPlainObject(e)&&c.isPlainObject(t)?c.merge(e,t):c.isPlainObject(t)?c.merge({},t):c.isArray(t)?t.slice():t}function n(e){return c.isUndefined(r[e])?c.isUndefined(t[e])?void 0:a(void 0,t[e]):a(t[e],r[e])}function e(e){if(!c.isUndefined(r[e]))return a(void 0,r[e])}function o(e){return c.isUndefined(r[e])?c.isUndefined(t[e])?void 0:a(void 0,t[e]):a(void 0,r[e])}function s(e){return e in r?a(t[e],r[e]):e in t?a(void 0,t[e]):void 0}var l={url:e,method:e,data:e,baseURL:o,transformRequest:o,transformResponse:o,paramsSerializer:o,timeout:o,timeoutMessage:o,withCredentials:o,adapter:o,responseType:o,xsrfCookieName:o,xsrfHeaderName:o,onUploadProgress:o,onDownloadProgress:o,decompress:o,maxContentLength:o,maxBodyLength:o,beforeRedirect:o,transport:o,httpAgent:o,httpsAgent:o,cancelToken:o,socketPath:o,responseEncoding:o,validateStatus:s};return c.forEach(Object.keys(t).concat(Object.keys(r)),function(e){var t=l[e]||n,r=t(e);c.isUndefined(r)&&t!==s||(i[e]=r)}),i}},{"../utils":33}],14:[function(e,t,r){"use strict";var a=e("./AxiosError");t.exports=function(e,t,r){var i=r.config.validateStatus;r.status&&i&&!i(r.status)?t(new a("Request failed with status code "+r.status,[a.ERR_BAD_REQUEST,a.ERR_BAD_RESPONSE][Math.floor(r.status/100)-4],r.config,r.request,r)):e(r)}},{"./AxiosError":9}],15:[function(e,t,r){"use strict";var a=e("./../utils"),n=e("../defaults");t.exports=function(t,r,e){var i=this||n;return a.forEach(e,function(e){t=e.call(i,t,r)}),t}},{"../defaults":16,"./../utils":33}],16:[function(p,u,e){!function(n){!function(){"use strict";var o=p("../utils"),s=p("../helpers/normalizeHeaderName"),i=p("../core/AxiosError"),e=p("./transitional"),l=p("../helpers/toFormData"),t={"Content-Type":"application/x-www-form-urlencoded"};function c(e,t){!o.isUndefined(e)&&o.isUndefined(e["Content-Type"])&&(e["Content-Type"]=t)}var r,a={transitional:e,adapter:("undefined"!=typeof XMLHttpRequest?r=p("../adapters/xhr"):void 0!==n&&"[object process]"===Object.prototype.toString.call(n)&&(r=p("../adapters/http")),r),transformRequest:[function(e,t){if(s(t,"Accept"),s(t,"Content-Type"),o.isFormData(e)||o.isArrayBuffer(e)||o.isBuffer(e)||o.isStream(e)||o.isFile(e)||o.isBlob(e))return e;if(o.isArrayBufferView(e))return e.buffer;if(o.isURLSearchParams(e))return c(t,"application/x-www-form-urlencoded;charset=utf-8"),e.toString();var r=o.isObject(e),i=t&&t["Content-Type"];{if((a=o.isFileList(e))||r&&"multipart/form-data"===i)return n=this.env&&this.env.FormData,l(a?{"files[]":e}:e,n&&new n);if(r||"application/json"===i){c(t,"application/json");var a=e,n=void 0;if(r=void 0,o.isString(a))try{return(n||JSON.parse)(a),o.trim(a)}catch(e){if("SyntaxError"!==e.name)throw e}return(r||JSON.stringify)(a)}return e}}],transformResponse:[function(e){var t=this.transitional||a.transitional,r=t&&t.silentJSONParsing,t=t&&t.forcedJSONParsing,r=!r&&"json"===this.responseType;if(r||t&&o.isString(e)&&e.length)try{return JSON.parse(e)}catch(e){if(r){if("SyntaxError"===e.name)throw i.from(e,i.ERR_BAD_RESPONSE,this,null,this.response);throw e}}return e}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:p("./env/FormData")},validateStatus:function(e){return 200<=e&&e<300},headers:{common:{Accept:"application/json, text/plain, */*"}}};o.forEach(["delete","get","head"],function(e){a.headers[e]={}}),o.forEach(["post","put","patch"],function(e){a.headers[e]=o.merge(t)}),u.exports=a}.call(this)}.call(this,p("_process"))},{"../adapters/http":3,"../adapters/xhr":3,"../core/AxiosError":9,"../helpers/normalizeHeaderName":26,"../helpers/toFormData":31,"../utils":33,"./env/FormData":27,"./transitional":17,_process:37}],17:[function(e,t,r){"use strict";t.exports={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1}},{}],18:[function(e,t,r){t.exports={version:"0.27.2"}},{}],19:[function(e,t,r){"use strict";t.exports=function(r,i){return function(){for(var e=new Array(arguments.length),t=0;t<e.length;t++)e[t]=arguments[t];return r.apply(i,e)}}},{}],20:[function(e,t,r){"use strict";var a=e("./../utils");function n(e){return encodeURIComponent(e).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}t.exports=function(e,t,r){if(!t)return e;var i,r=r?r(t):a.isURLSearchParams(t)?t.toString():(i=[],a.forEach(t,function(e,t){null!=e&&(a.isArray(e)?t+="[]":e=[e],a.forEach(e,function(e){a.isDate(e)?e=e.toISOString():a.isObject(e)&&(e=JSON.stringify(e)),i.push(n(t)+"="+n(e))}))}),i.join("&"));return r&&(-1!==(t=e.indexOf("#"))&&(e=e.slice(0,t)),e+=(-1===e.indexOf("?")?"?":"&")+r),e}},{"./../utils":33}],21:[function(e,t,r){"use strict";t.exports=function(e,t){return t?e.replace(/\/+$/,"")+"/"+t.replace(/^\/+/,""):e}},{}],22:[function(e,t,r){"use strict";var s=e("./../utils");t.exports=s.isStandardBrowserEnv()?{write:function(e,t,r,i,a,n){var o=[];o.push(e+"="+encodeURIComponent(t)),s.isNumber(r)&&o.push("expires="+new Date(r).toGMTString()),s.isString(i)&&o.push("path="+i),s.isString(a)&&o.push("domain="+a),!0===n&&o.push("secure"),document.cookie=o.join("; ")},read:function(e){e=document.cookie.match(new RegExp("(^|;\\s*)("+e+")=([^;]*)"));return e?decodeURIComponent(e[3]):null},remove:function(e){this.write(e,"",Date.now()-864e5)}}:{write:function(){},read:function(){return null},remove:function(){}}},{"./../utils":33}],23:[function(e,t,r){"use strict";t.exports=function(e){return/^([a-z][a-z\d+\-.]*:)?\/\//i.test(e)}},{}],24:[function(e,t,r){"use strict";var i=e("./../utils");t.exports=function(e){return i.isObject(e)&&!0===e.isAxiosError}},{"./../utils":33}],25:[function(e,t,r){"use strict";var i,a,n,o=e("./../utils");function s(e){return a&&(n.setAttribute("href",e),e=n.href),n.setAttribute("href",e),{href:n.href,protocol:n.protocol?n.protocol.replace(/:$/,""):"",host:n.host,search:n.search?n.search.replace(/^\?/,""):"",hash:n.hash?n.hash.replace(/^#/,""):"",hostname:n.hostname,port:n.port,pathname:"/"===n.pathname.charAt(0)?n.pathname:"/"+n.pathname}}t.exports=o.isStandardBrowserEnv()?(a=/(msie|trident)/i.test(navigator.userAgent),n=document.createElement("a"),i=s(window.location.href),function(e){e=o.isString(e)?s(e):e;return e.protocol===i.protocol&&e.host===i.host}):function(){return!0}},{"./../utils":33}],26:[function(e,t,r){"use strict";var a=e("../utils");t.exports=function(r,i){a.forEach(r,function(e,t){t!==i&&t.toUpperCase()===i.toUpperCase()&&(r[i]=e,delete r[t])})}},{"../utils":33}],27:[function(e,t,r){t.exports=null},{}],28:[function(e,t,r){"use strict";var a=e("./../utils"),n=["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"];t.exports=function(e){var t,r,i={};return e&&a.forEach(e.split("\n"),function(e){r=e.indexOf(":"),t=a.trim(e.substr(0,r)).toLowerCase(),r=a.trim(e.substr(r+1)),!t||i[t]&&0<=n.indexOf(t)||(i[t]="set-cookie"===t?(i[t]||[]).concat([r]):i[t]?i[t]+", "+r:r)}),i}},{"./../utils":33}],29:[function(e,t,r){"use strict";t.exports=function(e){e=/^([-+\w]{1,25})(:?\/\/|:)/.exec(e);return e&&e[1]||""}},{}],30:[function(e,t,r){"use strict";t.exports=function(t){return function(e){return t.apply(null,e)}}},{}],31:[function(e,t,r){!function(r){!function(){"use strict";var s=e("../utils");t.exports=function(e,n){n=n||new FormData;var t=[];function o(e){return null===e?"":s.isDate(e)?e.toISOString():s.isArrayBuffer(e)||s.isTypedArray(e)?"function"==typeof Blob?new Blob([e]):r.from(e):e}return function i(e,a){if(s.isPlainObject(e)||s.isArray(e)){if(-1!==t.indexOf(e))throw Error("Circular reference detected in "+a);t.push(e),s.forEach(e,function(e,t){if(!s.isUndefined(e)){var r=a?a+"."+t:t;if(e&&!a&&"object"==typeof e)if(s.endsWith(t,"{}"))e=JSON.stringify(e);else if(s.endsWith(t,"[]")&&(t=s.toArray(e)))return void t.forEach(function(e){s.isUndefined(e)||n.append(r,o(e))});i(e,r)}}),t.pop()}else n.append(a,o(e))}(e),n}}.call(this)}.call(this,e("buffer").Buffer)},{"../utils":33,buffer:35}],32:[function(e,t,r){"use strict";var o=e("../env/data").version,l=e("../core/AxiosError"),i={},s=(["object","boolean","number","function","string","symbol"].forEach(function(t,r){i[t]=function(e){return typeof e===t||"a"+(r<1?"n ":" ")+t}}),{});i.transitional=function(i,a,r){function n(e,t){return"[Axios v"+o+"] Transitional option '"+e+"'"+t+(r?". "+r:"")}return function(e,t,r){if(!1===i)throw new l(n(t," has been removed"+(a?" in "+a:"")),l.ERR_DEPRECATED);return a&&!s[t]&&(s[t]=!0,console.warn(n(t," has been deprecated since v"+a+" and will be removed in the near future"))),!i||i(e,t,r)}},t.exports={assertOptions:function(e,t,r){if("object"!=typeof e)throw new l("options must be an object",l.ERR_BAD_OPTION_VALUE);for(var i=Object.keys(e),a=i.length;0<a--;){var n=i[a],o=t[n];if(o){var s=e[n],o=void 0===s||o(s,n,e);if(!0!==o)throw new l("option "+n+" must be "+o,l.ERR_BAD_OPTION_VALUE)}else if(!0!==r)throw new l("Unknown option "+n,l.ERR_BAD_OPTION)}},validators:i}},{"../core/AxiosError":9,"../env/data":18}],33:[function(e,t,r){"use strict";function i(e){return e=o.call(e),a[e]||(a[e]=e.slice(8,-1).toLowerCase())}var a,n=e("./helpers/bind"),o=Object.prototype.toString;a=Object.create(null);function s(t){return t=t.toLowerCase(),function(e){return i(e)===t}}function l(e){return Array.isArray(e)}function c(e){return void 0===e}var p=s("ArrayBuffer");function u(e){return null!==e&&"object"==typeof e}function d(e){if("object"!==i(e))return!1;e=Object.getPrototypeOf(e);return null===e||e===Object.prototype}var e=s("Date"),f=s("File"),h=s("Blob"),g=s("FileList");function m(e){return"[object Function]"===o.call(e)}var y=s("URLSearchParams");function b(e,t){if(null!=e)if(l(e="object"!=typeof e?[e]:e))for(var r=0,i=e.length;r<i;r++)t.call(null,e[r],r,e);else for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&t.call(null,e[a],a,e)}var v;v="undefined"!=typeof Uint8Array&&Object.getPrototypeOf(Uint8Array);t.exports={isArray:l,isArrayBuffer:p,isBuffer:function(e){return null!==e&&!c(e)&&null!==e.constructor&&!c(e.constructor)&&"function"==typeof e.constructor.isBuffer&&e.constructor.isBuffer(e)},isFormData:function(e){var t="[object FormData]";return e&&("function"==typeof FormData&&e instanceof FormData||o.call(e)===t||m(e.toString)&&e.toString()===t)},isArrayBufferView:function(e){return"undefined"!=typeof ArrayBuffer&&ArrayBuffer.isView?ArrayBuffer.isView(e):e&&e.buffer&&p(e.buffer)},isString:function(e){return"string"==typeof e},isNumber:function(e){return"number"==typeof e},isObject:u,isPlainObject:d,isUndefined:c,isDate:e,isFile:f,isBlob:h,isFunction:m,isStream:function(e){return u(e)&&m(e.pipe)},isURLSearchParams:y,isStandardBrowserEnv:function(){return("undefined"==typeof navigator||"ReactNative"!==navigator.product&&"NativeScript"!==navigator.product&&"NS"!==navigator.product)&&"undefined"!=typeof window&&"undefined"!=typeof document},forEach:b,merge:function r(){var i={};function e(e,t){d(i[t])&&d(e)?i[t]=r(i[t],e):d(e)?i[t]=r({},e):l(e)?i[t]=e.slice():i[t]=e}for(var t=0,a=arguments.length;t<a;t++)b(arguments[t],e);return i},extend:function(r,e,i){return b(e,function(e,t){r[t]=i&&"function"==typeof e?n(e,i):e}),r},trim:function(e){return e.trim?e.trim():e.replace(/^\s+|\s+$/g,"")},stripBOM:function(e){return e=65279===e.charCodeAt(0)?e.slice(1):e},inherits:function(e,t,r,i){e.prototype=Object.create(t.prototype,i),e.prototype.constructor=e,r&&Object.assign(e.prototype,r)},toFlatObject:function(e,t,r){var i,a,n,o={};t=t||{};do{for(a=(i=Object.getOwnPropertyNames(e)).length;0<a--;)o[n=i[a]]||(t[n]=e[n],o[n]=!0)}while((e=Object.getPrototypeOf(e))&&(!r||r(e,t))&&e!==Object.prototype);return t},kindOf:i,kindOfTest:s,endsWith:function(e,t,r){return e=String(e),(void 0===r||r>e.length)&&(r=e.length),r-=t.length,-1!==(e=e.indexOf(t,r))&&e===r},toArray:function(e){if(!e)return null;var t=e.length;if(c(t))return null;for(var r=new Array(t);0<t--;)r[t]=e[t];return r},isTypedArray:function(e){return v&&e instanceof v},isFileList:g}},{"./helpers/bind":19}],34:[function(e,t,r){"use strict";r.byteLength=function(e){var e=p(e),t=e[0],e=e[1];return 3*(t+e)/4-e},r.toByteArray=function(e){var t,r,i=p(e),a=i[0],i=i[1],n=new c(function(e,t){return 3*(e+t)/4-t}(a,i)),o=0,s=0<i?a-4:a;for(r=0;r<s;r+=4)t=l[e.charCodeAt(r)]<<18|l[e.charCodeAt(r+1)]<<12|l[e.charCodeAt(r+2)]<<6|l[e.charCodeAt(r+3)],n[o++]=t>>16&255,n[o++]=t>>8&255,n[o++]=255&t;return 2===i&&(t=l[e.charCodeAt(r)]<<2|l[e.charCodeAt(r+1)]>>4,n[o++]=255&t),1===i&&(t=l[e.charCodeAt(r)]<<10|l[e.charCodeAt(r+1)]<<4|l[e.charCodeAt(r+2)]>>2,n[o++]=t>>8&255,n[o++]=255&t),n},r.fromByteArray=function(e){for(var t,r=e.length,i=r%3,a=[],n=0,o=r-i;n<o;n+=16383)a.push(function(e,t,r){for(var i,a=[],n=t;n<r;n+=3)i=(e[n]<<16&16711680)+(e[n+1]<<8&65280)+(255&e[n+2]),a.push(function(e){return s[e>>18&63]+s[e>>12&63]+s[e>>6&63]+s[63&e]}(i));return a.join("")}(e,n,o<n+16383?o:n+16383));return 1==i?(t=e[r-1],a.push(s[t>>2]+s[t<<4&63]+"==")):2==i&&(t=(e[r-2]<<8)+e[r-1],a.push(s[t>>10]+s[t>>4&63]+s[t<<2&63]+"=")),a.join("")};for(var s=[],l=[],c="undefined"!=typeof Uint8Array?Uint8Array:Array,i="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",a=0,n=i.length;a<n;++a)s[a]=i[a],l[i.charCodeAt(a)]=a;function p(e){var t=e.length;if(0<t%4)throw new Error("Invalid string. Length must be a multiple of 4");e=e.indexOf("=");return[e=-1===e?t:e,e===t?0:4-e%4]}l["-".charCodeAt(0)]=62,l["_".charCodeAt(0)]=63},{}],35:[function(O,e,L){!function(e){!function(){"use strict";var T=O("base64-js"),n=O("ieee754");L.Buffer=u,L.SlowBuffer=function(e){return u.alloc(+(e=+e!=e?0:e))},L.INSPECT_MAX_BYTES=50;function l(e){if(2147483647<e)throw new RangeError('The value "'+e+'" is invalid for option "size"');e=new Uint8Array(e);return e.__proto__=u.prototype,e}function u(e,t,r){if("number"!=typeof e)return i(e,t,r);if("string"==typeof t)throw new TypeError('The "string" argument must be of type string. Received type number');return o(e)}function i(e,t,r){if("string"==typeof e){var i=e,a=t;if(!u.isEncoding(a="string"==typeof a&&""!==a?a:"utf8"))throw new TypeError("Unknown encoding: "+a);var n=0|d(i,a),o=l(n);return o=(i=o.write(i,a))!==n?o.slice(0,i):o}if(ArrayBuffer.isView(e))return c(e);if(null==e)throw TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof e);if(S(e,ArrayBuffer)||e&&S(e.buffer,ArrayBuffer)){a=e,n=t,i=r;if(n<0||a.byteLength<n)throw new RangeError('"offset" is outside of buffer bounds');if(a.byteLength<n+(i||0))throw new RangeError('"length" is outside of buffer bounds');return(a=void 0===n&&void 0===i?new Uint8Array(a):void 0===i?new Uint8Array(a,n):new Uint8Array(a,n,i)).__proto__=u.prototype,a}if("number"==typeof e)throw new TypeError('The "value" argument must not be of type number. Received type number');o=e.valueOf&&e.valueOf();if(null!=o&&o!==e)return u.from(o,t,r);var s=function(e){{var t,r;if(u.isBuffer(e))return t=0|p(e.length),0!==(r=l(t)).length&&e.copy(r,0,0,t),r}return void 0!==e.length?"number"!=typeof e.length||C(e.length)?l(0):c(e):"Buffer"===e.type&&Array.isArray(e.data)?c(e.data):void 0}(e);if(s)return s;if("undefined"!=typeof Symbol&&null!=Symbol.toPrimitive&&"function"==typeof e[Symbol.toPrimitive])return u.from(e[Symbol.toPrimitive]("string"),t,r);throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof e)}function a(e){if("number"!=typeof e)throw new TypeError('"size" argument must be of type number');if(e<0)throw new RangeError('The value "'+e+'" is invalid for option "size"')}function o(e){return a(e),l(e<0?0:0|p(e))}function c(e){for(var t=e.length<0?0:0|p(e.length),r=l(t),i=0;i<t;i+=1)r[i]=255&e[i];return r}function p(e){if(2147483647<=e)throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+2147483647..toString(16)+" bytes");return 0|e}function d(e,t){if(u.isBuffer(e))return e.length;if(ArrayBuffer.isView(e)||S(e,ArrayBuffer))return e.byteLength;if("string"!=typeof e)throw new TypeError('The "string" argument must be one of type string, Buffer, or ArrayBuffer. Received type '+typeof e);var r=e.length,i=2<arguments.length&&!0===arguments[2];if(!i&&0===r)return 0;for(var a=!1;;)switch(t){case"ascii":case"latin1":case"binary":return r;case"utf8":case"utf-8":return x(e).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*r;case"hex":return r>>>1;case"base64":return k(e).length;default:if(a)return i?-1:x(e).length;t=(""+t).toLowerCase(),a=!0}}function t(e,t,r){var i,a=!1;if((t=void 0===t||t<0?0:t)>this.length)return"";if((r=void 0===r||r>this.length?this.length:r)<=0)return"";if((r>>>=0)<=(t>>>=0))return"";for(e=e||"utf8";;)switch(e){case"hex":var n=this,o=t,s=r,l=n.length;(!s||s<0||l<s)&&(s=l);for(var c="",p=o=!o||o<0?0:o;p<s;++p)c+=function(e){return e<16?"0"+e.toString(16):e.toString(16)}(n[p]);return c;case"utf8":case"utf-8":return A(this,t,r);case"ascii":var u=this,l=t,d=r,f="";d=Math.min(u.length,d);for(var h=l;h<d;++h)f+=String.fromCharCode(127&u[h]);return f;case"latin1":case"binary":var g=this,o=t,m=r,y="";m=Math.min(g.length,m);for(var b=o;b<m;++b)y+=String.fromCharCode(g[b]);return y;case"base64":return v=this,i=r,0===(w=t)&&i===v.length?T.fromByteArray(v):T.fromByteArray(v.slice(w,i));case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":for(var v=t,w=r,P=this.slice(v,w),x="",k=0;k<P.length;k+=2)x+=String.fromCharCode(P[k]+256*P[k+1]);return x;default:if(a)throw new TypeError("Unknown encoding: "+e);e=(e+"").toLowerCase(),a=!0}}function r(e,t,r){var i=e[t];e[t]=e[r],e[r]=i}function s(e,t,r,i,a){if(0===e.length)return-1;if("string"==typeof r?(i=r,r=0):2147483647<r?r=2147483647:r<-2147483648&&(r=-2147483648),(r=(r=C(r=+r)?a?0:e.length-1:r)<0?e.length+r:r)>=e.length){if(a)return-1;r=e.length-1}else if(r<0){if(!a)return-1;r=0}if("string"==typeof t&&(t=u.from(t,i)),u.isBuffer(t))return 0===t.length?-1:f(e,t,r,i,a);if("number"==typeof t)return t&=255,"function"==typeof Uint8Array.prototype.indexOf?(a?Uint8Array.prototype.indexOf:Uint8Array.prototype.lastIndexOf).call(e,t,r):f(e,[t],r,i,a);throw new TypeError("val must be string, number or Buffer")}function f(e,t,r,i,a){var n=1,o=e.length,s=t.length;if(void 0!==i&&("ucs2"===(i=String(i).toLowerCase())||"ucs-2"===i||"utf16le"===i||"utf-16le"===i)){if(e.length<2||t.length<2)return-1;o/=n=2,s/=2,r/=2}function l(e,t){return 1===n?e[t]:e.readUInt16BE(t*n)}if(a)for(var c=-1,p=r;p<o;p++)if(l(e,p)===l(t,-1===c?0:p-c)){if(p-(c=-1===c?p:c)+1===s)return c*n}else-1!==c&&(p-=p-c),c=-1;else for(p=r=o<r+s?o-s:r;0<=p;p--){for(var u=!0,d=0;d<s;d++)if(l(e,p+d)!==l(t,d)){u=!1;break}if(u)return p}return-1}function m(e,t,r,i){return E(function(e){for(var t=[],r=0;r<e.length;++r)t.push(255&e.charCodeAt(r));return t}(t),e,r,i)}function y(e,t,r,i){return E(function(e,t){for(var r,i,a=[],n=0;n<e.length&&!((t-=2)<0);++n)r=(i=e.charCodeAt(n))>>8,i=i%256,a.push(i),a.push(r);return a}(t,e.length-r),e,r,i)}function A(e,t,r){r=Math.min(e.length,r);for(var i=[],a=t;a<r;){var n,o,s,l,c=e[a],p=null,u=239<c?4:223<c?3:191<c?2:1;if(a+u<=r)switch(u){case 1:c<128&&(p=c);break;case 2:128==(192&(n=e[a+1]))&&127<(l=(31&c)<<6|63&n)&&(p=l);break;case 3:n=e[a+1],o=e[a+2],128==(192&n)&&128==(192&o)&&2047<(l=(15&c)<<12|(63&n)<<6|63&o)&&(l<55296||57343<l)&&(p=l);break;case 4:n=e[a+1],o=e[a+2],s=e[a+3],128==(192&n)&&128==(192&o)&&128==(192&s)&&65535<(l=(15&c)<<18|(63&n)<<12|(63&o)<<6|63&s)&&l<1114112&&(p=l)}null===p?(p=65533,u=1):65535<p&&(p-=65536,i.push(p>>>10&1023|55296),p=56320|1023&p),i.push(p),a+=u}var d=i,f=d.length;if(f<=4096)return String.fromCharCode.apply(String,d);for(var h="",g=0;g<f;)h+=String.fromCharCode.apply(String,d.slice(g,g+=4096));return h}L.kMaxLength=2147483647,(u.TYPED_ARRAY_SUPPORT=function(){try{var e=new Uint8Array(1);return e.__proto__={__proto__:Uint8Array.prototype,foo:function(){return 42}},42===e.foo()}catch(e){return!1}}())||"undefined"==typeof console||"function"!=typeof console.error||console.error("This browser lacks typed array (Uint8Array) support which is required by `buffer` v5.x. Use `buffer` v4.x if you require old browser support."),Object.defineProperty(u.prototype,"parent",{enumerable:!0,get:function(){if(u.isBuffer(this))return this.buffer}}),Object.defineProperty(u.prototype,"offset",{enumerable:!0,get:function(){if(u.isBuffer(this))return this.byteOffset}}),"undefined"!=typeof Symbol&&null!=Symbol.species&&u[Symbol.species]===u&&Object.defineProperty(u,Symbol.species,{value:null,configurable:!0,enumerable:!1,writable:!1}),u.poolSize=8192,u.from=i,u.prototype.__proto__=Uint8Array.prototype,u.__proto__=Uint8Array,u.alloc=function(e,t,r){return t=t,r=r,a(e=e),!(e<=0)&&void 0!==t?"string"==typeof r?l(e).fill(t,r):l(e).fill(t):l(e)},u.allocUnsafe=o,u.allocUnsafeSlow=o,u.isBuffer=function(e){return null!=e&&!0===e._isBuffer&&e!==u.prototype},u.compare=function(e,t){if(S(e,Uint8Array)&&(e=u.from(e,e.offset,e.byteLength)),S(t,Uint8Array)&&(t=u.from(t,t.offset,t.byteLength)),!u.isBuffer(e)||!u.isBuffer(t))throw new TypeError('The "buf1", "buf2" arguments must be one of type Buffer or Uint8Array');if(e===t)return 0;for(var r=e.length,i=t.length,a=0,n=Math.min(r,i);a<n;++a)if(e[a]!==t[a]){r=e[a],i=t[a];break}return r<i?-1:i<r?1:0},u.isEncoding=function(e){switch(String(e).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},u.concat=function(e,t){if(!Array.isArray(e))throw new TypeError('"list" argument must be an Array of Buffers');if(0===e.length)return u.alloc(0);if(void 0===t)for(a=t=0;a<e.length;++a)t+=e[a].length;for(var r=u.allocUnsafe(t),i=0,a=0;a<e.length;++a){var n=e[a];if(S(n,Uint8Array)&&(n=u.from(n)),!u.isBuffer(n))throw new TypeError('"list" argument must be an Array of Buffers');n.copy(r,i),i+=n.length}return r},u.byteLength=d,u.prototype._isBuffer=!0,u.prototype.swap16=function(){var e=this.length;if(e%2!=0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(var t=0;t<e;t+=2)r(this,t,t+1);return this},u.prototype.swap32=function(){var e=this.length;if(e%4!=0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(var t=0;t<e;t+=4)r(this,t,t+3),r(this,t+1,t+2);return this},u.prototype.swap64=function(){var e=this.length;if(e%8!=0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(var t=0;t<e;t+=8)r(this,t,t+7),r(this,t+1,t+6),r(this,t+2,t+5),r(this,t+3,t+4);return this},u.prototype.toLocaleString=u.prototype.toString=function(){var e=this.length;return 0===e?"":0===arguments.length?A(this,0,e):t.apply(this,arguments)},u.prototype.equals=function(e){if(u.isBuffer(e))return this===e||0===u.compare(this,e);throw new TypeError("Argument must be a Buffer")},u.prototype.inspect=function(){var e="",t=L.INSPECT_MAX_BYTES,e=this.toString("hex",0,t).replace(/(.{2})/g,"$1 ").trim();return this.length>t&&(e+=" ... "),"<Buffer "+e+">"},u.prototype.compare=function(e,t,r,i,a){if(S(e,Uint8Array)&&(e=u.from(e,e.offset,e.byteLength)),!u.isBuffer(e))throw new TypeError('The "target" argument must be one of type Buffer or Uint8Array. Received type '+typeof e);if(void 0===r&&(r=e?e.length:0),void 0===i&&(i=0),void 0===a&&(a=this.length),(t=void 0===t?0:t)<0||r>e.length||i<0||a>this.length)throw new RangeError("out of range index");if(a<=i&&r<=t)return 0;if(a<=i)return-1;if(r<=t)return 1;if(this===e)return 0;for(var n=(a>>>=0)-(i>>>=0),o=(r>>>=0)-(t>>>=0),s=Math.min(n,o),l=this.slice(i,a),c=e.slice(t,r),p=0;p<s;++p)if(l[p]!==c[p]){n=l[p],o=c[p];break}return n<o?-1:o<n?1:0},u.prototype.includes=function(e,t,r){return-1!==this.indexOf(e,t,r)},u.prototype.indexOf=function(e,t,r){return s(this,e,t,r,!0)},u.prototype.lastIndexOf=function(e,t,r){return s(this,e,t,r,!1)},u.prototype.write=function(e,t,r,i){if(void 0===t)i="utf8",r=this.length,t=0;else if(void 0===r&&"string"==typeof t)i=t,r=this.length,t=0;else{if(!isFinite(t))throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");t>>>=0,isFinite(r)?(r>>>=0,void 0===i&&(i="utf8")):(i=r,r=void 0)}var a=this.length-t;if((void 0===r||a<r)&&(r=a),0<e.length&&(r<0||t<0)||t>this.length)throw new RangeError("Attempt to write outside buffer bounds");i=i||"utf8";for(var n,o,s,l=!1;;)switch(i){case"hex":var c=this,p=e,u=t,d=r,f=(u=Number(u)||0,c.length-u);(!d||(d=Number(d))>f)&&(d=f),(f=p.length)/2<d&&(d=f/2);for(var h=0;h<d;++h){var g=parseInt(p.substr(2*h,2),16);if(C(g))return h;c[u+h]=g}return h;case"utf8":case"utf-8":return f=t,s=r,E(x(e,(o=this).length-f),o,f,s);case"ascii":return m(this,e,t,r);case"latin1":case"binary":return m(this,e,t,r);case"base64":return o=this,s=t,n=r,E(k(e),o,s,n);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return y(this,e,t,r);default:if(l)throw new TypeError("Unknown encoding: "+i);i=(""+i).toLowerCase(),l=!0}},u.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};function h(e,t,r){if(e%1!=0||e<0)throw new RangeError("offset is not uint");if(r<e+t)throw new RangeError("Trying to access beyond buffer length")}function g(e,t,r,i,a,n){if(!u.isBuffer(e))throw new TypeError('"buffer" argument must be a Buffer instance');if(a<t||t<n)throw new RangeError('"value" argument is out of bounds');if(r+i>e.length)throw new RangeError("Index out of range")}function b(e,t,r,i){if(r+i>e.length)throw new RangeError("Index out of range");if(r<0)throw new RangeError("Index out of range")}function v(e,t,r,i,a){return t=+t,r>>>=0,a||b(e,0,r,4),n.write(e,t,r,i,23,4),r+4}function w(e,t,r,i,a){return t=+t,r>>>=0,a||b(e,0,r,8),n.write(e,t,r,i,52,8),r+8}u.prototype.slice=function(e,t){var r=this.length,r=((e=~~e)<0?(e+=r)<0&&(e=0):r<e&&(e=r),(t=void 0===t?r:~~t)<0?(t+=r)<0&&(t=0):r<t&&(t=r),t<e&&(t=e),this.subarray(e,t));return r.__proto__=u.prototype,r},u.prototype.readUIntLE=function(e,t,r){e>>>=0,t>>>=0,r||h(e,t,this.length);for(var i=this[e],a=1,n=0;++n<t&&(a*=256);)i+=this[e+n]*a;return i},u.prototype.readUIntBE=function(e,t,r){e>>>=0,t>>>=0,r||h(e,t,this.length);for(var i=this[e+--t],a=1;0<t&&(a*=256);)i+=this[e+--t]*a;return i},u.prototype.readUInt8=function(e,t){return e>>>=0,t||h(e,1,this.length),this[e]},u.prototype.readUInt16LE=function(e,t){return e>>>=0,t||h(e,2,this.length),this[e]|this[e+1]<<8},u.prototype.readUInt16BE=function(e,t){return e>>>=0,t||h(e,2,this.length),this[e]<<8|this[e+1]},u.prototype.readUInt32LE=function(e,t){return e>>>=0,t||h(e,4,this.length),(this[e]|this[e+1]<<8|this[e+2]<<16)+16777216*this[e+3]},u.prototype.readUInt32BE=function(e,t){return e>>>=0,t||h(e,4,this.length),16777216*this[e]+(this[e+1]<<16|this[e+2]<<8|this[e+3])},u.prototype.readIntLE=function(e,t,r){e>>>=0,t>>>=0,r||h(e,t,this.length);for(var i=this[e],a=1,n=0;++n<t&&(a*=256);)i+=this[e+n]*a;return i>=(a*=128)&&(i-=Math.pow(2,8*t)),i},u.prototype.readIntBE=function(e,t,r){e>>>=0,t>>>=0,r||h(e,t,this.length);for(var i=t,a=1,n=this[e+--i];0<i&&(a*=256);)n+=this[e+--i]*a;return n>=(a*=128)&&(n-=Math.pow(2,8*t)),n},u.prototype.readInt8=function(e,t){return e>>>=0,t||h(e,1,this.length),128&this[e]?-1*(255-this[e]+1):this[e]},u.prototype.readInt16LE=function(e,t){e>>>=0,t||h(e,2,this.length);t=this[e]|this[e+1]<<8;return 32768&t?4294901760|t:t},u.prototype.readInt16BE=function(e,t){e>>>=0,t||h(e,2,this.length);t=this[e+1]|this[e]<<8;return 32768&t?4294901760|t:t},u.prototype.readInt32LE=function(e,t){return e>>>=0,t||h(e,4,this.length),this[e]|this[e+1]<<8|this[e+2]<<16|this[e+3]<<24},u.prototype.readInt32BE=function(e,t){return e>>>=0,t||h(e,4,this.length),this[e]<<24|this[e+1]<<16|this[e+2]<<8|this[e+3]},u.prototype.readFloatLE=function(e,t){return e>>>=0,t||h(e,4,this.length),n.read(this,e,!0,23,4)},u.prototype.readFloatBE=function(e,t){return e>>>=0,t||h(e,4,this.length),n.read(this,e,!1,23,4)},u.prototype.readDoubleLE=function(e,t){return e>>>=0,t||h(e,8,this.length),n.read(this,e,!0,52,8)},u.prototype.readDoubleBE=function(e,t){return e>>>=0,t||h(e,8,this.length),n.read(this,e,!1,52,8)},u.prototype.writeUIntLE=function(e,t,r,i){e=+e,t>>>=0,r>>>=0,i||g(this,e,t,r,Math.pow(2,8*r)-1,0);var a=1,n=0;for(this[t]=255&e;++n<r&&(a*=256);)this[t+n]=e/a&255;return t+r},u.prototype.writeUIntBE=function(e,t,r,i){e=+e,t>>>=0,r>>>=0,i||g(this,e,t,r,Math.pow(2,8*r)-1,0);var a=r-1,n=1;for(this[t+a]=255&e;0<=--a&&(n*=256);)this[t+a]=e/n&255;return t+r},u.prototype.writeUInt8=function(e,t,r){return e=+e,t>>>=0,r||g(this,e,t,1,255,0),this[t]=255&e,t+1},u.prototype.writeUInt16LE=function(e,t,r){return e=+e,t>>>=0,r||g(this,e,t,2,65535,0),this[t]=255&e,this[t+1]=e>>>8,t+2},u.prototype.writeUInt16BE=function(e,t,r){return e=+e,t>>>=0,r||g(this,e,t,2,65535,0),this[t]=e>>>8,this[t+1]=255&e,t+2},u.prototype.writeUInt32LE=function(e,t,r){return e=+e,t>>>=0,r||g(this,e,t,4,4294967295,0),this[t+3]=e>>>24,this[t+2]=e>>>16,this[t+1]=e>>>8,this[t]=255&e,t+4},u.prototype.writeUInt32BE=function(e,t,r){return e=+e,t>>>=0,r||g(this,e,t,4,4294967295,0),this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e,t+4},u.prototype.writeIntLE=function(e,t,r,i){e=+e,t>>>=0,i||g(this,e,t,r,(i=Math.pow(2,8*r-1))-1,-i);var a=0,n=1,o=0;for(this[t]=255&e;++a<r&&(n*=256);)e<0&&0===o&&0!==this[t+a-1]&&(o=1),this[t+a]=(e/n>>0)-o&255;return t+r},u.prototype.writeIntBE=function(e,t,r,i){e=+e,t>>>=0,i||g(this,e,t,r,(i=Math.pow(2,8*r-1))-1,-i);var a=r-1,n=1,o=0;for(this[t+a]=255&e;0<=--a&&(n*=256);)e<0&&0===o&&0!==this[t+a+1]&&(o=1),this[t+a]=(e/n>>0)-o&255;return t+r},u.prototype.writeInt8=function(e,t,r){return e=+e,t>>>=0,r||g(this,e,t,1,127,-128),this[t]=255&(e=e<0?255+e+1:e),t+1},u.prototype.writeInt16LE=function(e,t,r){return e=+e,t>>>=0,r||g(this,e,t,2,32767,-32768),this[t]=255&e,this[t+1]=e>>>8,t+2},u.prototype.writeInt16BE=function(e,t,r){return e=+e,t>>>=0,r||g(this,e,t,2,32767,-32768),this[t]=e>>>8,this[t+1]=255&e,t+2},u.prototype.writeInt32LE=function(e,t,r){return e=+e,t>>>=0,r||g(this,e,t,4,2147483647,-2147483648),this[t]=255&e,this[t+1]=e>>>8,this[t+2]=e>>>16,this[t+3]=e>>>24,t+4},u.prototype.writeInt32BE=function(e,t,r){return e=+e,t>>>=0,r||g(this,e,t,4,2147483647,-2147483648),this[t]=(e=e<0?4294967295+e+1:e)>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e,t+4},u.prototype.writeFloatLE=function(e,t,r){return v(this,e,t,!0,r)},u.prototype.writeFloatBE=function(e,t,r){return v(this,e,t,!1,r)},u.prototype.writeDoubleLE=function(e,t,r){return w(this,e,t,!0,r)},u.prototype.writeDoubleBE=function(e,t,r){return w(this,e,t,!1,r)},u.prototype.copy=function(e,t,r,i){if(!u.isBuffer(e))throw new TypeError("argument should be a Buffer");if(r=r||0,i||0===i||(i=this.length),t>=e.length&&(t=e.length),(i=0<i&&i<r?r:i)===r)return 0;if(0===e.length||0===this.length)return 0;if((t=t||0)<0)throw new RangeError("targetStart out of bounds");if(r<0||r>=this.length)throw new RangeError("Index out of range");if(i<0)throw new RangeError("sourceEnd out of bounds");i>this.length&&(i=this.length);var a=(i=e.length-t<i-r?e.length-t+r:i)-r;if(this===e&&"function"==typeof Uint8Array.prototype.copyWithin)this.copyWithin(t,r,i);else if(this===e&&r<t&&t<i)for(var n=a-1;0<=n;--n)e[n+t]=this[n+r];else Uint8Array.prototype.set.call(e,this.subarray(r,i),t);return a},u.prototype.fill=function(e,t,r,i){if("string"==typeof e){if("string"==typeof t?(i=t,t=0,r=this.length):"string"==typeof r&&(i=r,r=this.length),void 0!==i&&"string"!=typeof i)throw new TypeError("encoding must be a string");if("string"==typeof i&&!u.isEncoding(i))throw new TypeError("Unknown encoding: "+i);var a;1===e.length&&(a=e.charCodeAt(0),("utf8"===i&&a<128||"latin1"===i)&&(e=a))}else"number"==typeof e&&(e&=255);if(t<0||this.length<t||this.length<r)throw new RangeError("Out of range index");if(r<=t)return this;var n;if(t>>>=0,r=void 0===r?this.length:r>>>0,"number"==typeof(e=e||0))for(n=t;n<r;++n)this[n]=e;else{var o=u.isBuffer(e)?e:u.from(e,i),s=o.length;if(0===s)throw new TypeError('The value "'+e+'" is invalid for argument "value"');for(n=0;n<r-t;++n)this[n+t]=o[n%s]}return this};var P=/[^+/0-9A-Za-z-_]/g;function x(e,t){var r;t=t||1/0;for(var i=e.length,a=null,n=[],o=0;o<i;++o){if(55295<(r=e.charCodeAt(o))&&r<57344){if(!a){if(56319<r){-1<(t-=3)&&n.push(239,191,189);continue}if(o+1===i){-1<(t-=3)&&n.push(239,191,189);continue}a=r;continue}if(r<56320){-1<(t-=3)&&n.push(239,191,189),a=r;continue}r=65536+(a-55296<<10|r-56320)}else a&&-1<(t-=3)&&n.push(239,191,189);if(a=null,r<128){if(--t<0)break;n.push(r)}else if(r<2048){if((t-=2)<0)break;n.push(r>>6|192,63&r|128)}else if(r<65536){if((t-=3)<0)break;n.push(r>>12|224,r>>6&63|128,63&r|128)}else{if(!(r<1114112))throw new Error("Invalid code point");if((t-=4)<0)break;n.push(r>>18|240,r>>12&63|128,r>>6&63|128,63&r|128)}}return n}function k(e){return T.toByteArray(function(e){if((e=(e=e.split("=")[0]).trim().replace(P,"")).length<2)return"";for(;e.length%4!=0;)e+="=";return e}(e))}function E(e,t,r,i){for(var a=0;a<i&&!(a+r>=t.length||a>=e.length);++a)t[a+r]=e[a];return a}function S(e,t){return e instanceof t||null!=e&&null!=e.constructor&&null!=e.constructor.name&&e.constructor.name===t.name}function C(e){return e!=e}}.call(this)}.call(this,O("buffer").Buffer)},{"base64-js":34,buffer:35,ieee754:36}],36:[function(e,t,r){r.read=function(e,t,r,i,a){var n,o,s=8*a-i-1,l=(1<<s)-1,c=l>>1,p=-7,u=r?a-1:0,d=r?-1:1,a=e[t+u];for(u+=d,n=a&(1<<-p)-1,a>>=-p,p+=s;0<p;n=256*n+e[t+u],u+=d,p-=8);for(o=n&(1<<-p)-1,n>>=-p,p+=i;0<p;o=256*o+e[t+u],u+=d,p-=8);if(0===n)n=1-c;else{if(n===l)return o?NaN:1/0*(a?-1:1);o+=Math.pow(2,i),n-=c}return(a?-1:1)*o*Math.pow(2,n-i)},r.write=function(e,t,r,i,a,n){var o,s,l=8*n-a-1,c=(1<<l)-1,p=c>>1,u=23===a?Math.pow(2,-24)-Math.pow(2,-77):0,d=i?0:n-1,f=i?1:-1,n=t<0||0===t&&1/t<0?1:0;for(t=Math.abs(t),isNaN(t)||t===1/0?(s=isNaN(t)?1:0,o=c):(o=Math.floor(Math.log(t)/Math.LN2),t*(i=Math.pow(2,-o))<1&&(o--,i*=2),2<=(t+=1<=o+p?u/i:u*Math.pow(2,1-p))*i&&(o++,i/=2),c<=o+p?(s=0,o=c):1<=o+p?(s=(t*i-1)*Math.pow(2,a),o+=p):(s=t*Math.pow(2,p-1)*Math.pow(2,a),o=0));8<=a;e[r+d]=255&s,d+=f,s/=256,a-=8);for(o=o<<a|s,l+=a;0<l;e[r+d]=255&o,d+=f,o/=256,l-=8);e[r+d-f]|=128*n}},{}],37:[function(e,t,r){var i,a,t=t.exports={};function n(){throw new Error("setTimeout has not been defined")}function o(){throw new Error("clearTimeout has not been defined")}function s(t){if(i===setTimeout)return setTimeout(t,0);if((i===n||!i)&&setTimeout)return(i=setTimeout)(t,0);try{return i(t,0)}catch(e){try{return i.call(null,t,0)}catch(e){return i.call(this,t,0)}}}try{i="function"==typeof setTimeout?setTimeout:n}catch(e){i=n}try{a="function"==typeof clearTimeout?clearTimeout:o}catch(e){a=o}var l,c=[],p=!1,u=-1;function d(){p&&l&&(p=!1,l.length?c=l.concat(c):u=-1,c.length&&f())}function f(){if(!p){var e=s(d);p=!0;for(var t=c.length;t;){for(l=c,c=[];++u<t;)l&&l[u].run();u=-1,t=c.length}l=null,p=!1,function(t){if(a===clearTimeout)return clearTimeout(t);if((a===o||!a)&&clearTimeout)return(a=clearTimeout)(t);try{a(t)}catch(e){try{return a.call(null,t)}catch(e){return a.call(this,t)}}}(e)}}function h(e,t){this.fun=e,this.array=t}function g(){}t.nextTick=function(e){var t=new Array(arguments.length-1);if(1<arguments.length)for(var r=1;r<arguments.length;r++)t[r-1]=arguments[r];c.push(new h(e,t)),1!==c.length||p||s(f)},h.prototype.run=function(){this.fun.apply(null,this.array)},t.title="browser",t.browser=!0,t.env={},t.argv=[],t.version="",t.versions={},t.on=g,t.addListener=g,t.once=g,t.off=g,t.removeListener=g,t.removeAllListeners=g,t.emit=g,t.prependListener=g,t.prependOnceListener=g,t.listeners=function(e){return[]},t.binding=function(e){throw new Error("process.binding is not supported")},t.cwd=function(){return"/"},t.chdir=function(e){throw new Error("process.chdir is not supported")},t.umask=function(){return 0}},{}],38:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});r.default={githubRateLimit:"https://api.github.com/rate_limit",githubGists:"https://api.github.com/gists",corsAnywhere:"https://cors-anywhere.herokuapp.com/",identifier:{prefix:"__",suffix:"-db-from-github-gist-api.txt",content:"This is the persistent store for the <APP-NAME> app. Playing with this gist directly, may have adverse effects in your application."}}},{}],39:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});e=e("./models/GithubGist");r.default=e.default},{"./models/GithubGist":41}],40:[function(e,t,r){"use strict";var i=this&&this.__awaiter||function(e,o,s,l){return new(s=s||Promise)(function(r,t){function i(e){try{n(l.next(e))}catch(e){t(e)}}function a(e){try{n(l.throw(e))}catch(e){t(e)}}function n(e){var t;e.done?r(e.value):((t=e.value)instanceof s?t:new s(function(e){e(t)})).then(i,a)}n((l=l.apply(e,o||[])).next())})};Object.defineProperty(r,"__esModule",{value:!0});const a=e("axios"),n=e("../util/auth-config"),o=e("../constants");r.default=class{constructor(e){var t;this.gistOwner="",this.fileHasUpdates=!1,this.overwrite=e=>{this.fileContent=e,this.fileHasUpdates=!0},this.save=()=>i(this,void 0,void 0,function*(){var e,t;this.hasUpdates&&(e=o.default.githubGists+"/"+this.gistId,t={public:this.isPublic,files:{[this.fileName]:{content:this.fileContent}}},yield a.default.post(e,t,(0,n.default)({personalAccessToken:this.personalAccessToken})),this.fileHasUpdates=!1)}),this.fetchLatest=()=>i(this,void 0,void 0,function*(){var e=yield this.getLatestGistCommit(),e=this.getLatestGistFileFetchUrl(e),e=yield a.default.get(e,(0,n.default)({personalAccessToken:this.personalAccessToken}));this.fileContent=e.data,this.fileHasUpdates=!1}),this.getLatestGistFileFetchUrl=e=>{const{addCorsPrefix:t,customCorsPrefix:r,gistOwner:i,gistId:a}=this,n="https://gist.githubusercontent.com/"+i+`/${a}/raw/${e}/`+this.fileName;return t?null!=r?r(n):o.default.corsAnywhere+n:n},this.getLatestGistCommit=()=>i(this,void 0,void 0,function*(){var e="dummyParam="+Math.random(),e=`${o.default.githubGists}/${this.gistId}?`+e;try{return(yield a.default.get(e,(0,n.default)({personalAccessToken:this.personalAccessToken}))).data.history[0].version}catch(e){throw new Error("Error while fetching the latest commit.")}}),this.personalAccessToken=e.personalAccessToken,this.gistId=e.gistId,this.gistOwner=e.gistOwner,this.fileName=e.fileName,this.fileContent=e.fileContent,this.isPublic=e.isPublic,this.fileHasUpdates=!0,this.addCorsPrefix=Boolean(null==(t=e.cors)?void 0:t.addPrefix),this.customCorsPrefix=null==(t=e.cors)?void 0:t.customPrefix}get hasUpdates(){return this.fileHasUpdates}get name(){return this.fileName}get content(){return this.fileContent}set hasUpdates(e){this.fileHasUpdates=e}}},{"../constants":38,"../util/auth-config":42,axios:2}],41:[function(e,t,r){"use strict";var a=this&&this.__awaiter||function(e,o,s,l){return new(s=s||Promise)(function(r,t){function i(e){try{n(l.next(e))}catch(e){t(e)}}function a(e){try{n(l.throw(e))}catch(e){t(e)}}function n(e){var t;e.done?r(e.value):((t=e.value)instanceof s?t:new s(function(e){e(t)})).then(i,a)}n((l=l.apply(e,o||[])).next())})};Object.defineProperty(r,"__esModule",{value:!0});const o=e("axios"),s=e("../util/auth-config"),i=e("../util/token-validity"),n=e("../util/is-string-empty"),l=e("../util/formatted-gist-identifier"),c=e("../constants"),p=e("./GistFile");r.default=class{constructor(e){var t;this.gistId="",this.gistOwner="",this.gistFiles=[],this.touch=()=>a(this,void 0,void 0,function*(){yield(0,i.default)(this.personalAccessToken),yield this.fetchGist(),(0,n.default)(this.gistId)&&(yield this.createGist())}),this.createFile=(t,e)=>{const r=this.gistFiles.find(e=>e.name===t);if(r)return r.overwrite(e),!1;e=this.constructGistFile(t,e);return this.gistFiles.push(e),!0},this.getFile=t=>{return this.gistFiles.find(e=>e.name===t)||null},this.getFiles=()=>[...this.gistFiles],this.getFileNames=()=>this.gistFiles.map(e=>e.name),this.save=()=>a(this,void 0,void 0,function*(){const e={};for(const i of this.gistFiles)!1!==i.hasUpdates&&(e[i.name]={content:i.content});var t,r;0!==Object.keys(e).length&&(t=c.default.githubGists+"/"+this.gistId,r={public:this.isPublic,files:e},yield o.default.post(t,r,(0,s.default)({personalAccessToken:this.personalAccessToken})),this.gistFiles.forEach(e=>{e.hasUpdates=!1}))}),this.fetchGist=()=>a(this,void 0,void 0,function*(){for(const e of(yield o.default.get(c.default.githubGists,(0,s.default)({personalAccessToken:this.personalAccessToken}))).data){const t=Object.keys(e.files);if(t.includes(this.formattedAppIdentifier)){yield this.initialize(e);break}}}),this.createGist=()=>a(this,void 0,void 0,function*(){const{identifier:{content:e},githubGists:t}=c.default,r=e.replace("<APP-NAME>",this.appIdentifier),i={public:this.isPublic,files:{[this.formattedAppIdentifier]:{content:r}}},a=yield o.default.post(t,i,(0,s.default)({personalAccessToken:this.personalAccessToken})),n=a.data;yield this.initialize(n)}),this.initialize=i=>a(this,void 0,void 0,function*(){this.gistId=i.id,this.gistOwner=i.owner.login;const e=[];this.gistFiles=[];for(const t of Object.keys(i.files)){const r=this.constructGistFile(t,"");e.push(r.fetchLatest()),this.gistFiles.push(r)}yield Promise.all(e)}),this.constructGistFile=(e,t)=>new p.default({fileName:e,fileContent:t,gistId:this.gistId,gistOwner:this.gistOwner,cors:{addPrefix:this.addCorsPrefix,customPrefix:this.customCorsPrefix},personalAccessToken:this.personalAccessToken,isPublic:this.isPublic}),this.personalAccessToken=e.personalAccessToken,this.appIdentifier=e.appIdentifier,this.formattedAppIdentifier=(0,l.default)(e.appIdentifier),this.isPublic=Boolean(e.isPublic),this.addCorsPrefix=Boolean(null==(t=e.cors)?void 0:t.addPrefix),this.customCorsPrefix=null==(t=e.cors)?void 0:t.customPrefix}get id(){return this.gistId}get ownerUsername(){return this.gistOwner}}},{"../constants":38,"../util/auth-config":42,"../util/formatted-gist-identifier":43,"../util/is-string-empty":44,"../util/token-validity":45,"./GistFile":40,axios:2}],42:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});r.default=e=>({headers:{Authorization:"token "+e.personalAccessToken}})},{}],43:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});const i=e("../constants");r.default=e=>{var{prefix:t,suffix:r}=i.default.identifier;return t+e+r}},{"../constants":38}],44:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});r.default=e=>0===e.length},{}],45:[function(e,t,r){"use strict";var i=this&&this.__awaiter||function(e,o,s,l){return new(s=s||Promise)(function(r,t){function i(e){try{n(l.next(e))}catch(e){t(e)}}function a(e){try{n(l.throw(e))}catch(e){t(e)}}function n(e){var t;e.done?r(e.value):((t=e.value)instanceof s?t:new s(function(e){e(t)})).then(i,a)}n((l=l.apply(e,o||[])).next())})};Object.defineProperty(r,"__esModule",{value:!0});const a=e("axios"),n=e("../constants"),o=t=>i(void 0,void 0,void 0,function*(){var e=n.default.githubRateLimit;return a.default.get(e,{headers:{Authorization:"token "+t}}).then(e=>e.headers["x-oauth-scopes"].includes("gist"))});r.default=e=>i(void 0,void 0,void 0,function*(){if(!(yield o(e)))throw new Error("Token is invalid or it doesn't have gist access.")})},{"../constants":38,axios:2}]},{},[1]),async(e,t=!0)=>{if(!(e=e||await getStorage("syncPAT")))return setStorage("syncState",!1),{ok:!1,payload:"noPAT"};var r=await getStorage("syncTest");const i=new GithubGist.default({appIdentifier:r?"TestsPaperMemorySync":"PaperMemorySync",personalAccessToken:e,isPublic:!1});try{return await i.touch(),t&&await setStorage("syncPAT",e),{ok:!0,payload:{gist:i,pat:e}}}catch(e){return console.log(e.response.data.message),warn("Because of the error ^ syncing is now disabled."),setStorage("syncState",!1),{ok:!1,payload:"wrongPAT",error:e}}}),getDataFile=async e=>{var t="PaperMemory-sync-data.json";let r=e.getFile(t);return r||(e.createFile(t),r=e.getFile(t)),r},pushToRemote=async()=>sendMessageToBackground({type:"writeSync"}),pullFromRemote=async(e,t)=>{var r=Date.now(),i=await sendMessageToBackground({type:"pullSync"});return consoleHeader("PaperMemory Pull "+String.fromCodePoint("0x1F504")),log("Remote Papers pulled: ",i),i&&(await initState({isContentScript:t,papers:i??e,print:!1}),t=(Date.now()-r)/1e3,info(`Successfully pulled from Github (${t}s).`),await setStorage("papers",global.state.papers)),console.groupEnd(),i},shouldSync=async()=>!!await getStorage("syncState"),initSyncAndState=async({papers:e=null,isContentScript:t=!1,stateIsReady:r=()=>{},remoteIsReady:i=()=>{}}={})=>{global.state.dataVersion||await initState({papers:e,isContentScript:t}),r(),await shouldSync()&&(t||startSyncLoader(),await pullFromRemote(e,t)?t||(r=global.state.sortedPapers.length,setPlaceholder("memory-search",`Search ${r} entries...`),global.state.memoryIsOpen||window.location.href.includes("options.html")||await makeMemoryHTML(),successSyncLoader()):t||errorSyncLoader()),i()},startSyncLoader=async()=>{showId("sync-popup-feedback"),hideId("sync-popup-error"),hideId("sync-popup-synced"),showId("sync-popup-syncing","flex")},successSyncLoader=async()=>{showId("sync-popup-feedback"),hideId("sync-popup-syncing"),hideId("sync-popup-error"),showId("sync-popup-synced"),setTimeout(()=>{hideId("sync-popup-feedback")},2e3)},errorSyncLoader=async()=>{showId("sync-popup-feedback"),hideId("sync-popup-syncing"),hideId("sync-popup-synced"),showId("sync-popup-error"),setTimeout(()=>{hideId("sync-popup-feedback")},2e3)},migrateData=async(r,t,e=!0)=>{if(void 0===r)return chrome.storage.local.set({papers:{__dataVersion:t}}),{papers:{__dataVersion:t},success:!0};var i,a,n,o=r.__dataVersion||-1,s=[];let l={...r};try{if(502<=o)return log("No migration needed"),{papers:r,success:!0};e&&backupData({...r}),delete r.__dataVersion;for(const c in r)o<5&&(info("Applying migration 5"),r[c].hasOwnProperty("bibtex")||(r[c].bibtex="",log("Migrating bibtex for "+c)),r[c].pdfLink.endsWith(".pdf")||(r[c].pdfLink=r[c].pdfLink+".pdf"),r[c].codeLink||(r[c].codeLink=""),r[c].source||(r[c].id.includes("NeurIPS")?r[c].source="neurips":r[c].source="arxiv")),o<208&&(info("Applying migration 0.2.8"),"arxiv"!==r[c].source&&r[c].md.includes("https://arxiv.com/abs/")&&(r[c].md=`[${r[c].title}](${r[c].pdfLink})`),"arxiv"!==r[c].source&&r[c].pdfLink.includes("arxiv.org/pdf/")&&(r[c].source="arxiv"),c.match(/^\d/)&&"arxiv"===r[c].source&&(i="Arxiv-"+c,a={...r[c],id:i},r[i]=a,s.push(c))),o<209&&(info("Applying migration 0.2.9"),r[c].hasOwnProperty("favorite")||(r[c].favorite=!1,r[c].favoriteDate="")),o<210&&(info("Applying migration 0.2.10"),"arxiv"===r[c].source&&(n=r[c].pdfLink.match(/v\d+\.pdf/gi))&&0<n.length&&(r[c].pdfLink=r[c].pdfLink.replace(n[0],".pdf")),r[c].hasOwnProperty("bibtext")&&(r[c].bibtex=r[c].bibtext+"",delete r[c].bibtext)),o<450&&(info("Applying migration 0.4.5"),r[c].hasOwnProperty("venue")||(r[c].venue=await makeVenue(r[c]))),o<502&&(info("Applying migration 0.5.2"),c.startsWith("ACL-")&&"acl"!==r[c].source&&(r[c].source="acl"),"acs"===r[c].source&&(r[c].pdfLink=r[c].pdfLink.replace("/doi/pdf/abs/","/doi/pdf/")));return s.forEach((e,t)=>{delete r[e],log("Deleting "+e)}),(l={...r}).__dataVersion=t,e&&chrome.storage.local.set({papers:l},()=>{log("Migrated papers:"),log(l),log("Data version is now "+t)}),{papers:l,success:!0}}catch(e){return log(`Error migrating data from version ${o} to ${t}:`),log(e),{papers:l,success:!1,error:e}}},logStorage=t=>{chrome.storage.local.get(t,e=>{log(e[t])})},getStorage=async r=>new Promise((t,e)=>{chrome.storage.local.get(r,e=>{t("string"==typeof r?e[r]:e)})}),setStorage=async(r,i,a=()=>{})=>new Promise((e,t)=>{chrome.storage.local.set({[r]:i},()=>{a(),e(!0)})}),deletePaperInStorage=async(e,t)=>{let r=!1;(t=t||(await getStorage("papers")??{})).hasOwnProperty(e)&&(updateDuplicatedUrls(null,e,!0),r=(r=delete global.state.titleHashToIds[miniHash(t[e].title)])&&delete t[e],delete global.state.papers[e]),r?(await setStorage("papers",t),global.state.papersList=Object.values(cleanPapers(global.state.papers)),sortMemory(),log("Successfully deleted paper",e)):log("Error: no deletion")},getTheme=async()=>{return await getStorage("checkDarkMode")?"dark":"light"},backupData=async r=>{chrome.storage.local.get("papersBackup",({papersBackup:e})=>{void 0===e&&(e={});for(const t of Object.keys(e).map(e=>parseInt(e)).sort((e,t)=>e<t?1:-1).slice(4))delete e[t];e[r.__dataVersion]=r,chrome.storage.local.set({papersBackup:e},()=>{log("Backed up data with version: "+r.__dataVersion)})})};function dateDiffInDays(e,t){e=Date.UTC(e.getFullYear(),e.getMonth(),e.getDate()),t=Date.UTC(t.getFullYear(),t.getMonth(),t.getDate());return Math.floor((t-e)/864e5)}const weeklyBackup=async()=>{var e=await getStorage("weeklyBackups")??{};const t=new Date,r=Object.keys(e).map(e=>new Date(e)).sort((e,t)=>e.getTime()-t.getTime());if(0<r.length&&dateDiffInDays(r[r.length-1],t)<7)return;let i={};for(const a of r.reverse().slice(0,5))i[a.toString()]=e[a.toString()];i[t.toString()]=await getStorage("papers")??{},setStorage("weeklyBackups",i)},getPrefs=async()=>{let e=!1,t;const r=await getStorage("prefs")??{};(e=0===Object.keys(r).length?!0:e)&&(t=await getStorage(global.prefsStorageKeys)??{});let i={};for(const a of global.prefsCheckNames)i[a]=(t??r).hasOwnProperty(a)?(t??r)[a]:!(0<=global.prefsCheckDefaultFalse.indexOf(a));return i.checkOfficialRepos&&(setStorage("pwcPrefs",{official:!0}),delete i.checkOfficialRepos,setStorage("prefs",i)),e&&setStorage("prefs",i),i},getManifestDataVersion=()=>{const e=chrome.runtime.getManifest();return e.version.split(".").map((e,t)=>parseInt(e)*10**(4-2*t)).reduce((e,t)=>e+t)},versionToSemantic=e=>(e=(e-=1e4*(major=parseInt(e/1e4,10)))-100*(minor=parseInt(e/100,10)),`${major}.${minor}.`+e),validatePaper=(e,t=!0)=>{const r={addDate:{type:"string",desc:"the paper's date of addition to the Memory",default:e=>(new Date).toJSON()},author:{type:"string",desc:"` and `-separated authors `${firstName} ${lastName}`"},bibtex:{type:"string",desc:"BibTex citation with new lines (`\n`)"},code:{type:"object",desc:"the paper's code object as returned by the PapersWithCode API",default:e=>({})},codeLink:{type:"string",desc:"the paper's code link",default:e=>""},count:{type:"number",desc:"the paper's number of visits",default:e=>1},extras:{type:"object",desc:"extra information about the paper which may be required per source",optional:!0},favorite:{type:"boolean",desc:"user wants to star the paper",default:e=>!1},favoriteDate:{type:"string",desc:"date the paper was added as a favorite",default:e=>""},id:{type:"string",desc:"Unique PaperMemory ID"},key:{type:"string",desc:"BibTex citation key",default:e=>"defaultKey_"+e.id},lastOpenDate:{type:"string",desc:"When the paper was last opened",default:e=>(new Date).toJSON()},md:{type:"string",desc:"markdown-formatted string `[${title}](${pdfLink})`",default:e=>`[${e.title}](${e.pdfLink})`},note:{type:"string",desc:"the user's note for this paper",default:e=>""},pdfLink:{type:"string",desc:"the link to the paper's pdf"},source:{type:"string",desc:"the paper's source i.e. where it was added to the memory from"},tags:{type:"array[string]",desc:"the user's tags for this paper",default:e=>[]},venue:{type:"string",desc:"the paper's publication venue",default:e=>""},year:{type:"string",desc:"year of publication"}};let i=[];for(const l in r)if(e.hasOwnProperty(l)){const c=r[l].type;var a,n=typeof e[l];c.includes("array")||"object"===c?c.includes("array")?Array.isArray(e[l])?(o=c.split("[")[1].replace("]",""),0<e[l].length&&((a=typeof e[l][0])!==o&&(message=` ${l} should contain ${o} not ${a} (${e.id})`,i.push(message),t&&console.warn(message)))):(message=`${l} should be an array (${e.id})`,i.push(message),t&&console.warn(message)):Object(e[l])!==e[l]&&(message=`${l} should be an object (${e.id})`,i.push(message),t&&console.warn(message)):n!==c&&(message=` ${l} should be of type ${c} not ${n} (${e.id})`,i.push(message),t&&console.warn(message))}else if(r[l].default){var o=r[l].default(e);e[l]=o,message=` Attribute "${l}" absent; will be set to "${JSON.stringify(o)}" (${e.id})`,i.push(message),t&&console.warn(message)}else if(!r[l].optional)throw new Error(`Cannot continue, paper is corrupted. Missing mandatory attribute "${l}" in `+e.id);const s=Object.keys(global.knownPaperPages);return s.indexOf(e.source)<0&&(message=`Unknown source ${e.source} (${e.id})`,i.push(message),console.warn(message)),{warnings:i,paper:e}},prepareOverwriteData=async e=>{let t=!0,r="",i="",a;try{e.__dataVersion||(e.__dataVersion=1);var n,o=await migrateData(e,getManifestDataVersion(),!1);if(!o.success)return i="Could not migrate the data before storing it",o.error&&(i+=":<br/>"+stringifyError(o.error)),{success:!1,message:i};for(const s in a=o.papers)s.startsWith("__")||(paperWarnings=validatePaper(a[s]).warnings)&&0<paperWarnings.length&&(r+="<br/>"+paperWarnings.join("<br/>"));r&&(n=await getStorage("papers")??{},setStorage("uploadBackup",n)),t=!1}catch(e){log("prepareOverwriteData error",e),i='<h5 class="errorTitle">/!\\ OverwriteMemoryError:</h5><br>'+stringifyError(e),t=!0}return{success:!t,message:i,warning:r,papersToWrite:a}},makeVenue=async e=>{let t="";switch((t=e.note&&e.note.match(/(accepted|published)\ @\ .+\(?\d{4}\)?/i)?e.note.split("@")[1].trim().replace(/\(?\d{4}\)?/,"").split("--")[0].trim():t)&&"neurips"===t.toLowerCase()&&(t="NeurIPS"),e.source){case"arxiv":break;case"neurips":t="NeurIPS";break;case"cvf":t=t||(await makeCVFPaper(e.pdfLink)).venue;break;case"openreview":t=t||(await makeOpenReviewPaper(e.pdfLink)).venue;break;case"biorxiv":break;case"pmlr":t=e.conf?.split(/\d{4}/)[0]??"";break;case"acl":t=e.conf??"";break;case"pnas":t="PNAS";break;case"nature":t=t||e.venue;break;case"iop":case"acs":t=e.venue}return t},isPaper=("undefined"!=typeof module&&null!=module.exports&&(dummyModule=module,dummyModule.exports={migrateData:migrateData,logStorage:logStorage,getStorage:getStorage,setStorage:setStorage,deletePaperInStorage:deletePaperInStorage,getTheme:getTheme,backupData:backupData,weeklyBackup:weeklyBackup,getPrefs:getPrefs,getManifestDataVersion:getManifestDataVersion,versionToSemantic:versionToSemantic,validatePaper:validatePaper,prepareOverwriteData:prepareOverwriteData,makeVenue:makeVenue}),async(e,t=!1)=>{let r={};if(!e)return r;for(const a in global.knownPaperPages){var i=global.knownPaperPages[a];r[a]=!1;for(const n of i)"string"==typeof n?e.includes(n)&&(r[a]=!0):"function"==typeof n&&(r[a]=n(e))}return r.localFile=isKnownLocalFile(e),r.stored=!t&&await findLocalFile(e),r}),isSourceURL=async(e,t)=>Object.values(await isPaper(e,t)).some(e=>e),paperToAbs=e=>{let t,r,i;const a=e.pdfLink;let n="";switch(e.source){case"arxiv":n="https://arxiv.org/abs/"+e.id.split("-")[1];break;case"neurips":n=a.replace("/file/","/hash/").replace("-Paper.pdf","-Abstract.html");break;case"cvf":n=a.replace("/papers/","/html/").replace(".pdf",".html");break;case"openreview":n=a.replace("/pdf?","/forum?");break;case"biorxiv":n=a.replace(".full.pdf","");break;case"pmlr":n=a.split("/").slice(0,-1).join("/")+".html";break;case"acl":n=a.replace(".pdf","");break;case"pnas":n=a.replace(".full.pdf","").replace("/doi/pdf/","/doi/full/");break;case"nature":n=a.replace(".pdf","");break;case"acs":n=a.replace("pubs.acs.org/doi/pdf/","pubs.acs.org/doi/").split("?")[0];break;case"iop":n=a.split("#")[0].replace(/\/pdf$/,"");break;case"jmlr":n=a.split("/").slice(0,-1).join("/").replace("/papers/volume","/papers/v")+".html";break;case"pmc":var o=a.match(/PMC\d+/)[0];n=a.split(o)[0]+o;break;case"ijcai":var o=a.replace(".pdf","").split("/").last().match(/[1-9]\d*/),s=a.match(/proceedings\/\d+/gi)[0].split("/")[1];n=`https://www.ijcai.org/proceedings/${s}/`+o;break;case"acm":n=a.replace("/doi/pdf/","/doi/");break;case"ieee":n="https://ieeexplore.ieee.org/document/"+e.key;break;case"springer":n=e.extra.url;break;case"aps":[t,r]=parseUrl(a).pathname.split("/").slice(1,3),n=a.replace(`/${t}/${r}/`,`/${t}/abstract/`);break;case"wiley":n=a.replace(/\/doi\/e?pdf\//g,"/doi/abs/");break;case"sciencedirect":s=a.split("/pii/")[1].split("/")[0].split("#")[0].split("?")[0];n="https://www.sciencedirect.com/science/article/pii/"+s;break;case"science":(i=a.split("/doi/")[1]).startsWith("10.")||(i=i.split("/").slice(1).join("/")),n="https://science.org/doi/full/"+i;break;case"frontiers":n=a.replace(/\/pdf$/,"/full");break;case"ihep":n="https://inspirehep.net/literature/"+e.id.split("-")[1];break;case"plos":n=a.replace("/article/file?","/article?").split("&")[0];break;case"rsc":n=a.replace("/articlepdf/","/articlelanding/");break;default:n="https://xkcd.com/1969/"}return n.replace("http://","https://")},paperToPDF=e=>{let t=e.pdfLink;switch(e.source){case"arxiv":t=t.replace("arxiv.org/abs/","arxiv.org/pdf/").replace(/\.pdf$/,"").replace(/v\d+$/gi,""),t+=".pdf";break;case"neurips":t=t.replace("/hash/","/file/").replace("-Abstract.html","-Paper.pdf");break;case"cvf":t=t.replace("/html/","/papers/").replace(".html",".pdf");break;case"openreview":t=t.replace("/forum?","/pdf?");break;case"biorxiv":t=cleanBiorxivURL(t)+".full.pdf";break;case"pmlr":case"acl":case"pnas":break;case"nature":t.endsWith(".pdf")||(t+=".pdf");break;case"iop":t.endsWith("/pdf")||(t+="/pdf");break;case"acs":case"jmlr":case"pmc":case"ijcai":case"acm":case"ieee":case"springer":case"aps":case"wiley":case"sciencedirect":case"science":case"frontiers":case"ihep":case"plos":case"rsc":break;default:t="https://xkcd.com/1969/"}return t.replace("http://","https://")},findLocalFile=async t=>{if("string"==typeof t){let e;try{e=await parseIdFromUrl(t)}catch(e){return new Promise(e=>e(null))}if(!global.state.papers.hasOwnProperty(e))return new Promise(e=>e(null));paper=global.state.papers[e]}else paper=t;t=await getStoredFiles(),t=await matchPapersToFiles({[paper.id]:paper},t),t=Object.values(t);return 1===t.length?t[0]:null},matchPapersToFiles=async(e,t)=>{var r=Object.fromEntries(Object.values(e).map(e=>[e.id,miniHash(e.title)])),i=(t=t.filter(e=>e.exists&&"complete"===e.state&&!e.filename.toLowerCase().includes("readme.txt")),Object.fromEntries(t.map(e=>[e.id,miniHash(e.filename)])));let a={};for(const o of t){let t;try{(t=await parseIdFromUrl(o.finalUrl))&&e.hasOwnProperty(t)&&(a[t]=o)}catch(e){t=null}if(!t){const s=i[o.id];var n=Object.entries(r).find(([,e])=>s.includes(e));n&&(a[n[0]]=o)}}return a},matchAllFilesToPapers=()=>new Promise((t,e)=>{chrome.downloads.search({filenameRegex:"PaperMemoryStore/.*"},async e=>{e=await matchPapersToFiles(cleanPapers(global.state.papers),e);t(e)})}),mergePapers=(e={newPaper:{},oldPaper:{}})=>{const{oldPaper:t,newPaper:r,...i}=e;let a={...t};e={overwrites:["lastOpenDate"],incrementCount:!1,syncMerge:!1,...i};for(const n in r)(!t.hasOwnProperty(n)||r[n]&&!t[n])&&(a[n]=r[n]);e.incrementCount&&1===a.count&&(a.count+=1),e.syncMerge&&(a.count=t.count+r.count,a.note=t.note??"",r.note&&r.note!==t.note&&(a.note+="\n\n--[Sync Merge]--\n",a.note+=r.note),a.tags=[...t.tags,...r.tags],a.lastOpenDate=r.lastOpenDate,r.lastOpenDate>t.lastOpenDate&&(a.lastOpenDate=r.lastOpenDate),a.addDate=r.addDate,r.addDate>t.addDate&&(a.addDate=r.addDate));for(const o of e.overwrites)r.hasOwnProperty(o)&&(a[o]=r[o]);return a},updatePaperVisits=e=>(e.count+=1,e.lastOpenDate=(new Date).toJSON(),log("Updating paper to:",e),e),addOrUpdatePaper=async({url:t,is:e,prefs:a,store:n=!0,contentScriptCallbacks:o={update:()=>{},preprints:()=>{}}})=>{const s=Date.now();let l,c,p={};consoleHeader("PaperMemory Parsing "+String.fromCodePoint("0x1F4DD")),global.state.papers=await getStorage("papers")??{};var r=await parseIdFromUrl(t),i=global.state.papers.hasOwnProperty(r);if(r&&i)l=updatePaperVisits(global.state.papers[r]),c=!1;else{if(!(l=await makePaper(e,t)))return;i=findFuzzyPaperMatch(global.state.titleHashToIds,l);if(i&&n){let e=global.state.papers[i];log("New paper",l,"already exists as",e),addPaperToTitleHashToId(l),!l.venue&&e.venue||l.venue&&e.venue?(e=mergePapers({newPaper:l,oldPaper:e,incrementCount:!1,overwrites:["lastOpenDate"]}),updateDuplicatedUrls(t,i)):!e.venue&&l.venue&&(updateDuplicatedUrls(paperToAbs(e),l.id),updateDuplicatedUrls(paperToPDF(e),l.id),await deletePaperInStorage(e.id,global.state.papers),e=mergePapers({newPaper:l,oldPaper:e,incrementCount:!1,overwrites:["lastOpenDate","venue","bibtex","id","key","pdfLink","source","year"]})),l=updatePaperVisits(e),c=!1}else c=!0}if(!l.codeLink||!l.venue)try{const g=await tryPWCMatch(l);var u=!l.codeLink&&g?.url,d=g?.note,f=g?.bibtex,h=!l.venue&&g?.venue;(p={codeLink:u,note:d,venue:h,bibtex:f}).codeLink&&(l.codeLink=p.codeLink,g.hasOwnProperty("note")&&delete g.note,l.code=g)}catch(e){log("Error trying to discover a code repository:"),log(e)}return global.state.papers=await getStorage("papers")??{},c&&global.state.papers.hasOwnProperty(l.id)&&(warn("Paper has been created by another page: merging papers."),l=mergePapers({newPaper:global.state.papers[l.id],oldPaper:l,incrementCount:!0}),c=!1),n&&(global.state.papers[l.id]=l),chrome.storage.local.set({papers:global.state.papers},async()=>{o.update(l),pushToRemote();let e;if(c||p.codeLink?c?(n?logOk("Added '"+l.title+"' to your Memory!"):warn("Discovered '"+l.title+"' but did not store it."),log("paper: ",l),e="Added to your Memory",p.codeLink&&(e+="<br/><div id='feedback-pwc'>(+ repo from PapersWithCode) </div>"),a&&a.checkFeedback&&n&&feedback(e,l)):(e="Found a code repository on PapersWithCode!",a&&a.checkFeedback&&n&&feedback(e)):n&&logOk("Updated '"+l.title+"' in your Memory"),!l.note||!l.venue){var t,r=await tryPreprintMatch(l);for(const i of["note","venue","bibtex"])l[i]&&"bibtex"!==i||(t=r[i]??p[i])&&(log(`Updating preprint ${i} to`,t),l[i]=t);global.state.papers=await getStorage("papers")??{},c&&global.state.papers.hasOwnProperty(l.id)&&1<global.state.papers[l.id].count&&(warn("Paper has been created by another page: merging papers."),l=mergePapers({newPaper:global.state.papers[l.id],oldPaper:l,incrementCount:!1})),n&&(global.state.papers[l.id]=l),chrome.storage.local.set({papers:global.state.papers})}o.preprints(l),pushToRemote(),info(`Done processing paper (${(Date.now()-s)/1e3}s).`),console.groupEnd()}),{paper:l,id:r}},findPaperForProperty=(e,t,r,i="id")=>e.find(e=>e.source===t&&e[i].includes(r))?.id,parseIdFromUrl=async t=>{let r;var e=miniHash(t),e=global.state.urlHashToId[e];if(e)return e;var e=await isPaper(t,!0),i=Object.values(cleanPapers(global.state.papers));if(e.arxiv){var a=t.match(/\d{4}\.\d{4,5}/g)[0];r="Arxiv-"+a;const o=Object.values(global.state.titleHashToIds).find(e=>e.includes(r));o&&(r=o.find(e=>!e.startsWith("Arxiv-"))??r)}else if(e.neurips){var a=t.split("/paper/")[1].split("/")[0],n=t.split("/").last().split("-")[0].slice(0,8);r=`NeurIPS-${a}_`+n}else if(e.cvf)r=parseCVFUrl(t).id;else if(e.openreview){a=t.match(/id=\w+/)[0].replace("id=","");r=findPaperForProperty(i,"openreview",a)}else if(e.biorxiv){let e=(t=cleanBiorxivURL(t)).split("/").last();e.match(/v\d+$/)&&(e=e.split("v")[0]),r="Biorxiv-"+e;const s=Object.values(global.state.titleHashToIds).find(e=>e.includes(r));s&&(r=s.find(e=>!e.startsWith("Biorxiv-"))??r)}else if(e.pmlr){const l=t.split("/").last().split(".")[0];var n="20"+l.match(/\d+/)[0];r=`PMLR-${n}-`+l}else if(e.acl){a=(t=(t=t.replace(".pdf","")).endsWith("/")?t.slice(0,-1):t).split("/").last();r=findPaperForProperty(i,"acl",a)}else if(e.pnas){n=((t=t.replace(".full.pdf","")).endsWith("/")?t.split("/").slice(-2):t.split("/").slice(-1))[0];r=findPaperForProperty(i,"pnas",n)}else if(e.nature){a=(t=t.replace(".pdf","").split("#")[0]).split("/").last();r=findPaperForProperty(i,"nature",a)}else if(e.acs){t=noParamUrl(t).replace("pubs.acs.org/doi/pdf/","/doi/").replace("pubs.acs.org/doi/abs/","/doi/");const doi=miniHash(t.split("/doi/")[1]);r="ACS_"+doi}else if(e.iop){t=noParamUrl(t).replace(/\/pdf$/,"");const doi=miniHash(t.split("/article/")[1]);r="IOPscience_"+doi}else if(e.jmlr){const c=(t=(t=t.endsWith(".pdf")?t.split("/").slice(0,-1).join("/"):t).replace(".html","")).split("/").last();n="20"+c.match(/\d+/)[0];r=`JMLR-${n}_`+c}else if(e.pmc){a=t.match(/PMC\d+/g)[0].replace("PMC","");r=findPaperForProperty(i,"pmc",a)}else if(e.ijcai){n=t.endsWith(".pdf")?t.replace(".pdf","").split("/").last().match(/[1-9]\d*/):t.split("/").last(),a=t.match(/proceedings\/\d+/gi)[0].split("/")[1];r=`IJCAI-${a}_`+n}else if(e.acm){const doi=t.replace(/\/doi\/?(pdf|abs|full)?\//,"/doi/").split("/doi/")[1];r=findPaperForProperty(i,"acm",miniHash(doi))}else if(e.ieee){a=(t.includes("ieee.org/document/")?t.split("ieee.org/document/"):t.includes("ieee.org/abstract/document/")?t.split("ieee.org/abstract/document/"):t.split("arnumber="))[1].match(/\d+/)[0];r=findPaperForProperty(i,"ieee",a)}else if(e.springer){const p=global.sourceExtras.springer.types;let e=p.filter(e=>t.includes(`/${e}/`))[0];if(!e){if(!t.includes("/content/pdf/"))throw new Error("Could not find Springer type for "+t);e="content/pdf"}n=t.split(`/${e}/`)[1].split("?")[0].replace(".pdf","");r=findPaperForProperty(i,"springer",miniHash(n))}else if(e.aps){var[a,n]=parseUrl(t.split("#")[0]).pathname.split("/").slice(1,3);const doi=t.split(`/${a}/${n}/`).last();r=findPaperForProperty(i,"aps",miniHash(doi))}else if(e.wiley){const doi=t.split("?")[0].split("#")[0].split("/").slice(-2).join("/");r=findPaperForProperty(i,"wiley",miniHash(doi))}else if(e.sciencedirect){a=t.split("/pii/")[1].split("/")[0].split("#")[0].split("?")[0];r=findPaperForProperty(i,"sciencedirect",miniHash(a))}else if(e.science)(doi=noParamUrl(t).split("/doi/")[1]).startsWith("10.")||(doi=doi.split("/").slice(1).join("/")),r=findPaperForProperty(i,"science",miniHash(doi));else if(e.frontiers)doi=noParamUrl(t).split("/articles/")[1].split("/").slice(0,-1).join("/"),r=findPaperForProperty(i,"frontiers",miniHash(doi));else if(e.ihep)r=t.includes("/literature/")?(n=noParamUrl(t).match(/\/literature\/(\d+)/)[1],findPaperForProperty(i,"ihep",n)):(a=noParamUrl(t).split("/files/")[1].split("/")[0],findPaperForProperty(i,"ihep",a,"pdfLink"));else if(e.plos){const doi=t.split("?id=").last().split("&")[0];r=findPaperForProperty(i,"plos",miniHash(doi))}else if(e.rsc){n=noParamUrl(t).split("/").last();r=findPaperForProperty(i,"rsc",miniHash(n))}else{if(!e.localFile)throw new Error("unknown paper url");r=e.localFile}return r},isKnownLocalFile=e=>{if(!e.startsWith("file://"))return!1;if(!e.endsWith(".pdf"))return!1;const t=decodeURIComponent(e).replace("file://","");var r=Object.entries(global.state.files).filter(([,e])=>e.filename===t);if(0<r.length)return console.log("Found stored"),r[0][0];const i=decodeURIComponent(e.split("/").last()).toLowerCase().replace(/\W/g,"");r=Object.values(cleanPapers(global.state.papers)).map(e=>({title:miniHash(e.title),id:e.id})).filter(e=>i.includes(e.title));return 0!==r.length&&r[0].id},makeMdLink=(e,t={})=>{var r=(t.checkPreferPdf?paperToPDF:paperToAbs)(e);let i="",a=(!t.checkMdYearVenue||(i=(i=e.note.match(/(.+)\s*@\s*([\w\s]+\(?\d{4}\)?)/i))&&i[2]?.replace(/\s+/g," ").replace(/[\(\)]/g,""))||(i="",e.venue&&(i+=e.venue+" "),i+=e.year),e.title);return`[${a=i?`${a} (${i.replace(/\s+/g," ")})`:a}](${r})`},duration=("undefined"!=typeof module&&null!=module.exports&&(dummyModule=module,dummyModule.exports={isPaper:isPaper,isSourceURL:isSourceURL,paperToAbs:paperToAbs,paperToPDF:paperToPDF,findLocalFile:findLocalFile,matchPapersToFiles:matchPapersToFiles,matchAllFilesToPapers:matchAllFilesToPapers,mergePapers:mergePapers,addOrUpdatePaper:addOrUpdatePaper,parseIdFromUrl:parseIdFromUrl,isKnownLocalFile:isKnownLocalFile,makeMdLink:makeMdLink,updatePaperVisits:updatePaperVisits}),e=>(Date.now()-e[0])/1e3),initState=async({papers:e,isContentScript:t,print:r=!0}={})=>{const i=[];i.unshift(Date.now()),r&&consoleHeader("PaperMemory Init "+String.fromCodePoint("0x2705")),e||(e=await getStorage("papers")??{},r&&log("Time to retrieve stored papers (s): "+duration(i))),i.unshift(Date.now()),global.state.dataVersion=getManifestDataVersion(),r&&log("Time to parse data version (s): "+duration(i)),i.unshift(Date.now()),global.state.titleFunction=(await getTitleFunction()).titleFunction,r&&log("Time to make title function (s): "+duration(i)),i.unshift(Date.now()),weeklyBackup(),r&&log("Time to backup papers (weekly) (s): "+duration(i)),i.unshift(Date.now());var a,n,o=await migrateData(e,global.state.dataVersion);r&&log("Time to migrate data (s): "+duration(i)),i.unshift(Date.now()),e=o.papers,global.state.papers=e,global.state.prefs=await getPrefs(),r&&log("Time to retrieve user preferences (s): "+duration(i)),i.unshift(Date.now()),global.state.ignoreSources=await getStorage("ignoreSources")??{},r&&log("Time to retrieve sources to ignore (s): "+duration(i)),i.unshift(Date.now()),global.state.urlHashToId=await getStorage("urlHashToId")??{},r&&log("Time to retrieve sources to urlHashToId (s): "+duration(i)),i.unshift(Date.now()),global.state.titleHashToIds={};for([a,n]of Object.entries(cleanPapers(e))){var s=miniHash(n.title);global.state.titleHashToIds.hasOwnProperty(s)||(global.state.titleHashToIds[s]=[]),global.state.titleHashToIds[s].push(a)}r&&log("Time to hash titles (s): "+duration(i)),i.unshift(Date.now()),t||(global.state.files=await matchAllFilesToPapers(),r&&log("Time to match all local files (s): "+duration(i)),i.unshift(Date.now()),global.state.papersList=Object.values(cleanPapers(e)),global.state.sortKey="lastOpenDate",global.state.papersReady=!0,sortMemory(),r&&log("Time to sort memory (s): "+duration(i)),i.unshift(Date.now()),makeTags(),r&&log("Time to make tags (s): "+duration(i)),i.unshift(Date.now())),info("State init duration (s): "+(Date.now()-i.last())/1e3),r&&console.groupEnd()},sortMemory=()=>{global.state.sortedPapers=Object.values(cleanPapers(global.state.papers)),global.state.sortedPapers.sort(orderPapers(0<=global.descendingSortKeys.indexOf(global.state.sortKey))),global.state.papersList.sort(orderPapers(0<=global.descendingSortKeys.indexOf(global.state.sortKey)))},orderPapers=a=>(e,t)=>{let r=e[global.state.sortKey],i=t[global.state.sortKey];return void 0===r&&(r=""),void 0===i&&(i=""),"string"==typeof r&&(r=r.toLowerCase(),i=i.toLowerCase()),a?r>i?-1:1:r>i?1:-1},makeTags=()=>{let e=new Set;for(const t of global.state.sortedPapers)for(const r of t.tags)e.add(r);global.state.paperTags=[...e],global.state.paperTags.sort()},getExamplePaper=async e=>{var t=await getStorage("papers")??{},r=Object.keys(t).filter(e=>-1===e.indexOf("__")).reverse();let i=t[r[e=void 0===e?getRandomInt(r.length):e]];return i=void 0===i?{title:"Dummy title",author:"Cool Author and Great Author and Complicated Name uthor",year:2021,id:"NoneXiv-214324",bibtex:"@Nonesense{}",tags:["t1","t2"],note:"Thispaperdoesnotexist.com"}:i},getTitleFunction=async(code=null)=>{let titleFunction;code=code||await getStorage("titleFunctionCode"),void 0===code&&(code=global.defaultTitleFunctionCode);let errorMessage;try{titleFunction=eval(code)}catch(error){errorMessage="Error parsing the title function: "+error,log("Error parsing the title function. Function string then error:"),log(code),log(error),titleFunction=eval(global.defaultTitleFunctionCode),code=global.defaultTitleFunctionCode}try{const examplePaper=await getExamplePaper(0),result=titleFunction(examplePaper);if("string"!=typeof result)throw new Error(`Result ${result} is not a string`)}catch(error){errorMessage="Error executing the title function: "+error,log("Error testing the user's title function. Function string then error:"),log(code),log(error),titleFunction=eval(global.defaultTitleFunctionCode),code=global.defaultTitleFunctionCode}return{titleFunction:titleFunction,code:code.trim(),errorMessage:errorMessage}},stateTitleFunction=paperOrId=>{let paper=paperOrId;if("string"==typeof paperOrId&&(paper=global.state.papers[paperOrId],void 0===paper))return log("Error in stateTitleFunction: unknown id",paperOrId),"Unknown ID";let name;try{name=global.state.titleFunction(paper)}catch(error){log("Error in stateTitleFunction:",error),name=eval(global.defaultTitleFunctionCode)(paper)}return name.replaceAll("\n"," ").replace(/\s\s+/g," ")},updateDuplicatedUrls=(t,r,e=!1)=>{if(e){let e;if((e=t?[miniHash(t)]:Object.keys(global.state.urlHashToId).filter(e=>global.state.urlHashToId[e]===r))&&e.length){for(const i of e)warn("Removing duplicated url",t,"for",r),delete global.state.urlHashToId[i];setStorage("urlHashToId",global.state.urlHashToId)}}else global.state.urlHashToId[miniHash(t)]=r,setStorage("urlHashToId",global.state.urlHashToId)},addPaperToTitleHashToId=e=>{var t=e.id,e=miniHash(e.title);global.state.titleHashToIds.hasOwnProperty(e)||(global.state.titleHashToIds[e]=[]),global.state.titleHashToIds[e].includes(t)||global.state.titleHashToIds[e].push(t)},readJournalAbbreviations=async()=>{var e,t;global.journalAbbreviations||(e=chrome.runtime.getURL("src/data/iso4-journals.json"),e=await fetch(e).then(e=>e.json()),t=chrome.runtime.getURL("src/data/journal-abbreviations.json"),t=await fetch(t).then(e=>e.json()),global.journalAbbreviations=Object.fromEntries([...Object.entries(e),...Object.entries(t)].map(([e,t])=>[miniHash(e),t])))},downloadPaperPdf=async e=>{if(!global.state.papersReady)throw new Error("[PM] State is not ready (downloadPaperPdf)");let t=stateTitleFunction(e);t=(t=t.replaceAll(":"," ")).replace(/[\u2000-\u206F\u2E00-\u2E7F\\'!"#$%&()*+,\/:;<=>?@\[\]^`{|}~]/g," ").replace(/\s+/g," "),global.state.prefs.checkStore&&(t="PaperMemoryStore/"+t,0===(await getStoredFiles()).length&&chrome.downloads.download({url:URL.createObjectURL(new Blob([global.storeReadme])),filename:"PaperMemoryStore/IMPORTANT_README.txt",saveAs:!1})),(t=t.endsWith("pdf")?t.slice(0,-3)+".pdf":t).endsWith(".pdf")||(t+=".pdf"),log("Downloading paper",e,"to",t),chrome.downloads.download({url:paperToPDF(e),filename:t})},decodeHtml=("undefined"!=typeof module&&null!=module.exports&&(dummyModule=module,dummyModule.exports={initState:initState,getExamplePaper:getExamplePaper,getTitleFunction:getTitleFunction,stateTitleFunction:stateTitleFunction,updateDuplicatedUrls:updateDuplicatedUrls,addPaperToTitleHashToId:addPaperToTitleHashToId,readJournalAbbreviations:readJournalAbbreviations,downloadPaperPdf:downloadPaperPdf}),e=>{var t=document.createElement("textarea");return t.innerHTML=e,t.value}),flipAuthor=e=>e.split(", ").reverse().join(" "),flipAndAuthors=e=>e.split(" and ").map(flipAuthor).join(" and "),fetchArxivXML=async e=>{e=e.replace("Arxiv-","");return fetch("https://export.arxiv.org/api/query?"+new URLSearchParams({id_list:e}))},fetchCvfHTML=async e=>{let t,r;if(t=e.endsWith(".pdf")?e.replace("/papers_backup/","/papers/").replace("/papers/","/html/").replace(".pdf",".html"):e,!(r=await fetch(t).then(e=>e.ok?e.text():""))&&t.includes("thecvf.com/content_")){const{conf:i,year:a}=parseCVFUrl(e);t=t.replace(`/content_${i}_${a}/`,`/content_${i.toLowerCase()}_${a}/`),r=await fetch(t).then(e=>e.ok?e.text():"")}return r},getOpenReviewNoteJSON=e=>sendMessageToBackground({type:"OpenReviewNoteJSON",url:e}),getOpenReviewForumJSON=e=>sendMessageToBackground({type:"OpenReviewForumJSON",url:e}),fetchDom=async e=>{const t=await fetch(e).then(e=>e.ok?e.text():"");return(new DOMParser).parseFromString(t.replaceAll("\n",""),"text/html")},fetchText=async e=>{try{const t=await fetch(e),r=t.ok?await t.text():"";return r.trim()}catch(e){return console.log("fetchText error:",e),""}},fetchJSON=async e=>{try{const t=await fetch(e);return t.ok?await t.json():null}catch(e){return console.log("fetchJSON error:",e),null}},fetchBibtex=async e=>{e=await fetchText(e);const t=bibtexToObject(e);delete t.abstract;var e=bibtexToString(t),r=`Published in ${t.journal} (${t.year})`;return{...t,bibtex:e,note:r,venue:t.journal,key:t.citationKey}},extractCrossrefData=e=>{if(e.status&&"ok"===e.status)if("work"!==e["message-type"])error("Unknown `message-type` from CrossRef",e);else{const o=e.message;log("Crossref data.message: ",o);var t=o.author.map(e=>e.given+" "+e.family).join(" and ");const s=o.issued?o.issued["date-parts"][0][0]+"":o.published?o.published["date-parts"][0][0]+"":null;if(s){var r=o.title[0];if(r){var i=o["container-title"][0]??"Springer",a=[miniHash(o.author[0].family),s.slice(2),firstNonStopLowercase(r)].join(""),n=o.DOI;let e={entryType:"book"===o.type?"book":"book-chapter"===o.type?"InBook":o.type.includes("article")?"Article":"InProceedings",citationKey:a,publisher:o.publisher,author:t,title:r,year:s,doi:n};o.page&&(e.pages=o.page),o.volume&&(e.volume=o.volume),o.type.includes("journal")&&(e.journal=i),o.link&&0<o.link.length&&((a=o.link.find(e=>"application/pdf"===e["content-type"]))&&(e.pdf=a.URL),(t=o.link.find(e=>"text/html"===e["content-type"])??o.link[0])&&(e.url=t.URL));r=bibtexToString(e);return{...e,bibtex:r,venue:i}}error("Cannot find title in CrossRef data",o)}else error("Cannot find year in CrossRef data",o)}else error("Cannot parse CrossRef response",e)},fetchCrossRefDataForDoi=async e=>{e=await fetchJSON(`https://api.crossref.org/works/${e}?mailto=schmidtv%40mila.quebec`);return extractCrossrefData(e)},fetchSemanticsScholarDataForDoi=async e=>{const t=await fetchJSON(`https://api.semanticscholar.org/graph/v1/paper/${e}?fields=venue,year,authors,title`);let r;var i;return t&&(r={},t.venue&&(r.venue=t.venue),t.year&&(r.year=t.year),t.authors&&(r.author=t.authors.map(e=>e.name).join(" and ")),t.title&&(r.title=t.title),e=""+miniHash(t.authors[0].name)+firstNonStopLowercase(r.title),i=bibtexToString({entryType:"article",citationKey:e,...r}),r.bibtex=i,r.key=e),r},getMetaContent=(e,t,r=!1)=>{e="meta"+Object.entries(e).map(([e,t])=>`[${e}='${t}']`).join("");return r?queryAll(t,e).map(e=>e.getAttribute("content")??""):t.querySelector(e)?.getAttribute("content")??""},extractDataFromDCMetaTags=e=>{const t=getMetaContent({name:"dc.Creator"},e,!0).map(e=>e.replace(/([a-z])([A-Z])/g,"$1 $2")).join(" and ");if(!t)return null;var r=getMetaContent({name:"dc.Date"},e).split("-")[0],i=getMetaContent({name:"dc.Publisher"},e).replaceAll("\n"," "),a=getMetaContent({name:"dc.Title"},e),n=getMetaContent({name:"citation_journal_title"},e),o=(""+t.split(" and ")[1].split(" ")[0]+r+firstNonStopLowercase(a)).toLowerCase(),e=getMetaContent({name:"dc.Date",scheme:"doi"},e),s=bibtexToString({citationKey:o,entryType:"article",title:a,author:t,year:r,doi:e,publisher:i,journal:n});return{author:t,year:r,publisher:i,title:a,venue:n,key:o,doi:e,bibtex:s,note:`Published @ ${n} (${r})`}},makeArxivPaper=async e=>{e=e.match(/\/(\d{4}\.\d{4,5})/)[1];const t=await fetchArxivXML(e),r=await t.text();var i=(new DOMParser).parseFromString(r.replaceAll("\n",""),"text/xml");const a=queryAll(i,"author name").map(e=>e.innerHTML);var n=a.join(" and "),o=[...i.getElementsByTagName("link")].map(e=>e.getAttribute("href")).filter(e=>e.includes("arxiv.org/pdf/"))[0].replace(/v\d+\.pdf$/gi,".pdf"),s=i.querySelector("entry title").innerHTML,i=i.querySelector("entry published").innerHTML.slice(0,4),l=a[0].split(" ").last().toLowerCase()+i+firstNonStopLowercase(s),e="Arxiv-"+e,c="";return{author:n,bibtex:c+`@article{${l},
`+`title={${s} },
`+`author={${n} },
`+`year={${i}},
`+`journal={arXiv preprint arXiv: ${e}}
`+"}",id:e,key:l,pdfLink:o,title:s,venue:"",year:i}},makeNeuripsPaper=async e=>{const t=(e=e.endsWith(".pdf")?e.replace("/file/","/hash/").replace("-Paper.pdf","-Abstract.html"):e).split("/").slice(-1)[0].replace("-Paper.pdf",""),r=await fetchDom(e);var i=[...r.getElementsByTagName("a")].filter(e=>"Bibtex"===e.innerText)[0]?.getAttribute("href");let a,n,o,s,l;if(i)a=await fetchText("https://"+parseUrl(e).host+i),{author:n,citationKey,title:o,year:s}=bibtexToObject(a),n=flipAndAuthors(n),l=citationKey;else{const u=queryAll(r,".container-fluid .col p"),d=(o=r.getElementsByTagName("h4")[0].innerHTML,queryAll(document,"h4").filter(e=>"Authors"===e.innerText)[0]);n=d.nextElementSibling.innerText.split(", ").map(e=>e.split(" ").map(e=>e.capitalize()).join(" ")).join(" and "),s=u[0].innerHTML.match(/\d{4}/)[0],l="neurips"+s+t.slice(0,8),a="",a=(a=(a=(a=(a+=`@inproceedings{NEURIPS${s}_${t.slice(0,8)},
`)+`author={${n}},
`+`booktitle={Advances in Neural Information Processing Systems},
`)+`editor={H.Larochelle and M.Ranzato and R.Hadsell and M.F.Balcan and H.Lin},
`+`publisher={Curran Associates, Inc.},
`)+`title={${o}},
`+`url={${e}},
`)+`year={${s}}
`+"}",a=bibtexToString(a)}var i=e.replace("/hash/","/file/").replace("-Abstract.html","-Paper.pdf"),e=`NeurIPS-${s}_`+t.slice(0,8),c="NeurIPS",p=`Accepted @ ${c} (${s})`;return{author:n,bibtex:a,id:e,key:l,note:p,pdfLink:i,title:o,venue:c,year:s}},makeCVFPaper=async e=>{const t=await fetchCvfHTML(e),r=(new DOMParser).parseFromString(t.replaceAll("\n",""),"text/html");var i=r.getElementById("papertitle").innerText.trim(),a=r.querySelector("#authors i").innerText.split(",").map(e=>e.trim()).join(" and "),{year:n,id:o,conf:s}=parseCVFUrl(e);let l="";if(e.endsWith(".pdf"))l=e;else{let e=[...r.getElementsByTagName("a")].filter(e=>"pdf"===e.innerText)[0].getAttribute("href");(e=e.startsWith("../")?e.replaceAll("../",""):e).startsWith("/")||(e="/"+e),l="http://openaccess.thecvf.com"+e}e=s,s=`Accepted @ ${e} (${n})`;const c=bibtexToString(r.querySelector(".bibref").innerText);var p=c.split("{")[1].split(",")[0];return{author:a,bibtex:c,id:o,key:p,note:s,pdfLink:l,title:i,venue:e,year:n}},makeOpenReviewBibTex=(e,t)=>{var r=e.content.title,i=e.content.authors.join(" and "),a=e.cdate?new Date(e.cdate).getFullYear():"0000",e=(e.cdate||log("makeOpenReviewBibTex: no cdate found in",e),e.content.authors[0].split(" ").last()),n="";return n+`@inproceedings{${e=(e+=a)+firstNonStopLowercase(r)},
`+`title={${r}},
`+`author={${i}},
`+`year={${a}},
`+`url={${t}},
`+"}"},makeOpenReviewPaper=async e=>{var t=await getOpenReviewNoteJSON(e),r=await getOpenReviewForumJSON(e),t=t.notes[0],r=r.notes,i=t.content.title,a=t.content.authors.join(" and "),n=bibtexToString(t.content._bibtex||makeOpenReviewBibTex(t,e)),o=bibtexToObject(n),s=o.citationKey,o=o.year;let l;l=t.pdf?"https://openreview.net/pdf?id="+t.id:(t.html||e).replace("/forum?id=","/pdf?id=");const c=t.invitation.split("/");let p=c[0].split(".")[0],u=c.slice(1).join("/").split("-")[0].replaceAll("/"," ").replace(" Conference",""),d=p,f=!1;global.overrideORConfs.hasOwnProperty(p)&&(d=global.overrideORConfs[p],f=!0),f&&(u=u.replace(d,""),p=d);e=(p+" "+u).replace(/ \d\d\d\d/g,"").replace(/\s\s+/g," "),t=`OR-${p}-${o}_`+t.id;let h,g,m,y="";return(h=r.filter(e=>e&&e.content&&-1<["Final Decision","Paper Decision","Acceptance Decision"].indexOf(e.content.title)))&&0<h.length&&(g=h[0].content.decision.split(" ").map((e,t)=>0===t?e+"ed":e).join(" "),m=g+` @ ${e} (${o})`,g.toLowerCase().indexOf("rejected")<0&&(y=e)),{author:a,bibtex:n,id:t,key:s,note:m="Anonymous"===a?`Under review @ ${e} (${o}) (${(new Date).toLocaleDateString()})`:m,pdfLink:l,title:i,venue:y,year:o}},makeBioRxivPaper=async e=>{var t=e.replace(".full.pdf",""),r="https://api.biorxiv.org//details/biorxiv/"+e.split("/").slice(-2).join("/").replace(".full.pdf","").split("v")[0];const i=await fetch(r).then(e=>e.json());if("ok"!==i.messages[0].status)throw new Error(r+" returned "+i.messages[0].status);const a=i.collection.last(),n=await fetchText(t),o=(new DOMParser).parseFromString(n.replaceAll("\n",""),"text/html");r=o.querySelector(".bibtext a").getAttribute("href");const s=bibtexToString(await(await fetch(r)).text());var t=extractAuthor(s),r=await parseIdFromUrl(e),l=s.split("\n")[0].split("{")[1].replace(",","").trim(),e=cleanBiorxivURL(e)+".full.pdf",c=a.title,p=a.date.split("-")[0];return{author:t,bibtex:s,id:r,key:l,note:"",pdfLink:e,title:c,venue:"",year:p}},makePMLRPaper=async e=>{var t=e.split("/").last().split(".")[0],r=await parseIdFromUrl(e);const i=e.includes(".html")?e:e.split("/").slice(0,-2).join("/")+`/${t}.html`;e=i.replace(".html","")+`/${t}.pdf`;const a=await fetchDom(i);a.getElementById("button-bibtex1").getAttribute("onclick").match(/https.+\.bib/)[0];const n=a.getElementById("bibtex").innerText.replaceAll("\t"," ").replaceAll(/\s\s+/g," ");let o=n;for(const d of n.match(/,\ ?\w+ ?= ?{/g))o=o.replace(d,d.replace(", ",",\n    ").replace(" = ","="));o.endsWith("}}")&&(o=o.slice(0,-2)+"}\n}"),o=bibtexToString(o);var s=extractAuthor(o),l=a.getElementsByTagName("h1")[0].innerText,c=extractBibtexValue(o,"year");let p=extractBibtexValue(o,"booktitle").replaceAll("Proceedings of the",""),u=p;note=`Accepted @ ${u} (${c})`;for(const f in global.overridePMLRConfs)if(p.includes(f)){u=global.overridePMLRConfs[f],p=u+" "+c,note="Accepted @ "+p;break}return{author:s,bibtex:o,id:r,key:t,note:note,pdfLink:e,title:l,venue:u,year:c}},findACLValue=(e,t)=>{return queryAll(e,"dt").filter(e=>e.innerText.includes(t))[0].nextElementSibling.innerText},makeACLPaper=async e=>{e=e.replace(".pdf","");const t=await fetchDom(e);e=t.getElementById("citeBibtexContent");if(e){var r=t.getElementById("title").innerText,e=bibtexToString(e.innerText);const l=bibtexToObject(e);var i=l.year,a=l.author.replace(/\s+/g," ").split(" and ").map(e=>e.split(",").map(e=>e.trim()).reverse().join(" ")).join(" and "),n=l.citationKey,o=findACLValue(t,"Venue"),s=findACLValue(t,"PDF");return{author:a,bibtex:e,id:`ACL-${o}-${i}_`+findACLValue(t,"Anthology ID"),key:n,note:`Accepted @ ${o} (${i})`,pdfLink:s,title:r,venue:o,year:i}}},makePNASPaper=async e=>{e=e.replace(".full.pdf","").replace(/\/doi\/e?pdf\//,"/doi/abs/");const t=await fetchDom(e);var r=t.getElementsByTagName("h1")[0].innerText,i=queryAll(t,".authors span[property='author'] a:not([property='email']):not(.orcid-id)").filter(e=>!e.getAttribute("href").includes("mailto:")).map(e=>e.innerText).join(" and "),a=t.querySelector("span[property='datePublished']").innerText.match(/\d{4}/g)[0],n=`PNAS-${a}_`+(e.endsWith("/")?e.split("/").slice(-2):e.split("/").slice(-1))[0];const o=e.includes("/doi/pdf/")||e.includes("/doi/epdf/")?e.replace("/doi/epdf/","/doi/pdf/"):e.replace("/doi/abs/","/doi/pdf/").replace("/doi/full/","/doi/pdf/");var e=[...t.querySelector(".core-container").getElementsByTagName("a")].map(e=>e.getAttribute("href")).filter(e=>e?.includes("https://doi.org"))[0].split("/").slice(-2).join("/"),s="doi:"+e;return{author:i,bibtex:bibtexToString(`@article{${s}, author={${i}}, title={${r}}, journal = {Proceedings of the National Academy of Sciences}, year={${a}}, doi={${e}}, eprint={${o}}, URL={${o.replace("/doi/pdf/","/doi/abs/")}} }`),id:n,key:s,note:`Published @ PNAS (${a})`,pdfLink:o,title:r,venue:"PNAS",year:a}},makeNaturePaper=async e=>{var t=(e=e.replace(".pdf","").split("#")[0])+".pdf",r=e.split("/").last();const i=await fetchDom(e);e=i.querySelector("h1.c-article-title").innerText;const a=queryAll(i,"ul.c-article-author-list li").map(e=>e.innerText.replace(/(\ ?,)|&||\d/g,"").split(/orcid/i)[0].trim()).filter(e=>0<e.length).join(" and ");var n=i.querySelector(".c-article-info-details").innerText.match(/\(\d{4}\)/)[0].replace(/\(|\)/g,""),o=i.querySelector(".c-article-info-details [data-test]").innerText,r=`Nature-${n}_`+r;let s;for(const u of[".c-bibliographic-information__citation",".c-bibliographic-information__value"])if(s=document.querySelector(u)?.innerText.split("https://doi.org/")[1])break;s=s||[...i.getElementsByTagName("span")].map(e=>e.innerText).filter(e=>e.includes("https://doi.org"))[0];var l=""+a.split(" ")[1]+n+firstNonStopLowercase(e);let c={citationKey:l,entryType:"article",author:a,title:e,journal:o,year:n};s&&(c.doi=s,c.url="https://doi.org/"+s);var p=bibtexToString(c);return{author:a,bibtex:p,id:r,key:l,note:`Published @ ${o} (${n})`,pdfLink:t,title:e,venue:o,year:n}},makeACSPaper=async e=>{const t=(e=e.replace("pubs.acs.org/doi/pdf/","pubs.acs.org/doi/").split("?")[0]).replace("/abs/","/").split("/doi/")[1];console.log("doi: ",t);e=`https://pubs.acs.org/action/downloadCitation?doi=${t}&include=cit&format=bibtex&direct=true`,e=await fetchText(e);const r=bibtexToObject(e);var i=r.author.replaceAll("\n","").trim(),a=r.title.trim(),n=r.year.trim(),o=r.citationKey.trim(),s="https://pubs.acs.org/doi/pdf/"+t,l=`Published @ ${r.journal} (${r.year})`;return{author:i,bibtex:e,id:"ACS_"+t.replaceAll(".","").replaceAll("/",""),key:o,note:l,pdfLink:s,title:a,venue:r.journal,year:n}},makeIOPPaper=async e=>{(e=e.split("#")[0]).endsWith("/pdf")&&(e=e.slice(0,-4));var t=await fetchDom(e),t=queryAll(t,".btn-multi-block a").filter(e=>"BibTeX"===e.innerText).map(e=>e.getAttribute("href"))[0],t="https://"+parseUrl(e).host+t,t=await fetchText(t);const r=bibtexToObject(t);var i=r.author.replaceAll("\n","").trim(),a=r.title.trim(),n=r.year.trim(),o=r.citationKey.trim(),s=e+"/pdf",l=r.journal,c=`Published @ ${l} (${n})`;const p=e.split("/article/").last();return{author:i,bibtex:t,id:"IOPscience_"+p.replaceAll(".","").replaceAll("/",""),key:o,note:c,pdfLink:s,title:a,venue:l,year:n}},makeJMLRPaper=async e=>{var t=(e=(e=(e=e.includes("/papers/volume")?e.replace("/papers/volume","/papers/v"):e).endsWith(".pdf")?e.split("/").slice(0,-1).join("/"):e).replace(".html","")).split("/").last(),r=e+".bib",r=await fetchText(r);const{author:i,year:a,title:n,citationKey:o}=bibtexToObject(r);return{author:i,bibtex:r,id:`JMLR-${a}_`+t,key:o.trim(),note:`Published @ JMLR (${a})`,pdfLink:e.replace("/papers/v","/papers/volume")+`/${t}.pdf`,title:n,venue:"JMLR",year:a}},makePMCPaper=async e=>{var t=e.match(/PMC\d+/)[0].replace("PMC",""),r=e.split("PMC"+t)[0]+"PMC"+t;const i=await(await fetch(`https://api.ncbi.nlm.nih.gov/lit/ctxp/v1/pmc/?format=csl&id=${t}&download=true`)).json();var a=(i["epub-date"]||i.issued)["date-parts"][0][0],n=i.author.map(e=>e.given+" "+e.family).join(" and "),o=i["container-title"].split(" ").map(e=>e.capitalize()).join(" "),s=i.title,t=`PMC-${a}_`+t,l=""+i.author[0].family+a+firstNonStopLowercase(s),c=bibtexToString({entryType:"article",citationKey:l,journal:o,issn:i.ISSN,volume:i.volume,page:i.page,doi:i.DOI,PMID:i.PMID,PMCID:i.PMCID,publisher:i.publisher,author:n,title:s});let p;if(isPdfUrl(e))p=e;else{const f=i.DOI.split("/")[1].split("-");var e=f[0].match(/\d+/)[0],u=f[1].replace(f[1].match(/^0*/)[0],""),d=f[2].replace(f[2].match(/^0*/)[0],"");p=r+`/pdf/${e}_${u}_Article_${d}.pdf`}return{author:n,bibtex:c,id:t,key:l,note:`Published @ ${o} (${a})`,pdfLink:p,title:s,venue:o,year:a}},makePubMedPaper=async e=>{const t=await fetchDom(e.split("?")[0]),r=[...t.getElementsByTagName("meta")].filter(e=>e.getAttribute("name")?.includes("citation_")),i=Object.fromEntries(r.map(e=>[e.getAttribute("name").replace("citation_",""),e.getAttribute("content")])),a=document.querySelector("div.authors-list").innerText.replace(/\d/gi,"").split(",").map(e=>e.trim()).join(" and ");var e=i.title,n=i.journal_title,o=i.date.split("/")[2],s=`PubMed-${o}_`+i.pmid,l=""+a.split(" and ")[0].split(" ").last()+o+firstNonStopLowercase(i.title),c={entryType:"article",citationKey:l,publisher:i.publisher,doi:i.doi,issn:i.issn,journal:n,year:o,author:a},c=bibtexToString(c),p=`Accepted @ ${journal} (${o})`;return{author:a,bibtex:c,id:s,key:l,note:p,pdfLink:"",title:e,venue:n,year:o}},makeIJCAIPaper=async e=>{const t=e.endsWith(".pdf")?e.replace(".pdf","").split("/").last().match(/[1-9]\d*/)[0]:e.split("/").last();e=e.match(/proceedings\/\d+/gi)[0].split("/")[1];const r=(await fetchText(`https://www.ijcai.org/proceedings/${e}/bibtex/`+t)).replace(/}\n/gi,"},\n");var i=bibtexToObject(r.split("\n").filter(e=>!/note\s+=/gi.test(e)).join("\n")),a=i.citationKey,n=i.title,i=flipAndAuthors(i.author),o=`IJCAI-${e}_`+t,s=`Accepted @ IJCAI (${e})`,l=t.padStart(4,0);return{author:i,bibtex:r,id:o,key:a,note:s,pdfLink:`https://www.ijcai.org/proceedings/${e}/${l}.pdf`,title:n,venue:"IJCAI",year:e}},makeACMPaper=async e=>{let t;t=isPdfUrl(e)?e:e.replace(/\/doi\/?(abs|full)?\//,"/doi/pdf/");const r=await fetchDom(e.replace("/doi/pdf/","/doi/"));let i,a,n,o,s,l,c,p;var u=extractDataFromDCMetaTags(r);if(u)({author:i,year:a,title:n,venue:o,key:s,doi:l,bibtex:c,note:p}=u);else{n=r.querySelector(".citation__title").innerText,i=queryAll(r,"ul[ariaa-label='authors'] li.loa__item .loa__author-name").map(e=>e.innerText.replace(",","").trim()).join(" and ");const d=r.querySelector(".issue-item__detail a").innerText;o=d.split("'")[0].trim(),a="20"+d.split("'")[1].split(":")[0].trim(),l=t.split("/doi/pdf/")[1],p=`Accepted @ ${o} (${a})`,s=l,c=bibtexToString({entryType:"article",citationKey:l,journal:o,author:i,title:n,year:a,publisher:"Association for Computing Machinery",address:"New York, NY, USA",url:e.replace("/doi/pdf/","/doi/")})}u=`ACM-${a}_`+miniHash(l);return{author:i,bibtex:c,id:u,key:s,note:p,pdfLink:t,title:n,venue:o,year:a}},makeIEEEPaper=async e=>{isPdfUrl(e)&&(e=`https://ieeexplore.ieee.org/document/${e.split("/stamp/stamp.jsp?tp=&arnumber=")[1].match(/\d+/)[0]}/`,console.log("url: ",e));const t=await fetchDom(e),r=JSON.parse([...t.getElementsByTagName("script")].filter(e=>e.innerHTML?.includes("metadata="))[0].innerHTML.split("metadata=")[1].split(/};\s*/)[0]+"}");var i=r.title,a=r.authors.map(e=>e.name).join(" and "),n=r.publicationYear,e=""+parseUrl(e).origin+r.pdfUrl,o=r.publicationTitle,s=r.articleId;return{author:a,bibtex:bibtexToString({entryType:"article",citationKey:s,journal:o,volume:r.volume,pages:r.startPage+"-"+r.endPage,doi:r.doi,title:i,year:n,author:a}),id:`IEEE-${n}_`+s,key:s,note:`Accepted @ ${o} (${n})`,pdfLink:e,title:i,venue:o,year:n}},makeSpringerPaper=async t=>{const e=[...global.sourceExtras.springer.types,"content/pdf"];var r=e.find(e=>t.includes(`/${e}/`));if(!r)throw new Error(`Could not find Springer type for ${t} (known: ${e.join(", ")})`);var i=t.split(`/${r}/`)[1].split("?")[0].replace(".pdf",""),a=await fetchCrossRefDataForDoi(i);if(!a)throw new Error("Aborting Springer paper parsing, see error above");var{author:n,bibtex:o,citationKey:s,year:l,title:c,venue:p}=a;return{author:n,bibtex:o,id:`Springer-${l}_`+miniHash(i),key:s,note:`Published @ ${p} (${l})`,pdfLink:a.pdf??("content/pdf"===r?t:t.replace(`/${r}/`,"/content/pdf/")+".pdf"),title:c,venue:p,year:l,extra:{url:"https://doi.org/"+i}}},makeAPSPaper=async e=>{e=e.split("#")[0];var[t,r]=parseUrl(e).pathname.split("/").slice(1,3),i=e.split(`/${t}/${r}/`).last(),a=e.replace(`/${t}/${r}/`,`/${t}/export/`),a=await fetchText(a+"?type=bibtex&download=true"),n=bibtexToObject(a),e=e.replace(`/${t}/${r}/`,`/${t}/pdf/`),r=`APS-${n.year}_`+miniHash(i),t=n.journal??n.publisher,i=(await readJournalAbbreviations(),global.journalAbbreviations[miniHash(t)]??t),t=`Published @ ${i} (${n.year})`;return{author:flipAndAuthors(n.author),bibtex:a,id:r,key:n.citationKey,note:t,pdfLink:e,title:n.title,venue:i,year:n.year}},makeWileyPaper=async e=>{const t=e.replace(/\/doi\/(abs|epdf|full)\//g,"/doi/pdf/");e=t.replace("/doi/pdf/","/doi/abs/");const r=await fetchDom(e);var e=queryAll("meta[name=citation_author]").map(e=>e.getAttribute("content")).join(" and "),i=r.querySelector("meta[name=citation_journal_title]").getAttribute("content"),a=r.querySelector("meta[name=citation_title]").getAttribute("content"),n=r.querySelector("meta[name=citation_publisher]").getAttribute("content"),o=r.querySelector("meta[name=citation_publication_date]")?.getAttribute("content")?.split("/")[0]??r.querySelector("meta[name=citation_online_date]")?.getAttribute("content")?.split("/")[0],s=r.querySelector("meta[name=citation_doi]").getAttribute("content"),l=`Published @ ${i} (${o})`,c=`Wiley-${o}_`+miniHash(s);return{author:e,bibtex:bibtexToString({citationKey:s,entryType:"article",title:a,author:e,year:o,doi:s,publisher:n,journal:i}),id:c,key:s,note:l,pdfLink:t,title:a,venue:i,year:o}},makeScienceDirectPaper=async e=>{var e=e.split("/pii/")[1].split("/")[0].split("#")[0].split("?")[0],t=await fetchText(`https://www.sciencedirect.com/sdfe/arp/cite?pii=${e}&format=text%2Fx-bibtex&withabstract=false`),{author:r,journal:i,year:a,title:n,citationKey:o}=bibtexToObject(t),s=`Published @ ${i} (${a})`;return{author:r,bibtex:t,id:`ScienceDirect-${a}_`+miniHash(e),key:o,note:s,pdfLink:"https://reader.elsevier.com/reader/sd/pii/"+e,title:n,venue:i??"Science Direct",year:a}},makeSciencePaper=async e=>{let t,r,i,a,n,o,s,l,c,p,u;o="https://science.org/doi/pdf/"+(p=(p=noParamUrl(e).split("/doi/")[1]).startsWith("10.")?p:p.split("/").slice(1).join("/")),u="https://science.org/doi/full/"+p;var e=await fetchCrossRefDataForDoi(p);return e?({author:t,bibtex:r,title:s,venue:l,year:c}=e,a=e.citationKey,n=`Published @ ${l} (${c})`):(e=await fetchDom(u),{author:t,year:c,publisher,title:s,venue:l,key:a,bibtex:r,note:n}=extractDataFromDCMetaTags(e)),i=`Science-${c}_`+miniHash(p),{author:t,bibtex:r,id:i,key:a,note:n,pdfLink:o,title:s,venue:l,year:c}},makeFrontiersPaper=async e=>{e=e.replace(/\/pdf$/,"/full");var t=noParamUrl(e).split("/articles/")[1].split("/full")[0],r=await fetchText(`https://www.frontiersin.org/articles/${t}/bibTex`);const i=Object.fromEntries(Object.entries(bibtexToObject(r)).map(([e,t])=>["citationKey"===e||"entryType"===e?e:e.toLowerCase(),t]));i.author=flipAndAuthors(i.author),delete i.abstract;var{author:r,journal:a,year:n,title:o,citationKey:s}=i,l=`Published @ ${a} (${n})`;return{author:r,bibtex:bibtexToString(i),id:`Frontiers-${n}_`+miniHash(t),key:s,note:l,pdfLink:e.replace(/\/full$/,"/pdf"),title:o,venue:a,year:n}},makeIHEPPaper=async t=>{let r,i;if(t.includes("/files/")){const d=t.split("/files/")[1].split("/")[0];var a="https://inspirehep.net/api/literature?q=documents.key:"+d;const e=await fetchJSON(a);if(!(r=e.hits.hits.find(e=>!!e.metadata.documents.find(e=>e.key===d))))return void warn("Could not find an Inspire HEP record for the url",t);i=r.metadata.control_number}else i=t.match(/\/literature\/(\d+)/)[1];if(i){var a=await fetchText(`https://inspirehep.net/api/literature/${i}?format=bibtex`),n=(r=r||await fetchJSON(`https://inspirehep.net/api/literature/${i}?format=json`),bibtexToObject(a));let e=n.title??r.metadata.titles[0].title;e.startsWith("{")&&e.endsWith("}")&&(e=e.slice(1,-1));var o=r.metadata.documents?.[0]?.url??t,s=flipAndAuthors(n.author),l=n.year??r.created.split("-")[0],c="IHEP-"+i,p=n.journal??"Inspire HEP",u=n.citationKey,n=n.doi??"";return{author:s,bibtex:a,id:c,key:u,note:`Published @ ${p} (${l})`,pdfLink:o,title:e,venue:p,year:l,doi:n}}warn("Could not find an Inspire HEP id for the url",t)},makePLOSPaper=async e=>{var t=e.split("?id=").last().split("&")[0],{bibtex:r,key:i,author:a,venue:n,title:o,note:s,year:l}=await fetchBibtex(e.split("/article")[0]+"/article/citation/bibtex?id="+t),c=e.split("/article")[0]+`/article/file?id=${t}&type=printable`,e=e.split("journals.plos.org/")[1].split("/")[0];return{author:flipAndAuthors(a),bibtex:r,id:`PLOS-${e}_`+miniHash(t),key:i,note:s,pdfLink:c,title:o,venue:n,year:l,doi:t}},makeRSCPaper=async e=>{var t=noParamUrl(e).split("/").last(),r=e.split("/").find(e=>"articlehtml"===e||"articlepdf"===e||"articlelanding"===e).replace("article",""),e="articlepdf"===r?e:e.replace(`/article${r}/`,"/articlepdf/");let{bibtex:i,key:a,author:n,venue:o,title:s,note:l,year:c,doi:p}=await fetchBibtex(`https://pubs.rsc.org/en/content/formatedresult?markedids=${t}&downloadtype=article&managertype=bibtex`);return{author:flipAndAuthors(n),bibtex:i,id:`RSC-${o.replaceAll(" ","")}_`+miniHash(t),key:a,note:l,pdfLink:e,title:s,venue:o,year:c,doi:p}},tryPWCMatch=async e=>{let t;var r={type:"papersWithCode",pwcPrefs:await getStorage("pwcPrefs")??{},paper:e},{url:r,note:i,venue:a,pubYear:n}=await sendMessageToBackground(r)??{};return r&&!e.codeLink?log("[PapersWithCode] Discovered a code repository:",r):log("[PapersWithCode] No code repository found"),a&&!e.venue?(log("[PapersWithCode] Found a publication venue:",a),e=bibtexToObject(e.bibtex),t=bibtexToString({...e,year:n,journal:a})):log("[PapersWithCode] No publication found"),{codeLink:r,note:i,venue:a,bibtex:t}},tryCrossRef=async e=>{try{var t="https://api.crossref.org/works?rows=1&mailto=schmidtv%40mila.quebec&select=event%2Ctitle&query.title="+encodeURI(e.title);const i=await fetch(t).then(e=>e.json());if("ok"!==i.status)return log(`[Crossref] ${t} returned `+i.message.status),{note:null};if(0===i.message.items.length)return{note:null};if(i.message.items[0].title[0].toLowerCase().replaceAll("\n"," ").replaceAll(/\s\s+/g," ")!==e.title.toLowerCase().replaceAll("\n"," ").replaceAll(/\s\s+/g," "))return{note:null};if(!i.message.items[0].event||!i.message.items[0].event.name)return{note:null};info("Found a CrossRef match");var r=i.message.items[0].event.name.trim();return{venue:r,note:`Accepted @ ${r} -- [crossref.org]`}}catch(e){return logError("[Crossref]",e),{note:null}}},tryDBLP=async e=>{try{var t,r,i,a,n=encodeURI(e.title);const o=await fetch(`https://dblp.org/search/publ/api?q=${n}&format=json`).then(e=>e.json());if(!(o.result&&o.result.hits&&o.result.hits.hit&&o.result.hits.hit.length))return{note:null};for(const s of o.result.hits.hit.sort((e,t)=>parseInt(e.info.year,10)-parseInt(t.info.year,10)))if(decodeHtml(s.info.title.toLowerCase().replaceAll("\n"," ").replaceAll(".","").replaceAll(/\s\s+/g," "))===e.title.toLowerCase().replaceAll("\n"," ").replaceAll(".","").replaceAll(/\s\s+/g," ")&&"CoRR"!==s.info.venue)return info("Found a DBLP match"),t=await fetchText(s.info.url+".bib"),r=miniHash(s.info.venue),await readJournalAbbreviations(),i=(global.journalAbbreviations[r]??s.info.venue).trim(),a=s.info.year,s.info.url,{venue:i,note:`Accepted @ ${i} ${a} -- [dblp.org]`,bibtex:t};return{note:null}}catch(e){return logError("[DBLP]",e),{note:null}}},trySemanticScholar=async t=>{try{var e=await fetchJSON(`https://api.semanticscholar.org/graph/v1/paper/search?query=${encodeURI(t.title)}&fields=title,venue,year,authors,externalIds,url&limit=50`);if(e&&e.data&&0<e.data.length)for(const s of e.data)if(miniHash(s.title)===miniHash(t.title)&&s.venue&&"arxiv"!==s.venue.toLowerCase()){info("Found a Semantic Scholar match");let e=s.venue.trim().replace(/^\d{4}/,"").trim().capitalize(!0);e.indexOf(" ")<0&&(e=e.toUpperCase());var r=(s.year+"").trim(),i=`Accepted @ ${e} (${r}) -- [semanticscholar.org]`,a=s.authors.map(e=>e.name).join(" and "),n=s.externalIds.DOI,o=bibtexToString({entryType:"article",citationKey:miniHash(s.authors[0].name.split(" ").last())+r+firstNonStopLowercase(t.title),title:t.title,author:a,journal:e,year:r,doi:n,bibSource:"Semantic Scholar "+s.url});return{venue:e,note:i,bibtex:o}}}catch(e){logError("[SemanticScholar]",e)}},tryGoogleScholar=async e=>{return await sendMessageToBackground({type:"google-scholar",paper:e})},tryPreprintMatch=async(e,t=!1)=>{let r,i,a,n,o={},s=["DBLP","SemanticScholar","CrossRef","GoogleScholar"],l=[silentPromiseTimeout(tryGoogleScholar(e)),silentPromiseTimeout(trySemanticScholar(e)),silentPromiseTimeout(tryCrossRef(e)),silentPromiseTimeout(tryDBLP(e))];t&&(l.push(silentPromiseTimeout(tryPWCMatch(e))),s.push("PapersWithCode"));for(var[c,p]of Object.entries(s)){if(o[p]=await l[c],{note:r,venue:i,bibtex:a}=o[p]??{},r)break;log(`[${p}] No publication found`)}return t&&(t="PapersWithCode",o.hasOwnProperty(t)||(o[t]=await l[t]),o[t].codeLink&&!e.codeLink&&(n=o[t].codeLink)),{note:r,venue:i,bibtex:a,code:n}},initPaper=async e=>{e.note||(e.note=""),e.md=`[${e.title}](${e.pdfLink})`,e.tags=[],e.codeLink="",e.favorite=!1,e.favoriteDate="",e.addDate=(new Date).toJSON(),e.lastOpenDate=e.addDate,e.count=1,e.code={};for(const t in e)e.hasOwnProperty(t)&&"string"==typeof e[t]&&(e[t]=e[t].trim());return e=await autoTagPaper(e),validatePaper(e),e},autoTagPaper=async r=>{try{var e,i,a=await getStorage("autoTags");if(!a||!a.length)return r;let t=new Set;for(const n of a)n.tags?.length&&(n.title||n.author)&&(e=!n.title||new RegExp(n.title,"i").test(r.title),i=!n.author||new RegExp(n.author,"i").test(r.author),e&&i&&n.tags.forEach(e=>t.add(e)));return r.tags=[...t].sort(),r.tags.length&&log("Automatically adding tags:",r.tags),r}catch(e){return log("Error auto-tagging:",e),log("Paper:",r),r}},makePaper=async(e,t)=>{let r;if(e.arxiv)(r=await makeArxivPaper(t))&&(r.source="arxiv");else if(e.neurips)(r=await makeNeuripsPaper(t))&&(r.source="neurips");else if(e.cvf)(r=await makeCVFPaper(t))&&(r.source="cvf");else if(e.openreview)(r=await makeOpenReviewPaper(t))&&(r.source="openreview");else if(e.biorxiv)(r=await makeBioRxivPaper(t))&&(r.source="biorxiv");else if(e.pmlr)(r=await makePMLRPaper(t))&&(r.source="pmlr");else if(e.acl)(r=await makeACLPaper(t))&&(r.source="acl");else if(e.pnas)(r=await makePNASPaper(t))&&(r.source="pnas");else if(e.nature)(r=await makeNaturePaper(t))&&(r.source="nature");else if(e.acs)(r=await makeACSPaper(t))&&(r.source="acs");else if(e.iop)(r=await makeIOPPaper(t))&&(r.source="iop");else if(e.jmlr)(r=await makeJMLRPaper(t))&&(r.source="jmlr");else if(e.pmc)(r=await makePMCPaper(t))&&(r.source="pmc");else if(e.ijcai)(r=await makeIJCAIPaper(t))&&(r.source="ijcai");else if(e.acm)(r=await makeACMPaper(t))&&(r.source="acm");else if(e.ieee)(r=await makeIEEEPaper(t))&&(r.source="ieee");else if(e.springer)(r=await makeSpringerPaper(t))&&(r.source="springer");else if(e.aps)(r=await makeAPSPaper(t))&&(r.source="aps");else if(e.wiley)(r=await makeWileyPaper(t))&&(r.source="wiley");else if(e.sciencedirect)(r=await makeScienceDirectPaper(t))&&(r.source="sciencedirect");else if(e.science)(r=await makeSciencePaper(t))&&(r.source="science");else if(e.frontiers)(r=await makeFrontiersPaper(t))&&(r.source="frontiers");else if(e.ihep)(r=await makeIHEPPaper(t))&&(r.source="ihep");else if(e.plos)(r=await makePLOSPaper(t))&&(r.source="plos");else{if(!e.rsc)throw new Error("Unknown paper source: "+JSON.stringify({is:e,url:t}));(r=await makeRSCPaper(t))&&(r.source="rsc")}if(void 0!==r)return initPaper(r)},findFuzzyPaperMatch=(e,t)=>{t=miniHash(t.title);if(e.hasOwnProperty(t)){const r=e[t];e=r.find(t=>!global.preprintSources.some(e=>t.toLowerCase().startsWith(e)));return e?e:r[0]}return null};"undefined"!=typeof module&&null!=module.exports&&(dummyModule=module,dummyModule.exports={autoTagPaper:autoTagPaper,decodeHtml:decodeHtml,fetchArxivXML:fetchArxivXML,fetchCrossRefDataForDoi:fetchCrossRefDataForDoi,fetchCvfHTML:fetchCvfHTML,fetchDom:fetchDom,getOpenReviewForumJSON:getOpenReviewForumJSON,getOpenReviewNoteJSON:getOpenReviewNoteJSON,fetchSemanticsScholarDataForDoi:fetchSemanticsScholarDataForDoi,fetchText:fetchText,findACLValue:findACLValue,findFuzzyPaperMatch:findFuzzyPaperMatch,flipAndAuthors:flipAndAuthors,flipAuthor:flipAuthor,initPaper:initPaper,makeACLPaper:makeACLPaper,makeACMPaper:makeACMPaper,makeACSPaper:makeACSPaper,makeAPSPaper:makeAPSPaper,makeArxivPaper:makeArxivPaper,makeBioRxivPaper:makeBioRxivPaper,makeCVFPaper:makeCVFPaper,makeIEEEPaper:makeIEEEPaper,makeIJCAIPaper:makeIJCAIPaper,makeIOPPaper:makeIOPPaper,makeJMLRPaper:makeJMLRPaper,makeNaturePaper:makeNaturePaper,makeNeuripsPaper:makeNeuripsPaper,makeOpenReviewBibTex:makeOpenReviewBibTex,makeOpenReviewPaper:makeOpenReviewPaper,makePaper:makePaper,makePMCPaper:makePMCPaper,makePMLRPaper:makePMLRPaper,makePNASPaper:makePNASPaper,makePubMedPaper:makePubMedPaper,makePLOSPaper:makePLOSPaper,makeSpringerPaper:makeSpringerPaper,makeWileyPaper:makeWileyPaper,tryCrossRef:tryCrossRef,tryDBLP:tryDBLP,tryPreprintMatch:tryPreprintMatch,tryPWCMatch:tryPWCMatch,trySemanticScholar:trySemanticScholar});