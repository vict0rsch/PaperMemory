!function a(i,o,n){function s(t,e){if(!o[t]){if(!i[t]){var r="function"==typeof require&&require;if(!e&&r)return r(t,!0);if(l)return l(t,!0);throw(e=new Error("Cannot find module '"+t+"'")).code="MODULE_NOT_FOUND",e}r=o[t]={exports:{}},i[t][0].call(r.exports,function(e){return s(i[t][1][e]||e)},r,r.exports,a,i,o,n)}return o[t].exports}for(var l="function"==typeof require&&require,e=0;e<n.length;e++)s(n[e]);return s}({1:[function(e,t,r){var a,i,t=t.exports={};function o(){throw new Error("setTimeout has not been defined")}function n(){throw new Error("clearTimeout has not been defined")}try{a="function"==typeof setTimeout?setTimeout:o}catch(e){a=o}try{i="function"==typeof clearTimeout?clearTimeout:n}catch(e){i=n}function s(t){if(a===setTimeout)return setTimeout(t,0);if((a===o||!a)&&setTimeout)return(a=setTimeout)(t,0);try{return a(t,0)}catch(e){try{return a.call(null,t,0)}catch(e){return a.call(this,t,0)}}}var l,p=[],c=!1,d=-1;function u(){c&&l&&(c=!1,l.length?p=l.concat(p):d=-1,p.length)&&h()}function h(){if(!c){for(var e=s(u),t=(c=!0,p.length);t;){for(l=p,p=[];++d<t;)l&&l[d].run();d=-1,t=p.length}l=null,c=!1,!function(t){if(i===clearTimeout)return clearTimeout(t);if((i===n||!i)&&clearTimeout)return(i=clearTimeout)(t);try{i(t)}catch(e){try{return i.call(null,t)}catch(e){return i.call(this,t)}}}(e)}}function f(e,t){this.fun=e,this.array=t}function m(){}t.nextTick=function(e){var t=new Array(arguments.length-1);if(1<arguments.length)for(var r=1;r<arguments.length;r++)t[r-1]=arguments[r];p.push(new f(e,t)),1!==p.length||c||s(h)},f.prototype.run=function(){this.fun.apply(null,this.array)},t.title="browser",t.browser=!0,t.env={},t.argv=[],t.version="",t.versions={},t.on=m,t.addListener=m,t.once=m,t.off=m,t.removeListener=m,t.removeAllListeners=m,t.emit=m,t.prependListener=m,t.prependOnceListener=m,t.listeners=function(e){return[]},t.binding=function(e){throw new Error("process.binding is not supported")},t.cwd=function(){return"/"},t.chdir=function(e){throw new Error("process.chdir is not supported")},t.umask=function(){return 0}},{}],2:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});e="octokit-endpoint.js/9.0.4 "+(r.endpoint=void 0,e("universal-user-agent").getUserAgent)();function s(t,r){const a=Object.assign({},t);return Object.keys(r).forEach(e=>{(function(e){var t;if("object"==typeof e&&null!==e&&"[object Object]"===Object.prototype.toString.call(e))return null===(t=Object.getPrototypeOf(e))||"function"==typeof(t=Object.prototype.hasOwnProperty.call(t,"constructor")&&t.constructor)&&t instanceof t&&Function.prototype.call(t)===Function.prototype.call(e)})(r[e])&&e in t?a[e]=s(t[e],r[e]):Object.assign(a,{[e]:r[e]})}),a}function l(e){for(const t in e)void 0===e[t]&&delete e[t]}function a(e,t,r){var a,i,o;(r="string"==typeof t?([a,i]=t.split(" "),Object.assign(i?{method:a,url:i}:{url:a},r)):Object.assign({},t)).headers=(o=r.headers)?Object.keys(o).reduce((e,t)=>(e[t.toLowerCase()]=o[t],e),{}):{},l(r),l(r.headers);const n=s(e||{},r);return"/graphql"===r.url&&(e&&e.mediaType.previews?.length&&(n.mediaType.previews=e.mediaType.previews.filter(e=>!n.mediaType.previews.includes(e)).concat(n.mediaType.previews)),n.mediaType.previews=(n.mediaType.previews||[]).map(e=>e.replace(/-preview/,""))),n}var d=/\{[^}]+\}/g;function u(e){return e.replace(/^\W+|\W+$/g,"").split(/,/)}function h(e,t){var r={__proto__:null};for(const a of Object.keys(e))-1===t.indexOf(a)&&(r[a]=e[a]);return r}function n(e){return e.split(/(%[0-9A-Fa-f]{2})/g).map(function(e){return e=/%[0-9A-Fa-f]/.test(e)?e:encodeURI(e).replace(/%5B/g,"[").replace(/%5D/g,"]")}).join("")}function p(e){return encodeURIComponent(e).replace(/[!'()*]/g,function(e){return"%"+e.charCodeAt(0).toString(16).toUpperCase()})}function c(e,t,r){return t=("+"===e||"#"===e?n:p)(t),r?p(r)+"="+t:t}function f(e){return null!=e}function m(e){return";"===e||"&"===e||"?"===e}function g(e){return{expand:function(e,i){var o=["+","#",".","/",";","?","&"];return"/"===(e=e.replace(/\{([^\{\}]+)\}|([^\{\}]+)/g,function(e,r,t){if(r){let t="";const a=[];return-1!==o.indexOf(r.charAt(0))&&(t=r.charAt(0),r=r.substr(1)),r.split(/,/g).forEach(function(e){e=/([^:\*]*)(?::(\d+)|(\*))?/.exec(e);a.push(function(e,t,r,a){var i=e[r],o=[];if(f(i)&&""!==i)if("string"==typeof i||"number"==typeof i||"boolean"==typeof i)i=i.toString(),a&&"*"!==a&&(i=i.substring(0,parseInt(a,10))),o.push(c(t,i,m(t)?r:""));else if("*"===a)Array.isArray(i)?i.filter(f).forEach(function(e){o.push(c(t,e,m(t)?r:""))}):Object.keys(i).forEach(function(e){f(i[e])&&o.push(c(t,i[e],e))});else{const n=[];Array.isArray(i)?i.filter(f).forEach(function(e){n.push(c(t,e))}):Object.keys(i).forEach(function(e){f(i[e])&&(n.push(p(e)),n.push(c(t,i[e].toString())))}),m(t)?o.push(p(r)+"="+n.join(",")):0!==n.length&&o.push(n.join(","))}else";"===t?f(i)&&o.push(p(r)):""!==i||"&"!==t&&"?"!==t?""===i&&o.push(""):o.push(p(r)+"=");return o}(i,t,e[1],e[2]||e[3]))}),t&&"+"!==t?(r=",","?"===t?r="&":"#"!==t&&(r=t),(0!==a.length?t:"")+a.join(r)):a.join(",")}return n(t)}))?e:e.replace(/\/$/,"")}.bind(null,e)}}function i(t){var e=t.method.toUpperCase();let r=(t.url||"/").replace(/:([a-z]\w+)/g,"{$1}");var a=Object.assign({},t.headers);let i;var o=h(t,["method","baseUrl","url","headers","request","mediaType"]);const n=(c=(c=r).match(d))?c.map(u).reduce((e,t)=>e.concat(t),[]):[];r=g(r).expand(o),/^http/.test(r)||(r=t.baseUrl+r);var s,l,p,c=h(o,Object.keys(t).filter(e=>n.includes(e)).concat("baseUrl"));return/application\/octet-stream/i.test(a.accept)||(t.mediaType.format&&(a.accept=a.accept.split(/,/).map(e=>e.replace(/application\/vnd(\.\w+)(\.v3)?(\.\w+)?(\+json)?$/,"application/vnd$1$2."+t.mediaType.format)).join(",")),r.endsWith("/graphql")&&t.mediaType.previews?.length&&(o=a.accept.match(/[\w-]+(?=-preview)/g)||[],a.accept=o.concat(t.mediaType.previews).map(e=>{return`application/vnd.github.${e}-preview`+(t.mediaType.format?"."+t.mediaType.format:"+json")}).join(","))),["GET","HEAD"].includes(e)?r=(o=r,s=c,l=/\?/.test(o)?"&":"?",0===(p=Object.keys(s)).length?o:o+l+p.map(e=>"q"===e?"q="+s.q.split("+").map(encodeURIComponent).join("+"):e+"="+encodeURIComponent(s[e])).join("&")):"data"in c?i=c.data:Object.keys(c).length&&(i=c),a["content-type"]||void 0===i||(a["content-type"]="application/json; charset=utf-8"),["PATCH","PUT"].includes(e)&&void 0===i&&(i=""),Object.assign({method:e,url:r,headers:a},void 0!==i?{body:i}:null,t.request?{request:t.request}:null)}function o(e,t){e=a(e,t),t=function(e,t,r){return i(a(e,t,r))}.bind(null,e);return Object.assign(t,{DEFAULTS:e,defaults:o.bind(null,e),merge:a.bind(null,e),parse:i})}r.endpoint=o(null,{method:"GET",baseUrl:"https://api.github.com",headers:{accept:"application/vnd.github.v3+json","user-agent":e},mediaType:{format:""}})},{"universal-user-agent":7}],3:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.RequestError=void 0;var i=e("deprecation"),e=(e=e("once"))&&e.__esModule?e:{default:e};var o=(0,e.default)(e=>console.warn(e)),n=(0,e.default)(e=>console.warn(e)),e=class extends Error{constructor(e,t,r){super(e),Error.captureStackTrace&&Error.captureStackTrace(this,this.constructor),this.name="HttpError",this.status=t;let a;"headers"in r&&void 0!==r.headers&&(a=r.headers),"response"in r&&(this.response=r.response,a=r.response.headers);e=Object.assign({},r.request);r.request.headers.authorization&&(e.headers=Object.assign({},r.request.headers,{authorization:r.request.headers.authorization.replace(/ .*$/," [REDACTED]")})),e.url=e.url.replace(/\bclient_secret=\w+/g,"client_secret=[REDACTED]").replace(/\baccess_token=\w+/g,"access_token=[REDACTED]"),this.request=e,Object.defineProperty(this,"code",{get(){return o(new i.Deprecation("[@octokit/request-error] `error.code` is deprecated, use `error.status`.")),t}}),Object.defineProperty(this,"headers",{get(){return n(new i.Deprecation("[@octokit/request-error] `error.headers` is deprecated, use `error.response.headers`.")),a||{}}})}};r.RequestError=e},{deprecation:5,once:6}],4:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.request=void 0;var a=e("@octokit/endpoint"),i=e("universal-user-agent"),p=e("@octokit/request-error");function o(a){const i=a.request&&a.request.log?a.request.log:console,o=!1!==a.request?.parseSuccessResponseBody;(function(e){var t;if("object"==typeof e&&null!==e&&"[object Object]"===Object.prototype.toString.call(e))return null===(t=Object.getPrototypeOf(e))||"function"==typeof(t=Object.prototype.hasOwnProperty.call(t,"constructor")&&t.constructor)&&t instanceof t&&Function.prototype.call(t)===Function.prototype.call(e)}(a.body)||Array.isArray(a.body))&&(a.body=JSON.stringify(a.body));let n={},s,l,e=globalThis["fetch"];if(e=a.request?.fetch?a.request.fetch:e)return e(a.url,{method:a.method,body:a.body,headers:a.headers,signal:a.request?.signal,...a.body&&{duplex:"half"}}).then(async e=>{l=e.url,s=e.status;for(const r of e.headers)n[r[0]]=r[1];var t;if("deprecation"in n&&(t=(t=n.link&&n.link.match(/<([^>]+)>; rel="deprecation"/))&&t.pop(),i.warn(`[@octokit/request] "${a.method} ${a.url}" is deprecated. It is scheduled to be removed on `+n.sunset+(t?". See "+t:""))),204!==s&&205!==s){if("HEAD"===a.method){if(s<400)return;throw new p.RequestError(e.statusText,s,{response:{url:l,status:s,headers:n,data:void 0},request:a})}if(304===s)throw new p.RequestError("Not modified",s,{response:{url:l,status:s,headers:n,data:await c(e)},request:a});if(400<=s)throw t=await c(e),new p.RequestError(function(e){if("string"==typeof e)return e;if("message"in e)return Array.isArray(e.errors)?e.message+": "+e.errors.map(JSON.stringify).join(", "):e.message;return"Unknown error: "+JSON.stringify(e)}(t),s,{response:{url:l,status:s,headers:n,data:t},request:a});return o?await c(e):e.body}}).then(e=>({status:s,url:l,headers:n,data:e})).catch(e=>{if(e instanceof p.RequestError)throw e;if("AbortError"===e.name)throw e;let t=e.message;throw"TypeError"===e.name&&"cause"in e&&(e.cause instanceof Error?t=e.cause.message:"string"==typeof e.cause&&(t=e.cause)),new p.RequestError(t,500,{request:a})});throw new Error("fetch is not set. Please pass a fetch implementation as new Octokit({ request: { fetch }}). Learn more at https://github.com/octokit/octokit.js/#fetch-missing")}async function c(e){var t=e.headers.get("content-type");return/application\/json/.test(t)?e.json().catch(()=>e.text()).catch(()=>""):!t||/^text\/|charset=utf-8$/.test(t)?e.text():e.arrayBuffer()}function n(e,t){const r=e.defaults(t);return Object.assign(function(e,t){e=r.merge(e,t);return e.request&&e.request.hook?(t=(e,t)=>o(r.parse(r.merge(e,t))),Object.assign(t,{endpoint:r,defaults:n.bind(null,r)}),e.request.hook(t,e)):o(r.parse(e))},{endpoint:r,defaults:n.bind(null,r)})}r.request=n(a.endpoint,{headers:{"user-agent":"octokit-request.js/8.1.6 "+(0,i.getUserAgent)()}})},{"@octokit/endpoint":2,"@octokit/request-error":3,"universal-user-agent":7}],5:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.Deprecation=void 0;class a extends Error{constructor(e){super(e),Error.captureStackTrace&&Error.captureStackTrace(this,this.constructor),this.name="Deprecation"}}r.Deprecation=a},{}],6:[function(e,t,r){e=e("wrappy");function a(e){function t(){return t.called?t.value:(t.called=!0,t.value=e.apply(this,arguments))}return t.called=!1,t}function i(e){function t(){if(t.called)throw new Error(t.onceError);return t.called=!0,t.value=e.apply(this,arguments)}var r=e.name||"Function wrapped with `once`";return t.onceError=r+" shouldn't be called more than once",t.called=!1,t}t.exports=e(a),t.exports.strict=e(i),a.proto=a(function(){Object.defineProperty(Function.prototype,"once",{value:function(){return a(this)},configurable:!0}),Object.defineProperty(Function.prototype,"onceStrict",{value:function(){return i(this)},configurable:!0})})},{wrappy:8}],7:[function(e,t,r){!function(e){!function(){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.getUserAgent=function(){if("object"==typeof navigator&&"userAgent"in navigator)return navigator.userAgent;return"object"!=typeof e||void 0===e.version?"<environment undetectable>":`Node.js/${e.version.substr(1)} (${e.platform}; ${e.arch})`}}.call(this)}.call(this,e("_process"))},{_process:1}],8:[function(e,t,r){t.exports=function e(i,t){if(i&&t)return e(i)(t);if("function"!=typeof i)throw new TypeError("need wrapper function");Object.keys(i).forEach(function(e){r[e]=i[e]});return r;function r(){for(var e=new Array(arguments.length),t=0;t<e.length;t++)e[t]=arguments[t];var r=i.apply(this,e),a=e[e.length-1];return"function"==typeof r&&r!==a&&Object.keys(a).forEach(function(e){r[e]=a[e]}),r}}},{}],9:[function(r,e,t){!function(t){!function(){var e=r("@octokit/request")["request"];"undefined"==typeof window?window=t:t=window,t.octokitRequest=e}.call(this)}.call(this,void 0!==global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"@octokit/request":4}]},{},[9]);const findEl=(e,t)=>void 0===t?"string"==typeof e?document.getElementById(e):e:(t.startsWith(".")||(t="."+t),findEl("memory-container--"+e).querySelector(t)),fadeOut=(e,t=250,r=()=>{})=>{(e=findEl(e)).style.transition=t+"ms",e.style.opacity=0,setTimeout(()=>{e.style.display="none",r()},t)},fadeIn=(e,t="block",r=250,a=()=>{})=>{(e=findEl(e)).style.opacity=0,"none"===e.style.display&&(e.style.display=t),setTimeout(()=>{e.style.transition=r+"ms",e.style.opacity=1,setTimeout(()=>{a()},r)},0)},val=(e,t)=>{if((e="string"==typeof e?findEl(e):e)instanceof HTMLInputElement&&"checkbox"===e.type){if(void 0===t)return e.checked;e.checked=t}if(void 0===t)return e?e.value:"";e&&(e.value=t)},showId=(e,t="block")=>{(e="string"==typeof e?findEl(e):e)&&(e.style.display=t)},hideId=e=>{(e="string"==typeof e?findEl(e):e)&&(e.style.display="none")},setTextId=(e,t)=>{(e="string"==typeof e?findEl(e):e)&&(e.innerText=t)},setHTML=(e,t)=>{(e="string"==typeof e?findEl(e):e)&&(e.innerHTML=t)},dispatch=(e,t)=>{if("string"==typeof e&&(e=findEl(e)),"string"==typeof t){if("focus"===t)return void e.focus();if("blur"===t)return void e.blur();t=new Event(t)}e&&e.dispatchEvent(t)},hasClass=(e,t)=>{let r;if(r="string"==typeof e?findEl(e):e)return r.classList.contains(t)},addClass=(e,t)=>{let r;(r="string"==typeof e?findEl(e):e)&&r.classList.add(t)},removeClass=(e,t)=>{let r;(r="string"==typeof e?findEl(e):e)&&r.classList.remove(t)},addListener=(e,t,r)=>{(e="string"==typeof e?findEl(e):e)&&e.addEventListener(t,r)},setPlaceholder=(e,t)=>{(e="string"==typeof e?findEl(e):e)&&void 0!==e.placeholder&&(e.placeholder=t)},style=(e,t,r)=>{if(e="string"==typeof e?findEl(e):e){if(void 0===r)return e.style[t];e.style[t]=r}},disable=(e,t=!0)=>{(e="string"==typeof e?findEl(e):e)&&(e.disabled=t)},slideUp=(e,t=250,r=()=>{})=>{(e="string"==typeof e?findEl(e):e)&&(e.style.transitionProperty="height, margin, padding",e.style.transitionDuration=t+"ms",e.style.height=e.offsetHeight+"px",e.offsetHeight,e.style.overflow="hidden",e.style.height=0,e.style.paddingTop=0,e.style.paddingBottom=0,e.style.marginTop=0,e.style.marginBottom=0,window.setTimeout(()=>{e.style.display="none",e.style.removeProperty("height"),e.style.removeProperty("padding-top"),e.style.removeProperty("padding-bottom"),e.style.removeProperty("margin-top"),e.style.removeProperty("margin-bottom"),e.style.removeProperty("overflow"),e.style.removeProperty("transition-duration"),e.style.removeProperty("transition-property"),e.style.removeProperty("box-sizing"),r()},t))},slideDown=(t,r=500,a=()=>{})=>{if(t="string"==typeof t?findEl(t):t){t.style.removeProperty("display");let e=window.getComputedStyle(t).display;"none"===e&&(e="block"),t.style.display=e;var i=t.offsetHeight;t.style.overflow="hidden",t.style.height=0,t.style.paddingTop=0,t.style.paddingBottom=0,t.style.marginTop=0,t.style.marginBottom=0,t.offsetHeight,t.style.transitionProperty="height, margin, padding",t.style.transitionDuration=r+"ms",t.style.height=i+"px",t.style.removeProperty("padding-top"),t.style.removeProperty("padding-bottom"),t.style.removeProperty("margin-top"),t.style.removeProperty("margin-bottom"),window.setTimeout(()=>{t.style.removeProperty("height"),t.style.removeProperty("overflow"),t.style.removeProperty("transition-duration"),t.style.removeProperty("transition-property"),a()},r)}},queryAll=(e,t)=>t?[...t.querySelectorAll(e)]:[...document.querySelectorAll(e)],createElementFromHTML=e=>{var t=document.createElement("div");return t.innerHTML=e.trim(),t.firstChild},addEventToClass=(e,t,r)=>{e.startsWith(".")||(e="."+e),document.querySelectorAll(e).forEach(e=>{e.addEventListener(t,r)})};"undefined"!=typeof module&&null!=module.exports&&((dummyModule=module).exports={findEl:findEl,fadeOut:fadeOut,fadeIn:fadeIn,val:val,showId:showId,hideId:hideId,setTextId:setTextId,setHTML:setHTML,dispatch:dispatch,hasClass:hasClass,addClass:addClass,removeClass:removeClass,addListener:addListener,setPlaceholder:setPlaceholder,style:style,disable:disable,slideUp:slideUp,slideDown:slideDown,queryAll:queryAll,addEventToClass:addEventToClass,createElementFromHTML:createElementFromHTML}),Object.defineProperty(Array.prototype,"last",{value:function(e=0){return this.reverse()[e]}}),Object.defineProperty(String.prototype,"capitalize",{value:function(e=!1){return e?this.split(" ").map(e=>e.capitalize()).join(" "):this.charAt(0).toUpperCase()+this.slice(1).toLowerCase()}});var dummyModule,global={};function _min(e,t,r,a,i){return e<t||r<t?r<e?r+1:e+1:a===i?t:t+1}"undefined"!=typeof window&&(global=window),chrome?.runtime?.setUninstallURL&&chrome?.runtime?.setUninstallURL("https://forms.gle/1JSV8PcxQugRmsd46"),global.state={currentMemoryPagination:0,dataVersion:0,deleted:{},files:{},ignoreSources:{},lastRefresh:new Date,memoryIsOpen:!1,memoryItemsPerPage:25,menuIsOpen:!1,papers:{},papersList:[],papersReady:!1,paperTags:new Set,pdfTitleFn:null,prefs:{},showFavorites:!1,sortedPapers:[],sortKey:"",timerIdMap:new WeakMap,titleHashToIds:{},titleFunction:null,urlHashToId:{}},global.state.titleFunction=e=>{let t=e.title.replaceAll("\n","")+" - "+e.id;return t=t.replaceAll(":"," ").replace(/\\s\\s+/g," ")},global.descendingSortKeys=["addDate","count","lastOpenDate","favoriteDate","year"],global.select2Options={placeholder:"Tag paper",maximumSelectionLength:5,allowClear:!0,tags:!0,tokenSeparators:[","," "]},global.prefsCheckNames=["checkBib","checkMd","checkDownload","checkPdfTitle","checkFeedback","checkDarkMode","checkDirectOpen","checkStore","checkScirate","checkVanity","checkAr5iv","checkHuggingface","checkOfficialRepos","checkPreferPdf","checkPdfOnly","checkNoAuto","checkMdYearVenue","checkEnterLocalPdf","checkWebsiteParsing"],global.prefsCheckDefaultFalse=["checkDarkMode","checkStore","checkScirate","checkVanity","checkAr5iv","checkHuggingface","checkOfficialRepos","checkPdfOnly","checkNoAuto","checkMdYearVenue"],global.prefsStorageKeys=[...global.prefsCheckNames,"pdfTitleFn"],global.sourceExtras={springer:{types:["chapter","article","book","referenceworkentry"]}},global.preprintSources=["arxiv","biorxiv"],global.knownPaperPages={acl:{patterns:["aclanthology.org/"],name:"ACL Anthology (Association for Computational Linguistics)"},acm:{patterns:["dl.acm.org/doi/"],name:"ACM (Association for Computing Machinery)"},aps:{patterns:[e=>Boolean(e.match(/journals\.aps\.org\/\w+\/(abstract|pdf)\//g))],name:"APS (American Physical Society)"},acs:{patterns:["pubs.acs.org/doi/"],name:"ACS (American Chemical Society)"},arxiv:{patterns:["arxiv.org/abs/","arxiv.org/pdf/","scirate.com/arxiv/","ar5iv.labs.arxiv.org/html/","arxiv-vanity.com/papers/",e=>e.includes("huggingface.co/papers/")&&e.split("huggingface.co/papers/")[1].match(/\d+\.\d+/)],name:"ArXiv"},biorxiv:{patterns:["biorxiv.org/content"],name:"BioRxiv"},cvf:{patterns:["openaccess.thecvf.com/content"],name:"CVF (Computer Vision Foundation)"},frontiers:{patterns:["frontiersin.org/articles"],name:"Frontiers"},hal:{patterns:[e=>/hal\.science\/\w+-\d+(v\d+)?(\/document)?$/gi.test(e)],name:"HAL"},ihep:{patterns:["inspirehep.net/literature/","inspirehep.net/files/"],name:"IHEP (INSPIRE - High Energy Physics)"},ijcai:{patterns:[e=>/ijcai\.org\/proceedings\/\d{4}\/\d+/gi.test(e)],name:"IJCAI (International Joint Conferences on Artificial Intelligence)"},ieee:{patterns:["ieeexplore.ieee.org/document/","ieeexplore.ieee.org/abstract/document/","ieeexplore.ieee.org/stamp/stamp.jsp?tp=&arnumber="],name:"IEEE (Institute of Electrical and Electronics Engineers)"},iop:{patterns:["iopscience.iop.org/article/"],name:"IOP (Institute Of Physics)"},jmlr:{patterns:[e=>e.includes("jmlr.org/papers/v")&&!e.endsWith("/")],name:"JMLR (Journal of Machine Learning Research)"},mdpi:{patterns:[e=>/mdpi\.com\/\d+-.+/gi.test(e)],name:"MDPI (Multidisciplinary Digital Publishing Institute)"},nature:{patterns:["nature.com/articles/"],name:"Nature"},neurips:{patterns:["neurips.cc/paper/","neurips.cc/paper_files/paper/","nips.cc/paper/"],name:"NeurIPS (Neural Information Processing Systems)"},openreview:{patterns:["openreview.net/forum","openreview.net/pdf","openreview.net/attachment"],name:"OpenReview"},oup:{patterns:[e=>0<=(e.split("https://academic.oup.com/")[1]?.split("/")[1]?.indexOf("article")??-1)],name:"OUP (Oxford University Press)"},plos:{patterns:[e=>/journals\.plos\.org\/.+\/article.+id=/gi.test(e)],name:"PLOS (Public Library of Science)"},pmc:{patterns:["ncbi.nlm.nih.gov/pmc/articles/PMC"],name:"PMC (PubMed Central)"},pmlr:{patterns:["proceedings.mlr.press/"],name:"PMLR (Proceedings of Machine Learning Research)"},pnas:{patterns:["pnas.org/content/","pnas.org/doi/"],name:"PNAS (Proceedings of the National Academy of Sciences)"},rsc:{patterns:["pubs.rsc.org/en/content/article"],name:"RSC (Royal Society of Chemistry)"},science:{patterns:[e=>Boolean(e.match(/science\.org\/doi\/?(abs|full|pdf|epdf)?\//g))],name:"Science"},sciencedirect:{patterns:["sciencedirect.com/science/article/pii/","sciencedirect.com/science/article/abs/pii/","reader.elsevier.com/reader/sd/pii/"],name:"ScienceDirect"},springer:{patterns:[...global.sourceExtras.springer.types.map(e=>`link.springer.com/${e}/`),"link.springer.com/content/pdf/"],name:"Springer"},website:{patterns:[],name:"Manually parsed website"},wiley:{patterns:[e=>Boolean(e.match(/onlinelibrary\.wiley\.com\/doi\/(abs|full|pdf|epdf)\//g))],name:"Wiley"}},global.overrideORConfs={"robot-learning":"CoRL",ijcai:"IJCAI"},global.overridePMLRConfs={"Conference on Learning Theory":"CoLT","International Conference on Machine Learning":"ICML","Conference on Uncertainty in Artificial Intelligence":"UAI","Conference on Robot Learning":"CoRL","International Conference on Artificial Intelligence and Statistics":"AISTATS","International Conference on Algorithmic Learning Theory":"ALT"},global.overrideDBLPVenues={"J. Mach. Learn. Res.":"JMLR"},global.consolHeaderStyle="@import url('https://fonts.googleapis.com/css2?family=Fira+Code:wght@300');font-family:'Fira Code' monospace;font-size:1rem;font-weight:300;display:inline-block;border:2px solid #A41716;border-radius: 4px;padding: 12px; margin: 12px;",global.fuzzyTitleMatchMinDist=4,global.storeReadme=`/!\\ Warning: This folder has been created automatically by your PaperMemory browser extension.
 /!\\ It has to stay in your downloads for PaperMemory to be able to access your papers.
 /!\\ To be able to open files from this folder instead of re-downloading them, PaperMemory will match their titles and downloaded urls.
 /!\\ If you change the default title function in the Advanced Options and do not include a paper's title in the file name, PaperMemory may not be able to open the file and will instead open the pdf url.
 /!\\ Unfortunately, PaperMemory cannot detect papers that have not been *downloaded there* so putting papers in this folder will not make them discoverable by the \`browser.downloads\` API PaperMemory uses.`,global.englishStopWords=new Set(["i","me","my","myself","we","our","ours","ourselves","you","your","yours","yourself","yourselves","he","him","his","himself","she","her","hers","herself","it","its","itself","they","them","their","theirs","themselves","what","which","who","whom","this","that","these","those","am","is","are","was","were","be","been","being","have","has","had","having","do","does","did","doing","a","an","the","and","but","if","or","because","as","until","while","of","at","by","for","with","about","against","between","into","through","during","before","after","above","below","to","from","up","down","in","out","on","off","over","under","again","further","then","once","here","there","when","where","why","how","all","any","both","each","few","more","most","other","some","such","no","nor","not","only","own","same","so","than","too","very","s","t","can","will","just","don","should","now"]),global.journalAbbreviations=null,"undefined"!=typeof module&&null!=module.exports&&((dummyModule=module).exports={state:global.state,descendingSortKeys:global.descendingSortKeys,select2Options:global.select2Options,prefsCheckNames:global.prefsCheckNames,prefsCheckDefaultFalse:global.prefsCheckDefaultFalse,prefsStorageKeys:global.prefsStorageKeys,sourceExtras:global.sourceExtras,preprintSources:global.preprintSources,knownPaperPages:global.knownPaperPages,overrideORConfs:global.overrideORConfs,overridePMLRConfs:global.overridePMLRConfs,overrideDBLPVenues:global.overrideDBLPVenues,fuzzyTitleMatchMinDist:global.fuzzyTitleMatchMinDist,storeReadme:global.storeReadme,englishStopWords:global.englishStopWords,journalAbbreviations:global.journalAbbreviations,consolHeaderStyle:global.consolHeaderStyle});const levenshtein=(e,t)=>{if(e===t)return 0;e.length>t.length&&(r=e,e=t,t=r);for(var r,a=e.length,i=t.length;0<a&&e.charCodeAt(a-1)===t.charCodeAt(i-1);)a--,i--;for(var o=0;o<a&&e.charCodeAt(o)===t.charCodeAt(o);)o++;if(i-=o,0===(a-=o)||i<3)return i;for(var n,s,l,p,c,d,u,h,f,m,g,y=0,b=[],v=0;v<a;v++)b.push(v+1),b.push(e.charCodeAt(o+v));for(var w=b.length-1;y<i-3;)for(h=t.charCodeAt(o+(n=y)),f=t.charCodeAt(o+(s=y+1)),m=t.charCodeAt(o+(l=y+2)),g=t.charCodeAt(o+(p=y+3)),c=y+=4,v=0;v<w;v+=2)n=_min(d=b[v],n,s,h,u=b[v+1]),s=_min(n,s,l,f,u),l=_min(s,l,p,m,u),c=_min(l,p,c,g,u),b[v]=c,p=l,l=s,s=n,n=d;for(;y<i;)for(h=t.charCodeAt(o+(n=y)),c=++y,v=0;v<w;v+=2)b[v]=c=_min(d=b[v],n,c,h,b[v+1]),n=d;return c};function BibtexParser(){this.months=["jan","feb","mar","apr","may","jun","jul","aug","sep","oct","nov","dec"],this.notKey=[",","{","}"," ","="],this.pos=0,this.input="",this.entries=new Array,this.currentEntry="",this.setInput=function(e){this.input=e},this.getEntries=function(){return this.entries},this.isWhitespace=function(e){return" "==e||"\r"==e||"\t"==e||"\n"==e},this.match=function(e,t){if(this.skipWhitespace(t=null==t?!0:t),this.input.substring(this.pos,this.pos+e.length)!=e)throw TypeError("Token mismatch: match -> expected "+e+", found "+this.input.substring(this.pos));this.pos+=e.length,this.skipWhitespace(t)},this.tryMatch=function(e,t){return this.skipWhitespace(t=null==t?!0:t),this.input.substring(this.pos,this.pos+e.length)==e},this.matchAt=function(){for(;this.input.length>this.pos&&"@"!=this.input[this.pos];)this.pos++;return"@"==this.input[this.pos]},this.skipWhitespace=function(e){for(;this.isWhitespace(this.input[this.pos]);)this.pos++;if("%"==this.input[this.pos]&&1==e){for(;"\n"!=this.input[this.pos];)this.pos++;this.skipWhitespace(e)}},this.value_braces=function(){for(var e,t=0,r=(this.match("{",!1),this.pos),a=!1;;){if(!a)if("}"==this.input[this.pos]){if(!(0<t))return e=this.pos,this.match("}",!1),this.input.substring(r,e);t--}else if("{"==this.input[this.pos])t++;else if(this.pos>=this.input.length-1)throw TypeError("Unterminated value: value_braces");a="\\"==this.input[this.pos]&&0==a,this.pos++}},this.value_comment=function(){for(var e="",t=0;!this.tryMatch("}",!1)||0!=t;){if(e+=this.input[this.pos],"{"==this.input[this.pos]&&t++,"}"==this.input[this.pos]&&t--,this.pos>=this.input.length-1)throw TypeError("Unterminated value: value_comment",+this.input.substring(start));this.pos++}return e},this.value_quotes=function(){this.match('"',!1);for(var e,t=this.pos,r=!1;;){if(!r){if('"'==this.input[this.pos])return e=this.pos,this.match('"',!1),this.input.substring(t,e);if(this.pos>=this.input.length-1)throw TypeError("Unterminated value: value_quotes",this.input.substring(t))}r="\\"==this.input[this.pos]&&0==r,this.pos++}},this.single_value=function(){var e=this.pos;if(this.tryMatch("{"))return this.value_braces();if(this.tryMatch('"'))return this.value_quotes();var t=this.key();if(t.match("^[0-9]+$"))return t;if(0<=this.months.indexOf(t.toLowerCase()))return t.toLowerCase();throw"Value expected: single_value"+this.input.substring(e)+" for key: "+t},this.value=function(){var e=[];for(e.push(this.single_value());this.tryMatch("#");)this.match("#"),e.push(this.single_value());return e.join("")},this.key=function(e){for(var t=this.pos;;){if(this.pos>=this.input.length)throw TypeError("Runaway key: key");if(0<=this.notKey.indexOf(this.input[this.pos]))return e&&","!=this.input[this.pos]?(this.pos=t,null):this.input.substring(t,this.pos);this.pos++}},this.key_equals_value=function(){var e,t=this.key();if(this.tryMatch("="))return this.match("="),e=this.value(),[t=t.trim(),e];throw TypeError("Value expected, equals sign missing: key_equals_value",this.input.substring(this.pos))},this.key_value_list=function(){var e=this.key_equals_value();for(this.currentEntry.entryTags={},this.currentEntry.entryTags[e[0]]=e[1];this.tryMatch(",")&&(this.match(","),!this.tryMatch("}"));)e=this.key_equals_value(),this.currentEntry.entryTags[e[0]]=e[1]},this.entry_body=function(e){this.currentEntry={},this.currentEntry.citationKey=this.key(!0),this.currentEntry.entryType=e.substring(1),null!=this.currentEntry.citationKey&&this.match(","),this.key_value_list(),this.entries.push(this.currentEntry)},this.directive=function(){return this.match("@"),"@"+this.key()},this.preamble=function(){this.currentEntry={},this.currentEntry.entryType="PREAMBLE",this.currentEntry.entry=this.value_comment(),this.entries.push(this.currentEntry)},this.comment=function(){this.currentEntry={},this.currentEntry.entryType="COMMENT",this.currentEntry.entry=this.value_comment(),this.entries.push(this.currentEntry)},this.entry=function(e){this.entry_body(e)},this.alernativeCitationKey=function(){this.entries.forEach(function(e){!e.citationKey&&e.entryTags&&(e.citationKey="",e.entryTags.author&&(e.citationKey+=e.entryTags.author.split(",")[0]+=", "),e.citationKey+=e.entryTags.year)})},this.cleanCitationKey=function(){var e=this.pos,t=e+this.input.slice(e).indexOf(","),r=this.input.slice(0,e),a=this.input.slice(t),i=this.input.slice(e,t).split("{");let o=i[0];for(var n=1;n<i.length;n++){var s=i[n].split("}");o+=s[0].replace(/\W/g,"")+s[1]}o=o.replace(/\s+/g,""),this.input=r+o+a},this.bibtex=function(){for(;this.matchAt();){var e=this.directive();this.match("{"),this.cleanCitationKey(),"@STRING"==e.toUpperCase()?this.string():"@PREAMBLE"==e.toUpperCase()?this.preamble():"@COMMENT"==e.toUpperCase()?this.comment():this.entry(e),this.match("}")}this.alernativeCitationKey()}}const safeRemoveSurroundingBraces=e=>{let t=0,r=0,a=!0;for(const i of e.slice(1,-1))if("{"===i&&t++,"}"===i&&r++,r>t){a=!1;break}return a?e.slice(1,-1):e},bibtexToObject=e=>{var t,r,a=new BibtexParser,e=(a.setInput(e),a.bibtex(),a.getEntries()[0]),i={...e.entryTags,entryType:e.entryType,citationKey:e.citationKey};for([t,r]of Object.entries(i))r.startsWith("{")&&r.endsWith("}")&&(i[t]=safeRemoveSurroundingBraces(r)),t===t.toUpperCase()&&(i[t.toLowerCase()]=i[t],delete i[t]);return i},bibtexToString=t=>{let r=`@${(t={...t=(t="string"==typeof t?bibtexToObject(t):t).hasOwnProperty("entryTags")?{...t.entryTags,entryType:t.entryType,citationKey:t.citationKey}:t}).entryType.toLowerCase()}{${t.citationKey},
`;delete t.entryType,delete t.citationKey;var a=Math.max(...Object.keys(t).map(e=>e.length));for(const o in t)if(t.hasOwnProperty(o)&&t[o]){let e=t[o].replaceAll(/\s+/g," ").trim();e.startsWith("{")&&e.endsWith("}")&&(e=safeRemoveSurroundingBraces(e));var i=o+" ".repeat(a-o.length);r+=`	${i} = {${e}},
`}return(r.slice(0,-2)+"\n}").replaceAll("\t","  ").replaceAll("--","-")},extractBibtexValue=(e,t)=>{e=bibtexToObject(e);return e.hasOwnProperty(t)?e[t]:""},extractAuthor=e=>extractBibtexValue(e,"author").replaceAll("{","").replaceAll("}","").replaceAll("\\","").split(" and ").map(e=>e.split(", ").reverse().join(" ")).join(" and "),logTrace=("undefined"!=typeof module&&null!=module.exports&&((dummyModule=module).exports={bibtexToObject:bibtexToObject,bibtexToString:bibtexToString,extractBibtexValue:extractBibtexValue,extractAuthor:extractAuthor}),"undefined"!=typeof LOGTRACE&&LOGTRACE),log=(...e)=>{var t;logTrace&&(t=(new Error).stack,e.push("\n\nLog trace:\n"+t.split("\n").slice(2).join("\n")));let r="%c%s ",a=!1,i=!1,o=!1,n=!1,s=!1;"[info]"===e[0]?(a=!0,e=e.slice(1)):"[warn]"===e[0]?(i=!0,e=e.slice(1)):"[error]"===e[0]?(o=!0,e=e.slice(1)):"[ok]"===e[0]?(s=!0,e=e.slice(1)):"[debug]"===e[0]&&(n=!0,e=e.slice(1)),e.forEach(e=>{switch(typeof e){case"bigint":case"number":r+="%d   ";break;case"string":r+="%s   ";break;default:r+="%o   "}}),console.log(r,"color: "+(a?"#8BB4F7; font-weight:bold;":i?"#f3bd1e; font-weight:bold;":o?"#FF4F54; font-weight:bold;":s?"#23F62B; font-weight:bold;":n?"#BA357E; font-weight:bold;":"tan"),"[PM]",...e)},info=(...e)=>log("[info]",...e),warn=(...e)=>log("[warn]",...e),debug=(...e)=>log("[debug]",...e),logOk=(...e)=>log("[ok]",...e),logError=(...e)=>log("[error]",...e),consoleHeader=e=>console.groupCollapsed("%c"+e,global.consolHeaderStyle),getDisplayId=e=>{var t=e;return(e=e.split("_")[0].split(".")[0]).startsWith("OR-")||(e=e.split("-").slice(0,2).join("-")),global.state.papers.hasOwnProperty(t)&&("nature"===(t=global.state.papers[t]).source&&(t.note.match(/^Published\ @.+\(\d+\)$/)&&(e+="-"+t.note.split("@")[1].split("(")[0].trim().split(" ").map(e=>e[0].toUpperCase()).join("")),e.includes(t.year+"")||(e+="-"+t.year)),"acs"!==t.source||e.includes(t.year+"")||(e+="-"+t.year),"iop"!==t.source||e.includes(t.year+"")||(e+="-"+t.year)),e},isObject=e=>"object"==typeof e&&!Array.isArray(e)&&null!==e,isPdfUrl=e=>e.endsWith(".pdf")||e.endsWith("/pdf")||e.includes("openreview.net/pdf")||e.match(/\/e?pdf\//g)||e.includes("ieee.org/stamp/stamp.jsp?tp=&arnumber=")||e.includes("articlepdf");function delay(t,r){let a=0;return function(...e){clearTimeout(a),a=setTimeout(t.bind(this,...e),r||0)}}const cleanPapers=e=>{e={...e};return delete e.__dataVersion,e},firstNonStopLowercase=e=>{var e=e.toLowerCase().split(" ").map(miniHash),t=e.filter(e=>!global.englishStopWords.has(e));return(0<t.length?t:e)[0]},miniHash=e=>e.toLowerCase().replace(/\W/g,""),fallbackCopyTextToClipboard=e=>{var t=document.createElement("textarea");t.value=e,t.style.top="0",t.style.left="0",t.style.position="fixed",document.body.appendChild(t),t.focus(),t.select();try{var r=document.execCommand("copy")?"successful":"unsuccessful";log("Fallback: Copying text command was "+r)}catch(e){console.error("Fallback: Oops, unable to copy",e)}document.body.removeChild(t)},copyTextToClipboard=e=>{navigator.clipboard?navigator.clipboard.writeText(e).then(()=>{log("Async: Copying to clipboard was successful!")},e=>{console.error("Async: Could not copy text: ",e)}):fallbackCopyTextToClipboard(e)};async function pasteRich(t,r){var e,a;"undefined"!=typeof ClipboardItem?(e=new Blob([t],{type:"text/html"}),a=new Blob([r],{type:"text/plain"}),e=new ClipboardItem({"text/html":e,"text/plain":a}),await navigator.clipboard.write([e])):(a=e=>{e.clipboardData.setData("text/html",t),e.clipboardData.setData("text/plain",r),e.preventDefault()},document.addEventListener("copy",a),document.execCommand("copy"),document.removeEventListener("copy",a))}const copyHyperLinkToClipboard=(e,t)=>{pasteRich(`<a href="${e}">${t}</a>`,t+" "+e)},padRight=(e,t,r)=>(void 0===r&&(r=" "),e.length<t?e+r.repeat(t-e.length):e),parseUrl=e=>{var t=document.createElement("a");return t.href=e,t},downloadTextFile=(e,t,r)=>{var a=document.createElement("a");"text/plain"===r?(e=e.replace(/\\n/g,"%0D%0A").replace(/"/g,""),a.download=t,a.href="data:text/plain,"+e):(e=new Blob([e],{type:r}),a.href=URL.createObjectURL(e),a.download=t),a.click()},eventId=e=>e.target.closest(".memory-container").id.split("--")[1],downloadFile=(e,t)=>{var r;window.ActiveXObject?window.ActiveXObject&&document.execCommand&&((r=window.open(e,"_blank")).document.close(),r.document.execCommand("SaveAs",!0,t||e),r.close()):((r=document.createElement("a")).href=e,r.target="_blank",e=e.substring(e.lastIndexOf("/")+1),r.download=t||e,navigator.userAgent.toLowerCase().match(/(ipad|iphone|safari)/)&&navigator.userAgent.search("Chrome")<0?document.location=r.href:(t=new MouseEvent("click",{view:window,bubbles:!0,cancelable:!1}),r.dispatchEvent(t),(window.URL||window.webkitURL).revokeObjectURL(r.href)))},hashCode=e=>e.split("").reduce((e,t)=>(e=(e<<5)-e+t.charCodeAt(0))&e,0),parseCVFUrl=e=>{var t=e.replace("https://openaccess.thecvf.com/content","").slice(1).split("/")[0].split("_");let r,a;a=1===t.length?(r=t[0].slice(0,-4),t[0].slice(-4)):(r=t[0].toUpperCase(),t[1]);t=e.split("/").last().split(".")[0],e=(hashCode(t)+"").replace("-","").slice(0,8),t=`${r}-${a}_`+e;return{conf:r,year:a,id:t}},cleanBiorxivURL=e=>e=(e=e.replace(".full.pdf","")).match(/\d$/)?e:e.split(".").slice(0,-1).join("."),textareaFocusEnd=e=>{setTimeout(()=>{e.selectionStart=e.selectionEnd=1e4},0)},tablerSvg=(e,t,r)=>{switch(t=(t=void 0===t?"":t)&&`id="${t}"`,r=(r=(r=void 0===r?[]:r).filter(e=>e))&&`class="${r.join(" ")}"`,e){case"adjustments":return`<svg viewBox="0 0 24 24" ${t} ${r}><path stroke="none" d="M0 0h24v24H0z" fill="none"/><circle cx="6" cy="10" r="2"/><line x1="6" y1="4" x2="6" y2="8"/><line x1="6" y1="12" x2="6" y2="20"/><circle cx="12" cy="16" r="2"/><line x1="12" y1="4" x2="12" y2="14"/><line x1="12" y1="18" x2="12" y2="20"/><circle cx="18" cy="7" r="2"/><line x1="18" y1="4" x2="18" y2="5"/><line x1="18" y1="9" x2="18" y2="20"/></svg>`;case"circle-x":return`<svg viewBox="0 0 24 24" ${t} ${r}><path stroke="none" d="M0 0h24v24H0z" fill="none"/><circle cx="12" cy="12" r="9"/><path d="M10 10l4 4m0 -4l-4 4"/></svg>`;case"star":return`<svg viewBox="0 0 24 24" ${t} ${r}><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M12 17.75l-6.172 3.245l1.179 -6.873l-5 -4.867l6.9 -1l3.086 -6.253l3.086 6.253l6.9 1l-5 4.867l1.179 6.873z"/></svg>`;case"writing":return`<svg viewBox="0 0 24 24" ${t} ${r}><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M20 17v-12c0 -1.121 -.879 -2 -2 -2s-2 .879 -2 2v12l2 2l2 -2z"/><path d="M16 7h4"/><path d="M18 19h-13a2 2 0 1 1 0 -4h4a2 2 0 1 0 0 -4h-3"/></svg>`;case"file-symlink":return`<svg viewBox="0 0 24 24" ${t} ${r}><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M4 21v-4a3 3 0 0 1 3 -3h5"/><path d="M9 17l3 -3l-3 -3"/><path d="M14 3v4a1 1 0 0 0 1 1h4"/><path d="M5 11v-6a2 2 0 0 1 2 -2h7l5 5v11a2 2 0 0 1 -2 2h-9.5"/></svg>`;case"link":return`<svg viewBox="0 0 24 24" ${t} ${r}><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M10 14a3.5 3.5 0 0 0 5 0l4 -4a3.5 3.5 0 0 0 -5 -5l-.5 .5"/><path d="M14 10a3.5 3.5 0 0 0 -5 0l-4 4a3.5 3.5 0 0 0 5 5l.5 -.5"/></svg>`;case"clipboard-list":return`<svg viewBox="0 0 24 24" ${t} ${r}><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M9 5h-2a2 2 0 0 0 -2 2v12a2 2 0 0 0 2 2h10a2 2 0 0 0 2 -2v-12a2 2 0 0 0 -2 -2h-2"/><rect x="9" y="3" width="6" height="4" rx="2"/><line x1="9" y1="12" x2="9.01" y2="12"/><line x1="13" y1="12" x2="15" y2="12"/><line x1="9" y1="16" x2="9.01" y2="16"/><line x1="13" y1="16" x2="15" y2="16"/></svg>`;case"archive":return`<svg viewBox="0 0 24 24" ${t} ${r}><path stroke="none" d="M0 0h24v24H0z" fill="none"/><rect x="3" y="4" width="18" height="4" rx="2"/><path d="M5 8v10a2 2 0 0 0 2 2h10a2 2 0 0 0 2 -2v-10"/><line x1="10" y1="12" x2="14" y2="12"/></svg>`;case"external-link":return`<svg viewBox="0 0 24 24" ${t} ${r}><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M11 7h-5a2 2 0 0 0 -2 2v9a2 2 0 0 0 2 2h9a2 2 0 0 0 2 -2v-5"/><line x1="10" y1="14" x2="20" y2="4"/><polyline points="15 4 20 4 20 9"/></svg>`;case"file-download":return`<svg viewBox="0 0 24 24" ${t} ${r}><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M14 3v4a1 1 0 0 0 1 1h4"/><path d="M17 21h-10a2 2 0 0 1 -2 -2v-14a2 2 0 0 1 2 -2h7l5 5v11a2 2 0 0 1 -2 2z"/><line x1="12" y1="11" x2="12" y2="17"/><polyline points="9 14 12 17 15 14"/></svg>`;case"cirlce-x":return`<svg viewBox="0 0 24 24" ${t} ${r}><path stroke="none" d="M0 0h24v24H0z" fill="none"/><circle cx="12" cy="12" r="9"/><path d="M10 10l4 4m0 -4l-4 4"/></svg>`;case"settings":return`<svg viewBox="0 0 24 24" ${t} ${r}><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M10.325 4.317c.426 -1.756 2.924 -1.756 3.35 0a1.724 1.724 0 0 0 2.573 1.066c1.543 -.94 3.31 .826 2.37 2.37a1.724 1.724 0 0 0 1.065 2.572c1.756 .426 1.756 2.924 0 3.35a1.724 1.724 0 0 0 -1.066 2.573c.94 1.543 -.826 3.31 -2.37 2.37a1.724 1.724 0 0 0 -2.572 1.065c-.426 1.756 -2.924 1.756 -3.35 0a1.724 1.724 0 0 0 -2.573 -1.066c-1.543 .94 -3.31 -.826 -2.37 -2.37a1.724 1.724 0 0 0 -1.065 -2.572c-1.756 -.426 -1.756 -2.924 0 -3.35a1.724 1.724 0 0 0 1.066 -2.573c-.94 -1.543 .826 -3.31 2.37 -2.37c1 .608 2.296 .07 2.572 -1.065z"/><circle cx="12" cy="12" r="3"/></svg>`;case"messages":return`<svg viewBox="0 0 24 24" ${t} ${r}><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M21 14l-3 -3h-7a1 1 0 0 1 -1 -1v-6a1 1 0 0 1 1 -1h9a1 1 0 0 1 1 1v10"/><path d="M14 15v2a1 1 0 0 1 -1 1h-7l-3 3v-10a1 1 0 0 1 1 -1h2"/></svg>`;case"vanity":return`<svg viewBox="0 0 24 24" ${t} ${r}><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M 17.278533 40.830163 C 18.35462 40.830163 19.222826 41.69837 19.222826 42.774457 L 19.222826 43.80163 C 19.222826 44.889946 18.35462 45.758152 17.278533 45.758152 C 16.202446 45.758152 15.322011 44.889946 15.322011 43.80163 L 15.322011 42.774457 C 15.322011 41.69837 16.202446 40.830163 17.278533 40.830163 Z M 17.278533 40.830163 " transform="matrix(0.319444,0,0,0.319444,0,0)"/><path d="M 22.597826 37.345109 C 23.673913 37.345109 24.54212 38.213315 24.54212 39.289402 L 24.54212 40.316576 C 24.54212 41.392663 23.673913 42.273098 22.597826 42.273098 C 21.521739 42.273098 20.641304 41.392663 20.641304 40.316576 L 20.641304 39.289402 C 20.641304 38.213315 21.521739 37.345109 22.597826 37.345109 Z M 22.597826 37.345109 " transform="matrix(0.319444,0,0,0.319444,0,0)"/><path d="M 27.758152 39.228261 C 28.834239 39.228261 29.702446 40.096467 29.702446 41.172554 L 29.702446 42.199728 C 29.702446 43.275815 28.834239 44.15625 27.758152 44.15625 C 26.682065 44.15625 25.80163 43.275815 25.80163 42.199728 L 25.80163 41.172554 C 25.80163 40.096467 26.682065 39.228261 27.758152 39.228261 Z M 27.758152 39.228261 " transform="matrix(0.319444,0,0,0.319444,0,0)"/><path d="M 33.052989 46.797554 C 34.129076 46.797554 34.997283 47.665761 34.997283 48.741848 L 34.997283 49.78125 C 34.997283 50.857337 34.129076 51.725543 33.052989 51.725543 C 31.976902 51.725543 31.108696 50.857337 31.108696 49.78125 L 31.108696 48.741848 C 31.108696 47.665761 31.976902 46.797554 33.052989 46.797554 Z M 33.052989 46.797554 " transform="matrix(0.319444,0,0,0.319444,0,0)"/><path d="M 20.188859 56.53125 L 19.980978 43.067935 C 19.907609 41.649457 18.745924 40.524457 17.327446 40.5 C 16.630435 40.475543 15.970109 40.744565 15.480978 41.221467 C 15.004076 41.710598 14.735054 42.383152 14.759511 43.067935 L 14.808424 59.686141 " transform="matrix(0.319444,0,0,0.319444,0,0)"/><path d="M 30.58288 56.800272 L 30.411685 41.625 C 30.411685 41.625 30.154891 39.044837 27.868207 39.044837 C 25.569293 39.044837 25.165761 41.625 25.165761 41.625 " transform="matrix(0.319444,0,0,0.319444,0,0)"/><path d="M 35.767663 59.686141 L 35.633152 48.754076 C 35.461957 47.519022 34.373641 46.601902 33.126359 46.638587 C 31.842391 46.589674 30.717391 47.482337 30.497283 48.754076 " transform="matrix(0.319444,0,0,0.319444,0,0)"/><path d="M 25.251359 55.235054 L 25.116848 39.142663 C 24.945652 37.907609 23.857337 37.002717 22.610054 37.039402 C 21.326087 36.978261 20.201087 37.883152 19.980978 39.154891 L 20.005435 44.755435 " transform="matrix(0.319444,0,0,0.319444,0,0)"/><path d="M 38.995924 36.5625 L 45.415761 26.902174 " transform="matrix(0.319444,0,0,0.319444,0,0)"/><path d="M 36.085598 43.532609 C 36.085598 43.532609 37.956522 42.138587 38.519022 41.612772 C 39.558424 40.78125 40.120924 39.497283 39.998641 38.164402 C 39.839674 37.173913 38.922554 36.501359 37.932065 36.648098 " transform="matrix(0.319444,0,0,0.319444,0,0)"/><path d="M 43.153533 25.410326 L 52.813859 11.017663 L 58.035326 13.769022 L 48.203804 28.748641 L 45.415761 26.902174 Z M 43.153533 25.410326 " transform="matrix(0.319444,0,0,0.319444,0,0)"/></svg>`;case"ar5iv":return`<svg viewBox="0 0 24 24" ${t} ${r}><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M12 2l.642 .005l.616 .017l.299 .013l.579 .034l.553 .046c4.687 .455 6.65 2.333 7.166 6.906l.03 .29l.046 .553l.041 .727l.006 .15l.017 .617l.005 .642l-.005 .642l-.017 .616l-.013 .299l-.034 .579l-.046 .553c-.455 4.687 -2.333 6.65 -6.906 7.166l-.29 .03l-.553 .046l-.727 .041l-.15 .006l-.617 .017l-.642 .005l-.642 -.005l-.616 -.017l-.299 -.013l-.579 -.034l-.553 -.046c-4.687 -.455 -6.65 -2.333 -7.166 -6.906l-.03 -.29l-.046 -.553l-.041 -.727l-.006 -.15l-.017 -.617l-.004 -.318v-.648l.004 -.318l.017 -.616l.013 -.299l.034 -.579l.046 -.553c.455 -4.687 2.333 -6.65 6.906 -7.166l.29 -.03l.553 -.046l.727 -.041l.15 -.006l.617 -.017c.21 -.003 .424 -.005 .642 -.005zm2 5h-4a1 1 0 0 0 -.993 .883l-.007 .117v4a1 1 0 0 0 .883 .993l.117 .007h3v2h-2l-.007 -.117a1 1 0 0 0 -1.993 .117a2 2 0 0 0 1.85 1.995l.15 .005h2a2 2 0 0 0 1.995 -1.85l.005 -.15v-2a2 2 0 0 0 -1.85 -1.995l-.15 -.005h-2v-2h3a1 1 0 0 0 .993 -.883l.007 -.117a1 1 0 0 0 -.883 -.993l-.117 -.007z" stroke-width="0" fill="#7c7f8b"></path></svg>`;case"vocabulary":return`<svg viewBox="0 0 24 24" ${t} ${r}><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M10 19h-6a1 1 0 0 1 -1 -1v-14a1 1 0 0 1 1 -1h6a2 2 0 0 1 2 2a2 2 0 0 1 2 -2h6a1 1 0 0 1 1 1v14a1 1 0 0 1 -1 1h-6a2 2 0 0 0 -2 2a2 2 0 0 0 -2 -2z"/><path d="M12 5v16"/><path d="M7 7h1"/><path d="M7 11h1"/><path d="M16 7h1"/><path d="M16 11h1"/><path d="M16 15h1"/></svg>`;case"database-export":return`<svg viewBox="0 0 24 24" ${t} ${r}><path stroke="none" d="M0 0h24v24H0z" fill="none"/><ellipse cx="12" cy="6" rx="8" ry="3"/><path d="M4 6v6c0 1.657 3.582 3 8 3a19.84 19.84 0 0 0 3.302 -.267m4.698 -2.733v-6"/><path d="M4 12v6c0 1.599 3.335 2.905 7.538 2.995m8.462 -6.995v-2m-6 7h7m-3 -3l3 3l-3 3"/></svg>`;case"eyeglass":return`<svg viewBox="0 0 24 24" ${t} ${r}><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M8 4h-2l-3 10"/><path d="M16 4h2l3 10"/><line x1="10" y1="16" x2="14" y2="16"/><path d="M21 16.5a3.5 3.5 0 0 1 -7 0v-2.5h7v2.5"/><path d="M10 16.5a3.5 3.5 0 0 1 -7 0v-2.5h7v2.5"/></svg>`;case"markdown":return`<svg viewBox="0 0 24 24" ${t} ${r}><path stroke="none" d="M0 0h24v24H0z" fill="none"/><rect x="3" y="5" width="18" height="14" rx="2"/><path d="M7 15v-6l2 2l2 -2v6"/><path d="M14 13l2 2l2 -2m-2 2v-6"/></svg>`;case"math-function":return`<svg viewBox="0 0 24 24" ${t} ${r}><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M14 10h1c1 0 1 1 2.016 3.527c.984 2.473 .984 3.473 1.984 3.473h1"/><path d="M13 17c1.5 0 3 -2 4 -3.5s2.5 -3.5 4 -3.5"/><path d="M3 19c0 1.5 .5 2 2 2s2 -4 3 -9s1.5 -9 3 -9s2 .5 2 2"/><line x1="5" y1="12" x2="11" y2="12"/></svg>`;case"device-desktop-code":return`<svg viewBox="0 0 24 24" ${t} ${r}><path stroke="none" d="M0 0h24v24H0z" fill="none"></path><path d="M12.5 16h-8.5a1 1 0 0 1 -1 -1v-10a1 1 0 0 1 1 -1h16a1 1 0 0 1 1 1v8"></path><path d="M7 20h4"></path><path d="M9 16v4"></path><path d="M20 21l2 -2l-2 -2"></path><path d="M17 17l-2 2l2 2"></path></svg>`;case"info-square-rounded":return`<svg viewBox="0 0 24 24" ${t} ${r}><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M12 9h.01"/><path d="M11 12h1v4h1"/><path d="M12 3c7.2 0 9 1.8 9 9s-1.8 9 -9 9s-9 -1.8 -9 -9s1.8 -9 9 -9z"/></svg>`;case"huggingface":return`<img src="${chrome.runtime.getURL(global.state.prefs.checkDarkMode?"src/shared/hf-logo-transparent-darktheme.svg":"src/shared/hf-logo-transparent-lighttheme.svg")}" ${t} ${r}>`;default:return""}},stringifyError=e=>{const t=chrome.runtime.id;return e.stack.split("\n").map(e=>e.split(" ").map(e=>e.split(t).last()).join(" ")).join("<br/>")},arraysIdentical=(e,t)=>{var r=e.length;if(r!=t.length)return!1;for(;r--;)if(e[r]!==t[r])return!1;return!0},parseTags=e=>{e=Array.from(e.selectedOptions,e=>e.value.trim()).filter(e=>e);return e.sort(),e},getPaperEdits=(e,t)=>{let r,a,i,o;return o=t?(r=val("popup-form-note-textarea--"+e),i=val(document.getElementById("popup-form-note--"+e).querySelector(".form-code-input")),a=parseTags(findEl("popup-item-tags--"+e)),findEl("checkFavorite--"+e).checked):(r=val(findEl(e,"form-note-textarea")),i=val(findEl(e,"form-code-input")),a=parseTags(findEl(e,"memory-item-tags")),hasClass("memory-container--"+e,"favorite")),{note:r,tags:a,codeLink:i,favorite:o}},setFormChangeListener=(e,t)=>{let r,a,i,o;t?(r="#popup-item-tags--"+e.replace(".","\\."),i="popup-form-codeLink--"+e,a="popup-form-note-textarea--"+e,o="checkFavorite--"+e,$(r).on("change",delay(monitorPaperEdits(e,t),300)),addListener(i,"keyup",delay(monitorPaperEdits(e,t),300)),addListener(a,"keyup",delay(monitorPaperEdits(e,t),300)),addListener(o,"change",delay(monitorPaperEdits(e,t),300))):(r=".memory-item-tags",i=".form-code-input",a=".form-note-textarea",addEventToClass(i,"keyup",delay(monitorPaperEdits(void 0,t),300)),addEventToClass(a,"keyup",delay(monitorPaperEdits(void 0,t),300)))},monitorPaperEdits=(l,p)=>e=>{let t;t=void 0===l?eventId(e):l;var r=getPaperEdits(t,p),a=global.state.papers[t];let i=!1;for(const s in r){var o=a[s],n=(s,r[s]);"tags"===s?arraysIdentical(o,n)||(i=!0):o!==n&&(i=!0)}i&&(console.log("Updating meta data for",t),(p?handlePopupSaveEdits:handleMemorySaveEdits)(t))},cutAuthors=(e,t,r)=>{void 0===t&&(t=140),void 0===r&&(r=", ");let a="";var i,o,n=e.split(" and "),s=n[n.length-1];for([i,o]of n.entries()){if(!(5+a.length+r.length+o.length+s.length<t||i==n.length-1)){a+=" <span class='expand-memory-authors'>...</span> "+s;break}a?a+=", "+o:a=o}return a},sendMessageToBackground=e=>new Promise(t=>{chrome.runtime.sendMessage(e,e=>{t(e)})}),getStoredFiles=()=>new Promise(t=>{chrome.downloads.search({filenameRegex:"(PaperMemoryStore/)?.*.pdf"},e=>t(e.filter(e=>e.exists&&"complete"===e.state&&!e.filename.toLowerCase().includes("readme.txt"))))}),noParamUrl=e=>e.split("?")[0].split("#")[0],urlToWebsiteId=e=>{var t;return e.split("/").last().includes("#")&&(t=e.split("#").length-1,e=e.split("#").slice(0,t).join("#")),miniHash(e.replace("https://","").replace("http://","").replace("www.",""))},silentPromiseTimeout=(e,r=5e3)=>{let a;return Promise.race([e,new Promise((e,t)=>a=setTimeout(e,r))]).finally(()=>clearTimeout(a))},shouldWarn=async(e,t=()=>{})=>t(!1),spaceCamelCase=e=>e.replace(/([A-Z](?=[a-z]+)|[A-Z]+(?![a-z]))/g," $1").trim(),toSingleSpace=e=>e.replace(/\s\s+/g," "),dedent=e=>(""+e).replace(/(\n)\s+/g,"$1"),arxivIdFromPaperID=e=>e.split("-").last().replace("_","/"),cleanStr=e=>e.replace(/[^a-zA-Z0-9 ]/g,""),arxivIdFromURL=e=>e.includes("scirate.com/arxiv/")?e.split("scirate.com/arxiv/")[1].match(/\d+\.\d+/)[0]:e.includes("arxiv-vanity.com/papers/")?e.split("arxiv-vanity.com/papers/")[1].match(/\d+\.\d+/)[0]:e.includes("ar5iv.labs.arxiv.org/html/")?e.split("ar5iv.labs.arxiv.org/html/")[1].match(/\d+\.\d+/)[0]:e.includes("huggingface.co/papers/")?e.split("huggingface.co/papers/")[1].match(/\d+\.\d+/)[0]:noParamUrl(e).replace("/abs/","/pdf/").split("/pdf/")[1].replace(".pdf","").split("v")[0].replace("/","_"),getGist=("undefined"!=typeof module&&null!=module.exports&&((dummyModule=module).exports={log:log,info:info,logError:logError,logOk:logOk,debug:debug,warn:warn,getDisplayId:getDisplayId,isObject:isObject,isPdfUrl:isPdfUrl,delay:delay,cleanPapers:cleanPapers,firstNonStopLowercase:firstNonStopLowercase,fallbackCopyTextToClipboard:fallbackCopyTextToClipboard,copyTextToClipboard:copyTextToClipboard,parseUrl:parseUrl,downloadTextFile:downloadTextFile,eventId:eventId,downloadFile:downloadFile,hashCode:hashCode,parseCVFUrl:parseCVFUrl,cleanBiorxivURL:cleanBiorxivURL,textareaFocusEnd:textareaFocusEnd,tablerSvg:tablerSvg,stringifyError:stringifyError,arraysIdentical:arraysIdentical,parseTags:parseTags,getPaperEdits:getPaperEdits,setFormChangeListener:setFormChangeListener,monitorPaperEdits:monitorPaperEdits,cutAuthors:cutAuthors,sendMessageToBackground:sendMessageToBackground,getStoredFiles:getStoredFiles,miniHash:miniHash,noParamUrl:noParamUrl,silentPromiseTimeout:silentPromiseTimeout,shouldWarn:shouldWarn,spaceCamelCase:spaceCamelCase,toSingleSpace:toSingleSpace}),async(t,r=!0)=>{try{if(!(t=t||await getStorage("syncPAT")))return setStorage("syncState",!1),{ok:!1,payload:"noPAT"};const n=await getStorage("syncTest")?"TestsPaperMemorySync":"DO_NO_EDIT__PaperMemorySyncV2.json",s="Automated PaperMemory sync Gist. Do not edit manually.";var a,i=octokitRequest.defaults({headers:{authorization:"token "+t,"X-GitHub-Api-Version":"2022-11-28"}});let e=(await i("GET /gists")).data?.find(e=>e.description===s&&e.files[n]);e||(info("No Gist found. Creating new one..."),a=await i("POST /gists",{description:s,files:{[n]:{content:JSON.stringify(await getStorage("papers"))}},public:!1}),e=a.data),file=e.files[n];var o=e.id;return r&&await setStorage("syncPAT",t),{ok:!0,payload:{file:file,pat:t,gistId:o}}}catch(e){return console.log(e),warn("Because of the error ^ syncing is now disabled."),{ok:!1,payload:"wrongPAT",error:e}}}),getDataForGistFile=async e=>{var t,r;return e.filename.endsWith(".json")?({data:t,status:r}=await fetchJSON(e.raw_url),t):fetchText(e.raw_url)},updateGist=async(e,t,r)=>{var a=await getStorage("syncPAT");return a?octokitRequest.defaults({headers:{authorization:"token "+a,"X-GitHub-Api-Version":"2022-11-28"}})("PATCH /gists/"+r,{gist_id:r,files:{[e.filename]:{content:JSON.stringify(t,null,"")}}}):(info("(updateGist) No PAT found. Syncing is now disabled."),setStorage("syncState",!1),{ok:!1,payload:"noPAT"})},pushToRemote=async()=>sendMessageToBackground({type:"writeSync"}),pullFromRemote=async(e,t)=>{var r=Date.now(),a=await sendMessageToBackground({type:"pullSync"});return consoleHeader("PaperMemory Pull "+String.fromCodePoint("0x1F504")),log("Remote Papers pulled: ",a),a&&(await initState({isContentScript:t,papers:a??e,print:!1}),t=(Date.now()-r)/1e3,info(`Successfully pulled from Github (${t}s).`),await setStorage("papers",global.state.papers)),console.groupEnd(),a},shouldSync=async()=>!!await getStorage("syncState"),initSyncAndState=async({papers:e=null,isContentScript:t=!1,forceInit:r=!1,stateIsReady:a=()=>{},remoteIsReady:i=()=>{}}={})=>{global.state.dataVersion&&!r||await initState({papers:e,isContentScript:t}),a(),await shouldSync()&&(t||startSyncLoader(),await pullFromRemote(e,t)?t||(r=global.state.sortedPapers.length,setPlaceholder("memory-search",`Search ${r} entries...`),global.state.memoryIsOpen||window.location.href.includes("options.html")||await makeMemoryHTML(),successSyncLoader()):t||errorSyncLoader()),i()},startSyncLoader=async()=>{showId("sync-popup-feedback"),hideId("sync-popup-error"),hideId("sync-popup-synced"),showId("sync-popup-syncing","flex")},successSyncLoader=async()=>{showId("sync-popup-feedback"),hideId("sync-popup-syncing"),hideId("sync-popup-error"),showId("sync-popup-synced"),setTimeout(()=>{hideId("sync-popup-feedback")},2e3)},errorSyncLoader=async()=>{showId("sync-popup-feedback"),hideId("sync-popup-syncing"),hideId("sync-popup-synced"),showId("sync-popup-error"),setTimeout(()=>{hideId("sync-popup-feedback")},2e3)},migrateData=async(r,a,e=!0)=>{if(void 0===r)return chrome.storage.local.set({papers:{__dataVersion:a}}),{papers:{__dataVersion:a},success:!0};var i,o,n,s,l,p,c,d=r.__dataVersion||-1,u=[];let h={...r};try{if(1e4<=d)return log("No migration needed"),{papers:r,success:!0};e&&backupData({...r}),delete r.__dataVersion;let t={};for(const m in r){if(t[m]=[],d<5&&(r[m].hasOwnProperty("bibtex")||(r[m].bibtex="",t[m].push("(m5) bibtex default")),r[m].pdfLink.endsWith(".pdf")||(r[m].pdfLink=r[m].pdfLink+".pdf",t[m].push("(m5) pdfLink to .pdf")),r[m].codeLink||(r[m].codeLink="",t[m].push("(m5) codeLink default")),r[m].source||(r[m].id.includes("NeurIPS")?(r[m].source="neurips",t[m].push("(m5) NeurIPS to neurips")):(r[m].source="arxiv",t[m].push("(m5) source default is arxiv")))),d<208&&("arxiv"!==r[m].source&&r[m].md.includes("https://arxiv.com/abs/")&&(r[m].md=`[${r[m].title}](${r[m].pdfLink})`,t[m].push("(m208) md from title and pdfLink")),"arxiv"!==r[m].source&&r[m].pdfLink.includes("arxiv.org/pdf/")&&(r[m].source="arxiv",t[m].push("(m208) set arxiv source from pdfLink")),m.match(/^\d/))&&"arxiv"===r[m].source&&(i="Arxiv-"+m,o={...r[m],id:i},r[i]=o,u.push(m),t[m].push("(m208) new arxiv id to Arxiv-")),d<209&&(r[m].hasOwnProperty("favorite")||(r[m].favorite=!1,r[m].favoriteDate="",t[m].push("(m209) favorite defaults"))),d<210&&("arxiv"===r[m].source&&(n=r[m].pdfLink.match(/v\d+\.pdf/gi))&&0<n.length&&(r[m].pdfLink=r[m].pdfLink.replace(n[0],".pdf"),t[m].push("(m210) remove pdf version")),r[m].hasOwnProperty("bibtext"))&&(r[m].bibtex=r[m].bibtext+"",delete r[m].bibtext,t[m].push("(m210) bibtext typo to bibtex")),d<450&&!r[m].hasOwnProperty("venue"))try{r[m].venue=await makeVenue(r[m]),t[m].push("(m450) venue from id")}catch(e){logError(e),r[m].venue="",t[m].push("(m450) ERROR in venue from id")}if(d<502&&(m.startsWith("ACL-")&&"acl"!==r[m].source&&(r[m].source="acl",t[m].push("(m502) fix set source to acl")),"acs"===r[m].source)&&(r[m].pdfLink=r[m].pdfLink.replace("/doi/pdf/abs/","/doi/pdf/"),t[m].push("(m502) fix acs pdfLink")),d<510&&(r[m].venue?.toLowerCase().includes("arxiv")&&(r[m].venue="",r[m].note=r[m].note.replace(/accepted\s*@\s*arxiv\.org.+semanticscholar\.org\]/gi,"").trim(),t[m].push("(m509) fix: remove arxiv as venue")),!1===r[m].codeLink&&(r[m].codeLink="",t[m].push("(m509) codeLink from false to ''")),"string"!=typeof r[m].year&&(r[m].year=r[m].year+"",t[m].push("(m509) year to string"),"undefined"===r[m].year)&&(r[m].year="unknown",t[m].push("(m509) empty year to unknown")),void 0===r[m].venue)&&(r[m].venue="",t[m].push("(m509) venue undefined to ''")),d<513&&"iop"===r[m].source&&(l=(s=m).split("_")[1],p=s.split("_")[0]+"_"+miniHash(l),r[p]={...r[s]},u.push(s),t[m].push("(m513) iop doi-in-id to minihash")),d<1e4){if("acm"===r[m].source){let e=r[m].bibtex;var f=e.split("\n");f[0].includes("?")&&(f[0]=f[0].split("?")[0]+","),e=f.join("\n"),r[m].bibtex=e,t[m].push("(m10000) fix acm bibtex")}r[m].bibtex&&(c=bibtexToObject(r[m].bibtex))&&c.hasOwnProperty("abstract")&&(delete c.abstract,t[m].push("(m10000) remove bibtex abstract"),r[m].bibtex=bibtexToString(c))}}return u.forEach((e,t)=>{delete r[e],log("Deleting "+e)}),(h={...r}).__dataVersion=a,info("Migration summary:"),Object.keys(t).forEach(e=>{0<t[e].length&&log(e+":\n\t  "+t[e].join("\n\t  "))}),e&&chrome.storage.local.set({papers:h},()=>{log("Migrated papers:"),log(h),log("Data version is now "+a)}),{papers:h,success:!0}}catch(e){return log(`Error migrating data from version ${d} to ${a}:`),log(e),{papers:h,success:!1,error:e}}},logStorage=t=>{chrome.storage.local.get(t,e=>{log(e[t])})},getStorage=async r=>new Promise((t,e)=>{chrome.storage.local.get(r,e=>{t("string"==typeof r?e[r]:e)})}),setStorage=async(r,a,i=()=>{})=>new Promise((e,t)=>{chrome.storage.local.set({[r]:a},()=>{i(),e(!0)})}),deletePaperInStorage=async(e,t)=>{let r=!1;(t=t||(await getStorage("papers")??{})).hasOwnProperty(e)&&(updateDuplicatedUrls(null,e,!0),r=(r=delete global.state.titleHashToIds[miniHash(t[e].title)])&&delete t[e],delete global.state.papers[e]),r?(await setStorage("papers",t),global.state.papersList=Object.values(cleanPapers(global.state.papers)),sortMemory(),log("Successfully deleted paper",e)):log("Error: no deletion")},getTheme=async()=>{return await getStorage("checkDarkMode")?"dark":"light"},backupData=async r=>{chrome.storage.local.get("papersBackup",({papersBackup:e})=>{void 0===e&&(e={});for(const t of Object.keys(e).map(e=>parseInt(e)).sort((e,t)=>e<t?1:-1).slice(4))delete e[t];e[r.__dataVersion]=r,chrome.storage.local.set({papersBackup:e},()=>{log("Backed up data with version: "+r.__dataVersion)})})};function dateDiffInDays(e,t){e=Date.UTC(e.getFullYear(),e.getMonth(),e.getDate()),t=Date.UTC(t.getFullYear(),t.getMonth(),t.getDate());return Math.floor((t-e)/864e5)}const weeklyBackup=async()=>{var e=await getStorage("weeklyBackups")??{},t=new Date,r=Object.keys(e).map(e=>new Date(e)).sort((e,t)=>e.getTime()-t.getTime());if(0<r.length&&dateDiffInDays(r[r.length-1],t)<7)return;var a={};for(const i of r.reverse().slice(0,5))a[i.toString()]=e[i.toString()];a[t.toString()]=await getStorage("papers")??{},setStorage("weeklyBackups",a)},getPrefs=async()=>{let e=!1,t;var r=await getStorage("prefs")??{},a=((e=0===Object.keys(r).length?!0:e)&&(t=await getStorage(global.prefsStorageKeys)??{}),{});for(const i of global.prefsCheckNames)a[i]=(t??r).hasOwnProperty(i)?(t??r)[i]:!(0<=global.prefsCheckDefaultFalse.indexOf(i));return a.checkOfficialRepos&&(setStorage("pwcPrefs",{official:!0}),delete a.checkOfficialRepos,setStorage("prefs",a)),e&&setStorage("prefs",a),a},getManifestDataVersion=()=>{return chrome.runtime.getManifest().version.split(".").map((e,t)=>parseInt(e)*10**(4-2*t)).reduce((e,t)=>e+t)},versionToSemantic=e=>(e=(e-=1e4*(major=parseInt(e/1e4,10)))-100*(minor=parseInt(e/100,10)),`${major}.${minor}.`+e),validatePaper=(t,e=!0)=>{var r,a={addDate:{type:"string",desc:"the paper's date of addition to the Memory",default:e=>(new Date).toJSON(),validation:e=>{try{new Date(e)}catch(e){return`Invalid addDate (could not parse as date: ${e})`}}},author:{type:"string",desc:"` and `-separated authors `${firstName} ${lastName}`",validation:e=>{if(!e)throw Error(`No author: ${e} for paper ${t.id}:
${JSON.stringify(t,null,2)}
Fix the json file and try again.
`)}},bibtex:{type:"string",desc:"BibTex citation with new lines (`\n`)",validation:t=>{try{bibtexToObject(t)}catch(e){return`Invalid BibTex: ${e} :
`+t}}},code:{type:"object",desc:"the paper's code object as returned by the PapersWithCode API",default:e=>({})},codeLink:{type:"string",desc:"the paper's code link",default:e=>"",validation:t=>{try{parseUrl(t)}catch(e){return`Invalid codeLink (${t}): `+e}}},count:{type:"number",desc:"the paper's number of visits",default:e=>1,validation:e=>{if(e<0)return`Invalid count (${e}): must be >= 0`}},extras:{type:"object",desc:"extra information about the paper which may be required per source",optional:!0},favorite:{type:"boolean",desc:"user wants to star the paper",default:e=>!1},favoriteDate:{type:"string",desc:"date the paper was added as a favorite",default:e=>""},id:{type:"string",desc:"Unique PaperMemory ID"},key:{type:"string",desc:"BibTex citation key",default:e=>"defaultKey_"+e.id},lastOpenDate:{type:"string",desc:"When the paper was last opened",default:e=>(new Date).toJSON()},md:{type:"string",desc:"markdown-formatted string `[${title}](${pdfLink})`",default:e=>`[${e.title}](${e.pdfLink})`},note:{type:"string",desc:"the user's note for this paper",default:e=>""},pdfLink:{type:"string",desc:"the link to the paper's pdf"},source:{type:"string",desc:"the paper's source i.e. where it was added to the memory from",validation:e=>{if(Object.keys(global.knownPaperPages).indexOf(e)<0)return"Unknown source "+e}},tags:{type:"array[string]",desc:"the user's tags for this paper",default:e=>[]},title:{type:"string",desc:"the paper's title",validation:e=>{if(!e)throw Error(`No title: ${e} for paper ${t.id}:
${JSON.stringify(t,null,2)}
Fix the json file and try again.
`)}},venue:{type:"string",desc:"the paper's publication venue",default:e=>""},year:{type:"string",desc:"year of publication",validation:e=>{if(!/^\d{4}$/.test(e))return`Invalid year (${e}): must be 4 digits exactly`}}},i={};for(const p in a)if(i[p]||(i[p]=[]),t.hasOwnProperty(p)){var o,n=a[p].type,s=typeof t[p];n.includes("array")||"object"===n?n.includes("array")?Array.isArray(t[p])?(l=n.split("[")[1].replace("]",""),0<t[p].length&&(o=typeof t[p][0])!==l&&(message=` ${p} should contain ${l} not ${o} (${t.id})`,i[p].push(message),e)&&console.warn(message)):(message=`${p} should be an array (${t.id})`,i[p].push(message),e&&console.warn(message)):Object(t[p])!==t[p]&&(message=`${p} should be an object (${t.id})`,i[p].push(message),e)&&console.warn(message):s!==n&&(message=` ${p} should be of type ${n} not ${s} (${t.id})`,i[p].push(message),e)&&console.warn(message)}else if(a[p].default){var l=a[p].default(t);t[p]=l,message=` Attribute "${p}" absent; will be set to '${JSON.stringify(l)}' (${t.id})`,i[p].push(message),e&&console.warn(message)}else if(!a[p].optional)throw new Error(`Cannot continue, paper is corrupted. Missing mandatory attribute "${p}" in `+t.id);for(const c in a)a[c].validation&&(r=a[c].validation(t[c]))&&(i[c]||(i[c]=[]),i[c].push(r),e)&&console.warn(r+`(${t.id})`);return{warnings:i,paper:t}},prepareOverwriteData=async e=>{let t=!0,r="",a="",i;try{e.__dataVersion||(e.__dataVersion=1);var o,n=await migrateData(e,getManifestDataVersion(),!1);if(!n.success)return a="Could not migrate the data before storing it",n.error&&(a+=":<br/>"+stringifyError(n.error)),{success:!1,message:a};for(const s in i=n.papers)s.startsWith("__")||(paperWarnings=validatePaper(i[s]).warnings)&&0<paperWarnings.length&&(r+="<br/>"+Object.entries(paperWarnings).map((e,t)=>`<h5>${e}</h5>`+t.join("<br/>")).join("<br/>"));r&&(o=await getStorage("papers")??{},setStorage("uploadBackup",o)),t=!1}catch(e){log("prepareOverwriteData error",e),a='<h5 class="errorTitle">/!\\ OverwriteMemoryError:</h5><br>'+stringifyError(e),t=!0}return{success:!t,message:a,warning:r,papersToWrite:i}},makeVenue=async e=>{let t="";switch((t=e.note&&e.note.match(/(accepted|published)\ @\ .+\(?\d{4}\)?/i)?e.note.split("@")[1].trim().replace(/\(?\d{4}\)?/,"").split("--")[0].trim():t)&&"neurips"===t.toLowerCase()&&(t="NeurIPS"),e.source){case"arxiv":break;case"neurips":t="NeurIPS";break;case"cvf":t=t||(await makeCVFPaper(e.pdfLink)).venue;break;case"openreview":t=t||(await makeOpenReviewPaper(e.pdfLink)).venue;break;case"biorxiv":break;case"pmlr":t=e.conf?.split(/\d{4}/)[0]??"";break;case"acl":t=e.conf??"";break;case"pnas":t="PNAS";break;case"nature":t=t||e.venue;break;case"iop":case"acs":t=e.venue}return t},isPaper=("undefined"!=typeof module&&null!=module.exports&&((dummyModule=module).exports={migrateData:migrateData,logStorage:logStorage,getStorage:getStorage,setStorage:setStorage,deletePaperInStorage:deletePaperInStorage,getTheme:getTheme,backupData:backupData,weeklyBackup:weeklyBackup,getPrefs:getPrefs,getManifestDataVersion:getManifestDataVersion,versionToSemantic:versionToSemantic,validatePaper:validatePaper,prepareOverwriteData:prepareOverwriteData,makeVenue:makeVenue}),async(e,t=!1)=>{var r={};if(e){for(const i in global.knownPaperPages){var a=global.knownPaperPages[i].patterns;r[i]=!1;for(const o of a)if("string"==typeof o){if(e.includes(o)){r[i]=!0;break}}else"function"==typeof o&&(r[i]=o(e))}r.localFile=isKnownLocalFile(e),r.stored=!t&&(await findLocalFile(e)??!1),r.parsedWebsite=global.state.papers["Website_"+urlToWebsiteId(e)]??!1}return r}),isSourceURL=async(e,t)=>Object.values(await isPaper(e,t)).some(e=>e),paperToAbs=e=>{let t,r,a;var i=e.pdfLink;let o="";switch(e.source){case"arxiv":o=i.replace("/pdf/","/abs/").replace(".pdf","");break;case"neurips":o=i.replace("/file/","/hash/").replace("-Paper.pdf","-Abstract.html");break;case"cvf":o=i.replace("/papers/","/html/").replace(".pdf",".html");break;case"openreview":o=i.replace("/pdf?","/forum?");break;case"biorxiv":o=i.replace(".full.pdf","");break;case"pmlr":o=i.split("/").slice(0,-1).join("/")+".html";break;case"acl":o=i.replace(".pdf","");break;case"pnas":o=i.replace(".full.pdf","").replace("/doi/pdf/","/doi/full/");break;case"nature":o=i.replace(".pdf","");break;case"acs":o=i.replace("pubs.acs.org/doi/pdf/","pubs.acs.org/doi/").split("?")[0];break;case"iop":o=i.split("#")[0].replace(/\/pdf$/,"");break;case"jmlr":o=i.split("/").slice(0,-1).join("/").replace("/papers/volume","/papers/v")+".html";break;case"pmc":var n=i.match(/PMC\d+/)[0];o=i.split(n)[0]+n;break;case"ijcai":var n=i.replace(".pdf","").split("/").last().match(/[1-9]\d*/),s=i.match(/proceedings\/\d+/gi)[0].split("/")[1];o=`https://www.ijcai.org/proceedings/${s}/`+n;break;case"acm":o=i.replace("/doi/pdf/","/doi/");break;case"ieee":o="https://ieeexplore.ieee.org/document/"+e.key;break;case"springer":o=e.extra.url;break;case"aps":[t,r]=parseUrl(i).pathname.split("/").slice(1,3),o=i.replace(`/${t}/${r}/`,`/${t}/abstract/`);break;case"wiley":o=i.replace(/\/doi\/e?pdf\//g,"/doi/abs/");break;case"sciencedirect":s=i.split("/pii/")[1].split("/")[0].split("#")[0].split("?")[0];o="https://www.sciencedirect.com/science/article/pii/"+s;break;case"science":(a=i.split("/doi/")[1]).startsWith("10.")||(a=a.split("/").slice(1).join("/")),o="https://science.org/doi/full/"+a;break;case"frontiers":o=i.replace(/\/pdf$/,"/full");break;case"ihep":o="https://inspirehep.net/literature/"+e.id.split("-")[1];break;case"plos":o=i.replace("/article/file?","/article?").split("&")[0];break;case"rsc":o=i.replace("/articlepdf/","/articlelanding/");break;case"website":o=e.pdfLink;break;case"mdpi":o=e.pdfLink.split("/pdf")[0];break;case"oup":o="https://doi.org/"+e.doi;break;default:o="https://xkcd.com/1969/"}return o.replace("http://","https://")},paperToPDF=e=>{let t=e.pdfLink;switch(e.source){case"arxiv":t=t.replace("arxiv.org/abs/","arxiv.org/pdf/").replace(/\.pdf$/,"").replace(/v\d+$/gi,""),t+=".pdf";break;case"neurips":t=t.replace("/hash/","/file/").replace("-Abstract.html","-Paper.pdf");break;case"cvf":t=t.replace("/html/","/papers/").replace(".html",".pdf");break;case"openreview":t=t.replace("/forum?","/pdf?");break;case"biorxiv":t=cleanBiorxivURL(t)+".full.pdf";break;case"pmlr":case"acl":case"pnas":break;case"nature":t.endsWith(".pdf")||(t+=".pdf");break;case"iop":t.endsWith("/pdf")||(t+="/pdf");break;case"acs":case"jmlr":case"pmc":case"ijcai":case"acm":case"ieee":case"springer":case"aps":case"wiley":case"sciencedirect":case"science":case"frontiers":case"ihep":case"plos":case"rsc":case"mdpi":case"oup":break;case"website":abs=e.pdfLink;break;default:t="https://xkcd.com/1969/"}return t.replace("http://","https://")},findLocalFile=async t=>{if("string"==typeof t){let e;try{e=await parseIdFromUrl(t)}catch(e){return new Promise(e=>e(null))}if(!global.state.papers.hasOwnProperty(e))return new Promise(e=>e(null));paper=global.state.papers[e]}else paper=t;t=await getStoredFiles(),t=await matchPapersToFiles({[paper.id]:paper},t),t=Object.values(t);return 1===t.length?t[0]:null},matchPapersToFiles=async(e,t)=>{var r=Object.fromEntries(Object.values(e).map(e=>[e.id,miniHash(e.title)])),a=(t=t.filter(e=>e.exists&&"complete"===e.state&&!e.filename.toLowerCase().includes("readme.txt")),Object.fromEntries(t.map(e=>[e.id,miniHash(e.filename)]))),i={};for(const n of t){let t;try{(t=await parseIdFromUrl(n.finalUrl))&&e.hasOwnProperty(t)&&(i[t]=n)}catch(e){t=null}if(!t){const s=a[n.id];var o=Object.entries(r).find(([,e])=>s.includes(e));o&&(i[o[0]]=n)}}return i},matchAllFilesToPapers=()=>new Promise((t,e)=>{chrome.downloads.search({filenameRegex:"PaperMemoryStore/.*"},async e=>{e=await matchPapersToFiles(cleanPapers(global.state.papers),e);t(e)})}),mergePapers=(e={newPaper:{},oldPaper:{}})=>{const{oldPaper:t,newPaper:r,...a}=e;var i={...t},e={overwrites:["lastOpenDate"],incrementCount:!1,syncMerge:!1,...a};for(const o in r)(!t.hasOwnProperty(o)||r[o]&&!t[o])&&(i[o]=r[o]);e.incrementCount&&1===i.count&&(i.count+=1),e.syncMerge&&(i.count=t.count+r.count,i.note=t.note??"",r.note&&r.note!==t.note&&(i.note+="\n\n--[Sync Merge]--\n",i.note+=r.note),i.tags=[...t.tags,...r.tags],i.lastOpenDate=r.lastOpenDate,r.lastOpenDate>t.lastOpenDate&&(i.lastOpenDate=r.lastOpenDate),i.addDate=r.addDate,r.addDate>t.addDate)&&(i.addDate=r.addDate);for(const n of e.overwrites)r.hasOwnProperty(n)&&(i[n]=r[n]);return i},updatePaperVisits=e=>(e.count+=1,e.lastOpenDate=(new Date).toJSON(),log("Updating paper to:",e),e),addOrUpdatePaper=async({url:r,is:a,prefs:i,tab:e,store:o=!0,contentScriptCallbacks:n={update:()=>{},preprints:()=>{}}})=>{const s=Date.now();let l,p,c={};consoleHeader("PaperMemory Parsing "+String.fromCodePoint("0x1F4DD")),global.state.papers=await getStorage("papers")??{};var t=await parseIdFromUrl(r,e),d=global.state.papers.hasOwnProperty(t);if(t&&d&&"anonymous"!==global.state.papers[t].author.toLowerCase())l=updatePaperVisits(global.state.papers[t]),p=!1;else{let t=await makePaper(a,r,e);if(!t)return;d=findFuzzyPaperMatch(global.state.titleHashToIds,t);if(d&&o){let e=global.state.papers[d];log("New paper",t,"already exists as",e),addPaperToTitleHashToId(t),e.venue?(a=["lastOpenDate"],"anonymous"===e.author.toLowerCase()&&(a.push("author"),a.push("year"),a.push("venue"),a.push("bibtex"),a.push("note")),console.log("overwrites: ",a),e=mergePapers({newPaper:t,overwrites:a,oldPaper:e,incrementCount:!1}),updateDuplicatedUrls(r,d)):t.venue?(updateDuplicatedUrls(paperToAbs(e),t.id),updateDuplicatedUrls(paperToPDF(e),t.id),await deletePaperInStorage(e.id,global.state.papers),e=mergePapers({newPaper:t,oldPaper:e,incrementCount:!1,overwrites:["lastOpenDate","venue","bibtex","id","key","pdfLink","source","year","author"]})):"anonymous"===e.author.toLowerCase()&&(e=mergePapers({newPaper:t,oldPaper:e,incrementCount:!0,overwrites:["lastOpenDate","author","year","venue","bibtex","note"]})),t=updatePaperVisits(e),p=!1}else p=!0;l=t}if(!l.codeLink||!l.venue)try{var u=await tryPWCMatch(l),h=!l.codeLink&&u?.codeLink,f=u?.note,m=u?.bibtex,g=!l.venue&&u?.venue;(c={codeLink:h,note:f,venue:g,bibtex:m}).codeLink&&(l.codeLink=c.codeLink,u.hasOwnProperty("note")&&delete u.note,l.code=u)}catch(e){log("Error trying to discover a code repository:"),log(e)}return global.state.papers=await getStorage("papers")??{},p&&global.state.papers.hasOwnProperty(l.id)&&(warn("Paper has been created by another page: merging papers."),l=mergePapers({newPaper:global.state.papers[l.id],oldPaper:l,incrementCount:!0}),p=!1),o&&!global.state.deleted[l.id]&&(global.state.papers[l.id]=l),chrome.storage.local.set({papers:global.state.papers},async()=>{n.update(l),pushToRemote();let e;if(p||c.codeLink?p?(o?logOk("Added '"+l.title+"' to your Memory!"):warn("Discovered '"+l.title+"' but did not store it (`store` is false)."),log("paper: ",l),e="Added to your Memory",c.codeLink&&(e+="<br/><div id='feedback-pwc'>(+ repo from PapersWithCode) </div>"),i&&i.checkFeedback&&o&&feedback(e,l)):(e="Found a code repository on PapersWithCode!",i&&i.checkFeedback&&o&&feedback(e)):o&&logOk("Updated '"+l.title+"' in your Memory"),!l.note||!l.venue||"anonymous"===l.author.toLowerCase()){var t,r=await tryPreprintMatch(l);for(const a of["note","venue","bibtex","doi"])l[a]&&"bibtex"!==a||(t=r[a]??c[a])&&(log(`Updating preprint ${a} to`,t),l[a]=t);global.state.papers=await getStorage("papers")??{},p&&global.state.papers.hasOwnProperty(l.id)&&1<global.state.papers[l.id].count&&(warn("Paper has been created by another page: merging papers."),l=mergePapers({newPaper:global.state.papers[l.id],oldPaper:l,incrementCount:!1})),o&&!global.state.deleted[l.id]&&(global.state.papers[l.id]=l),chrome.storage.local.set({papers:global.state.papers})}n.preprints(l),pushToRemote(),info(`Done processing paper (${(Date.now()-s)/1e3}s).`),console.groupEnd()}),{paper:l,id:t}},findPaperForProperty=(e,t,r,a="id")=>e.find(e=>e.source===t&&e[a].includes(r))?.id,parseIdFromUrl=async(t,e=null)=>{if(e)return urlToWebsiteId(t);let r;e=miniHash(t),e=global.state.urlHashToId[e];if(e)return e;var e=await isPaper(t,!0),a=Object.values(cleanPapers(global.state.papers));if(e.arxiv){var i=arxivIdFromURL(t),i=(r="Arxiv-"+i,Object.values(global.state.titleHashToIds).find(e=>e.includes(r)));i&&(r=i.find(e=>!e.startsWith("Arxiv-"))??r)}else if(e.neurips){var i=t.split("/paper/")[1].split("/")[0],o=t.split("/").last().split("-")[0].slice(0,8);r=`NeurIPS-${i}_`+o}else if(e.cvf)r=parseCVFUrl(t).id;else if(e.openreview){i=t.match(/id=\w+/)[0].replace("id=","");r=findPaperForProperty(a,"openreview",i)}else if(e.biorxiv){let e=(t=cleanBiorxivURL(t)).split("/").last();e.match(/v\d+$/)&&(e=e.split("v")[0]),r="Biorxiv-"+e;var o=Object.values(global.state.titleHashToIds).find(e=>e.includes(r));o&&(r=o.find(e=>!e.startsWith("Biorxiv-"))??r)}else if(e.pmlr){i=t.split("/").last().split(".")[0],o="20"+i.match(/\d+/)[0];r=`PMLR-${o}-`+i}else if(e.acl){o=(t=(t=t.replace(".pdf","")).endsWith("/")?t.slice(0,-1):t).split("/").last();r=findPaperForProperty(a,"acl",o)}else if(e.pnas){i=((t=t.replace(".full.pdf","")).endsWith("/")?t.split("/").slice(-2):t.split("/").slice(-1))[0];r=findPaperForProperty(a,"pnas",i)}else if(e.nature){o=(t=t.replace(".pdf","").split("#")[0]).split("/").last();r=findPaperForProperty(a,"nature",o)}else if(e.acs){t=noParamUrl(t).replace("pubs.acs.org/doi/pdf/","/doi/").replace("pubs.acs.org/doi/abs/","/doi/");const doi=miniHash(t.split("/doi/")[1]);r="ACS_"+doi}else if(e.iop){t=noParamUrl(t).replace(/\/pdf$/,"");const doi=miniHash(t.split("/article/")[1].split("/meta")[0]);r="IOPscience_"+doi}else if(e.jmlr){i=(t=(t=t.endsWith(".pdf")?t.split("/").slice(0,-1).join("/"):t).replace(".html","")).split("/").last(),o="20"+i.match(/\d+/)[0];r=`JMLR-${o}_`+i}else if(e.pmc){o=t.match(/PMC\d+/g)[0].replace("PMC","");r=findPaperForProperty(a,"pmc",o)}else if(e.ijcai){i=t.endsWith(".pdf")?t.replace(".pdf","").split("/").last().match(/[1-9]\d*/):t.split("/").last(),o=t.match(/proceedings\/\d+/gi)[0].split("/")[1];r=`IJCAI-${o}_`+i}else if(e.acm){const doi=t.replace(/\/doi\/?(pdf|abs|full)?\//,"/doi/").split("/doi/")[1];r=findPaperForProperty(a,"acm",miniHash(doi))}else if(e.ieee){o=(t.includes("ieee.org/document/")?t.split("ieee.org/document/"):t.includes("ieee.org/abstract/document/")?t.split("ieee.org/abstract/document/"):t.split("arnumber="))[1].match(/\d+/)[0];r=findPaperForProperty(a,"ieee",o)}else if(e.springer){let e=global.sourceExtras.springer.types.filter(e=>t.includes(`/${e}/`))[0];if(!e){if(!t.includes("/content/pdf/"))throw new Error("Could not find Springer type for "+t);e="content/pdf"}i=noParamUrl(t).split(`/${e}/`)[1].replace(".pdf","");r=findPaperForProperty(a,"springer",miniHash(i))}else if(e.aps){var[o,i]=parseUrl(t.split("#")[0]).pathname.split("/").slice(1,3);const doi=t.split(`/${o}/${i}/`).last();r=findPaperForProperty(a,"aps",miniHash(doi))}else if(e.wiley){const doi=t.split("?")[0].split("#")[0].split("/").slice(-2).join("/");r=findPaperForProperty(a,"wiley",miniHash(doi))}else if(e.sciencedirect){o=t.split("/pii/")[1].split("/")[0].split("#")[0].split("?")[0];r=findPaperForProperty(a,"sciencedirect",miniHash(o))}else if(e.science)(doi=noParamUrl(t).split("/doi/")[1]).startsWith("10.")||(doi=doi.split("/").slice(1).join("/")),r=findPaperForProperty(a,"science",miniHash(doi));else if(e.frontiers)doi=noParamUrl(t).split("/articles/")[1].split("/").slice(0,-1).join("/"),r=findPaperForProperty(a,"frontiers",miniHash(doi));else if(e.ihep)r=t.includes("/literature/")?(i=noParamUrl(t).match(/\/literature\/(\d+)/)[1],findPaperForProperty(a,"ihep",i)):(o=noParamUrl(t).split("/files/")[1].split("/")[0],findPaperForProperty(a,"ihep",o,"pdfLink"));else if(e.plos){const doi=t.split("?id=").last().split("&")[0];r=findPaperForProperty(a,"plos",miniHash(doi))}else if(e.rsc){i=noParamUrl(t).split("/").last();r=findPaperForProperty(a,"rsc",miniHash(i))}else if(e.mdpi){o=noParamUrl(t.split("mdpi.com/")[1].split("/pdf")[0].split("/reprints")[0].split("/notes")[0]);r=findPaperForProperty(a,"mdpi",miniHash(o))}else if(e.oup){t=noParamUrl(t).split("https://academic.oup.com/").last();i=(t=isPdfUrl(t)?t.split("/").slice(0,-1).join("/"):t).split("/").slice(2).join("");r=findPaperForProperty(a,"oup",miniHash(i))}else if(e.hal){o=(t=noParamUrl(t).replace(/(hal\.science\/\w+-\d+)(v\d+)?(\/document)?/,"$1")).split("/").last();r=findPaperForProperty(a,"hal",miniHash(o))}else if(e.localFile)r=e.localFile;else{if(!e.parsedWebsite)throw new Error("unknown paper url. Is: "+JSON.stringify(e));r=e.parsedWebsite.id}return r},isKnownLocalFile=e=>{if(!e.startsWith("file://"))return!1;if(!e.endsWith(".pdf"))return!1;const t=decodeURIComponent(e).replace("file://","");var r=Object.entries(global.state.files).filter(([,e])=>e.filename===t);if(0<r.length)return console.log("Found stored"),r[0][0];const a=decodeURIComponent(e.split("/").last()).toLowerCase().replace(/\W/g,"");r=Object.values(cleanPapers(global.state.papers)).map(e=>({title:miniHash(e.title),id:e.id})).filter(e=>a.includes(e.title));return 0!==r.length&&r[0].id},makeMdLink=(e,t={})=>{var r=(t.checkPreferPdf?paperToPDF:paperToAbs)(e);let a="",i=(!t.checkMdYearVenue||(a=(a=e.note.match(/(.+)\s*@\s*([\w\s]+\(?\d{4}\)?)/i))&&a[2]?.replace(/\s+/g," ").replace(/[\(\)]/g,""))||(a="",e.venue&&(a+=e.venue+" "),a+=e.year),e.title);return`[${i=a?`${i} (${a.replace(/\s+/g," ")})`:i}](${r})`},duration=("undefined"!=typeof module&&null!=module.exports&&((dummyModule=module).exports={isPaper:isPaper,isSourceURL:isSourceURL,paperToAbs:paperToAbs,paperToPDF:paperToPDF,findLocalFile:findLocalFile,matchPapersToFiles:matchPapersToFiles,matchAllFilesToPapers:matchAllFilesToPapers,mergePapers:mergePapers,addOrUpdatePaper:addOrUpdatePaper,parseIdFromUrl:parseIdFromUrl,isKnownLocalFile:isKnownLocalFile,makeMdLink:makeMdLink,updatePaperVisits:updatePaperVisits}),e=>(Date.now()-e[0])/1e3),initState=async({papers:e,isContentScript:t,print:r=!0}={})=>{var a,i,o=[],n=(o.unshift(Date.now()),r&&consoleHeader("PaperMemory Init "+String.fromCodePoint("0x2705")),e||(e=await getStorage("papers")??{},r&&log("Time to retrieve stored papers (s): "+duration(o))),o.unshift(Date.now()),global.state.dataVersion=getManifestDataVersion(),r&&log("Time to parse data version (s): "+duration(o)),o.unshift(Date.now()),weeklyBackup(),r&&log("Time to backup papers (weekly) (s): "+duration(o)),o.unshift(Date.now()),await migrateData(e,global.state.dataVersion));r&&log("Time to migrate data (s): "+duration(o)),o.unshift(Date.now()),e=n.papers,global.state.papers=e,global.state.prefs=await getPrefs(),r&&log("Time to retrieve user preferences (s): "+duration(o)),o.unshift(Date.now()),global.state.ignoreSources=await getStorage("ignoreSources")??{},r&&log("Time to retrieve sources to ignore (s): "+duration(o)),o.unshift(Date.now()),global.state.urlHashToId=await getStorage("urlHashToId")??{},r&&log("Time to retrieve sources to urlHashToId (s): "+duration(o)),o.unshift(Date.now()),global.state.titleHashToIds={};for([a,i]of Object.entries(cleanPapers(e))){var s=miniHash(i.title);global.state.titleHashToIds.hasOwnProperty(s)||(global.state.titleHashToIds[s]=[]),global.state.titleHashToIds[s].push(a)}r&&log("Time to hash titles (s): "+duration(o)),o.unshift(Date.now()),t||(global.state.files=await matchAllFilesToPapers(),r&&log("Time to match all local files (s): "+duration(o)),o.unshift(Date.now()),global.state.papersList=Object.values(cleanPapers(e)),global.state.sortKey="lastOpenDate",global.state.papersReady=!0,sortMemory(),r&&log("Time to sort memory (s): "+duration(o)),o.unshift(Date.now()),makeTags(),r&&log("Time to make tags (s): "+duration(o)),o.unshift(Date.now())),info("State init duration (s): "+(Date.now()-o.last())/1e3),r&&console.groupEnd()},sortMemory=()=>{global.state.sortedPapers=Object.values(cleanPapers(global.state.papers)),global.state.sortedPapers.sort(orderPapers(0<=global.descendingSortKeys.indexOf(global.state.sortKey))),global.state.papersList.sort(orderPapers(0<=global.descendingSortKeys.indexOf(global.state.sortKey)))},orderPapers=i=>(e,t)=>{let r=e[global.state.sortKey],a=t[global.state.sortKey];return void 0===r&&(r=""),void 0===a&&(a=""),"string"==typeof r&&(r=r.toLowerCase(),a=a.toLowerCase()),i?r>a?-1:1:r>a?1:-1},makeTags=()=>{var e=new Set;for(const t of global.state.sortedPapers)for(const r of t.tags)e.add(r);global.state.paperTags=[...e],global.state.paperTags.sort()},getExamplePaper=async e=>{var t=await getStorage("papers")??{},r=Object.keys(t).filter(e=>-1===e.indexOf("__")).reverse();let a=t[r[e=void 0===e?getRandomInt(r.length):e]];return a=void 0===a?{title:"Dummy title",author:"Cool Author and Great Author and Complicated Name uthor",year:2021,id:"NoneXiv-214324",bibtex:"@Nonesense{}",tags:["t1","t2"],note:"Thispaperdoesnotexist.com"}:a},stateTitleFunction=e=>{let t=e;return"string"==typeof e&&void 0===(t=global.state.papers[e])?(log("Error in stateTitleFunction: unknown id",e),"Unknown ID"):global.state.titleFunction(t).replaceAll("\n"," ").replace(/\s\s+/g," ")},updateDuplicatedUrls=(t,r,e=!1)=>{if(e){let e;if((e=t?[miniHash(t)]:Object.keys(global.state.urlHashToId).filter(e=>global.state.urlHashToId[e]===r))&&e.length){for(const a of e)warn("Removing duplicated url",t,"for",r),delete global.state.urlHashToId[a];setStorage("urlHashToId",global.state.urlHashToId)}}else global.state.urlHashToId[miniHash(t)]=r,setStorage("urlHashToId",global.state.urlHashToId)},addPaperToTitleHashToId=e=>{var t=e.id,e=miniHash(e.title);global.state.titleHashToIds.hasOwnProperty(e)||(global.state.titleHashToIds[e]=[]),global.state.titleHashToIds[e].includes(t)||global.state.titleHashToIds[e].push(t)},readJournalAbbreviations=async()=>{var e,t;global.journalAbbreviations||(e=chrome.runtime.getURL("src/data/iso4-journals.json"),e=await fetch(e).then(e=>e.json()),t=chrome.runtime.getURL("src/data/journal-abbreviations.json"),t=await fetch(t).then(e=>e.json()),global.journalAbbreviations=Object.fromEntries([...Object.entries(e),...Object.entries(t)].map(([e,t])=>[miniHash(e),t])))},downloadPaperPdf=async e=>{if(!global.state.papersReady)throw new Error("[PM] State is not ready (downloadPaperPdf)");let t=stateTitleFunction(e);t=(t=t.replaceAll(":"," ")).replace(/[\u2000-\u206F\u2E00-\u2E7F\\'!"#$%&()*+,\/:;<=>?@\[\]^`{|}~]/g," ").replace(/\s+/g," "),global.state.prefs.checkStore&&(t="PaperMemoryStore/"+t,0===(await getStoredFiles()).length)&&chrome.downloads.download({url:URL.createObjectURL(new Blob([global.storeReadme])),filename:"PaperMemoryStore/IMPORTANT_README.txt",saveAs:!1}),(t=t.endsWith("pdf")?t.slice(0,-3)+".pdf":t).endsWith(".pdf")||(t+=".pdf"),log("Downloading paper",e,"to",t),chrome.downloads.download({url:paperToPDF(e),filename:t})},decodeHtml=("undefined"!=typeof module&&null!=module.exports&&((dummyModule=module).exports={initState:initState,getExamplePaper:getExamplePaper,stateTitleFunction:stateTitleFunction,updateDuplicatedUrls:updateDuplicatedUrls,addPaperToTitleHashToId:addPaperToTitleHashToId,readJournalAbbreviations:readJournalAbbreviations,downloadPaperPdf:downloadPaperPdf}),e=>{var t=document.createElement("textarea");return t.innerHTML=e,t.value}),flipAuthor=e=>e.split(", ").reverse().join(" "),flipAndAuthors=e=>e.split(" and ").map(flipAuthor).join(" and "),fetchArxivXML=async e=>{e=e.replace("Arxiv-","").replace("_","/");return fetch("https://export.arxiv.org/api/query?"+new URLSearchParams({id_list:e}))},fetchCvfHTML=async e=>{let t,r;var a;return t=e.endsWith(".pdf")?e.replace("/papers_backup/","/papers/").replace("/papers/","/html/").replace(".pdf",".html"):e,!(r=await fetch(t).then(e=>e.ok?e.text():""))&&t.includes("thecvf.com/content_")&&({conf:e,year:a}=parseCVFUrl(e),t=t.replace(`/content_${e}_${a}/`,`/content_${e.toLowerCase()}_${a}/`),r=await fetch(t).then(e=>e.ok?e.text():"")),r},getOpenReviewNoteJSON=e=>sendMessageToBackground({type:"OpenReviewNoteJSON",url:e}),getOpenReviewForumJSON=e=>sendMessageToBackground({type:"OpenReviewForumJSON",url:e}),fetchDom=async e=>{e=await fetch(e).then(e=>e.ok?e.text():"");return(new DOMParser).parseFromString(e.replaceAll("\n",""),"text/html")},fetchText=async e=>{try{var t=await fetch(e);return(t.ok?await t.text():"").trim()}catch(e){return logError("fetchText error:",e),""}},fetchJSON=async e=>{try{var t=await fetch(e),r=t.status;return{data:t.ok?await t.json():null,status:r}}catch(e){return logError("fetchJSON error:",e),{}}},fetchBibtex=async e=>{var e=await fetchText(e),t=bibtexToObject(e),r=(delete t.abstract,e=bibtexToString(t),`Published in ${t.journal} (${t.year})`);return{...t,bibtex:e,note:r,venue:t.journal,key:t.citationKey}},extractCrossrefData=e=>{if(e.status&&"ok"===e.status)if("work"!==e["message-type"])error("Unknown `message-type` from CrossRef",e);else{var t=e.message,r=(log("Crossref data.message: ",t),t.author.map(e=>e.given+" "+e.family).join(" and ")),a=t.issued?t.issued["date-parts"][0][0]+"":t.published?t.published["date-parts"][0][0]+"":null;if(a){var i,o,n,s=t.title[0];if(s)return i=t["container-title"][0]??"Springer",n=[miniHash(t.author[0].family),a.slice(2),firstNonStopLowercase(s)].join(""),o=t.DOI,n={entryType:"book"===t.type?"book":"book-chapter"===t.type?"InBook":t.type.includes("article")?"Article":"InProceedings",citationKey:n,publisher:t.publisher,author:r,title:s,year:a,doi:o},t.page&&(n.pages=t.page),t.volume&&(n.volume=t.volume),t.type.includes("journal")&&(n.journal=i),t.link&&0<t.link.length&&((r=t.link.find(e=>"application/pdf"===e["content-type"]))&&(n.pdf=r.URL),s=t.link.find(e=>"text/html"===e["content-type"])??t.link[0])&&(n.url=s.URL),a=bibtexToString(n),{...n,bibtex:a,venue:i};error("Cannot find title in CrossRef data",t)}else error("Cannot find year in CrossRef data",t)}else error("Cannot parse CrossRef response",e)},fetchCrossRefDataForDoi=async e=>{var{data:e,status:t}=await fetchJSON(`https://api.crossref.org/works/${e}?mailto=schmidtv%40mila.quebec`);return{data:extractCrossrefData(e),status:t}},fetchSemanticScholarDataForDoi=async e=>{var t,e=(await fetchJSON(`https://api.semanticscholar.org/graph/v1/paper/${e}?fields=venue,year,authors,title`))["data"];let r;return e&&(r={},e.venue&&(r.venue=e.venue),e.year&&(r.year=e.year),e.authors&&(r.author=e.authors.map(e=>e.name).join(" and ")),e.title&&(r.title=e.title),e=""+miniHash(e.authors[0].name)+firstNonStopLowercase(r.title),t=bibtexToString({entryType:"article",citationKey:e,...r}),r.bibtex=t,r.key=e),r},getMetaContent=({selector:e,dom:t,all:r=!1,pure:a=!1})=>{let i="";for(var[o,n]of Object.entries(e))if(i+=`meta[${o}='${n}']`,n.startsWith("dc.")){let e;var n=n.split("dc.")[1],s=n[0];e=s===s.toLowerCase()?s.toUpperCase():s.toLowerCase(),i+=`,meta[${o}='dc.${e+n.slice(1)}']`}if(r){const l=queryAll(i,t).map(e=>e.getAttribute("content")??"");return a?l:l.map(spaceCamelCase).map(toSingleSpace)}const l=t.querySelector(i)?.getAttribute("content")??"";return a?l:toSingleSpace(spaceCamelCase(l))},extractDataFromDCMetaTags=e=>{var t,r,a,i,o,n,s=getMetaContent({selector:{name:"dc.Creator"},dom:e,all:!0}).join(" and ");return s?(t=getMetaContent({selector:{name:"dc.Date"},dom:e}).split("-")[0],r=getMetaContent({selector:{name:"dc.Publisher"},dom:e}).replaceAll("\n"," "),a=getMetaContent({selector:{name:"dc.Title"},dom:e}),i=getMetaContent({selector:{name:"citation_journal_title"},dom:e}),o=getMetaContent({selector:{name:"citation_pdf_url"},dom:e,pure:!0}),e=getMetaContent({selector:{scheme:"doi"},dom:e})||getMetaContent({selector:{name:"citation_doi"},dom:e}),n=(""+s.split(" and ")[0].split(" ").find((e,t)=>1<=t&&1<miniHash(e).length)+t+firstNonStopLowercase(a)).toLowerCase(),{author:s,year:t,publisher:r,title:a,venue:i,key:n,doi:e,bibtex:bibtexToString({citationKey:n,entryType:"article",title:a,author:s,year:t,doi:e,publisher:r,journal:i}),pdfLink:o,note:`Published @ ${i} (${t})`}):null},makeArxivPaper=async e=>{var e=arxivIdFromURL(e),t=await(await fetchArxivXML(e)).text(),t=(new DOMParser).parseFromString(t.replaceAll("\n",""),"text/xml"),r=queryAll("author name",t).map(e=>e.innerHTML),a=r.join(" and "),i=[...t.getElementsByTagName("link")].map(e=>e.getAttribute("href")).filter(e=>e.includes("arxiv.org/pdf/"))[0].replace(/v\d+\.pdf$/gi,".pdf"),o=t.querySelector("entry title").innerHTML,t=t.querySelector("entry published").innerHTML.slice(0,4),r=r[0].split(" ").last().toLowerCase()+t+firstNonStopLowercase(o),n="Arxiv-"+e.replace("/","_"),s="";return{author:a,bibtex:s+`@article{${r},
`+`title={${o} },
`+`author={${a} },
`+`year={${t}},
`+`journal={arXiv preprint arXiv: ${e}}
`+"}",id:n,key:r,pdfLink:i,title:o,venue:"",year:t}},makeNeuripsPaper=async e=>{var t=(e=e.endsWith(".pdf")?e.replace("/file/","/hash/").replace(/-Paper(.*)\.pdf/,"-Abstract$1.html"):e).split("/").slice(-1)[0].split("-Paper")[0],r=await fetchDom(e),a=[...r.getElementsByTagName("a")].filter(e=>"Bibtex"===e.innerText)[0]?.getAttribute("href");let i,o,n,s,l;a?(i=await fetchText("https://"+parseUrl(e).host+a),{author:o,citationKey,title:n,year:s}=bibtexToObject(i),o=flipAndAuthors(o),l=citationKey):(a=queryAll(".container-fluid .col p",r),n=r.getElementsByTagName("h4")[0].innerHTML,r=queryAll("h4",r).filter(e=>"Authors"===e.innerText)[0],o=r.nextElementSibling.innerText.split(", ").map(e=>e.split(" ").map(e=>e.capitalize()).join(" ")).join(" and "),s=a[0].innerHTML.match(/\d{4}/)[0],l="neurips"+s+t.slice(0,8),i="",i=(i=(i=(i=(i+=`@inproceedings{NEURIPS${s}_${t.slice(0,8)},
`)+`author={${o}},
`+`booktitle={Advances in Neural Information Processing Systems},
`)+`editor={H.Larochelle and M.Ranzato and R.Hadsell and M.F.Balcan and H.Lin},
`+`publisher={Curran Associates, Inc.},
`)+`title={${n}},
`+`url={${e}},
`)+`year={${s}}
`+"}",i=bibtexToString(i));r=e.replace("/hash/","/file/").replace("-Abstract.html","-Paper.pdf"),a=`NeurIPS-${s}_`+t.slice(0,8),e="NeurIPS",t=`Accepted @ ${e} (${s})`;return{author:o,bibtex:i,id:a,key:l,note:t,pdfLink:r,title:n,venue:e,year:s}},makeCVFPaper=async e=>{var t=await fetchCvfHTML(e),t=(new DOMParser).parseFromString(t.replaceAll("\n",""),"text/html"),r=t.getElementById("papertitle").innerText.trim(),a=t.querySelector("#authors i").innerText.split(",").map(e=>e.trim()).join(" and "),{year:i,id:o,conf:n}=parseCVFUrl(e);let s="";if(e.endsWith(".pdf"))s=e;else{let e=[...t.getElementsByTagName("a")].filter(e=>"pdf"===e.innerText)[0].getAttribute("href");(e=e.startsWith("../")?e.replaceAll("../",""):e).startsWith("/")||(e="/"+e),s="http://openaccess.thecvf.com"+e}var e=n,n=`Accepted @ ${e} (${i})`,t=bibtexToString(t.querySelector(".bibref").innerText),l=t.split("{")[1].split(",")[0];return{author:a,bibtex:t,id:o,key:l,note:n,pdfLink:s,title:r,venue:e,year:i}},makeOpenReviewBibTex=(e,t)=>{var r=e.content.title,a=e.content.authors.join(" and "),i=e.cdate?new Date(e.cdate).getFullYear():"0000",e=(e.cdate||log("makeOpenReviewBibTex: no cdate found in",e),e.content.authors[0].split(" ").last()),o="";return o+`@inproceedings{${e=(e+=i)+firstNonStopLowercase(r)},
`+`title={${r}},
`+`author={${a}},
`+`year={${i}},
`+`url={${t}},
`+"}"},extractAPIv2ContentValue=e=>{var t,r,a={};let i=!1;for([t,r]of Object.entries(e.content))r&&r.value?(a[t]=r.value,i=!0):a[t]=r;return e.content=a,{isV2:i,paper:e}},makeOpenReviewPaper=async e=>{var t=await getOpenReviewNoteJSON(e),r=await getOpenReviewForumJSON(e);if(403===t.status&&"ForbiddenError"===t.name)throw logError(dedent(`Error parsing OpenReview url ${e}. Most likely because this entry is protected and you do not have the rights to access it. 1/ Make sure you are logged in. 2/ Alternatively, this may be due to OpenReview changing the visibility of this paper. Try accessing this URL manually to make sure.`)),Error(t.message);if(404===t.status&&"NotFoundError"===t.name)throw logError(dedent(`Error parsing OpenReview url ${e}.`)),Error(t.message);var t=t.notes[0],a=!1,r=r.notes,i=({isV2:a,paper:t}=extractAPIv2ContentValue(t),t.content.title),o=(t.content.authors||t.content.authors.value).join(" and "),n=bibtexToString(t.content._bibtex||makeOpenReviewBibTex(t,e)),s=bibtexToObject(n),l=s.citationKey,s=s.year;let p;p=t.pdf?"https://openreview.net/pdf?id="+t.id:(t.html||e).replace("/forum?id=","/pdf?id=");e=t.invitation?.split("/")||t.domain.split("/");let c=e[0].split(".")[0],d=e.slice(1).join("/").split("-")[0].replaceAll("/"," ").replace(" Conference",""),u=c,h=!1;global.overrideORConfs.hasOwnProperty(c)&&(u=global.overrideORConfs[c],h=!0),h&&(d=d.replace(u,""),c=u);e=(c+" "+d).replace(/ \d\d\d\d/g,"").replace(/\s\s+/g," "),t=`OR-${c}-${s}_`+t.id;let f,m,g,y="";return(f=a?r.filter(e=>e?.content?.recommendation?.value):r.filter(e=>-1<["Final Decision","Paper Decision","Acceptance Decision"].indexOf(e?.content?.title)))&&0<f.length&&(m=(m=a?f[0].content.recommendation.value:f[0].content.decision).split(" ").map((e,t)=>0===t?cleanStr(e)+"ed":e).join(" "),g=m+` @ ${e} (${s})`,m.toLowerCase().indexOf("rejected")<0)&&(y=e),{author:o,bibtex:n,id:t,key:l,note:g="Anonymous"===o&&"Rejected"!=m?`Under review @ ${e} (${s}) (${(new Date).toLocaleDateString()})`:g,pdfLink:p,title:i,venue:y,year:s}},makeBioRxivPaper=async e=>{var t=e.replace(".full.pdf",""),r="https://api.biorxiv.org//details/biorxiv/"+e.split("/").slice(-2).join("/").replace(".full.pdf","").split("v")[0],a=await fetch(r).then(e=>e.json());if("ok"!==a.messages[0].status)throw new Error(r+" returned "+a.messages[0].status);var r=a.collection.last(),a=await fetchText(t),t=(new DOMParser).parseFromString(a.replaceAll("\n",""),"text/html").querySelector(".bibtext a").getAttribute("href"),a=bibtexToString(await(await fetch(t)).text()),t=extractAuthor(a),i=await parseIdFromUrl(e),o=a.split("\n")[0].split("{")[1].replace(",","").trim();return{author:t,bibtex:a,id:i,key:o,note:"",pdfLink:cleanBiorxivURL(e)+".full.pdf",title:r.title,venue:"",year:r.date.split("-")[0]}},makePMLRPaper=async e=>{var t=e.split("/").last().split(".")[0],r=await parseIdFromUrl(e),e=e.includes(".html")?e:e.split("/").slice(0,-2).join("/")+`/${t}.html`,a=e.replace(".html","")+`/${t}.pdf`,e=await fetchDom(e),i=e.getElementById("bibtex").innerText.replaceAll("\t"," ").replaceAll(/\s\s+/g," ");let o=i;for(const p of i.match(/,\ ?\w+ ?= ?{/g))o=o.replace(p,p.replace(", ",",\n    ").replace(" = ","="));o.endsWith("}}")&&(o=o.slice(0,-2)+"}\n}"),o=bibtexToString(o);var i=extractAuthor(o),e=e.getElementsByTagName("h1")[0].innerText,n=extractBibtexValue(o,"year");let s=extractBibtexValue(o,"booktitle").replaceAll("Proceedings of the",""),l=s;note=`Accepted @ ${l} (${n})`;for(const c in global.overridePMLRConfs)if(s.includes(c)){l=global.overridePMLRConfs[c],s=l+" "+n,note="Accepted @ "+s;break}return{author:i,bibtex:o,id:r,key:t,note:note,pdfLink:a,title:e,venue:l,year:n}},findACLValue=(e,t)=>{return queryAll("dt",e).filter(e=>e.innerText.includes(t))[0].nextElementSibling.innerText},makeACLPaper=async e=>{e=e.replace(".pdf","");var t,r,a,i,o,n,e=await fetchDom(e),s=e.getElementById("citeBibtexContent");if(s)return t=e.getElementById("title").innerText,s=bibtexToString(s.innerText),r=(i=bibtexToObject(s)).year,a=i.author.replace(/\s+/g," ").split(" and ").map(e=>e.split(",").map(e=>e.trim()).reverse().join(" ")).join(" and "),i=i.citationKey,o=findACLValue(e,"Venue"),n=findACLValue(e,"PDF"),{author:a,bibtex:s,id:`ACL-${o}-${r}_`+findACLValue(e,"Anthology ID"),key:i,note:`Accepted @ ${o} (${r})`,pdfLink:n,title:t,venue:o,year:r}},makePNASPaper=async e=>{e=e.replace(".full.pdf","").replace(/\/doi\/e?pdf\//,"/doi/abs/");var t=await fetchDom(e),r=t.getElementsByTagName("h1")[0].innerText,a=queryAll(".authors span[property='author'] a:not([property='email']):not(.orcid-id)",t).filter(e=>!e.getAttribute("href").includes("mailto:")).map(e=>e.innerText).join(" and "),i=t.querySelector("span[property='datePublished']").innerText.match(/\d{4}/g)[0],o=`PNAS-${i}_`+(e.endsWith("/")?e.split("/").slice(-2):e.split("/").slice(-1))[0],e=e.includes("/doi/pdf/")||e.includes("/doi/epdf/")?e.replace("/doi/epdf/","/doi/pdf/"):e.replace("/doi/abs/","/doi/pdf/").replace("/doi/full/","/doi/pdf/"),t=[...t.querySelector(".core-container").getElementsByTagName("a")].map(e=>e.getAttribute("href")).filter(e=>e?.includes("https://doi.org"))[0].split("/").slice(-2).join("/"),n="doi:"+t;return{author:a,bibtex:bibtexToString(`@article{${n}, author={${a}}, title={${r}}, journal = {Proceedings of the National Academy of Sciences}, year={${i}}, doi={${t}}, eprint={${e}}, URL={${e.replace("/doi/pdf/","/doi/abs/")}} }`),id:o,key:n,note:`Published @ PNAS (${i})`,pdfLink:e,title:r,venue:"PNAS",year:i}},makeNaturePaper=async e=>{var t=(e=e.replace(".pdf","").split("#")[0])+".pdf",r=e.split("/").last(),e=await fetchDom(e),a=e.querySelector("h1.c-article-title").innerText,i=queryAll("ul.c-article-author-list li",e).map(e=>e.innerText.replace(/(\ ?,)|&||\d/g,"").split(/orcid/i)[0].trim()).filter(e=>0<e.length).join(" and "),o=e.querySelector(".c-article-info-details").innerText.match(/\(\d{4}\)/)[0].replace(/\(|\)/g,""),n=e.querySelector(".c-article-info-details [data-test]").innerText,r=`Nature-${o}_`+r;let s;for(const p of[".c-bibliographic-information__citation",".c-bibliographic-information__value"])if(s=document.querySelector(p)?.innerText.split("https://doi.org/")[1])break;s=s||[...e.getElementsByTagName("span")].map(e=>e.innerText).filter(e=>e.includes("https://doi.org"))[0];var e=""+i.split(" ")[1]+o+firstNonStopLowercase(a),l={citationKey:e,entryType:"article",author:i,title:a,journal:n,year:o},l=(s&&(l.doi=s,l.url="https://doi.org/"+s),bibtexToString(l));return{author:i,bibtex:l,id:r,key:e,note:`Published @ ${n} (${o})`,pdfLink:t,title:a,venue:n,year:o}},makeACSPaper=async e=>{var e=(e=e.replace("pubs.acs.org/doi/pdf/","pubs.acs.org/doi/").split("?")[0]).replace("/abs/","/").split("/doi/")[1],t=`https://pubs.acs.org/action/downloadCitation?doi=${e}&include=cit&format=bibtex&direct=true`,t=await fetchText(t),r=bibtexToObject(t),a=r.author.replaceAll("\n","").trim(),i=r.title.trim(),o=r.year.trim(),n=r.citationKey.trim(),s="https://pubs.acs.org/doi/pdf/"+e,l=`Published @ ${r.journal} (${r.year})`;return{author:a,bibtex:t,id:"ACS_"+e.replaceAll(".","").replaceAll("/",""),key:n,note:l,pdfLink:s,title:i,venue:r.journal,year:o}},makeIOPPaper=async e=>{(e=e.split("#")[0]).endsWith("/pdf")&&(e=e.slice(0,-4));var t=await fetchDom(e),t=queryAll(".btn-multi-block a",t).filter(e=>"BibTeX"===e.innerText).map(e=>e.getAttribute("href"))[0],t="https://"+parseUrl(e).host+t,t=await fetchText(t),r=bibtexToObject(t),a=r.author.replaceAll("\n","").trim(),i=r.title.trim(),o=r.year.trim(),n=r.citationKey.trim(),s=e+"/pdf",r=r.journal,l=`Published @ ${r} (${o})`,e=e.split("/article/").last().split("/meta")[0];return{author:a,bibtex:t,id:"IOPscience_"+miniHash(e),key:n,note:l,pdfLink:s,title:i,venue:r,year:o}},makeJMLRPaper=async e=>{var t=(e=(e=(e=e.includes("/papers/volume")?e.replace("/papers/volume","/papers/v"):e).endsWith(".pdf")?e.split("/").slice(0,-1).join("/"):e).replace(".html","")).split("/").last(),r=e+".bib",r=await fetchText(r),{author:a,year:i,title:o,citationKey:n}=bibtexToObject(r);return{author:a,bibtex:r,id:`JMLR-${i}_`+t,key:n.trim(),note:`Published @ JMLR (${i})`,pdfLink:e.replace("/papers/v","/papers/volume")+`/${t}.pdf`,title:o,venue:"JMLR",year:i}},makePMCPaper=async e=>{var t=e.match(/PMC\d+/)[0].replace("PMC",""),r=e.split("PMC"+t)[0]+"PMC"+t,a=await(await fetch(`https://api.ncbi.nlm.nih.gov/lit/ctxp/v1/pmc/?format=csl&id=${t}&download=true`)).json(),i=a["epub-date"]?a["epub-date"]["date-parts"][0][0]+"":a.issued["date-parts"][0][0]+"",o=a.author.map(e=>e.given+" "+e.family).join(" and "),n=a["container-title"].split(" ").map(e=>e.capitalize()).join(" "),s=a.title,t=`PMC-${i}_`+t,l=a.author[0].family+i+firstNonStopLowercase(s);let p;return{author:o,bibtex:bibtexToString({entryType:"article",citationKey:l,journal:n,issn:a.ISSN,volume:a.volume,page:a.page,doi:a.DOI,PMID:a.PMID,PMCID:a.PMCID,publisher:a.publisher,author:o,title:s}),id:t,key:l,note:`Published @ ${n} (${i})`,pdfLink:p=isPdfUrl(e)?e:r+"/pdf",title:s,venue:n,year:i}},makePubMedPaper=async e=>{var e=[...(await fetchDom(e.split("?")[0])).getElementsByTagName("meta")].filter(e=>e.getAttribute("name")?.includes("citation_")),e=Object.fromEntries(e.map(e=>[e.getAttribute("name").replace("citation_",""),e.getAttribute("content")])),t=document.querySelector("div.authors-list").innerText.replace(/\d/gi,"").split(",").map(e=>e.trim()).join(" and "),r=e.title,a=e.journal_title,i=e.date.split("/")[2],o=`PubMed-${i}_`+e.pmid,n=""+t.split(" and ")[0].split(" ").last()+i+firstNonStopLowercase(e.title),e={entryType:"article",citationKey:n,publisher:e.publisher,doi:e.doi,issn:e.issn,journal:a,year:i,author:t};return{author:t,bibtex:bibtexToString(e),id:o,key:n,note:`Accepted @ ${journal} (${i})`,pdfLink:"",title:r,venue:a,year:i}},makeIJCAIPaper=async e=>{var t=e.endsWith(".pdf")?e.replace(".pdf","").split("/").last().match(/[1-9]\d*/)[0]:e.split("/").last(),e=e.match(/proceedings\/\d+/gi)[0].split("/")[1],r=(await fetchText(`https://www.ijcai.org/proceedings/${e}/bibtex/`+t)).replace(/}\n/gi,"},\n"),a=bibtexToObject(r.split("\n").filter(e=>!/note\s+=/gi.test(e)).join("\n")),i=a.citationKey,o=a.title;return{author:flipAndAuthors(a.author),bibtex:r,id:`IJCAI-${e}_`+t,key:i,note:`Accepted @ IJCAI (${e})`,pdfLink:`https://www.ijcai.org/proceedings/${e}/${t.padStart(4,0)}.pdf`,title:o,venue:"IJCAI",year:e}},makeACMPaper=async e=>{let t;e=noParamUrl(e),t=isPdfUrl(e)?e:e.replace(/\/doi\/?(abs|full)?\//,"/doi/pdf/");var r=await fetchDom(e.replace("/doi/pdf/","/doi/"));let a,i,o,n,s,l,p,c;var d=extractDataFromDCMetaTags(r),r=(d?{author:a,year:i,title:o,venue:n,key:s,doi:l,bibtex:p,note:c}=d:(o=r.querySelector(".citation__title").innerText,a=queryAll("ul[ariaa-label='authors'] li.loa__item .loa__author-name",r).map(e=>e.innerText.replace(",","").trim()).join(" and "),d=r.querySelector(".issue-item__detail a").innerText,n=d.split("'")[0].trim(),i="20"+d.split("'")[1].split(":")[0].trim(),l=t.split("/doi/pdf/")[1],c=`Accepted @ ${n} (${i})`,s=l,p=bibtexToString({entryType:"article",citationKey:l,journal:n,author:a,title:o,year:i,publisher:"Association for Computing Machinery",address:"New York, NY, USA",url:noParamUrl(e).replace("/doi/pdf/","/doi/")})),`ACM-${i}_`+miniHash(l));return{author:a,bibtex:p,id:r,key:s,note:c,pdfLink:t,title:o,venue:n,year:i}},makeIEEEPaper=async e=>{isPdfUrl(e)&&(e=`https://ieeexplore.ieee.org/document/${e.split("/stamp/stamp.jsp?tp=&arnumber=")[1].match(/\d+/)[0]}/`);var t=await fetchDom(e),t=JSON.parse([...t.getElementsByTagName("script")].filter(e=>e.innerHTML?.includes("metadata="))[0].innerHTML.split("metadata=")[1].split(/};\s*/)[0]+"}"),r=t.title,a=t.authors.map(e=>e.name).join(" and "),i=t.publicationYear,e=""+parseUrl(e).origin+t.pdfUrl,o=t.publicationTitle,n=t.articleId;return{author:a,bibtex:bibtexToString({entryType:"article",citationKey:n,journal:o,volume:t.volume,pages:t.startPage+"-"+t.endPage,doi:t.doi,title:r,year:i,author:a}),id:`IEEE-${i}_`+n,key:n,note:`Accepted @ ${o} (${i})`,pdfLink:e,title:r,venue:o,year:i}},makeSpringerPaper=async t=>{var e=[...global.sourceExtras.springer.types,"content/pdf"],r=e.find(e=>t.includes(`/${e}/`));if(!r)throw new Error(`Could not find Springer type for ${t} (known: ${e.join(", ")})`);var a,i,o,n,s,l,e=t.split(`/${r}/`)[1].split("?")[0].replace(".pdf",""),p=(await fetchCrossRefDataForDoi(e))["data"];if(p)return{author:a,bibtex:i,citationKey:o,year:n,title:s,venue:l}=p,{author:a,bibtex:i,id:`Springer-${n}_`+miniHash(e),key:o,note:`Published @ ${l} (${n})`,pdfLink:p.pdf??("content/pdf"===r?t:t.replace(`/${r}/`,"/content/pdf/")+".pdf"),title:s,venue:l,year:n,extra:{url:"https://doi.org/"+e}};throw new Error("Aborting Springer paper parsing, see error above")},makeAPSPaper=async e=>{e=e.split("#")[0];var[t,r]=parseUrl(e).pathname.split("/").slice(1,3),a=e.split(`/${t}/${r}/`).last(),i=e.replace(`/${t}/${r}/`,`/${t}/export/`),i=await fetchText(i+"?type=bibtex&download=true"),o=bibtexToObject(i),e=e.replace(`/${t}/${r}/`,`/${t}/pdf/`),r=`APS-${o.year}_`+miniHash(a),t=o.journal??o.publisher,a=(await readJournalAbbreviations(),global.journalAbbreviations[miniHash(t)]??t),t=`Published @ ${a} (${o.year})`;return{author:flipAndAuthors(o.author),bibtex:i,id:r,key:o.citationKey,note:t,pdfLink:e,title:o.title,venue:a,year:o.year}},makeWileyPaper=async e=>{var e=e.replace(/\/doi\/(abs|epdf|full)\//g,"/doi/pdf/"),t=e.replace("/doi/pdf/","/doi/abs/"),t=await fetchDom(t),r=queryAll("meta[name=citation_author]",t).map(e=>e.getAttribute("content")).join(" and "),a=t.querySelector("meta[name=citation_journal_title]").getAttribute("content"),i=t.querySelector("meta[name=citation_title]").getAttribute("content"),o=t.querySelector("meta[name=citation_publisher]").getAttribute("content"),n=t.querySelector("meta[name=citation_publication_date]")?.getAttribute("content")?.split("/")[0]??t.querySelector("meta[name=citation_online_date]")?.getAttribute("content")?.split("/")[0],t=t.querySelector("meta[name=citation_doi]").getAttribute("content"),s=`Published @ ${a} (${n})`,l=`Wiley-${n}_`+miniHash(t);return{author:r,bibtex:bibtexToString({citationKey:t,entryType:"article",title:i,author:r,year:n,doi:t,publisher:o,journal:a}),id:l,key:t,note:s,pdfLink:e,title:i,venue:a,year:n}},makeScienceDirectPaper=async e=>{var e=e.split("/pii/")[1].split("/")[0].split("#")[0].split("?")[0],t=await fetchText(`https://www.sciencedirect.com/sdfe/arp/cite?pii=${e}&format=text%2Fx-bibtex&withabstract=false`),{author:r,journal:a,year:i,title:o,citationKey:n}=bibtexToObject(t),s=`Published @ ${a} (${i})`;return{author:r,bibtex:t,id:`ScienceDirect-${i}_`+miniHash(e),key:n,note:s,pdfLink:"https://reader.elsevier.com/reader/sd/pii/"+e,title:o,venue:a??"Science Direct",year:i}},makeSciencePaper=async e=>{let t,r,a,i,o,n,s,l,p,c,d;n="https://science.org/doi/pdf/"+(c=(c=noParamUrl(e).split("/doi/")[1]).startsWith("10.")?c:c.split("/").slice(1).join("/")),d="https://science.org/doi/full/"+c;var e=(await fetchCrossRefDataForDoi(c))["data"];return e?({author:t,bibtex:r,title:s,venue:l,year:p}=e,i=e.citationKey,o=`Published @ ${l} (${p})`):(e=await fetchDom(d),{author:t,year:p,publisher,title:s,venue:l,key:i,bibtex:r,note:o}=extractDataFromDCMetaTags(e)),a=`Science-${p}_`+miniHash(c),{author:t,bibtex:r,id:a,key:i,note:o,pdfLink:n,title:s,venue:l,year:p}},makeFrontiersPaper=async e=>{e=e.replace(/\/pdf$/,"/full");var t=noParamUrl(e).split("/articles/")[1].split("/full")[0],r=await fetchText(`https://www.frontiersin.org/articles/${t}/bibTex`),r=Object.fromEntries(Object.entries(bibtexToObject(r)).map(([e,t])=>["citationKey"===e||"entryType"===e?e:e.toLowerCase(),t])),{author:a,journal:i,year:o,title:n,citationKey:s}=(r.author=flipAndAuthors(r.author),delete r.abstract,r),l=`Published @ ${i} (${o})`;return{author:a,bibtex:bibtexToString(r),id:`Frontiers-${o}_`+miniHash(t),key:s,note:l,pdfLink:e.replace(/\/full$/,"/pdf"),title:n,venue:i,year:o}},makeIHEPPaper=async t=>{let r,a;if(t.includes("/files/")){const u=t.split("/files/")[1].split("/")[0];var i="https://inspirehep.net/api/literature?q=documents.key:"+u,i=(await fetchJSON(i)).data;if(!(r=i.hits.hits.find(e=>!!e.metadata.documents.find(e=>e.key===u))))return void warn("Could not find an Inspire HEP record for the url",t);a=r.metadata.control_number}else a=t.match(/\/literature\/(\d+)/)[1];if(a){var i=await fetchText(`https://inspirehep.net/api/literature/${a}?format=bibtex`),o=(r||({data:r}=await fetchJSON(`https://inspirehep.net/api/literature/${a}?format=json`)),bibtexToObject(i));let e=o.title??r.metadata.titles[0].title;e.startsWith("{")&&e.endsWith("}")&&(e=e.slice(1,-1));var n=r.metadata.documents?.[0]?.url??t,s=flipAndAuthors(o.author),l=o.year??r.created.split("-")[0],p="IHEP-"+a,c=o.journal??"Inspire HEP",d=o.citationKey,o=o.doi??"";return{author:s,bibtex:i,id:p,key:d,note:`Published @ ${c} (${l})`,pdfLink:n,title:e,venue:c,year:l,doi:o}}warn("Could not find an Inspire HEP id for the url",t)},makePLOSPaper=async e=>{var t=e.split("?id=").last().split("&")[0],{bibtex:r,key:a,author:i,venue:o,title:n,note:s,year:l}=await fetchBibtex(e.split("/article")[0]+"/article/citation/bibtex?id="+t),p=e.split("/article")[0]+`/article/file?id=${t}&type=printable`,e=e.split("journals.plos.org/")[1].split("/")[0];return{author:flipAndAuthors(i),bibtex:r,id:`PLOS-${e}_`+miniHash(t),key:a,note:s,pdfLink:p,title:n,venue:o,year:l,doi:t}},makeRSCPaper=async e=>{var t=noParamUrl(e).split("/").last(),r=e.split("/").find(e=>"articlehtml"===e||"articlepdf"===e||"articlelanding"===e).replace("article",""),e="articlepdf"===r?e:e.replace(`/article${r}/`,"/articlepdf/"),{bibtex:r,key:a,author:i,venue:o,title:n,note:s,year:l,doi:p}=await fetchBibtex(`https://pubs.rsc.org/en/content/formatedresult?markedids=${t}&downloadtype=article&managertype=bibtex`);return{author:flipAndAuthors(i),bibtex:r,id:`RSC-${o.replaceAll(" ","")}_`+miniHash(t),key:a,note:s,pdfLink:e,title:n,venue:o,year:l,doi:p}},makeWebsitePaper=async e=>{var t=e.url,r=await fetchDom(t),r=Object.fromEntries([...r.querySelectorAll("meta")].filter(e=>e.getAttribute("property")).filter(e=>e.getAttribute("property").startsWith("og:")).map(e=>[e.getAttribute("property").replace("og:",""),e.getAttribute("content")])),a=r.site_name||parseUrl(t).hostname.replace("www.","").capitalize(),i=(new Date).getFullYear()+"",o="Website_"+urlToWebsiteId(t),n=r.description||"",s=t,r=r.title||e.title,e=miniHash(a)+i+firstNonStopLowercase(r),t=`@misc{${e}, author = {${a}}, title = {${r}}, year = {${i}}, url = {${t}}, note = {Accessed ${(new Date).toISOString().split("T")[0]}} }`;return{author:a,bibtex:bibtexToString(bibtexToObject(t)),id:o,key:e,note:n,pdfLink:s,title:r,venue:"",year:i}},makeMDPIPaper=async e=>{(e=(e=(e=noParamUrl(e)).split("/").last().startsWith("pdf")?e.split("/").slice(0,-1).join("/"):e).endsWith("/notes")?e.replace("/notes",""):e).endsWith("/reprints")&&(e=e.replace("/reprints",""));var t=await fetchDom(e),{author:t,year:r,title:a,venue:i,key:o,doi:n,bibtex:s,note:l,pdfLink:p}=extractDataFromDCMetaTags(t);return{author:t,bibtex:s,id:`MDPI-${r}_`+miniHash(e.split("mdpi.com/")[1]),key:o,note:l,pdfLink:p,title:a,venue:i,year:r,doi:n}},makeOUPPaper=async e=>{var t=(e=noParamUrl(e)).split("/").last(),t=await fetchText(`https://academic.oup.com/Citation/Download?resourceId=${t}&resourceType=3&citationFormat=2`),r=bibtexToObject(t),{title:r,year:a,author:i,journal:o,doi:n,citationKey:s,eprint:l}=(delete r.abstract,t=bibtexToString(r),r),i=flipAndAuthors(i),p=`Published @ ${o} (${a})`,c=e.split("https://academic.oup.com/")[1].split("/").slice(2).join("");return{author:i,bibtex:t,id:`OUP-${a}_`+miniHash(c),key:s,note:p,pdfLink:l?.replaceAll("\\","")??e,title:r,venue:o,year:a,doi:n}},makerHALPaper=async e=>{var t=(e=noParamUrl(e).replace(/(hal\.science\/\w+-\d+)(v\d+)?(\/document)?/,"$1")).split("/").last(),r=`https://hal.science/${t}/bibtex`,r=await fetchText(r),a=bibtexToObject(r),{title:i,year:o,journal:n,author:s,doi:l,pdf:p}=a,c=n?`Published @ ${n} (${o})`:"",a=a.citationKey;return{author:flipAndAuthors(s),bibtex:bibtexToString(r),id:`HAL-${o}_`+miniHash(t),key:a,note:c,pdfLink:p??e,title:i,venue:n,year:o,doi:l}},tryPWCMatch=async e=>{let t;var r={type:"papersWithCode",pwcPrefs:await getStorage("pwcPrefs")??{},paper:e},{url:r,note:a,venue:i,pubYear:o}=await sendMessageToBackground(r)??{};return r&&!e.codeLink?log("[PapersWithCode] Discovered a code repository:",r):log("[PapersWithCode] No code repository found"),i&&!e.venue?(log("[PapersWithCode] Found a publication venue:",i),e=bibtexToObject(e.bibtex),t=bibtexToString({...e,year:o,journal:i})):log("[PapersWithCode] No publication found"),{codeLink:r,note:a,venue:i,bibtex:t}},tryCrossRef=async e=>{try{var t="https://api.crossref.org/works?rows=1&mailto=schmidtv%40mila.quebec&select=event%2Ctitle&query.title="+encodeURI(e.title),r=await fetch(t).then(e=>e.json());if("ok"!==r.status)return log(`[Crossref] ${t} returned `+r.message.status),{note:null};if(0===r.message.items.length)return{note:null};if(r.message.items[0].title[0]?.toLowerCase().replaceAll("\n"," ").replaceAll(/\s\s+/g," ")!==e.title.toLowerCase().replaceAll("\n"," ").replaceAll(/\s\s+/g," "))return{note:null};if(!r.message.items[0].event||!r.message.items[0].event.name)return{note:null};info("Found a CrossRef match");var a=r.message.items[0].event.name.trim();return{venue:a,note:`Accepted @ ${a} -- [crossref.org]`}}catch(e){return logError("[Crossref]",e),{note:null}}},tryDBLP=async e=>{try{var t=encodeURI(e.title),r=await fetch(`https://dblp.org/search/publ/api?q=${t}&format=json`);if(429===r.status)return{note:null,status:429};var a,i,o,n,s=await r.json();if(s.result&&s.result.hits&&s.result.hits.hit&&s.result.hits.hit.length)for(const l of s.result.hits.hit.sort((e,t)=>parseInt(e.info.year,10)-parseInt(t.info.year,10)))if(decodeHtml(l.info.title?.toLowerCase().replaceAll("\n"," ").replaceAll(".","").replaceAll(/\s\s+/g," "))===e.title.toLowerCase().replaceAll("\n"," ").replaceAll(".","").replaceAll(/\s\s+/g," ")&&"CoRR"!==l.info.venue)return info("Found a DBLP match"),a=await fetchText(l.info.url+".bib"),i=miniHash(l.info.venue),await readJournalAbbreviations(),o=(global.journalAbbreviations[i]??l.info.venue).trim(),n=l.info.year,l.info.url,{venue:o,note:`Accepted @ ${o} ${n} -- [dblp.org]`,bibtex:a};return{note:null}}catch(e){return logError("[DBLP]",e),{note:null}}},trySemanticScholar=async t=>{try{var{data:e,status:r}=await fetchJSON(`https://api.semanticscholar.org/graph/v1/paper/search?query=${encodeURI(t.title)}&fields=title,venue,year,authors,externalIds,url&limit=50`);if(e&&e.data&&0<e.data.length)for(const l of e.data)if(miniHash(l.title)===miniHash(t.title)&&Math.abs(l.year-t.year)<3&&l.venue&&!l.venue.toLowerCase().includes("arxiv")&&!l.venue.toLowerCase().includes("biorxiv")){info("Found a Semantic Scholar match");let e=l.venue.trim().replace(/^\d{4}/,"").trim();e.indexOf(" ")<0&&(e=e.toUpperCase());var a=(l.year+"").trim(),i=`Accepted @ ${e} (${a}) -- [semanticscholar.org]`,o=l.authors.map(e=>e.name).join(" and "),n=l.externalIds.DOI,s=bibtexToString({entryType:"article",citationKey:miniHash(l.authors[0].name.split(" ").last())+a+firstNonStopLowercase(t.title),title:t.title,author:o,journal:e,year:a,doi:n,bibSource:"Semantic Scholar "+l.url});return{venue:e,note:i,bibtex:s,status:r}}}catch(e){logError("[SemanticScholar]",e)}},tryGoogleScholar=async e=>{return await sendMessageToBackground({type:"google-scholar",paper:e})},tryUnpaywall=async t=>{var e=`https://api.unpaywall.org/v2/search?query=${encodeURI(t.title)}&is_oa=true&email=papermemory+${parseInt(1e3*Math.random())}@gmail.com`,{data:e,status:r}=await fetchJSON(e);if(e&&200===r){r=e.results?.find(e=>miniHash(e.response.title)===miniHash(t.title));if(r&&r.journal_name)return{venue:e=r.journal_name,note:`Accepted @ ${e} (${r.year}) -- [unpaywall.org]`,doi:r.doi}}},tryPreprintMatch=async(e,t=!1)=>{let r,a,i,o,n;var s,l,p={},c=["DBLP","SemanticScholar","CrossRef","GoogleScholar","Unpaywall"],d=[silentPromiseTimeout(tryGoogleScholar(e)),silentPromiseTimeout(trySemanticScholar(e)),silentPromiseTimeout(tryCrossRef(e)),silentPromiseTimeout(tryDBLP(e)),silentPromiseTimeout(tryUnpaywall(e))];t&&(d.push(silentPromiseTimeout(tryPWCMatch(e))),c.push("PapersWithCode"));for([s,l]of Object.entries(c)){if(p[l]=await d[s],{note:r,venue:a,bibtex:i,doi:n}=p[l]??{},r)break;log(`[${l}] No publication found`)}return t&&(p.hasOwnProperty(c="PapersWithCode")||(p[c]=await d[c]),p[c].codeLink)&&!e.codeLink&&(o=p[c].codeLink),{note:r,venue:a,bibtex:i,code:o,doi:n}},initPaper=async e=>{e.note||(e.note=""),e.md=`[${e.title}](${e.pdfLink})`,e.tags=[],e.codeLink=e.codeLink??"",e.favorite=!1,e.favoriteDate="",e.addDate=(new Date).toJSON(),e.lastOpenDate=e.addDate,e.count=1,e.code={};for(const t in e)e.hasOwnProperty(t)&&"string"==typeof e[t]&&(e[t]=e[t].trim());return e=await autoTagPaper(e),validatePaper(e),e},autoTagPaper=async r=>{try{var e,a,i=await getStorage("autoTags");if(i&&i.length){let t=new Set;for(const o of i)o.tags?.length&&(o.title||o.author)&&(e=!o.title||new RegExp(o.title,"i").test(r.title),a=!o.author||new RegExp(o.author,"i").test(r.author),e)&&a&&o.tags.forEach(e=>t.add(e));r.tags=[...t].sort(),r.tags.length&&log("Automatically adding tags:",r.tags)}return r}catch(e){return log("Error auto-tagging:",e),log("Paper:",r),r}},makePaper=async(e,t,r=!1)=>{let a;if(r)(a=await makeWebsitePaper(r))&&(a.source="website");else if(e.arxiv)(a=await makeArxivPaper(t))&&(a.source="arxiv");else if(e.neurips)(a=await makeNeuripsPaper(t))&&(a.source="neurips");else if(e.cvf)(a=await makeCVFPaper(t))&&(a.source="cvf");else if(e.openreview)(a=await makeOpenReviewPaper(t))&&(a.source="openreview");else if(e.biorxiv)(a=await makeBioRxivPaper(t))&&(a.source="biorxiv");else if(e.pmlr)(a=await makePMLRPaper(t))&&(a.source="pmlr");else if(e.acl)(a=await makeACLPaper(t))&&(a.source="acl");else if(e.pnas)(a=await makePNASPaper(t))&&(a.source="pnas");else if(e.nature)(a=await makeNaturePaper(t))&&(a.source="nature");else if(e.acs)(a=await makeACSPaper(t))&&(a.source="acs");else if(e.iop)(a=await makeIOPPaper(t))&&(a.source="iop");else if(e.jmlr)(a=await makeJMLRPaper(t))&&(a.source="jmlr");else if(e.pmc)(a=await makePMCPaper(t))&&(a.source="pmc");else if(e.ijcai)(a=await makeIJCAIPaper(t))&&(a.source="ijcai");else if(e.acm)(a=await makeACMPaper(t))&&(a.source="acm");else if(e.ieee)(a=await makeIEEEPaper(t))&&(a.source="ieee");else if(e.springer)(a=await makeSpringerPaper(t))&&(a.source="springer");else if(e.aps)(a=await makeAPSPaper(t))&&(a.source="aps");else if(e.wiley)(a=await makeWileyPaper(t))&&(a.source="wiley");else if(e.sciencedirect)(a=await makeScienceDirectPaper(t))&&(a.source="sciencedirect");else if(e.science)(a=await makeSciencePaper(t))&&(a.source="science");else if(e.frontiers)(a=await makeFrontiersPaper(t))&&(a.source="frontiers");else if(e.ihep)(a=await makeIHEPPaper(t))&&(a.source="ihep");else if(e.plos)(a=await makePLOSPaper(t))&&(a.source="plos");else if(e.rsc)(a=await makeRSCPaper(t))&&(a.source="rsc");else if(e.mdpi)(a=await makeMDPIPaper(t))&&(a.source="mdpi");else if(e.oup)(a=await makeOUPPaper(t))&&(a.source="oup");else{if(!e.hal)throw new Error("Unknown paper source: "+JSON.stringify({is:e,url:t}));(a=await makerHALPaper(t))&&(a.source="hal")}if(void 0!==a)return initPaper(a)},findFuzzyPaperMatch=(e,t)=>{t=miniHash(t.title);return e.hasOwnProperty(t)?(e=e[t]).find(t=>!global.preprintSources.some(e=>t.toLowerCase().startsWith(e)))||e[0]:null};"undefined"!=typeof module&&null!=module.exports&&((dummyModule=module).exports={autoTagPaper:autoTagPaper,decodeHtml:decodeHtml,fetchArxivXML:fetchArxivXML,fetchCrossRefDataForDoi:fetchCrossRefDataForDoi,fetchCvfHTML:fetchCvfHTML,fetchDom:fetchDom,getOpenReviewForumJSON:getOpenReviewForumJSON,getOpenReviewNoteJSON:getOpenReviewNoteJSON,fetchSemanticScholarDataForDoi:fetchSemanticScholarDataForDoi,fetchText:fetchText,findACLValue:findACLValue,findFuzzyPaperMatch:findFuzzyPaperMatch,flipAndAuthors:flipAndAuthors,flipAuthor:flipAuthor,initPaper:initPaper,makeACLPaper:makeACLPaper,makeACMPaper:makeACMPaper,makeACSPaper:makeACSPaper,makeAPSPaper:makeAPSPaper,makeArxivPaper:makeArxivPaper,makeBioRxivPaper:makeBioRxivPaper,makeCVFPaper:makeCVFPaper,makeIEEEPaper:makeIEEEPaper,makeIJCAIPaper:makeIJCAIPaper,makeIOPPaper:makeIOPPaper,makeJMLRPaper:makeJMLRPaper,makeNaturePaper:makeNaturePaper,makeNeuripsPaper:makeNeuripsPaper,makeOpenReviewBibTex:makeOpenReviewBibTex,makeOpenReviewPaper:makeOpenReviewPaper,makePaper:makePaper,makePMCPaper:makePMCPaper,makePMLRPaper:makePMLRPaper,makePNASPaper:makePNASPaper,makePubMedPaper:makePubMedPaper,makePLOSPaper:makePLOSPaper,makeSpringerPaper:makeSpringerPaper,makeWileyPaper:makeWileyPaper,tryCrossRef:tryCrossRef,tryDBLP:tryDBLP,tryPreprintMatch:tryPreprintMatch,tryPWCMatch:tryPWCMatch,trySemanticScholar:trySemanticScholar,tryUnpaywall:tryUnpaywall});